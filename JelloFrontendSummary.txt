================================================================================
INICIO DEL ANÁLISIS DEL PROYECTO
================================================================================

Hola, soy un script automatizado. Este archivo contiene la estructura completa y el código fuente del proyecto solicitado.

NOTA IMPORTANTE: Este resumen excluye deliberadamente el contenido de los archivos de prueba (aquellos que contienen '.test' en su nombre). Sin embargo, estos archivos SÍ aparecen en la estructura de directorios a continuación para mantener la integridad del árbol del proyecto.

--------------------------------------------------------------------------------
SECCIÓN 1: ESTRUCTURA DE ARCHIVOS Y DIRECTORIOS
--------------------------------------------------------------------------------

Jello-Frontend/
├── .gitignore
├── .swc
│   └── plugins
│       └── v7_windows_x86_64_0.106.15
├── app
│   ├── activity
│   │   └── page.tsx
│   ├── assistant
│   │   └── page.tsx
│   ├── auth
│   │   └── callback
│   │       └── page.tsx
│   ├── dashboard
│   │   └── page.tsx
│   ├── forgot-password
│   │   └── page.tsx
│   ├── globals.css
│   ├── landing
│   │   └── page.tsx
│   ├── layout.tsx
│   ├── notifications
│   │   └── page.tsx
│   ├── page.tsx
│   ├── profile
│   │   └── page.tsx
│   ├── project
│   │   └── [projectId]
│   │       └── page.tsx
│   ├── projects
│   │   ├── loading.tsx
│   │   ├── page.test.tsx
│   │   └── page.tsx
│   ├── reset-password
│   │   └── [token]
│   │       └── page.tsx
│   ├── search
│   │   └── page.tsx
│   ├── settings
│   │   ├── appearance
│   │   │   └── page.tsx
│   │   ├── integrations
│   │   │   └── page.tsx
│   │   ├── notifications
│   │   │   └── page.tsx
│   │   └── page.tsx
│   ├── tasks
│   │   └── page.tsx
│   ├── todos
│   │   └── page.tsx
│   ├── verification-failed
│   │   └── page.tsx
│   ├── verification-success
│   │   └── page.tsx
│   └── verify-email
│       └── page.tsx
├── components
│   ├── activity
│   │   ├── ActivityFeed.tsx
│   │   └── ActivityItem.tsx
│   ├── animated-background.tsx
│   ├── AuthGuard.tsx
│   ├── dashboard
│   │   ├── assigned-tasks-widget.tsx
│   │   ├── personal-todo-widget.tsx
│   │   └── recent-activity-widget.tsx
│   ├── forms
│   │   ├── assignee-selector.tsx
│   │   ├── color-selector.tsx
│   │   ├── image-upload-field.tsx
│   │   ├── label-manager.tsx
│   │   └── member-selector.tsx.tsx
│   ├── jelli-chat.tsx
│   ├── kanban
│   │   ├── kanban-board.tsx
│   │   └── kanban-column.tsx
│   ├── landing
│   │   ├── cta-section.tsx
│   │   ├── features-section-v2.tsx
│   │   ├── features-section.tsx
│   │   ├── hero-section-v2.tsx
│   │   ├── hero-section.tsx
│   │   └── testimonials-section.tsx
│   ├── layout
│   │   ├── app-layout.tsx
│   │   ├── mobileHeader.tsx
│   │   ├── public-layout.tsx
│   │   └── sidebar.tsx
│   ├── login-form.test.tsx
│   ├── login-form.tsx
│   ├── modals
│   │   ├── AddMemberModal.tsx
│   │   ├── AttachmentViewerModal.tsx
│   │   ├── CollaborateModal.tsx
│   │   ├── create-project-modal.test.tsx
│   │   ├── create-project-modal.tsx
│   │   ├── create-task-modal.tsx
│   │   ├── DeleteProjectConfirmModal.tsx
│   │   ├── DeleteTaskAlert.tsx
│   │   ├── DetailModal.tsx
│   │   ├── edit-project-modal.tsx
│   │   ├── InviteUserModal.tsx
│   │   ├── NotificationDetailModal.tsx
│   │   └── UserSearchModal.tsx
│   ├── notification-panel.tsx
│   ├── notifications
│   │   └── NotificationItem.tsx
│   ├── profile
│   │   └── SkillsEditor.tsx
│   ├── project-card.test.tsx
│   ├── project-card.tsx
│   ├── project-header.tsx
│   ├── register-form.test.tsx
│   ├── register-form.tsx
│   ├── search
│   │   └── SearchResultCard.tsx
│   ├── search-bar.tsx
│   ├── settings
│   │   └── settings-layout.tsx
│   ├── tasks
│   │   ├── attachment-list.tsx
│   │   ├── comment-section.tsx
│   │   ├── subtask-list.tsx
│   │   ├── task-card.test.tsx
│   │   ├── task-card.tsx
│   │   ├── task-modal.test.tsx
│   │   └── task-modal.tsx
│   ├── theme-provider.tsx
│   ├── ui
│   │   ├── accordion.tsx
│   │   ├── alert-dialog.tsx
│   │   ├── alert.tsx
│   │   ├── aspect-ratio.tsx
│   │   ├── avatar.tsx
│   │   ├── badge.tsx
│   │   ├── breadcrumb.tsx
│   │   ├── button.tsx
│   │   ├── calendar.tsx
│   │   ├── card.tsx
│   │   ├── carousel.tsx
│   │   ├── chart.tsx
│   │   ├── checkbox.tsx
│   │   ├── collapsible.tsx
│   │   ├── color-picker.tsx
│   │   ├── command.tsx
│   │   ├── context-menu.tsx
│   │   ├── date-picker.tsx
│   │   ├── dialog.tsx
│   │   ├── drawer.tsx
│   │   ├── dropdown-menu.tsx
│   │   ├── form.tsx
│   │   ├── hover-card.tsx
│   │   ├── icon.tsx
│   │   ├── index.ts
│   │   ├── input-otp.tsx
│   │   ├── input.tsx
│   │   ├── label.tsx
│   │   ├── language-switcher.tsx
│   │   ├── menubar.tsx
│   │   ├── modal.tsx
│   │   ├── navigation-menu.tsx
│   │   ├── pagination.tsx
│   │   ├── popover.tsx
│   │   ├── progress.tsx
│   │   ├── radio-group.tsx
│   │   ├── resizable.tsx
│   │   ├── scroll-area.tsx
│   │   ├── select.tsx
│   │   ├── separator.tsx
│   │   ├── sheet.tsx
│   │   ├── sidebar.tsx
│   │   ├── skeleton.tsx
│   │   ├── slider.tsx
│   │   ├── sonner.tsx
│   │   ├── spinner.tsx
│   │   ├── switch.tsx
│   │   ├── table.tsx
│   │   ├── tabs.tsx
│   │   ├── textarea.tsx
│   │   ├── toast.tsx
│   │   ├── toaster.tsx
│   │   ├── toggle-group.tsx
│   │   ├── toggle.tsx
│   │   ├── tooltip.tsx
│   │   ├── use-mobile.ts
│   │   └── use-toast.ts
│   └── user-menu.tsx
├── components.json
├── contexts
│   ├── auth-context.tsx
│   └── theme-context.tsx
├── hooks
│   ├── use-media-query.ts
│   ├── use-mobile.ts
│   ├── use-toast.ts
│   ├── useApi.test.tsx
│   ├── useApi.ts
│   └── useDebounce.ts
├── jest.config.mjs
├── jest.setup.js
├── lib
│   ├── api.ts
│   ├── skills.ts
│   └── utils.ts
├── messages
│   ├── en.json
│   └── es.json
├── next-env.d.ts
├── next.config.mjs
├── package.json
├── postcss.config.mjs
├── public
│   ├── images
│   ├── llm-worker.js
│   ├── Nuevo Text Document.svg
│   ├── placeholder-logo.svg
│   ├── placeholder.svg
│   └── site.webmanifest
├── README.md
├── styles
│   └── globals.css
├── tsconfig.json
└── types
    ├── global.d.ts
    └── index.ts


--------------------------------------------------------------------------------
SECCIÓN 2: CONTENIDO DE LOS ARCHIVOS
--------------------------------------------------------------------------------


############################## INICIO DEL ARCHIVO: .gitignore ##############################

# dependencies
/node_modules

# next.js
/.next/
/out/

# production
/build

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# env files
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

############################## FIN DEL ARCHIVO: .gitignore ##################################

############################## INICIO DEL ARCHIVO: app\activity\page.tsx ##############################

"use client"

import { useState, useEffect } from "react"
import { motion, AnimatePresence } from "framer-motion"
import { AppLayout } from "@/components/layout/app-layout"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Badge } from "@/components/ui/badge"
import { Checkbox } from "@/components/ui/checkbox"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Icon } from "@/components/ui/icon"
import { Progress } from "@/components/ui/progress"
import { Trash2, Plus, CheckSquare, AlertTriangle } from "lucide-react"
import { DatePicker } from "@/components/ui/date-picker"
import { useApi } from "@/hooks/useApi"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"
import { Todo } from "@/types" 
import * as React from "react"

const categories = ["All", "Work", "Personal", "Projects", "Health"]
const priorities = [
  { value: "All", label: "All" }, { value: "high", label: "High" },
  { value: "medium", label: "Medium" }, { value: "low", label: "Low" }
]

export default function PersonalTodosPage() {
  const { data: todos, isLoading, error, refetch } = useApi<Todo[]>('/todos');
  
  const [isAdding, setIsAdding] = useState(false)
  const [newTodoText, setNewTodoText] = useState("")
  const [newTodoPriority, setNewTodoPriority] = useState<Todo['priority']>("medium")
  const [newTodoCategory, setNewTodoCategory] = useState("Personal")
  const [newTodoDueDate, setNewTodoDueDate] = useState<Date | undefined>()

  const [filterCategory, setFilterCategory] = useState("All")
  const [filterPriority, setFilterPriority] = useState("All")
  const [showCompleted, setShowCompleted] = useState(true)
  const [isManaging, setIsManaging] = useState(false)

  const addTodo = async () => {
    if (!newTodoText.trim()) return;
    try {
      await apiClient.post('/todos', {
        text: newTodoText,
        priority: newTodoPriority,
        category: newTodoCategory,
        dueDate: newTodoDueDate?.toISOString()
      });
      toast.success("Todo added!");
      refetch(); // Recargamos la lista
      setNewTodoText(""); setNewTodoPriority("medium"); setNewTodoCategory("Personal"); setNewTodoDueDate(undefined);
      setIsAdding(false);
    } catch (err) {
      toast.error((err as Error).message);
    }
  }

  const toggleTodo = async (id: string, completed: boolean) => {
    try {
        await apiClient.put(`/todos/${id}`, { completed });
        toast.success(`Task ${completed ? 'completed' : 'reopened'}!`);
        refetch();
    } catch (err) {
        toast.error((err as Error).message);
    }
  }

  const deleteTodo = async (id: string) => {
     if (!window.confirm("Are you sure you want to delete this todo?")) return;
     try {
        await apiClient.del(`/todos/${id}`);
        toast.success("Todo deleted.");
        refetch();
     } catch (err) {
        toast.error((err as Error).message);
     }
  }

  const filteredTodos = React.useMemo(() => {
    return todos?.filter((todo) => {
        if (!showCompleted && todo.completed) return false
        if (filterCategory !== "All" && todo.category !== filterCategory) return false
        if (filterPriority !== "All" && todo.priority !== filterPriority.toLowerCase()) return false
        return true
      }) || [];
  }, [todos, showCompleted, filterCategory, filterPriority]);

  const completedCount = todos?.filter((todo) => todo.completed).length || 0;
  const totalCount = todos?.length || 0;
  const progressPercentage = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
  
  const getPriorityColor = (priority: string) => { /* ... */ };

  return (
    <AppLayout>
      <div className="p-6 max-w-4xl mx-auto space-y-6">
        {/* ... (Header y barra de progreso se mantienen igual) ... */}
        {/* ... (Formulario para añadir Todos se mantiene igual, pero ahora llama a `addTodo`) ... */}
        {isLoading ? (
            <div className="space-y-3">
                {Array.from({ length: 3 }).map((_, i) => <Skeleton key={i} className="h-20 w-full rounded-2xl" />)}
            </div>
        ) : error ? (
            <div className="text-center text-destructive"><AlertTriangle className="mx-auto mb-2" /> {error}</div>
        ) : (
          <div className="space-y-3">
            <AnimatePresence>
              {filteredTodos.map((todo) => (
                <motion.div key={todo._id} layout initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, x: -100 }} className="glass-card p-4 rounded-2xl">
                  <div className="flex items-center gap-4">
                    <Checkbox checked={todo.completed} onCheckedChange={(checked) => toggleTodo(todo._id, !!checked)} />
                    {/* ... (Resto del renderizado del todo se mantiene igual, usando deleteTodo) ... */}
                  </div>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>
        )}
      </div>
    </AppLayout>
  )
}



############################## FIN DEL ARCHIVO: app\activity\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\assistant\page.tsx ##############################

import { JelliChat } from "@/components/jelli-chat"
import { AppLayout } from "@/components/layout/app-layout"

export default function AssistantPage() {
  return (
    <AppLayout>
      <div className="h-full p-6">
        <div className="mb-6">
          <h1 className="text-3xl font-bold text-foreground mb-2">AI Assistant</h1>
          <p className="text-muted-foreground">Chat with Jelli, your intelligent productivity partner</p>
        </div>

        <div className="h-[calc(100vh-200px)]">
          <JelliChat />
        </div>
      </div>
    </AppLayout>
  )
}


############################## FIN DEL ARCHIVO: app\assistant\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\auth\callback\page.tsx ##############################

"use client";

// 1. Importa Suspense y saca el Spinner del return
import { Suspense } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { useAuth } from '@/contexts/auth-context';
import { Spinner } from '@/components/ui/spinner';
import { apiClient } from '@/lib/api';
import { UserProfile } from '@/types';
import * as React from 'react'; // Asegúrate de que React esté importado

// 2. Mueve toda la lógica a un nuevo componente "use client"
function CallbackClient() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const { revalidateUser } = useAuth();

  React.useEffect(() => {
    const token = searchParams.get('token');

    if (!token) {
      router.push('/');
      return;
    }

    localStorage.setItem('authToken', token);
    sessionStorage.removeItem('authToken');

    const fetchUserAndRedirect = async () => {
      try {
        await revalidateUser();
        router.push('/dashboard');
      } catch (error) {
        console.error("Error al validar token de social auth:", error);
        router.push('/');
      }
    };

    fetchUserAndRedirect();
    
  }, [searchParams, router, revalidateUser]);

  // 3. Este componente cliente renderiza el Spinner
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background">
      <Spinner size="lg" />
      <p className="mt-4 text-muted-foreground">Autenticando...</p>
    </div>
  );
}

// 4. La página principal (Server Component por defecto) envuelve al cliente en Suspense
export default function AuthCallbackPage() {
  const fallbackUI = (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background">
      <Spinner size="lg" />
      <p className="mt-4 text-muted-foreground">Autenticando...</p>
    </div>
  );

  return (
    <Suspense fallback={fallbackUI}>
      <CallbackClient />
    </Suspense>
  );
}

############################## FIN DEL ARCHIVO: app\auth\callback\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\dashboard\page.tsx ##############################

// app/dashboard/page.tsx

"use client"

import * as React from "react"
import Link from "next/link"
import { AppLayout } from "@/components/layout/app-layout"
import { AssignedTasksWidget } from "@/components/dashboard/assigned-tasks-widget"
import { PersonalTodoWidget } from "@/components/dashboard/personal-todo-widget"
import { RecentActivityWidget } from "@/components/dashboard/recent-activity-widget"
import { ProjectCard } from "@/components/project-card"
import { Button } from "@/components/ui/button"
import { Skeleton } from "@/components/ui/skeleton"
import { Plus } from "lucide-react"
import { TaskModal } from "@/components/tasks/task-modal"
import { CreateProjectModal } from "@/components/modals/create-project-modal" 
import { useApi } from "@/hooks/useApi"
import { ProjectSummary, TaskDetails, ProjectDetails as ProjectDetailsType, UserSummary } from "@/types"
import { useAuth } from "@/contexts/auth-context"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"

export default function DashboardPage() {
  const { user } = useAuth();
  const { data: recentProjects, isLoading: isLoadingProjects, refetch: refetchProjects } = useApi<ProjectSummary[]>('/projects?limit=3');
   const [selectedTask, setSelectedTask] = React.useState<TaskDetails | null>(null);
  const [projectMembersForTask, setProjectMembersForTask] = React.useState<UserSummary[]>([]);
  const [isModalOpen, setIsModalOpen] = React.useState(false);
  const [isCreateModalOpen, setIsCreateModalOpen] = React.useState(false);


const handleTaskView = async (taskSummary: any) => {
    try {
      toast.info("Loading task details...");
      
      const [taskDetails, projectDetails] = await Promise.all([
        apiClient.get<TaskDetails>(`/tasks/${taskSummary.id}`),
        apiClient.get<ProjectDetailsType>(`/projects/${taskSummary.projectId}`)
      ]);
      
      setSelectedTask(taskDetails);
      setProjectMembersForTask(projectDetails.members); // Guardamos los miembros
      setIsModalOpen(true);
      
      toast.dismiss();
    } catch (error) {
      toast.error("Failed to load task details.");
      toast.dismiss();
    }
  }
  
  const handleModalClose = () => {
    setIsModalOpen(false);
    setSelectedTask(null);
    setProjectMembersForTask([]);
  }

  return (
    <>
      <AppLayout>
        {/* --- MODIFICADO: Se añade un contenedor para centrar y limitar el ancho --- */}
        <div className="max-w-7xl mx-auto space-y-6 sm:space-y-8">
          <div className="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
            <div className="space-y-1">
              <h1 className="text-2xl sm:text-3xl font-bold text-foreground">
                Good morning, {(user?.name || 'Usuario').split(' ')[0]}!
              </h1>
              <p className="text-sm sm:text-base text-muted-foreground">
                Here's what's happening with your projects today.
              </p>
            </div>
            <Button className="gap-2 w-full sm:w-auto" onClick={() => setIsCreateModalOpen(true)}>
              <Plus className="w-4 h-4" />
              Crear Proyecto
            </Button>
          </div>
          <div className="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
            <AssignedTasksWidget onTaskClick={handleTaskView} />
            <PersonalTodoWidget />
            <RecentActivityWidget />
          </div>

          <div className="space-y-4 sm:space-y-6">
            <div className="flex items-center justify-between">
              <h2 className="text-lg sm:text-xl font-semibold text-foreground">Recent Projects</h2>
              <Button asChild variant="ghost" size="sm">
                <Link href="/projects">View all projects</Link>
              </Button>
            </div>
            <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6">
              {isLoadingProjects ? (
                Array.from({ length: 3 }).map((_, index) => (
                  <Skeleton key={index} className="h-[260px] w-full rounded-2xl" />
                ))
              ) : (
                recentProjects?.map((project) => (
                  <ProjectCard key={project.id} project={project} onEdit={() => {}} />
                ))
              )}
            </div>
          </div>
        </div>
      </AppLayout>

       <TaskModal
        isOpen={isModalOpen}
        onClose={handleModalClose}
        task={selectedTask}
        onDataChange={refetchProjects}
        projectMembers={projectMembersForTask}
        showGoToProjectButton={true}
      />
      <CreateProjectModal
        isOpen={isCreateModalOpen}
        onClose={() => setIsCreateModalOpen(false)}
        onProjectCreated={refetchProjects}
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: app\dashboard\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\forgot-password\page.tsx ##############################

"use client";

import * as React from 'react';
import { apiClient } from '@/lib/api';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import Link from 'next/link';
import { ApiError } from '@/types'; // <-- 1. Importar el tipo

export default function ForgotPasswordPage() {
  const [email, setEmail] = React.useState('');
  const [isLoading, setIsLoading] = React.useState(false);
  const [isSubmitted, setIsSubmitted] = React.useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setIsLoading(true);
    try {
      // 2. Especificar el tipo de respuesta esperado: { message: string }
      const response = await apiClient.post<{ message: string }>('/auth/forgot-password', { email });
      toast.success(response.message || 'Si el correo es válido, recibirás un enlace para recuperar tu contraseña.');
      setIsSubmitted(true);
    } catch (error) {
      // 3. Manejar el error de forma segura
      const apiError = error as ApiError;
      const errorMessage = apiError.response?.data?.error || (error as Error).message || 'Ocurrió un error inesperado.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background p-4">
      <div className="w-full max-w-md text-center">
        <h1 className="text-3xl font-bold mb-2">Recuperar Contraseña</h1>
        {isSubmitted ? (
          <p className="text-muted-foreground">
            Revisa tu correo electrónico para continuar con el proceso.
          </p>
        ) : (
          <>
            <p className="text-muted-foreground mb-6">
              Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.
            </p>
            <form onSubmit={handleSubmit} className="space-y-4">
              <Input
                type="email"
                placeholder="tu-correo@ejemplo.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                disabled={isLoading}
              />
              <Button type="submit" disabled={isLoading} className="w-full">
                {isLoading ? 'Enviando...' : 'Enviar Enlace'}
              </Button>
            </form>
          </>
        )}
        <Button variant="link" asChild className="mt-4">
          <Link href="/">Volver a Inicio</Link>
        </Button>
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: app\forgot-password\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\globals.css ##############################

@import "tailwindcss";
@import "tw-animate-css";

@custom-variant dark (&:is(.dark *));

:root {
  /* Updated color palette based on design brief */
  --background: #ffffff;
  --foreground: #4b5563;
  --card: rgba(255, 255, 255, 0.8);
  --card-foreground: #4b5563;
  --popover: rgba(255, 255, 255, 0.9);
  --popover-foreground: #4b5563;

  /* Jello Blue Primary Colors */
  --primary: #00a3e0; /* Jello Blue */
  --primary-hover: #0088cc;
  --primary-foreground: #ffffff;

  /* Coral Secondary/Accent Colors */
  --secondary: #ff6f61; /* Coral */
  --secondary-foreground: #ffffff;
  --accent: #ff6f61; /* Coral for highlights */
  --accent-foreground: #ffffff;

  /* Jello Accent Colors for backgrounds */
  --accent-pink: #ec4899;
  --accent-purple: #8b5cf6;
  --accent-teal: #14b8a6;

  /* Glass Surface Colors */
  --glass-light: rgba(255, 255, 255, 0.3);
  --glass-border-light: rgba(255, 255, 255, 0.2);

  --muted: #f0f4f8;
  --muted-foreground: #4b5563;
  --destructive: #be123c;
  --destructive-foreground: #ffffff;
  --border: #d1e6f0;
  --input: #f9fafb;
  --ring: rgba(0, 163, 224, 0.5);
  --radius: 0.5rem;
  --chart-1: #00a3e0;
  --chart-2: #ff6f61;
  --chart-3: #d1e6f0;
  --chart-4: #f0f4f8;
  --chart-5: #4b5563;
  --sidebar: #f0f4f8;
  --sidebar-foreground: #4b5563;
  --sidebar-primary: #00a3e0;
  --sidebar-primary-foreground: #ffffff;
  --sidebar-accent: #ff6f61;
  --sidebar-accent-foreground: #ffffff;
  --sidebar-border: #d1e6f0;
  --sidebar-ring: rgba(0, 163, 224, 0.5);
}

.dark {
  --background: #0f172a;
  --foreground: #f1f5f9;
  --card: rgba(15, 23, 42, 0.8);
  --card-foreground: #f1f5f9;
  --popover: rgba(15, 23, 42, 0.9);
  --popover-foreground: #f1f5f9;

  /* Dark theme glass surfaces */
  --glass-light: rgba(15, 23, 42, 0.3);
  --glass-border-light: rgba(255, 255, 255, 0.1);

  --primary: #00a3e0;
  --primary-hover: #0088cc;
  --primary-foreground: #ffffff;
  --secondary: #ff6f61;
  --secondary-foreground: #ffffff;
  --muted: #1e293b;
  --muted-foreground: #94a3b8;
  --accent: #ff6f61;
  --accent-foreground: #ffffff;
  --destructive: #be123c;
  --destructive-foreground: #ffffff;
  --border: #334155;
  --input: #1e293b;
  --ring: rgba(0, 163, 224, 0.5);
  --chart-1: #00a3e0;
  --chart-2: #ff6f61;
  --chart-3: #334155;
  --chart-4: #1e293b;
  --chart-5: #94a3b8;
  --sidebar: #1e293b;
  --sidebar-foreground: #f1f5f9;
  --sidebar-primary: #00a3e0;
  --sidebar-primary-foreground: #ffffff;
  --sidebar-accent: #ff6f61;
  --sidebar-accent-foreground: #ffffff;
  --sidebar-border: #334155;
  --sidebar-ring: rgba(0, 163, 224, 0.5);
}

@theme inline {
  /* Updated font configuration for Inter */
  --font-sans: var(--font-inter);
  --font-mono: var(--font-geist-mono);

  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-hover: var(--primary-hover);
  --color-primary-foreground: var(--primary-foreground);

  /* Added Jello accent colors */
  --color-accent-pink: var(--accent-pink);
  --color-accent-purple: var(--accent-purple);
  --color-accent-teal: var(--accent-teal);

  /* Added glass surface colors */
  --color-glass: var(--glass-light);
  --color-glass-border: var(--glass-border-light);

  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);

    --animation-water-expand: water-expand 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;

}

@layer base {
  :root {
    view-transition-name: root; 
  };
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }


body, .glass-card, .glass-modal, button, a, h1, p {
@apply transition-colors duration-160 ease-in;
}
}

/* Updated glassmorphism and animated background styles */
@layer components {
  .glass-card {
    @apply backdrop-blur-lg bg-card border border-glass-border shadow-lg rounded-2xl;
  }

  .glass-modal {
    @apply backdrop-blur-xl bg-popover border border-glass-border shadow-2xl;
  }

  /* Added mobile-specific touch and interaction improvements */
  .touch-manipulation {
    touch-action: manipulation;
  }

  /* Mobile-specific blob sizing */
  .blob-bg {
    @apply fixed inset-0 overflow-hidden pointer-events-none;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
  }

  .dark .blob-bg {
    background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
  }

  .blob {
    @apply absolute rounded-full opacity-60 blur-3xl;
    animation: blob 20s infinite;
  }

  .blob-1 {
    top: 0;
    left: 0;
    width: 60vw;
    height: 60vw;
    background: var(--color-accent-pink);
    animation-delay: 0s;
  }

  .blob-2 {
    top: 50%;
    right: 0;
    width: 50vw;
    height: 50vw;
    background: var(--color-accent-purple);
    animation-delay: -10s;
  }

  .blob-3 {
    bottom: 0;
    left: 50%;
    width: 45vw;
    height: 45vw;
    background: var(--color-accent-teal);
    animation-delay: -5s;
  }

  /* Desktop blob sizing */
  @media (min-width: 768px) {
    .blob-1 {
      width: 40vw;
      height: 40vw;
    }

    .blob-2 {
      width: 35vw;
      height: 35vw;
    }

    .blob-3 {
      width: 30vw;
      height: 30vw;
    }
  }
}

@keyframes blob {
  0%,
  100% {
    transform: translate(0, 0) scale(1);
  }
  25% {
    transform: translate(20px, -50px) scale(1.1);
  }
  50% {
    transform: translate(-20px, 20px) scale(0.9);
  }
  75% {
    transform: translate(50px, 10px) scale(1.05);
  }
}
.water-expand {
  width: 1px;
  height: 1px;
  position: fixed;
  border-radius: 50%;
  transform: translate(-50%, -50%) scale(0);
  z-index: 9999;
  pointer-events: none;
  animation: water-expand 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
  -webkit-animation: water-expand 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}

.kanban-task-title {
  width: 100%;
  white-space: nowrap; 
  overflow: hidden; 
  text-overflow: ellipsis; 
}
.text-container-scrollable {
  overflow-wrap: break-word;
  word-wrap: break-word; 

  overflow-y: auto;

  max-height: 300px; 
}

@keyframes water-expand {
  from {
    transform: translate(-50%, -50%) scale(0);
    opacity: 1;
  }
  to {
    transform: translate(-50%, -50%) scale(1000);
    opacity: 0;
    -webkit-transform: translate(-50%, -50%) scale(1000);
    -moz-transform: translate(-50%, -50%) scale(1000);
    -ms-transform: translate(-50%, -50%) scale(1000);
    -o-transform: translate(-50%, -50%) scale(1000);
}
}

############################## FIN DEL ARCHIVO: app\globals.css ##################################

############################## INICIO DEL ARCHIVO: app\landing\page.tsx ##############################

import { PublicLayout } from "@/components/layout/public-layout"
import { HeroSection } from "@/components/landing/hero-section"
import { FeaturesSection } from "@/components/landing/features-section"

export default function HomePage() {
  return (
    <PublicLayout>
      <HeroSection />
      <FeaturesSection />
    </PublicLayout>
  )
}




############################## FIN DEL ARCHIVO: app\landing\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\layout.tsx ##############################

import "./globals.css"
import type { Metadata } from "next"
import { Inter } from "next/font/google"
import { GeistSans } from "geist/font/sans"
import { ThemeProvider } from "@/contexts/theme-context"
import { Toaster } from "@/components/ui/sonner"
import { AuthProvider } from "@/contexts/auth-context" 

const inter = Inter({ subsets: ["latin"], variable: "--font-inter" })

export const metadata: Metadata = {
  title: "Jello",
  description: "Your intelligent productivity ecosystem",
  icons: {
    icon: [
      { url: '/favicon-32x32.png', sizes: '32x32', type: 'image/png' },
      { url: '/favicon-16x16.png', sizes: '16x16', type: 'image/png' },
    ],
    apple: '/apple-touch-icon.png',
  },
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${GeistSans.variable} ${inter.variable} font-sans`}>
        <ThemeProvider>
          <AuthProvider> 
            {children}
            <Toaster />
          </AuthProvider>
        </ThemeProvider>
      </body>
    </html>
  )
}

############################## FIN DEL ARCHIVO: app\layout.tsx ##################################

############################## INICIO DEL ARCHIVO: app\notifications\page.tsx ##############################

"use client"

import * as React from "react"
import { Bell, CheckCheck } from "lucide-react"
import { useApi } from "@/hooks/useApi"
import { apiClient } from "@/lib/api"
import { Notification } from "@/types"
import { toast } from "sonner"
import { AppLayout } from "@/components/layout/app-layout"
import { Button } from "@/components/ui/button"
import { Skeleton } from "@/components/ui/skeleton"
import { NotificationItem } from "@/components/notifications/NotificationItem"
import { NotificationDetailModal } from "@/components/modals/NotificationDetailModal"
import { useRouter } from "next/navigation"
import { ChevronLeft, ChevronRight, MessageSquareWarning } from "lucide-react";

interface PaginatedNotifications {
  notifications: Notification[];
  totalPages: number;
  currentPage: number;
}

export default function NotificationsPage() {
  const [page, setPage] = React.useState(1);
  const { data, isLoading, error, refetch } = useApi<PaginatedNotifications>(`/notifications?page=${page}&limit=10`);
  const [selectedNotification, setSelectedNotification] = React.useState<Notification | null>(null);
  const router = useRouter();

  const handleMarkAllAsRead = async () => {
    try {
    await apiClient.put("/notifications/read/all", {}); 
      toast.success("Todas las notificaciones han sido marcadas como leídas.");
      refetch();
    } catch (err) {
      toast.error((err as Error).message);
    }
  };

  const handleNotificationClick = async (notification: Notification) => {
    // Siempre abre el modal, sin importar el tipo de notificación.
    setSelectedNotification(notification);

    // Si no está leída, la marca como leída en segundo plano.
    if (!notification.read) {
        try {
            await apiClient.put(`/notifications/${notification._id}/read`, {});
            refetch(); // Recarga los datos para actualizar el estado visual en la lista.
        } catch (err) {
            console.error("Failed to mark notification as read:", err);
            toast.error("Could not mark notification as read.");
        }
    }
};

  const unreadCount = data?.notifications?.filter((n) => !n.read).length || 0;

const handleMarkAsUnread = async (e: React.MouseEvent, notificationId: string) => {
    e.stopPropagation(); // Evita que se dispare el click del item principal
    try {
        await apiClient.put(`/notifications/${notificationId}/unread`, {});
        toast.success("Notification marked as unread.");
        refetch(); // Recarga los datos para reflejar el cambio
    } catch (err) {
        toast.error("Failed to mark as unread.");
    }
};

  return (
   <>
      <AppLayout>
        <div className="max-w-4xl mx-auto space-y-6 p-4 sm:p-6">
          <div className="flex flex-col sm:flex-row gap-4 sm:items-center sm:justify-between">
            <div className="space-y-1">
              <h1 className="text-2xl sm:text-3xl font-bold text-foreground">
                Notificaciones
              </h1>
              <p className="text-sm sm:text-base text-muted-foreground">
                Tu historial completo de actividad y solicitudes.
              </p>
            </div>
            <Button
              onClick={handleMarkAllAsRead}
              disabled={unreadCount === 0 || isLoading}
              className="w-full sm:w-auto"
            >
              <CheckCheck className="w-4 h-4 mr-2" />
              Marcar todo como leído
            </Button>
          </div>

          <div className="glass-card p-0 rounded-2xl overflow-hidden">
            <div className="space-y-0">
              {isLoading ? (
                <div className="space-y-2 p-4">
                  <Skeleton className="h-20 w-full rounded-lg" />
                  <Skeleton className="h-20 w-full rounded-lg" />
                  <Skeleton className="h-20 w-full rounded-lg" />
                </div>
              ) : error ? (
                (
                  <div className="text-center p-8 text-destructive">{error}</div>
                )
              ) : data && data.notifications.length > 0 ? (
                data.notifications.map((notification) => (
                  <NotificationItem
                    key={notification._id}
                    notification={notification}
                    onClick={() => handleNotificationClick(notification)}
                  />
                ))
              ) : (
                (
                  <div className="text-center p-12 text-muted-foreground">
                    <Bell className="mx-auto w-12 h-12 mb-4 opacity-50" />
                    <h3 className="font-semibold">Todo al día</h3>
                    <p>No tienes ninguna notificación.</p>
                  </div>
                )
              )}
            </div>
          </div>
          
          {/* Controles de Paginación */}
          {data && data.totalPages > 1 && (
            <div className="flex justify-center items-center gap-4 mt-6">
              <Button
                  variant="outline"
                  size="sm"
                  onClick={() => setPage(prev => Math.max(prev - 1, 1))}
                  disabled={isLoading || data.currentPage === 1}
              >
                  <ChevronLeft className="w-4 h-4 mr-2" />
                  Anterior
              </Button>
              <span className="text-sm text-muted-foreground">
                  Página {data.currentPage} de {data.totalPages}
              </span>
              <Button
                  variant="outline"
                  size="sm"
                  onClick={() => setPage(prev => prev + 1)}
                  disabled={isLoading || data.currentPage === data.totalPages}
              >
                  Siguiente
                  <ChevronRight className="w-4 h-4 ml-2" />
              </Button>
            </div>
          )}
        </div>
      </AppLayout>
      <NotificationDetailModal
        isOpen={!!selectedNotification}
        onClose={() => setSelectedNotification(null)}
        notification={selectedNotification}
        onResponseSuccess={refetch}
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: app\notifications\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\page.tsx ##############################

"use client";

import * as React from "react";
import Link from "next/link";
import Image from "next/image";
import { motion } from "framer-motion";

// --- 1. IMPORTACIONES REQUERIDAS ---
import {
    ArrowRight,
    Menu,
    Users,
    FolderSearch,
    BookOpen,
    Heart,
    Star,
    Shield,
    Briefcase,
    ClipboardList,
    Lightbulb,
    MessageSquare,
    Check,
    Bell, // Icono importado
    Sun,  // Icono para ThemeToggle
    Moon, // Icono para ThemeToggle
} from "lucide-react";

import { useAuth } from "@/contexts/auth-context"; // Hook de autenticación
import { useTheme } from "@/contexts/theme-context"; // Hook para el tema
import { Spinner } from "@/components/ui/spinner"; // Componente de carga
import { UserMenu } from "@/components/user-menu"; // Menú de usuario
import { UserProfile, TaskSummary } from "@/types"; // Tipos de la aplicación

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from "@/components/ui/card";
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar";
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet";
import { Dialog, DialogContent } from "@/components/ui/dialog";
import { AnimatedBackground } from "@/components/animated-background";
import { LoginForm } from "@/components/login-form";
import { RegisterForm } from "@/components/register-form";
import { TaskCard as FloatingTaskCard } from "@/components/tasks/task-card";

// --- 2. COMPONENTE PLACEHOLDER PARA NOTIFICACIONES ---
const NotificationsPlaceholder = () => (
    <Button variant="ghost" size="icon" asChild>
        <Link href="/notifications">
            <Bell className="h-5 w-5" />
        </Link>
    </Button>
);

const ThemeToggle = () => {
    const { theme, toggleTheme } = useTheme();
    return (
        <Button variant="ghost" size="icon" onClick={toggleTheme}>
            <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
            <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
            <span className="sr-only">Toggle theme</span>
        </Button>
    );
};


const LoggedInNavbar = () => (
    <motion.header 
        initial={{ y: -100, opacity: 0 }} 
        animate={{ y: 0, opacity: 1 }} 
        transition={{ duration: 0.5, ease: "easeOut" }} 
        className="sticky top-4 z-50 mx-auto w-[95%] max-w-7xl"
    >
        <div className="glass-card flex items-center justify-between p-3 rounded-2xl border border-border/50 shadow-lg">
            {/* Asegúrate de que este Link también apunte a "/" */}
            <Link href="/" className="flex items-center gap-2">
                <Avatar className="h-8 w-8"><AvatarImage src="/images/jelli-avatar.png" alt="Jello Logo" /><AvatarFallback>J</AvatarFallback></Avatar>
                <span className="text-xl font-bold">Jello</span>
            </Link>
            <div className="flex items-center gap-4">
                <Button asChild>
                    <Link href="/dashboard">Ir al Dashboard</Link>
                </Button>
                <NotificationsPlaceholder />
                <UserMenu /> {/* El UserMenu ya tiene el user desde el contexto */}
            </div>
        </div>
    </motion.header>
);

// --- Componente Principal de la Landing Page ---
export default function FinalStyledLandingPage() {
    // --- 3. LÓGICA DE ESTADO PRINCIPAL ---
    const { user, isLoading } = useAuth();
    const [isLoginModalOpen, setIsLoginModalOpen] = React.useState(false);
    const [isRegisterModalOpen, setIsRegisterModalOpen] = React.useState(false);

    // --- Funciones para intercambiar modales ---
    const switchToRegister = () => {
        setIsLoginModalOpen(false);
        setIsRegisterModalOpen(true);
    };

    const switchToLogin = () => {
        setIsRegisterModalOpen(false);
        setIsLoginModalOpen(true);
    };


    // --- 3.1. ESTADO DE CARGA ---
    if (isLoading) {
        return (
            <div className="flex min-h-screen w-full flex-col items-center justify-center bg-background">
                <Spinner size="lg" />
                <p className="mt-4 text-lg text-muted-foreground">Verificando sesión...</p>
            </div>
        );
    }

   

    return (
        <>
            <div className="relative flex min-h-screen w-full flex-col bg-background text-foreground overflow-x-hidden">
                <AnimatedBackground />

                {/* --- 4. GESTIÓN CENTRALIZADA DE MODALES --- */}
{user ? (
                    <LoggedInNavbar />
                ) : (
                    <Navbar onLoginClick={() => setIsLoginModalOpen(true)} onRegisterClick={() => setIsRegisterModalOpen(true)} />
                )}
                <main className="relative z-10 flex-grow">
                    <HeroSection onRegisterClick={() => setIsRegisterModalOpen(true)} />
                    <DetailedFeaturesSection />
                    <PricingSection onRegisterClick={() => setIsRegisterModalOpen(true)} />
                    <TestimonialsSection />
                    <CtaSection onRegisterClick={() => setIsRegisterModalOpen(true)} />
                </main>

                <Footer />
            </div>

            {/* --- 5. HABILITAR INTERCAMBIO ENTRE MODALES --- */}
            <Dialog open={isLoginModalOpen} onOpenChange={setIsLoginModalOpen}>
                <DialogContent className="p-0 border-none bg-transparent w-[90vw] max-w-md">
                    <LoginForm onSwitchToRegister={switchToRegister} />
                </DialogContent>
            </Dialog>

            <Dialog open={isRegisterModalOpen} onOpenChange={setIsRegisterModalOpen}>
                <DialogContent className="p-0 border-none bg-transparent w-[90vw] max-w-md">
                    <RegisterForm onSwitchToLogin={switchToLogin} />
                </DialogContent>
            </Dialog>
        </>
    );
}

// --- SUBCOMPONENTES DE LA PÁGINA (MODIFICADOS PARA RECIBIR PROPS) ---

// --- Navbar Modificado ---
const Navbar = ({ onLoginClick, onRegisterClick }: { onLoginClick: () => void; onRegisterClick: () => void; }) => {
    const [isMobileMenuOpen, setIsMobileMenuOpen] = React.useState(false);
    const navLinks = [
        { name: "Características", href: "#features" },
        { name: "Precios", href: "#pricing" },
        { name: "Testimonios", href: "#testimonials" },
    ];

    const handleLinkClick = (callback: () => void) => {
        setIsMobileMenuOpen(false);
        callback();
    };
    
    const NavItems = () => (
        <>
            {navLinks.map((link) => (
                <Link key={link.name} href={link.href} className="text-sm font-medium text-card-foreground hover:text-foreground transition-colors" onClick={() => setIsMobileMenuOpen(false)}>
                    {link.name}
                </Link>
            ))}
        </>
    );
    return (
        <motion.header initial={{ y: -100, opacity: 0 }} animate={{ y: 0, opacity: 1 }} transition={{ duration: 0.5, ease: "easeOut" }} className="sticky top-4 z-50 mx-auto w-[95%] max-w-7xl">
            <div className="glass-card flex items-center justify-between p-3 rounded-2xl border border-border/50 shadow-lg">
                <Link href="/" className="flex items-center gap-2">
                    <Avatar className="h-8 w-8"><AvatarImage src="/images/jelli-avatar.png" alt="Jello Logo" /><AvatarFallback>J</AvatarFallback></Avatar>
                    <span className="text-xl font-bold">Jello</span>
                </Link>
                <nav className="hidden md:flex items-center gap-6"><NavItems /></nav>
                <div className="hidden md:flex items-center gap-2">
                    <ThemeToggle /> {/* ThemeToggle añadido */}
                    <Button variant="ghost" onClick={onLoginClick}>Sign In</Button>
                    <Button onClick={onRegisterClick}>Get Started</Button>
                </div>
                <div className="md:hidden">
                    <Sheet open={isMobileMenuOpen} onOpenChange={setIsMobileMenuOpen}>
                        <SheetTrigger asChild><Button variant="ghost" size="icon"><Menu className="h-6 w-6" /></Button></SheetTrigger>
                        <SheetContent className="bg-card/80 backdrop-blur-lg border-l border-border/50 p-6">
                            <nav className="flex flex-col gap-6 pt-10">
                                <NavItems />
                                <div className="border-t border-border pt-6 flex flex-col gap-4">
                                    <Button variant="outline" onClick={() => handleLinkClick(onLoginClick)}>Sign In</Button>
                                    <Button onClick={() => handleLinkClick(onRegisterClick)}>Get Started</Button>
                                    <div className="self-center">
                                        <ThemeToggle /> {/* ThemeToggle añadido al menú móvil */}
                                    </div>
                                </div>
                            </nav>
                        </SheetContent>
                    </Sheet>
                </div>
            </div>
        </motion.header>
    );
};

// --- HeroSection Modificado ---
const HeroSection = ({ onRegisterClick }: { onRegisterClick: () => void; }) => {
    const mockTasks: TaskSummary[] = [
        { id: '1', title: 'Plan de Marketing para Lanzamiento', priority: 'high', labels: [{ _id: 'l1', name: 'Marketing', color: '#ec4899' }], assignees: [{ id: 'u1', name: 'S', avatarUrl: '/sarah-avatar.png' }], subtasks: { total: 5, completed: 2 }, status: 'in-progress', dueDate: '2025-11-15', commentCount: 3, attachmentCount: 1, projectId: 'p1' },
        { id: '2', title: 'Investigación de Mercado para App Móvil', priority: 'medium', labels: [{ _id: 'l2', name: 'Investigación', color: '#8b5cf6' }], assignees: [{ id: 'u2', name: 'M', avatarUrl: '/mike-avatar.jpg' }], subtasks: { total: 3, completed: 3 }, status: 'done', dueDate: '2025-10-30', commentCount: 8, attachmentCount: 2, projectId: 'p1' },
        { id: '3', title: 'Crear Repositorio Open-Source del Proyecto', priority: 'low', labels: [{ _id: 'l3', name: 'DevOps', color: '#14b8a6' }], assignees: [{ id: 'u3', name: 'E', avatarUrl: '/placeholder-user.jpg' }], subtasks: { total: 2, completed: 0 }, status: 'todo', dueDate: '2025-11-05', commentCount: 0, attachmentCount: 0, projectId: 'p2' },
    ];
    return (
        <section className="relative py-24 px-4 sm:py-32 text-center overflow-hidden">
            <div className="container relative z-10 max-w-5xl mx-auto">
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.7, ease: "easeOut" }}>
                    <h1 className="text-4xl sm:text-5xl md:text-7xl font-extrabold text-balance leading-tight bg-clip-text text-transparent bg-gradient-to-b from-foreground to-foreground/70">
                        Encuentra y Conecta. <br /> Construye sin Límites.
                    </h1>
                    <p className="mt-6 max-w-3xl mx-auto text-lg text-card-foreground text-pretty">
                        Jello es la plataforma flexible que une a personas y proyectos. Busca talento, explora iniciativas de código abierto o gestiona tu próximo gran producto en un solo lugar.
                    </p>
                    <div className="mt-10 flex flex-col sm:flex-row justify-center items-center gap-4">
                        <Button size="lg" className="group text-lg py-7 px-8 w-full sm:w-auto" onClick={onRegisterClick}>
                            Empieza Gratis
                            <ArrowRight className="ml-2 h-5 w-5 transition-transform group-hover:translate-x-1" />
                        </Button>
                    </div>
                </motion.div>
            </div>
            <div className="absolute inset-0 z-0 pointer-events-none">
                <motion.div className="absolute top-[15%] left-[5%] lg:left-[15%] w-72" animate={{ y: [0, -15, 0] }} transition={{ duration: 8, repeat: Infinity, ease: "easeInOut" }}><FloatingTaskCard task={mockTasks[0]} /></motion.div>
                <motion.div className="absolute bottom-[15%] right-[5%] lg:right-[15%] w-72" animate={{ y: [0, 15, 0] }} transition={{ duration: 9, repeat: Infinity, ease: "easeInOut", delay: -3 }}><FloatingTaskCard task={mockTasks[1]} /></motion.div>
                <motion.div className="absolute top-[55%] left-[10%] w-72 hidden xl:block" animate={{ y: [0, -12, 0] }} transition={{ duration: 7, repeat: Infinity, ease: "easeInOut", delay: -1 }}><FloatingTaskCard task={mockTasks[2]} /></motion.div>
            </div>
        </section>
    );
};

// --- El resto de los componentes de la landing no necesitan cambios, pero los incluyo por completitud ---

const DetailedFeaturesSection = () => {
    const mainFeatures = [
        { icon: ClipboardList, title: "Gestión de Proyectos Intuitiva", description: "Organiza, planifica y ejecuta tus proyectos con tableros Kanban dinámicos y herramientas visuales.", image: "/images/JelliKanban2.gif", points: ["Tableros Kanban personalizables", "Gestión de tareas y subtareas", "Fechas de entrega y recordatorios"] },
        { icon: Lightbulb, title: "Asistente con IA: Jelli", description: "Aprovecha la inteligencia artificial para automatizar tareas, obtener resúmenes y generar ideas.", image: "/images/JelliClear2.gif", points: ["Generación automática de tareas", "Resúmenes inteligentes de debates", "Sugerencias proactivas"] },
        { icon: MessageSquare, title: "Colaboración y Comunicación", description: "Mantén a tu equipo conectado con comentarios en tiempo real, menciones y un historial de actividad completo.", image: "/images/JelliConstructor2.gif", points: ["Comentarios directos en tareas", "Menciones a compañeros de equipo", "Historial de actividad centralizado"] },
    ];
    const platformFeatures = [
        { icon: FolderSearch, title: "Descubre Proyectos", description: "Explora proyectos públicos y open-source. ¡Encuentra tu próxima gran contribución!" },
        { icon: Users, title: "Encuentra Talento", description: "Utiliza nuestra búsqueda para filtrar usuarios por habilidades y roles. Construye tu equipo ideal." },
        { icon: Shield, title: "Control Total", description: "Decide quién ve tu trabajo. Mantén tus proyectos comerciales privados o ábrelos al mundo." },
    
        { icon: Briefcase, title: "Productos y Startups", description: "Herramientas para equipos que buscan lanzar su próximo gran producto." },
        { icon: BookOpen, title: "Código Abierto", description: "Plataforma transparente para colaborar en proyectos open-source." },
        { icon: Heart, title: "Iniciativas Sociales", description: "Organiza voluntarios y gestiona campañas para maximizar tu impacto." },
    ];

    return (
        <section id="features" className="py-24 px-4 ">
            <div className="container max-w-7xl mx-auto">
                <div className="text-center space-y-4 mb-20">
                    <h2 className="text-4xl font-bold">Un Ecosistema Completo para tu Productividad</h2>
                    <p className="text-lg text-card-foreground max-w-3xl mx-auto">Desde la gestión de tareas hasta la búsqueda de talento, Jello tiene todo lo que necesitas para llevar tus ideas a la realidad.</p>
                </div>

                <div className="space-y-20">
                    {mainFeatures.map((feature, index) => (
                        <motion.div key={feature.title} className={`bg-card/72 p-8 rounded-4xl flex flex-col md:flex-row items-center gap-12 lg:gap-24 ${index % 2 === 1 ? "md:flex-row-reverse" : ""}`} initial={{ opacity: 0, y: 50 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true, amount: 0.3 }} transition={{ duration: 0.8, ease: "easeOut" }}>
                            <div className="w-full md:w-1/2">
                                <motion.div className="relative w-full aspect-video rounded-3xl overflow-hidden bg-card/60  shadow-xl border border-border/50 flex items-center justify-center opacity-55 ">
                                    <Image src={feature.image} alt={feature.title} width={600} height={338} className="object-cover rounded-2xl" />
                                </motion.div>
                            </div>
                            <div className="w-full md:w-1/2 space-y-6 text-center md:text-left">
                                <feature.icon className="h-10 w-10 text-primary mx-auto md:mx-0" />
                                <h3 className="text-3xl font-bold">{feature.title}</h3>
                                <p className="text-lg text-card-foreground">{feature.description}</p>
                                <ul className="space-y-3">
                                    {feature.points.map((point, i) => (<li key={i} className="flex items-start gap-3 text-lg"><Check className="h-6 w-6 text-primary flex-shrink-0 mt-0.5" /><span>{point}</span></li>))}
                                </ul>
                            </div>
                        </motion.div>
                    ))}
                </div>

                <div className="mt-24 pt-16 border-t border-border">
                    <div className="text-center space-y-4 mb-16">
                         <h2 className="text-4xl font-bold">Una Plataforma, Infinitas Posibilidades</h2>
                         <p className="text-lg text-card-foreground max-w-3xl mx-auto">Jello está diseñado para ser tan flexible como tus proyectos. No importa si es privado, público o para una causa social.</p>
                    </div>
                    <div className="grid md:grid-cols-3 gap-8 mb-12">
                        {platformFeatures.map((feature, index) => (
                             <motion.div key={feature.title} initial={{ opacity: 0, y: 50 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true, amount: 0.5 }} transition={{ duration: 0.6, delay: index * 0.1 }}>
                                <Card className="h-full glass-card p-6 border border-border/50 shadow-lg text-left">
                                    <CardHeader className="flex flex-row items-center gap-4 p-0">
                                        <div className="inline-block p-3 bg-primary/10 rounded-lg">
                                            <feature.icon className="w-8 h-8 text-primary" />
                                        </div>
                                        <CardTitle className="text-xl">{feature.title}</CardTitle>
                                    </CardHeader>
                                    <CardContent className="p-0 pt-4">
                                        <p className="text-card-foreground">{feature.description}</p>
                                    </CardContent>
                                </Card>
                            </motion.div>
                        ))}
                    </div>
                </div>
            </div>
        </section>
    );
};

const PricingSection = ({ onRegisterClick }: { onRegisterClick: () => void; }) => {
    const tiers = [
        { name: "Gratis", price: "0", period: "/mes", description: "Perfecto para individuos y equipos pequeños.", features: ["3 Proyectos", "Búsqueda de Proyectos Públicos", "Acceso Básico a Jelli AI"], cta: "Comienza Gratis", popular: false },
        { name: "Pro", price: "15", period: "/mes/usuario", description: "Para equipos en crecimiento que necesitan más.", features: ["Proyectos Ilimitados", "Búsqueda Avanzada de Talento", "Acceso Completo a Jelli AI", "Soporte prioritario"], cta: "Prueba Pro Gratis", popular: true },
        { name: "Enterprise", price: "Personalizado", period: "", description: "Soluciones a medida para grandes organizaciones.", features: ["Todo en Pro", "Soporte 24/7 Dedicado", "Seguridad y Compliance (SSO)"], cta: "Contacta a Ventas", popular: false },
    ];
    return (
        <section id="pricing" className="py-24 px-4">
            <div className="container max-w-6xl mx-auto">
                <div className="text-center space-y-4 mb-16">
                    <h2 className="text-4xl font-bold">Planes Simples, Resultados Potentes</h2>
                    <p className="text-lg text-card-foreground max-w-3xl mx-auto">Encuentra el plan que se adapte a tus necesidades, sea cual sea el tamaño de tu equipo.</p>
                </div>
                <div className="grid lg:grid-cols-3 gap-8 items-stretch">
                    {tiers.map((tier, index) => (
                        <motion.div key={tier.name} initial={{ opacity: 0, y: 30 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true, amount: 0.5 }} transition={{ duration: 0.5, delay: index * 0.1 }} className="h-full">
                            <Card className={`flex flex-col h-full glass-card border ${tier.popular ? "border-primary shadow-2xl scale-[1.03]" : "border-border/50 shadow-lg"} transition-all duration-300 hover:shadow-xl`}>
                                <CardHeader className="relative pb-6">
                                    {tier.popular && <div className="absolute top-0 right-0 -mt-3 mr-6 bg-primary text-primary-foreground text-xs font-bold px-3 py-1 rounded-full">MÁS POPULAR</div>}
                                    <CardTitle className="text-2xl font-bold">{tier.name}</CardTitle>
                                    <div className="flex items-baseline mt-2">
                                        {tier.price !== "Personalizado" ? (<><span className="text-5xl font-extrabold">${tier.price}</span><span className="text-lg font-medium text-card-foreground">{tier.period}</span></>) : (<span className="text-3xl font-extrabold">{tier.price}</span>)}
                                    </div>
                                    <CardDescription className="text-sm text-card-foreground mt-2">{tier.description}</CardDescription>
                                </CardHeader>
                                <CardContent className="flex-grow space-y-3">
                                    <ul className="space-y-3">
                                        {tier.features.map(feature => (<li key={feature} className="flex items-center gap-3 text-sm text-foreground"><Check className="w-4 h-4 text-green-500 flex-shrink-0" /><span>{feature}</span></li>))}
                                    </ul>
                                </CardContent>
                                <CardFooter>
                                    <Button className={`w-full text-base py-6 ${tier.popular ? "bg-primary text-primary-foreground hover:bg-primary/90" : "glass-button"}`} variant={tier.popular ? "default" : "outline"} onClick={onRegisterClick}>{tier.cta}</Button>
                                </CardFooter>
                            </Card>
                        </motion.div>
                    ))}
                </div>
            </div>
        </section>
    );
};

const TestimonialsSection = () => {
    const testimonials = [
        { name: "Elena R.", role: "Directora de Proyectos", avatar: "/sarah-avatar.png", text: "Jello ha revolucionado cómo gestionamos proyectos. La IA es un ahorro de tiempo increíble.", rating: 5 },
        { name: "Marcos G.", role: "Fundador de Startup", avatar: "/mike-avatar.jpg", text: "La capacidad de encontrar colaboradores para nuestro proyecto open-source directamente en la plataforma ha sido un cambio radical.", rating: 5 },
        { name: "Sofía M.", role: "Diseñadora UX", avatar: "/placeholder-user.jpg", text: "Me encanta la estética. Es profesional, limpia y las animaciones hacen que usar la app sea un placer.", rating: 5 },
    ];
    return (
        <section id="testimonials" className="py-24 px-4 ">
            <div className="container max-w-7xl mx-auto">
                <div className="text-center space-y-4 mb-16">
                    <h2 className="text-4xl font-bold">Amado por equipos de todo el mundo</h2>
                    <p className="text-lg text-card-foreground max-w-3xl mx-auto">Cientos de equipos confían en Jello para potenciar su productividad diaria.</p>
                </div>
                <div className="grid md:grid-cols-3 gap-8">
                    {testimonials.map((testimonial, index) => (
                        <motion.div key={testimonial.name} className="glass-card p-6 text-center space-y-4 border border-border/50 shadow-lg flex flex-col justify-between" initial={{ opacity: 0, scale: 0.9 }} whileInView={{ opacity: 1, scale: 1 }} viewport={{ once: true, amount: 0.3 }} transition={{ duration: 0.6, delay: index * 0.1 }}>
                            <div>
                                <div className="flex justify-center mb-3">{[...Array(testimonial.rating)].map((_, i) => (<Star key={i} className="h-5 w-5 fill-yellow-400 text-yellow-400" />))}</div>
                                <p className="text-card-foreground italic text-pretty leading-relaxed">"{testimonial.text}"</p>
                            </div>
                            <div className="mt-6">
                                <Avatar className="w-16 h-16 mx-auto mb-3 border-4 border-background shadow-lg"><AvatarImage src={testimonial.avatar} alt={testimonial.name} /><AvatarFallback>{testimonial.name.charAt(0)}</AvatarFallback></Avatar>
                                <h4 className="font-semibold text-lg text-foreground">{testimonial.name}</h4>
                                <p className="text-sm text-primary">{testimonial.role}</p>
                            </div>
                        </motion.div>
                    ))}
                </div>
            </div>
        </section>
    );
};

const CtaSection = ({ onRegisterClick }: { onRegisterClick: () => void; }) => (
    <section className="py-24 px-4">
        <div className="container max-w-4xl mx-auto text-center">
            <motion.div className="space-y-6" initial={{ opacity: 0, y: 50 }} whileInView={{ opacity: 1, y: 0 }} viewport={{ once: true, amount: 0.5 }} transition={{ duration: 0.6 }}>
                <h2 className="text-4xl lg:text-5xl font-bold text-balance">Tu Futuro Productivo Comienza Hoy</h2>
                <p className="text-xl text-card-foreground max-w-2xl mx-auto text-pretty">Únete a la nueva era de la gestión de proyectos. Es gratis, es potente, es Jello.</p>
                <Button size="lg" className="group text-lg py-7 px-8 hover:scale-105 transition-transform duration-300" onClick={onRegisterClick}>
                    Empieza a construir tu éxito
                    <ArrowRight className="ml-2 h-5 w-5 transition-transform group-hover:translate-x-1" />
                </Button>
            </motion.div>
        </div>
    </section>
);

const Footer = () => (
    <footer className="relative z-10 mt-16">
        <div className="glass-card mx-4 mb-4 rounded-t-2xl border border-border/50">
            <div className="container mx-auto px-6 py-8">
                <div className="flex flex-col md:flex-row justify-between items-center text-center md:text-left gap-4">
                    <Link href="/" className="flex items-center gap-2">
                        <Avatar className="h-8 w-8"><AvatarImage src="/images/jelli-avatar.png" alt="Jello Logo" /><AvatarFallback>J</AvatarFallback></Avatar>
                        <span className="text-xl font-bold">Jello</span>
                    </Link>
                    <nav className="flex gap-6">
                        <Link href="#features" className="text-sm text-card-foreground hover:text-foreground">Características</Link>
                        <Link href="#pricing" className="text-sm text-card-foreground hover:text-foreground">Precios</Link>
                        <Link href="#testimonials" className="text-sm text-card-foreground hover:text-foreground">Testimonios</Link>
                    </nav>
                    <p className="text-sm text-card-foreground">© {new Date().getFullYear()} Jello. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </footer>
);

############################## FIN DEL ARCHIVO: app\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\profile\page.tsx ##############################

"use client"

import * as React from "react"
import { AppLayout } from "@/components/layout/app-layout"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Textarea } from "@/components/ui/textarea"
import { SkillsEditor } from "@/components/profile/SkillsEditor"
import { ImageUploadField } from "@/components/forms/image-upload-field"
import { Skeleton } from "@/components/ui/skeleton"
import { Edit, Save, AlertTriangle } from "lucide-react"
import { useAuth } from "@/contexts/auth-context"
import { useApi } from "@/hooks/useApi"
import { UserProfile } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"

export default function ProfilePage() {
  const { user: authUser, revalidateUser } = useAuth(); // Usamos revalidate para actualizar el user global
  const { data: profileData, isLoading, error, refetch } = useApi<UserProfile>(`/user/me`);
  
  const [isEditing, setIsEditing] = React.useState(false)
  const [formData, setFormData] = React.useState<Partial<UserProfile>>({});
  const [newAvatar, setNewAvatar] = React.useState<File | null>(null)
  const [newBanner, setNewBanner] = React.useState<File | null>(null)

  React.useEffect(() => {
    if (profileData) {
      setFormData(profileData);
    }
  }, [profileData]);

  const handleSave = async () => {
    setIsEditing(false);
    toast.info("Saving your profile...");
    
    try {
      if (newAvatar) {
        const avatarFormData = new FormData();
        avatarFormData.append('file', newAvatar);
        const uploadRes = await apiClient.post<{ url: string }>('/user/me/avatar', avatarFormData);
        setFormData(prev => ({ ...prev, avatarUrl: uploadRes.url }));
      }
      if (newBanner) {
        const bannerFormData = new FormData();
        bannerFormData.append('file', newBanner);
        const uploadRes = await apiClient.post<{ url: string }>('/user/me/banner', bannerFormData);
        setFormData(prev => ({ ...prev, bannerUrl: uploadRes.url }));
      }
      
      await apiClient.put('/user/profile', formData);

      await revalidateUser(); 
      await refetch(); 
      toast.success("Profile updated successfully!");

    } catch (err) {
      toast.error((err as Error).message);
    } finally {
      setNewAvatar(null);
      setNewBanner(null);
    }
  };

  const handleCancel = () => {
    if (profileData) setFormData(profileData);
    setIsEditing(false);
  }

  const handleFieldChange = (field: keyof UserProfile, value: any) => {
    setFormData(prev => ({ ...prev, [field]: value }));
  }

  if (isLoading) {
    return <AppLayout><Skeleton className="w-full h-[600px] rounded-2xl" /></AppLayout>;
  }

  if (error || !formData) {
     return (
      <AppLayout>
        <div className="flex flex-col items-center justify-center h-full text-center">
          <AlertTriangle className="w-16 h-16 text-destructive mb-4" />
          <h2 className="text-2xl font-bold">Error Loading Profile</h2>
          <p className="text-muted-foreground">{error}</p>
          <Button onClick={refetch} className="mt-6">Try Again</Button>
        </div>
      </AppLayout>
    );
  }

  return (
    <AppLayout>
      <div className="max-w-5xl mx-auto space-y-8 pb-12 bg-card/72 rounded-2xl shadow-xl">
        <div className="relative">
          <div className="h-48 bg-muted rounded-2xl overflow-hidden relative">
            <img src={newBanner ? URL.createObjectURL(newBanner) : formData.bannerUrl || "/placeholder.jpg"} alt="Banner" className="w-full h-full object-cover" />
            {isEditing && (
              <div className="absolute inset-0 bg-black/50 flex items-center justify-center">
                <ImageUploadField label="Change Banner" name="bannerImage" onChange={setNewBanner} />
              </div>
            )}
          </div>
          <div className="absolute -bottom-12 left-8">
            <div className="relative">
              <Avatar className="w-24 h-24 rounded-full border-4 border-background">
                <AvatarImage src={newAvatar ? URL.createObjectURL(newAvatar) : formData.avatarUrl || undefined} />
                <AvatarFallback className="text-3xl">{formData.name?.charAt(0)}</AvatarFallback>
              </Avatar>
              {isEditing && (
                <div className="absolute inset-0 bg-black/50 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 transition-opacity">
                   <ImageUploadField label="Change Avatar" name="avatarImage" onChange={setNewAvatar} />
                </div>
              )}
            </div>
          </div>
        </div>

        <div className="pt-14 px-8 flex justify-between items-start">
          <div className="space-y-1 min-w-0">
            {isEditing ? (
              <Input 
                className="text-3xl font-bold h-auto p-2 border-none focus-visible:ring-0" 
                value={formData.name || ''} 
                onChange={(e) => handleFieldChange('name', e.target.value)} 
              />
            ) : (
              <h1 className="text-3xl font-bold truncate">{formData.name}</h1>
            )}
             {isEditing ? (
              <Input 
                className="text-muted-foreground p-2 h-auto border-none focus-visible:ring-0" 
                value={formData.email || ''} 
                onChange={(e) => handleFieldChange('email', e.target.value)} 
              />
            ) : (
              <p className="text-muted-foreground break-words">{formData.email}</p>
            )}
          </div>
          <div className="flex items-center gap-2">
            {isEditing && <Button variant="ghost" onClick={handleCancel}>Cancel</Button>}
            {isEditing ? (
              <Button onClick={handleSave}><Save className="w-4 h-4 mr-2" />Save Changes</Button>
            ) : (
              <Button variant="outline" onClick={() => setIsEditing(true)}><Edit className="w-4 h-4 mr-2" />Edit Profile</Button>
            )}
          </div>
        </div>

        <div className="p-8 grid md:grid-cols-3 gap-8">
          <div className="md:col-span-2 space-y-6">
            <div className="glass-card p-6 rounded-2xl">
              <h3 className="text-lg font-semibold mb-4">Sobre mi</h3>
              {isEditing ? (
                <Textarea 
                  value={formData.bio || ''} 
                  onChange={(e) => handleFieldChange('bio', e.target.value)}
                  className="min-h-[120px]"
                />
              ) : (
                <p className="text-muted-foreground break-words">{formData.bio || "No bio provided."}</p>
              )}
            </div>
          </div>
          <div className="md:col-span-1 space-y-6">
            <div className="glass-card p-6 rounded-2xl space-y-4">
              <div>
                <Label>Cargo</Label>
                {isEditing ? <Input value={formData.title || ''} onChange={(e) => handleFieldChange('title', e.target.value)} /> : <p className="text-sm break-words">{formData.title || "Not specified"}</p>}
              </div>
              <div>
                <Label>Timezone</Label>
                {isEditing ? <Input value={formData.timezone || ''} onChange={(e) => handleFieldChange('timezone', e.target.value)} /> : <p className="text-sm break-words">{formData.timezone || "Not specified"}</p>}
              </div>
            </div>
            <div className="glass-card p-6 rounded-2xl">
              <h3 className="text-lg font-semibold mb-4">Skills</h3>
              <SkillsEditor 
                selectedSkills={formData.skills || []}
                setSelectedSkills={(skills) => handleFieldChange('skills', skills)}
                isEditing={isEditing}
              />
            </div>
          </div>
        </div>
      </div>
    </AppLayout>
  )
}


############################## FIN DEL ARCHIVO: app\profile\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\project\[projectId]\page.tsx ##############################

"use client"

import * as React from 'react'
import { useParams, useRouter, useSearchParams } from 'next/navigation'
import { useApi } from '@/hooks/useApi'
import { ProjectDetails, TaskSummary, TaskDetails } from '@/types'
import { AppLayout } from '@/components/layout/app-layout'
import { KanbanBoard } from '@/components/kanban/kanban-board'
import { TaskModal } from '@/components/tasks/task-modal'
import { CreateTaskModal } from '@/components/modals/create-task-modal'
import { ProjectHeader } from '@/components/project-header'
import { EditProjectModal } from '@/components/modals/edit-project-modal'
import { AddMemberModal } from '@/components/modals/AddMemberModal'
import { apiClient } from '@/lib/api'
import { toast } from 'sonner'
import { Skeleton } from '@/components/ui/skeleton'
import type { DropResult } from '@hello-pangea/dnd';
import { ActivityFeed } from '@/components/activity/ActivityFeed'

export default function ProjectPage() {
  const params = useParams();
  const router = useRouter();
  const searchParams = useSearchParams();
  const projectId = params.projectId as string;

  const { data: project, isLoading, error, refetch, setData: setProject } = useApi<ProjectDetails>(`/projects/${projectId}`);

  const [selectedTask, setSelectedTask] = React.useState<TaskDetails | null>(null);
  const [isTaskModalOpen, setIsTaskModalOpen] = React.useState(false);
  const [isCreateTaskModalOpen, setIsCreateTaskModalOpen] = React.useState(false);
  const [defaultStatusForCreate, setDefaultStatusForCreate] = React.useState<'todo' | 'in-progress' | 'review' | 'done'>('todo');

  const [isEditModalOpen, setIsEditModalOpen] = React.useState(false);
  const [isInviteModalOpen, setIsInviteModalOpen] = React.useState(false);

  const handleTaskStatusChange = async (result: DropResult) => {
    if (!project) return;

    const { source, destination, draggableId } = result;
    if (!destination) return;

    const originalProject = { ...project };

    const sourceColumnId = source.droppableId as keyof ProjectDetails['tasksByStatus'];
    const destColumnId = destination.droppableId as keyof ProjectDetails['tasksByStatus'];

    const sourceTasks = [...originalProject.tasksByStatus[sourceColumnId]];
    const destTasks = source.droppableId === destination.droppableId ? sourceTasks : [...originalProject.tasksByStatus[destColumnId]];

    const [movedTask] = sourceTasks.splice(source.index, 1);

    if (!movedTask) return;

    movedTask.status = destColumnId;
    destTasks.splice(destination.index, 0, movedTask);

    const newProjectState = {
      ...originalProject,
      tasksByStatus: {
        ...originalProject.tasksByStatus,
        [sourceColumnId]: sourceTasks,
        [destColumnId]: destTasks,
      }
    };

    setProject(newProjectState);

    try {
      await apiClient.put(`/projects/${projectId}/tasks/${draggableId}`, { status: destColumnId });
    } catch (err) {
      toast.error("Failed to update task status. Reverting changes.");
      setProject(originalProject);
    }
  };

  const handleTaskClick = async (taskSummary: TaskSummary) => {
    try {
      toast.info("Loading task details...");
      const detailedTask = await apiClient.get<TaskDetails>(`/tasks/${taskSummary.id}`);
      setSelectedTask(detailedTask);
      setIsTaskModalOpen(true);
      toast.dismiss();
    } catch (err) {
      toast.error("Failed to load task details.");
    }
  }

  const handleOpenCreateTaskModal = (columnId: string) => {
    setDefaultStatusForCreate(columnId as 'todo' | 'in-progress' | 'review' | 'done');
    setIsCreateTaskModalOpen(true);
  }


  React.useEffect(() => {
    const taskIdFromUrl = searchParams.get('taskId');
    if (taskIdFromUrl && project) {
      const taskSummary = Object.values(project.tasksByStatus).flat().find(t => t.id === taskIdFromUrl);
      if (taskSummary) {
        handleTaskClick(taskSummary);
        router.replace(`/project/${projectId}`, { scroll: false });
      }
    }
  }, [searchParams, project, router, projectId]);

  const handleCreateTask = async (formData: FormData) => {
    setIsCreateTaskModalOpen(false);
    toast.info("Creating new task...");
    try {
      const newTask = await apiClient.post<TaskSummary>(`/projects/${projectId}/tasks`, formData); // 

      toast.success(`Task "${newTask.title}" created!`);

      setProject(prevProject => {
        if (!prevProject) return null;

        // 3. Agrega la nueva tarea a la columna correcta
        const status = newTask.status;
        const updatedTasksInStatus = [...prevProject.tasksByStatus[status], newTask];

        return {
          ...prevProject,
          tasksByStatus: {
            ...prevProject.tasksByStatus,
            [status]: updatedTasksInStatus,
          }
        };
      });

    } catch (err) {
      toast.error(`Failed to create task: ${(err as Error).message}`); // [cite: 345]
    }
  };

  const handleModalClose = () => {
    setIsTaskModalOpen(false);
    setSelectedTask(null);
    router.replace(`/project/${projectId}`, { scroll: false });
  }

  const handleEditProject = async (formData: FormData) => {
    if (!project) return;
    toast.info("Saving changes...");
    try {
      await apiClient.put(
        `/projects/${project.id}`,
        formData
      );

      await refetch();

      toast.success("Project updated successfully!");
      setIsEditModalOpen(false);

    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  const handleDeleteProject = async (id: string) => {
    toast.info("Eliminando proyecto...");
    try {
      await apiClient.del(`/projects/${id}`);
      toast.success("Project deleted.");
      router.push('/projects');
    } catch (err) {
      toast.error((err as Error).message);
    }
  }

  const handleTaskDeleteOptimistic = (taskId: string, status: string) => {
    if (!project) return;

    setProject(prevProject => {
      if (!prevProject) return null;
      
      const updatedTasksInStatus = prevProject.tasksByStatus[status as keyof ProjectDetails['tasksByStatus']]
        .filter(task => task.id !== taskId);

      return {
        ...prevProject,
        tasksByStatus: {
          ...prevProject.tasksByStatus,
          [status]: updatedTasksInStatus,
        }
      };
    });
  };

  if (isLoading) {
    return (
      <AppLayout>
        <div className="p-8 space-y-6">
          <Skeleton className="h-12 w-1/3" />
          <Skeleton className="h-8 w-2/3" />
          <div className="flex gap-6 h-[calc(100vh-200px)]">
            <Skeleton className="w-96 h-full" />
            <Skeleton className="w-96 h-full" />
            <Skeleton className="w-96 h-full" />
          </div>
        </div>
      </AppLayout>
    )
  }

  if (error) {
    return <AppLayout><div>Error loading project.</div></AppLayout>
  }

  if (!project) {
    return <AppLayout><div>Project not found.</div></AppLayout>
  }

  return (
    <>
      <AppLayout>
        <div className="space-y-6">
          <ProjectHeader
            project={project!}
            onEdit={() => setIsEditModalOpen(true)}
            onInviteMembers={() => setIsInviteModalOpen(true)}
          />
          <div className="min-h-[65vh]">
            <KanbanBoard
              project={project!}
              onTaskStatusChange={handleTaskStatusChange}
              onTaskClick={handleTaskClick}
              onAddTask={handleOpenCreateTaskModal}
            />
          </div>
          <div className="border-t border-border p-6">
            <ActivityFeed projectId={projectId} />
          </div>
        </div>
      </AppLayout>

      {selectedTask && (
        <TaskModal
          isOpen={isTaskModalOpen}
          onClose={handleModalClose}
          task={selectedTask}
          onDataChange={refetch}
          projectMembers={project.members}
        />
      )}

      <CreateTaskModal isOpen={isCreateTaskModalOpen} onClose={() => setIsCreateTaskModalOpen(false)} onSubmit={handleCreateTask} defaultStatus={defaultStatusForCreate} projectId={projectId} />

      {project && <EditProjectModal isOpen={isEditModalOpen} onClose={() => setIsEditModalOpen(false)} onSubmit={handleEditProject} onDelete={handleDeleteProject} project={project} onDataChange={refetch} />}

      {project && <AddMemberModal isOpen={isInviteModalOpen} onClose={() => setIsInviteModalOpen(false)} projectId={project.id} onInviteSent={refetch} currentMembers={project.members.map(m => m.id)} />}
    </>
  )
}

############################## FIN DEL ARCHIVO: app\project\[projectId]\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\projects\loading.tsx ##############################

export default function Loading() {
  return null
}


############################## FIN DEL ARCHIVO: app\projects\loading.tsx ##################################

############################## INICIO DEL ARCHIVO: app\projects\page.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: app\projects\page.test.tsx ##################################

############################## INICIO DEL ARCHIVO: app\projects\page.tsx ##############################

"use client"

import * as React from "react"
import { AppLayout } from "@/components/layout/app-layout"
import { ProjectCard } from "@/components/project-card"
import { CreateProjectModal } from "@/components/modals/create-project-modal"
import { EditProjectModal } from "@/components/modals/edit-project-modal"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { Skeleton } from "@/components/ui/skeleton"
import { Plus, Search } from "lucide-react"
import { useApi } from "@/hooks/useApi"
import { ProjectSummary } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"

interface ProjectFormData {
  name: string;
  description: string;
  color: string;
  members: string[];
  projectImage?: File;
  bannerImage?: File;
  dueDate?: string;
}

type FilterType = "all" | "owned" | "working";

export default function ProjectsPage() {
  const [searchQuery, setSearchQuery] = React.useState("")
  const [filter, setFilter] = React.useState<FilterType>("all")
  
  const endpoint = `/projects?search=${searchQuery}&filter=${filter === 'all' ? '' : filter}`;
  const { data: projects, isLoading, refetch } = useApi<ProjectSummary[]>(endpoint);

  const [isCreateModalOpen, setIsCreateModalOpen] = React.useState(false)
  const [isEditModalOpen, setIsEditModalOpen] = React.useState(false)
  const [selectedProject, setSelectedProject] = React.useState<ProjectSummary | null>(null)

  React.useEffect(() => {
    const handler = setTimeout(() => { refetch() }, 300);
    return () => clearTimeout(handler);
  }, [searchQuery, filter, refetch]);

  const openEditModal = (project: ProjectSummary) => {
    setSelectedProject(project);
    setIsEditModalOpen(true);
  }

const handleEditProject = async (projectData: FormData) => { 
    if (!selectedProject) return;
    toast.info("Saving changes...");
    try {
      await apiClient.put(`/projects/${selectedProject.id}`, projectData);
      
      toast.success("Project updated successfully!");
      
      refetch(); 
      
      setIsEditModalOpen(false);
      setSelectedProject(null);
    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  const handleDeleteProject = async (projectId: string) => {
    if (!window.confirm("Are you sure you want to delete this project? This action cannot be undone.")) return;
    toast.info("Deleting project...");
    try {
      await apiClient.del(`/projects/${projectId}`);
      toast.success("Project deleted successfully!");
      refetch();
      setIsEditModalOpen(false); 
    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  return (
    <>
      <AppLayout>
        <div className="space-y-6 sm:space-y-8">
          <div className="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
            <div className="space-y-1">
              <h1 className="text-2xl sm:text-3xl font-bold text-foreground">Projects</h1>
              <p className="text-sm sm:text-base text-muted-foreground">
                Manage and track all your projects in one place.
              </p>
            </div>
            <Button className="gap-2 w-full sm:w-auto" onClick={() => setIsCreateModalOpen(true)}>
              <Plus className="w-4 h-4" />
              New Project
            </Button>
          </div>

          <div className="flex flex-col gap-3 sm:flex-row sm:gap-4">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground" />
              <Input
                placeholder="Search projects by name..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-10"
              />
            </div>
          </div>

          <Tabs value={filter} onValueChange={(value) => setFilter(value as FilterType)} className="space-y-4 sm:space-y-6">
            <TabsList className="grid w-full grid-cols-3 sm:max-w-md">
              <TabsTrigger value="all">All Projects</TabsTrigger>
              <TabsTrigger value="owned">Owned by Me</TabsTrigger>
              <TabsTrigger value="working">Working on</TabsTrigger>
            </TabsList>

            <TabsContent value={filter}>
              <div className="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
                {isLoading ? (
                  Array.from({ length: 6 }).map((_, index) => (
                    <Skeleton key={index} className="h-[260px] w-full rounded-2xl" />
                  ))
                ) : (
                  projects?.map((project) => (
                    <ProjectCard key={project.id} project={project} onEdit={() => openEditModal(project)} />
                  ))
                )}
              </div>
            </TabsContent>
          </Tabs>
        </div>
      </AppLayout>

      <CreateProjectModal
        isOpen={isCreateModalOpen}
        onClose={() => setIsCreateModalOpen(false)}
        onProjectCreated={refetch}
      />
      
      {selectedProject && (
        <EditProjectModal
          isOpen={isEditModalOpen}
          onClose={() => {setIsEditModalOpen(false); setSelectedProject(null)}}
          onSubmit={handleEditProject}
          onDelete={handleDeleteProject}
          project={selectedProject}
          onDataChange={refetch} 
        />
      )}
    </>
  )
}

############################## FIN DEL ARCHIVO: app\projects\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\reset-password\[token]\page.tsx ##############################

"use client";

import * as React from 'react';
import { apiClient } from '@/lib/api';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { useParams, useRouter } from 'next/navigation';
import Link from 'next/link';
import { ApiError } from '@/types'; // <-- 1. Importar el tipo

export default function ResetPasswordPage() {
  const [password, setPassword] = React.useState('');
  const [confirmPassword, setConfirmPassword] = React.useState('');
  const [isLoading, setIsLoading] = React.useState(false);
  const [isSuccess, setIsSuccess] = React.useState(false);
  
  const params = useParams();
  const router = useRouter();
  const token = params.token as string;

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (password !== confirmPassword) {
      toast.error('Las contraseñas no coinciden.');
      return;
    }
    if (password.length < 8) {
        toast.error('La contraseña debe tener al menos 8 caracteres.');
        return;
    }

    setIsLoading(true);
    try {
      // 2. Especificar el tipo de respuesta esperado: { message: string }
      const response = await apiClient.put<{ message: string }>(`/auth/reset-password/${token}`, { password });
      toast.success(response.message || 'Contraseña actualizada con éxito.');
      setIsSuccess(true);
    } catch (error) {
      // 3. Manejar el error de forma segura
      const apiError = error as ApiError;
      let errorMessage = apiError.response?.data?.error || (error as Error).message || 'Ocurrió un error inesperado.';
      toast.error(errorMessage);
      
      if (apiError.response?.status === 400 || apiError.response?.status === 404) {
         router.push('/verification-failed');
      }
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background p-4">
      <div className="w-full max-w-md text-center">
        <h1 className="text-3xl font-bold mb-2">Establecer Nueva Contraseña</h1>
        {isSuccess ? (
          <div>
            <p className="text-muted-foreground mb-6">
              Tu contraseña ha sido actualizada. Ahora puedes iniciar sesión.
            </p>
            <Button asChild>
              <Link href="/">Ir a Iniciar Sesión</Link>
            </Button>
          </div>
        ) : (
          <>
            <p className="text-muted-foreground mb-6">
              Ingresa tu nueva contraseña a continuación.
            </p>
            <form onSubmit={handleSubmit} className="space-y-4">
              <Input
                type="password"
                placeholder="Nueva contraseña"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                disabled={isLoading}
              />
              <Input
                type="password"
                placeholder="Confirmar nueva contraseña"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                required
                disabled={isLoading}
              />
              <Button type="submit" disabled={isLoading} className="w-full">
                {isLoading ? 'Actualizando...' : 'Actualizar Contraseña'}
              </Button>
            </form>
          </>
        )}
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: app\reset-password\[token]\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\search\page.tsx ##############################

// app/search/page.tsx

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { AppLayout } from "@/components/layout/app-layout"
import { Input } from "@/components/ui/input"
import { Search } from "lucide-react"
import { SearchResultCard } from "@/components/search/SearchResultCard"
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { apiClient } from "@/lib/api"
import { SearchResult } from "@/types"
import { toast } from "sonner"
import { Spinner } from "@/components/ui/spinner"

export default function SearchPage() {
  const [query, setQuery] = React.useState("")
  const [typeFilter, setTypeFilter] = React.useState<"all" | "project" | "user">("all")
  const [results, setResults] = React.useState<SearchResult[]>([])
  const [isLoading, setIsLoading] = React.useState(false)

  React.useEffect(() => {
    const fetchResults = async () => {
      if (query.length < 2) {
        setResults([]);
        return;
      }
      setIsLoading(true);
      try {
        const typeParam = typeFilter === 'all' ? '' : typeFilter;
        const data = await apiClient.get<SearchResult[]>(`/search?q=${query}&type=${typeParam}`);
        setResults(data);
      } catch (err) {
        toast.error((err as Error).message);
      } finally {
        setIsLoading(false);
      }
    };

    const debounceTimer = setTimeout(fetchResults, 300);
    return () => clearTimeout(debounceTimer);
  }, [query, typeFilter]);

  return (
    <AppLayout>
      <div className="max-w-4xl mx-auto space-y-6 p-6">
        
        <div className="space-y-6">
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between">
            <div className="space-y-1">
              <h1 className="text-2xl sm:text-3xl font-bold text-foreground">Buscar</h1>
              <p className="text-sm sm:text-base text-muted-foreground">
                Encuentra proyectos, usuarios y más.
              </p>
            </div>
          </div>

          <div className="flex flex-col gap-3 sm:flex-row sm:gap-4">
            <div className="relative flex-1">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground" />
              <Input
                placeholder="Search..."
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                className="pl-10 h-11"
                autoFocus
              />
            </div>
            <Tabs value={typeFilter} onValueChange={(value: any) => setTypeFilter(value)}>
              <TabsList>
                <TabsTrigger value="all">All</TabsTrigger>
                <TabsTrigger value="project">Projects</TabsTrigger>
                <TabsTrigger value="user">Users</TabsTrigger>
              </TabsList>
            </Tabs>
          </div>
        </div>
        
        {/* Sección de Resultados */}
        {isLoading ? (
          <div className="text-center py-24"><Spinner size="lg" /></div>
        ) : (
          <>
            {!query && (
              <div className="text-center py-24 text-muted-foreground">
                <Search className="w-16 h-16 mx-auto mb-4 opacity-50" />
                <h2 className="text-2xl font-bold">Search Jello</h2>
                <p>Find what you're looking for by typing in the search bar above.</p>
              </div>
            )}

            {query && results.length === 0 && (
              <div className="text-center py-24 text-muted-foreground">
                <Search className="w-16 h-16 mx-auto mb-4 opacity-50" />
                <h2 className="text-2xl font-bold">No results found for "{query}"</h2>
                <p>Try searching for something else or adjust your filters.</p>
              </div>
            )}
            
            {results.length > 0 && (
                <div className="grid md:grid-cols-2 gap-6">
                {results.map((result, index) => (
                  <motion.div
                    key={result.id}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ delay: index * 0.1 }}
                  >
                    <SearchResultCard result={result} />
                  </motion.div>
                ))}
              </div>
            )}
          </>
        )}
      </div>
    </AppLayout>
  )
}

############################## FIN DEL ARCHIVO: app\search\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\settings\appearance\page.tsx ##############################

"use client"

import type React from "react"
import { useState, useEffect } from "react"
import { motion } from "framer-motion"
import { Monitor, Moon, Sun, Zap } from "lucide-react"
import { SettingsLayout } from "@/components/settings/settings-layout"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { useTheme } from "@/contexts/theme-context"
import { useApi } from "@/hooks/useApi"
import { UserSettings } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"

export default function AppearanceSettingsPage() {
  const { theme, setTheme, toggleTheme } = useTheme()
  const { data: settings, isLoading, refetch } = useApi<UserSettings>('/user/me/settings');
  
  const [appearance, setAppearance] = useState<UserSettings['appearance'] | null>(null);

  useEffect(() => {
    if (settings) {
      setAppearance(settings.appearance);
    }
  }, [settings]);

  const handleThemeChange = (newTheme: string, event: React.MouseEvent) => {
    if (newTheme !== theme) {
      if (newTheme === "light" || newTheme === "dark") {
        toggleTheme(event as any)
      } else {
        setTheme(newTheme)
      }
      setAppearance(prev => prev ? { ...prev, theme: newTheme as any } : null);
    }
  }
  
  const handleSaveChanges = async () => {
    toast.info("Saving appearance settings...");
    try {
        await apiClient.put('/user/me/settings', { appearance });
        toast.success("Settings saved!");
        refetch();
    } catch(err) {
        toast.error((err as Error).message);
    }
  }

  if (isLoading || !appearance) {
    return <SettingsLayout><Skeleton className="w-full h-96" /></SettingsLayout>
  }

  return (
    <SettingsLayout>
      <div className="space-y-8">
        <div>
          <h2 className="text-2xl font-bold text-foreground mb-2">Appearance Settings</h2>
          <p className="text-muted-foreground">Customize how Jello looks and feels</p>
        </div>
        {/* ... Theme, Accent, and Animation sections remain structurally the same, but now use `appearance` state ... */}
        <div className="flex gap-3 pt-6 border-t border-border">
          <Button onClick={handleSaveChanges} className="bg-primary hover:bg-primary-hover">Save Changes</Button>
        </div>
      </div>
    </SettingsLayout>
  )
}


############################## FIN DEL ARCHIVO: app\settings\appearance\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\settings\integrations\page.tsx ##############################

"use client"

import { useState } from "react"
import { motion } from "framer-motion"
import { Plug, Check, ExternalLink, Settings } from "lucide-react"
import { SettingsLayout } from "@/components/settings/settings-layout"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"

interface Integration {
  id: string
  name: string
  description: string
  icon: string
  connected: boolean
  category: "productivity" | "communication" | "storage" | "development"
}

export default function IntegrationsSettingsPage() {
  const [integrations, setIntegrations] = useState<Integration[]>([
    {
      id: "slack",
      name: "Slack",
      description: "Get notifications and updates in your Slack channels",
      icon: "💬",
      connected: true,
      category: "communication",
    },
    {
      id: "google-drive",
      name: "Google Drive",
      description: "Attach files from Google Drive to your tasks",
      icon: "📁",
      connected: true,
      category: "storage",
    },
    {
      id: "github",
      name: "GitHub",
      description: "Link commits and pull requests to your projects",
      icon: "🐙",
      connected: false,
      category: "development",
    },
    {
      id: "figma",
      name: "Figma",
      description: "Embed design files and prototypes in your tasks",
      icon: "🎨",
      connected: false,
      category: "productivity",
    },
    {
      id: "zoom",
      name: "Zoom",
      description: "Schedule and join meetings directly from Jello",
      icon: "📹",
      connected: true,
      category: "communication",
    },
    {
      id: "notion",
      name: "Notion",
      description: "Sync your Notion pages with Jello projects",
      icon: "📝",
      connected: false,
      category: "productivity",
    },
  ])

  const toggleIntegration = (id: string) => {
    setIntegrations((prev) =>
      prev.map((integration) =>
        integration.id === id ? { ...integration, connected: !integration.connected } : integration,
      ),
    )
  }

  const categories = [
    { id: "all", name: "All Integrations" },
    { id: "productivity", name: "Productivity" },
    { id: "communication", name: "Communication" },
    { id: "storage", name: "Storage" },
    { id: "development", name: "Development" },
  ]

  const [selectedCategory, setSelectedCategory] = useState("all")

  const filteredIntegrations =
    selectedCategory === "all"
      ? integrations
      : integrations.filter((integration) => integration.category === selectedCategory)

  return (
    <SettingsLayout>
      <div className="space-y-8">
        <div>
          <h2 className="text-2xl font-bold text-foreground mb-2">Integrations</h2>
          <p className="text-muted-foreground">Connect Jello with your favorite tools and services</p>
        </div>

        {/* Category Filter */}
        <div className="flex flex-wrap gap-2">
          {categories.map((category) => (
            <Button
              key={category.id}
              variant={selectedCategory === category.id ? "default" : "outline"}
              size="sm"
              onClick={() => setSelectedCategory(category.id)}
              className={selectedCategory === category.id ? "bg-jello-blue hover:bg-jello-blue/90" : ""}
            >
              {category.name}
            </Button>
          ))}
        </div>

        {/* Integrations Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {filteredIntegrations.map((integration) => (
            <motion.div
              key={integration.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              className="p-6 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-all"
            >
              <div className="flex items-start justify-between mb-4">
                <div className="flex items-center gap-3">
                  <div className="text-2xl">{integration.icon}</div>
                  <div>
                    <h3 className="font-semibold text-foreground">{integration.name}</h3>
                    <Badge
                      variant={integration.connected ? "default" : "secondary"}
                      className={integration.connected ? "bg-green-500 hover:bg-green-600" : ""}
                    >
                      {integration.connected ? (
                        <>
                          <Check className="w-3 h-3 mr-1" />
                          Connected
                        </>
                      ) : (
                        <>
                          <Plug className="w-3 h-3 mr-1" />
                          Not Connected
                        </>
                      )}
                    </Badge>
                  </div>
                </div>
                {integration.connected && (
                  <Button variant="ghost" size="sm">
                    <Settings className="w-4 h-4" />
                  </Button>
                )}
              </div>

              <p className="text-sm text-muted-foreground mb-4 leading-relaxed">{integration.description}</p>

              <div className="flex gap-2">
                <Button
                  onClick={() => toggleIntegration(integration.id)}
                  variant={integration.connected ? "outline" : "default"}
                  size="sm"
                  className={!integration.connected ? "bg-jello-blue hover:bg-jello-blue/90" : ""}
                >
                  {integration.connected ? "Disconnect" : "Connect"}
                </Button>
                <Button variant="ghost" size="sm">
                  <ExternalLink className="w-4 h-4" />
                </Button>
              </div>
            </motion.div>
          ))}
        </div>

        {filteredIntegrations.length === 0 && (
          <div className="text-center py-12">
            <Plug className="w-12 h-12 text-muted-foreground mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-foreground mb-2">No integrations found</h3>
            <p className="text-muted-foreground">Try selecting a different category</p>
          </div>
        )}
      </div>
    </SettingsLayout>
  )
}


############################## FIN DEL ARCHIVO: app\settings\integrations\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\settings\notifications\page.tsx ##############################

"use client"

import { useState, useEffect } from "react"
import { motion } from "framer-motion"
import { Bell, Mail, MessageSquare, Calendar, Users } from "lucide-react"
import { SettingsLayout } from "@/components/settings/settings-layout"
import { Checkbox } from "@/components/ui/checkbox"
import { Button } from "@/components/ui/button"
import { useApi } from "@/hooks/useApi"
import { UserSettings } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"

type NotificationCategory = keyof UserSettings["notifications"];

export default function NotificationSettingsPage() {
  const { data: settings, isLoading, refetch } = useApi<UserSettings>('/user/me/settings');
  const [notifications, setNotifications] = useState<UserSettings['notifications'] | null>(null);

  useEffect(() => {
    if (settings) {
      setNotifications(settings.notifications);
    }
  }, [settings]);

  const updateSetting = (category: NotificationCategory, type: "email" | "push" | "inApp", value: boolean) => {
    setNotifications(prev => {
        if (!prev) return null;
        return {
            ...prev,
            [category]: {
                ...prev[category],
                [type]: value,
            }
        }
    });
  }
  
  const handleSaveChanges = async () => {
    toast.info("Saving notification settings...");
    try {
        await apiClient.put('/user/me/settings', { notifications });
        toast.success("Settings saved!");
        refetch();
    } catch(err) {
        toast.error((err as Error).message);
    }
  }

  const notificationTypes = [
    { id: "tasks", title: "Task Updates", description: "When tasks are assigned, completed, etc.", icon: MessageSquare },
    { id: "meetings", title: "Meeting Reminders", description: "For upcoming meetings and events", icon: Calendar },
    { id: "team", title: "Team Activity", description: "On team member activities and changes", icon: Users },
    { id: "mentions", title: "Mentions & Comments", description: "When someone mentions you", icon: Bell },
  ]

  if (isLoading || !notifications) {
    return <SettingsLayout><Skeleton className="w-full h-96" /></SettingsLayout>
  }

  return (
    <SettingsLayout>
      <div className="space-y-8">
        <div>
          <h2 className="text-2xl font-bold text-foreground mb-2">Notification Settings</h2>
          <p className="text-muted-foreground">Choose how you want to be notified</p>
        </div>
        <div className="space-y-6">
          {/* ... Table header remains the same ... */}
          {notificationTypes.map((setting) => (
            <motion.div
              key={setting.id}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              className="grid grid-cols-4 gap-4 items-center p-4 rounded-xl glass-card"
            >
              {/* ... Icon and description remain the same ... */}
              <div className="flex justify-center">
                <Checkbox
                  checked={notifications[setting.id as NotificationCategory]?.email}
                  onCheckedChange={(checked) => updateSetting(setting.id as NotificationCategory, "email", !!checked)}
                />
              </div>
              <div className="flex justify-center">
                 <Checkbox
                  checked={notifications[setting.id as NotificationCategory]?.push}
                  onCheckedChange={(checked) => updateSetting(setting.id as NotificationCategory, "push", !!checked)}
                />
              </div>
              <div className="flex justify-center">
                <Checkbox
                  checked={notifications[setting.id as NotificationCategory]?.inApp}
                  onCheckedChange={(checked) => updateSetting(setting.id as NotificationCategory, "inApp", !!checked)}
                />
              </div>
            </motion.div>
          ))}
        </div>
        <div className="flex gap-3 pt-6 border-t border-border">
          <Button onClick={handleSaveChanges} className="bg-primary hover:bg-primary-hover">Save Preferences</Button>
        </div>
      </div>
    </SettingsLayout>
  )
}


############################## FIN DEL ARCHIVO: app\settings\notifications\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\settings\page.tsx ##############################

import { redirect } from "next/navigation"

export default function SettingsPage() {
  redirect("/settings/integrations")
}


############################## FIN DEL ARCHIVO: app\settings\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\tasks\page.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import Link from "next/link"
import { AppLayout } from "@/components/layout/app-layout"
import { Input } from "@/components/ui/input"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Search, ArrowRight, AlertTriangle, Tag } from "lucide-react" 
import { TaskModal } from "@/components/tasks/task-modal"
import { cn } from "@/lib/utils"
import { TaskDetails, TaskSummary, ProjectDetails as ProjectDetailsType, UserSummary } from "@/types"
import { useApi } from "@/hooks/useApi"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"
import { 
    Tooltip, 
    TooltipContent, 
    TooltipProvider, 
    TooltipTrigger 
} from "@/components/ui/tooltip"

const statusConfig: { [key: string]: { color: string; label: string } } = {
    "all": { color: "bg-gray-500", label: "All Tasks" },
    "todo": { color: "bg-gray-500", label: "To Do" },
    "in-progress": { color: "bg-blue-500", label: "In Progress" },
    "review": { color: "bg-yellow-500", label: "Review" },
    "done": { color: "bg-green-500", label: "Done" },
};
export default function MyTasksPage() {
    const [searchQuery, setSearchQuery] = React.useState("");
    const [statusFilter, setStatusFilter] = React.useState<keyof typeof statusConfig>("all");
    const { data: tasks, isLoading, error, refetch } = useApi<TaskSummary[]>(`/tasks/my-tasks`);
    const [selectedTask, setSelectedTask] = React.useState<TaskDetails | null>(null);
    const [projectMembersForTask, setProjectMembersForTask] = React.useState<UserSummary[]>([]);
    const [isModalOpen, setIsModalOpen] = React.useState(false);
    
    const filteredTasks = React.useMemo(() => {
        return tasks?.filter((task) => {
            const matchesStatus = statusFilter === "all" || task.status === statusFilter;
            const matchesSearch = task.title.toLowerCase().includes(searchQuery.toLowerCase());
            return matchesStatus && matchesSearch;
        }) || [];
    }, [tasks, statusFilter, searchQuery]);
    
    const tasksByStatus = React.useMemo(() => ({
        todo: tasks?.filter((t) => t.status === "todo").length || 0,
        "in-progress": tasks?.filter((t) => t.status === "in-progress").length || 0,
        review: tasks?.filter((t) => t.status === "review").length || 0,
        done: tasks?.filter((t) => t.status === "done").length || 0,
    }), [tasks]);
    
    const handleTaskView = async (taskSummary: TaskSummary) => {
        try {
            toast.info("Loading task details...");
            const [taskDetails, projectDetails] = await Promise.all([
              apiClient.get<TaskDetails>(`/tasks/${taskSummary.id}`),
              apiClient.get<ProjectDetailsType>(`/projects/${taskSummary.projectId}`)
            ]);
            setSelectedTask(taskDetails);
            setProjectMembersForTask(projectDetails.members);
            setIsModalOpen(true);
            
            toast.dismiss();
        } catch (err) {
            toast.error("Failed to load task details.");
            toast.dismiss();
        }
    };

    const handleModalClose = () => {
      setIsModalOpen(false);
      setSelectedTask(null);
      setProjectMembersForTask([]);
    }
    
    const StatCard = ({ status, count }: { status: keyof typeof tasksByStatus | 'all'; count: number }) => {
        const config = statusConfig[status];
        return (
            <motion.button whileTap={{ scale: 0.95 }} onClick={() => setStatusFilter(status)} className="w-full text-left">
                <div className={cn("glass-card p-4 rounded-2xl transition-all", statusFilter === status ? 'ring-2 ring-primary' : 'ring-0 ring-transparent')}>
                    <div className="flex items-center gap-3">
                        <div className={`w-3 h-3 rounded-full ${config.color}`} />
                        <div>
                            <p className="text-2xl font-bold text-foreground">{count}</p>
                            <p className="text-sm text-muted-foreground capitalize">{config.label}</p>
                         </div>
                    </div>
                </div>
            </motion.button>
        );
    };

    return (
        <>
            <AppLayout>
                <div className="max-w-4xl mx-auto space-y-8 p-6">
                    <div>
                        <h1 className="text-3xl font-bold text-foreground">My Tasks</h1>
                         <p className="text-muted-foreground">All tasks assigned to you across projects</p>
                    </div>

                    <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                        <StatCard status="all" count={tasks?.length || 0} />
                         <StatCard status="todo" count={tasksByStatus.todo} />
                        <StatCard status="in-progress" count={tasksByStatus["in-progress"]} />
                        <StatCard status="review" count={tasksByStatus.review} />
                        <StatCard status="done" count={tasksByStatus.done} />
                    </div>

                    <div className="relative">
                        <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-muted-foreground" />
                        <Input placeholder="Search tasks..." className="pl-12 h-11" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                    </div>
                    
                    {isLoading ?
(
                        <div className="space-y-4">
                            {Array.from({ length: 3 }).map((_, i) => <Skeleton key={i} className="h-20 w-full rounded-2xl" />)}
                        </div>
                    ) : error ?
(
                        <div className="text-center text-destructive"><AlertTriangle className="mx-auto mb-2" /> {error}</div>
                    ) : (
                        <div className="space-y-4">
                     
                         {filteredTasks.map((task, index) => {
                                // --- INICIO DE LA CORRECCIÓN ---
                                const taskAsAny = task as any;

                                // 1. ID de la Tarea (para el 'key' y 'onClick')
                                const correctTaskId = taskAsAny._id || task.id;
                                
                                // 2. ID del Proyecto (para el 'Link' y 'onClick')
                                let correctProjectId: string;
                                if (taskAsAny.project && typeof taskAsAny.project === 'object') {
                                    correctProjectId = taskAsAny.project._id;
                                } else if (taskAsAny.project) {
                                    correctProjectId = taskAsAny.project;
                                } else {
                                    correctProjectId = task.projectId;
                                }

                                // 3. Nombre del Proyecto (para mostrar en la UI)
                                let correctProjectName: string;
                                if (taskAsAny.project && typeof taskAsAny.project === 'object') {
                                    correctProjectName = taskAsAny.project.name;
                                } else {
                                    // Fallback: si no tenemos nombre, mostramos el ID
                                    correctProjectName = correctProjectId; 
                                }
                                // --- FIN DE LA CORRECCIÓN ---

                                return (
                                <motion.div
                                    key={correctTaskId}
                                    className="glass-card p-4 rounded-2xl hover:shadow-lg transition-all duration-200 cursor-pointer"
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    transition={{ delay: index * 0.05 }}
                                    onClick={() => handleTaskView({ ...task, id: correctTaskId, projectId: correctProjectId })}
                                >
                                    <div className="flex items-center gap-4">
                                        <div className={`w-1.5 h-16 rounded-full ${statusConfig[task.status].color}`} />
                                        <div className="flex-1 min-w-0">
                                            <p className="font-semibold text-foreground truncate">{task.title}</p>
                                            <div className="flex items-center gap-4 text-xs text-muted-foreground mt-2">
                                                {/* AQUÍ ESTABA EL ERROR: Usamos el nombre del proyecto */}
                                                <span className="truncate">{correctProjectName}</span>
                                                <span>•</span>
                                                <span>Due: {task.dueDate ? new Date(task.dueDate).toLocaleDateString() : 'N/A'}</span>
                                            </div>
                                        </div>
                                        <div className="flex flex-col items-end gap-2">
                                            <div className="flex gap-1">
        {task.labels && task.labels.length > 0 && (
            <Badge variant="secondary" className="flex items-center gap-1.5 px-2 py-0 text-xs">
                <Tag className="w-3 h-3" />
                {task.labels.length}
            </Badge>
        )}
    </div>
                                            {/* Usamos el ID de proyecto correcto para el Link */}
                                            <Link href={`/project/${correctProjectId}`} onClick={(e) => e.stopPropagation()}>
                                                <Button variant="ghost" size="sm" asChild>
                                                    <span className="flex items-center">
                                                        Go to project <ArrowRight className="w-3 h-3 ml-2" />
                                                    </span>
                                                </Button>
                                            </Link>
                                        </div>
                                    </div>
                                </motion.div>
                            )})}
                        </div>
                    )}
                </div>
            </AppLayout>

            <TaskModal
                isOpen={isModalOpen}
                onClose={handleModalClose}
                task={selectedTask}
                onDataChange={refetch}
                projectMembers={projectMembersForTask}
                showGoToProjectButton={true}
            />
        </>
    )
}

############################## FIN DEL ARCHIVO: app\tasks\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\todos\page.tsx ##############################

"use client"

import { useState, useEffect, useMemo } from "react"
import { motion, AnimatePresence } from "framer-motion"
import { AppLayout } from "@/components/layout/app-layout"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Label } from "@/components/ui/label"
import { Badge } from "@/components/ui/badge"
import { Checkbox } from "@/components/ui/checkbox"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Progress } from "@/components/ui/progress"
import { Trash2, Plus, CheckSquare, AlertTriangle } from "lucide-react"
import { DatePicker } from "@/components/ui/date-picker"
import { useApi } from "@/hooks/useApi"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"
import { Todo } from "@/types"

const categories = ["All", "Work", "Personal", "Projects", "Health"]
const priorities = [
  { value: "All", label: "All" },
  { value: "high", label: "High" },
  { value: "medium", label: "Medium" },
  { value: "low", label: "Low" }
]

export default function PersonalTodosPage() {
const { data: todos, isLoading, error, refetch, setData } = useApi<Todo[]>('/todos');
  const [isAdding, setIsAdding] = useState(false)
  const [newTodoText, setNewTodoText] = useState("")
  const [newTodoPriority, setNewTodoPriority] = useState<Todo['priority']>("medium")
  const [newTodoCategory, setNewTodoCategory] = useState("Personal")
  const [newTodoDueDate, setNewTodoDueDate] = useState<Date | undefined>()

  const [filterCategory, setFilterCategory] = useState("All")
  const [filterPriority, setFilterPriority] = useState("All")
  const [showCompleted, setShowCompleted] = useState(true)
  const [isManaging, setIsManaging] = useState(false)

  const addTodo = async () => {
    if (!newTodoText.trim()) return;
    try {
      const newTodo = await apiClient.post<Todo>('/todos', { 
        text: newTodoText,
        priority: newTodoPriority,
        category: newTodoCategory,
        dueDate: newTodoDueDate?.toISOString()
      });
      
      toast.success("Todo added!");
      
      setData(prevTodos => (prevTodos ? [...prevTodos, newTodo] : [newTodo]));

      setNewTodoText("");
      setNewTodoPriority("medium");
      setNewTodoCategory("Personal");
      setNewTodoDueDate(undefined);
      setIsAdding(false);
    } catch (err) {
      toast.error((err as Error).message); 
    }
  }

  const toggleTodo = async (id: string, completed: boolean) => {
    try {
      await apiClient.put(`/todos/${id}`, { completed });
      toast.success(`Task ${completed ? 'completed' : 'reopened'}!`);
      refetch();
    } catch (err) {
      toast.error((err as Error).message);
    }
  }

  const deleteTodo = async (id: string) => {
    if (!window.confirm("Are you sure you want to delete this todo?")) return;
    try {
      await apiClient.del(`/todos/${id}`);
      toast.success("Todo deleted.");
      refetch();
    } catch (err) {
      toast.error((err as Error).message);
    }
  }

  const filteredTodos = useMemo(() => {
    return todos?.filter((todo) => {
      if (!showCompleted && todo.completed) return false
      if (filterCategory !== "All" && todo.category !== filterCategory) return false
      if (filterPriority !== "All" && todo.priority !== filterPriority.toLowerCase()) return false
      return true
    }) || [];
  }, [todos, showCompleted, filterCategory, filterPriority]);

  const completedCount = todos?.filter((todo) => todo.completed).length || 0;
  const totalCount = todos?.length || 0;
  const progressPercentage = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case "high": return "bg-red-500";
      case "medium": return "bg-yellow-500";
      case "low": return "bg-green-500";
      default: return "bg-gray-500";
    }
  };

  return (
    <AppLayout>
      <div className="p-6 max-w-4xl mx-auto space-y-6">
        <div>
          <div className="flex items-center gap-3 mb-4">
            <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-primary to-primary/80 flex items-center justify-center">
              <CheckSquare className="w-6 h-6 text-primary-foreground" />
            </div>
            <div>
              <h1 className="text-3xl font-bold text-foreground">Personal Todos</h1>
              <p className="text-muted-foreground">Manage your personal tasks and goals</p>
            </div>
          </div>
          <div className="glass-card p-4 rounded-2xl">
            <div className="flex items-center justify-between mb-2">
              <span className="text-sm font-medium text-foreground">Progress: {completedCount} of {totalCount} completed</span>
              <span className="text-sm text-muted-foreground">{Math.round(progressPercentage)}%</span>
            </div>
            <Progress value={progressPercentage} className="h-2" />
          </div>
        </div>

        <div className="glass-card p-4 rounded-2xl">
          <div className="flex flex-wrap gap-4 items-center">
            <div className="flex items-center gap-2">
              <span className="text-sm font-medium text-foreground">Category:</span>
              <Select value={filterCategory} onValueChange={setFilterCategory}>
                <SelectTrigger className="w-[120px]"><SelectValue /></SelectTrigger>
                <SelectContent>{categories.map(c => <SelectItem key={c} value={c}>{c}</SelectItem>)}</SelectContent>
              </Select>
            </div>
            <div className="flex items-center gap-2">
              <span className="text-sm font-medium text-foreground">Priority:</span>
              <Select value={filterPriority} onValueChange={setFilterPriority}>
                <SelectTrigger className="w-[120px]"><SelectValue /></SelectTrigger>
                <SelectContent>{priorities.map(p => <SelectItem key={p.value} value={p.value}>{p.label}</SelectItem>)}</SelectContent>
              </Select>
            </div>
            <div className="flex items-center gap-2">
              <Checkbox id="show-completed" checked={showCompleted} onCheckedChange={(checked) => setShowCompleted(Boolean(checked))} />
              <Label htmlFor="show-completed" className="text-sm">Show completed</Label>
            </div>
            <div className="flex-grow flex justify-end">
              <Button variant={isManaging ? "destructive" : "outline"} onClick={() => setIsManaging(!isManaging)}>
                {isManaging ? "Done" : "Manage"}
              </Button>
            </div>
          </div>
        </div>

        <div className="glass-card p-4 rounded-2xl">
          <AnimatePresence mode="wait">
            {isAdding ? (
              <motion.div key="form" initial={{ height: 0, opacity: 0 }} animate={{ height: "auto", opacity: 1 }} exit={{ height: 0, opacity: 0 }} transition={{ duration: 0.3, ease: "easeInOut" }} className="overflow-hidden">
                <div className="space-y-4 p-2">
                  <Input placeholder="What do you need to do?" value={newTodoText} onChange={(e) => setNewTodoText(e.target.value)} className="text-lg h-12" autoFocus />
                  <div className="grid sm:grid-cols-3 gap-4">
                    <div className="space-y-2">
                      <Label>Priority</Label>
                      <Select
                        value={newTodoPriority}
                        onValueChange={(value) => setNewTodoPriority(value as Todo['priority'])}
                      >
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>
                          {priorities.filter(p => p.value !== 'All').map(p =>
                            <SelectItem key={p.value} value={p.value}>
                              {p.label}
                            </SelectItem>
                          )}
                        </SelectContent>
                      </Select>
                    </div>

                    <div className="space-y-2">
                      <Label>Category</Label>
                      <Select value={newTodoCategory} onValueChange={(v: string) => setNewTodoCategory(v)}>
                        <SelectTrigger><SelectValue /></SelectTrigger>
                        <SelectContent>{categories.filter(c => c !== 'All').map(c => <SelectItem key={c} value={c}>{c}</SelectItem>)}</SelectContent>
                      </Select>
                    </div>
                    <div className="space-y-2">
                      <Label>Due Date</Label>
                      <DatePicker date={newTodoDueDate} setDate={setNewTodoDueDate} />
                    </div>
                  </div>
                  <div className="flex justify-end gap-2 pt-2">
                    <Button variant="ghost" onClick={() => setIsAdding(false)}>Cancel</Button>
                    <Button onClick={addTodo}>Add Task</Button>
                  </div>
                </div>
              </motion.div>
            ) : (
              <motion.div key="button" initial={{ opacity: 0 }} animate={{ opacity: 1 }} exit={{ opacity: 0 }}>
                <Button className="w-full h-12" variant="ghost" onClick={() => setIsAdding(true)}><Plus className="w-4 h-4 mr-2" />Add a new todo</Button>
              </motion.div>
            )}
          </AnimatePresence>
        </div>

        {isLoading ? (
          <div className="space-y-3">
            {Array.from({ length: 3 }).map((_, i) => <Skeleton key={i} className="h-20 w-full rounded-2xl" />)}
          </div>
        ) : error ? (
          <div className="text-center text-destructive"><AlertTriangle className="mx-auto mb-2" /> {error}</div>
        ) : (
          <div className="space-y-3">
            <AnimatePresence>
              {filteredTodos.map((todo) => (
                <motion.div key={todo._id} layout initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, x: -100 }} className="glass-card p-4 rounded-2xl">
                  <div className="flex items-center gap-4 w-full">
                    <Checkbox checked={todo.completed} onCheckedChange={(checked) => toggleTodo(todo._id, !!checked)} />
                    <div className="flex-1 min-w-0">
                      <p className={`text-base ${todo.completed ? "line-through text-muted-foreground" : "text-foreground wrap-break-words"} break-words`}>{todo.text}</p>
                      <div className="flex items-center gap-3 text-sm text-muted-foreground mt-1">
                        <Badge variant="secondary">{todo.category}</Badge>
                        <div className="flex items-center gap-1.5">
                          <div className={`w-2 h-2 rounded-full ${getPriorityColor(todo.priority)}`} />
                          <span className="capitalize">{todo.priority}</span>
                        </div>
                        {todo.dueDate && (<span>Due: {new Date(todo.dueDate).toLocaleDateString()}</span>)}
                      </div>
                    </div>
                    <AnimatePresence>
                      {isManaging && (
                        <motion.div initial={{ opacity: 0, scale: 0.5 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 0.5 }}>
                          <Button variant="ghost" size="icon" className="text-destructive hover:text-destructive" onClick={() => deleteTodo(todo._id)}>
                            <Trash2 className="w-4 h-4" />
                          </Button>
                        </motion.div>
                      )}
                    </AnimatePresence>
                  </div>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>
        )}
      </div>
    </AppLayout>
  )
}

############################## FIN DEL ARCHIVO: app\todos\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\verification-failed\page.tsx ##############################

// app/verification-failed/page.tsx
"use client";

import * as React from 'react';
import { apiClient } from '@/lib/api';
import { toast } from 'sonner';
import { Button } from '@/components/ui/button';
import { AlertTriangle } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { ApiError } from '@/types'; // <-- 1. Importar el tipo

export default function VerificationFailedPage() {
  const [email, setEmail] = React.useState('');
  const [isLoading, setIsLoading] = React.useState(false);

  const handleResend = async () => {
    if (!email) {
      toast.error('Por favor, ingresa tu correo electrónico.');
      return;
    }
    setIsLoading(true);
    try {
      // 2. Especificar el tipo de respuesta esperado: { message: string }
      const response = await apiClient.post<{ message: string }>('/auth/resend-verification', { email });
      toast.success(response.message || 'Correo de verificación enviado. Revisa tu bandeja de entrada.');
    } catch (error) {
      // 3. Manejar el error de forma segura
      const apiError = error as ApiError;
      const errorMessage = apiError.response?.data?.error || (error as Error).message || 'Ocurrió un error inesperado.';
      toast.error(errorMessage);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background text-center p-4">
      <AlertTriangle className="w-16 h-16 text-destructive mb-4" />
      <h1 className="text-3xl font-bold mb-2">Verificación Fallida</h1>
      <p className="text-muted-foreground mb-6 max-w-sm">
        El enlace de verificación es inválido o ha expirado. Por favor, ingresa tu correo para reenviar el enlace.
      </p>
      <div className="w-full max-w-sm space-y-4">
         <Input
            type="email"
            placeholder="tu-correo@ejemplo.com"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            disabled={isLoading}
          />
        <Button onClick={handleResend} disabled={isLoading} className="w-full">
          {isLoading ? 'Enviando...' : 'Reenviar Correo de Verificación'}
        </Button>
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: app\verification-failed\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\verification-success\page.tsx ##############################

// app/verification-success/page.tsx
import Link from 'next/link';
import { Button } from '@/components/ui/button';
import { CheckCircle } from 'lucide-react';

export default function VerificationSuccessPage() {
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background text-center p-4">
      <CheckCircle className="w-16 h-16 text-green-500 mb-4" />
      <h1 className="text-3xl font-bold mb-2">¡Cuenta Activada!</h1>
      <p className="text-muted-foreground mb-6 max-w-sm">
        Tu correo electrónico ha sido verificado correctamente. Ya puedes iniciar sesión y empezar a colaborar.
      </p>
      <Button asChild>
        <Link href="/">Ir a Iniciar Sesión</Link>
      </Button>
    </div>
  );
}

############################## FIN DEL ARCHIVO: app\verification-success\page.tsx ##################################

############################## INICIO DEL ARCHIVO: app\verify-email\page.tsx ##############################

"use client";

// 1. Importa Suspense y saca el Spinner del return
import { Suspense } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { apiClient } from '@/lib/api';
import { Spinner } from '@/components/ui/spinner';
import * as React from 'react'; // Asegúrate de que React esté importado

// 2. Mueve toda la lógica a un nuevo componente "use client"
function VerifyEmailClient() {
  const searchParams = useSearchParams();
  const router = useRouter();

  React.useEffect(() => {
    const token = searchParams.get('token');

    if (!token) {
      router.push('/verification-failed');
      return;
    }

    const verifyToken = async () => {
      try {
        await apiClient.get(`/auth/verify/${token}`);
        router.push('/verification-success');
      } catch (error) {
        router.push('/verification-failed');
      }
    };

    verifyToken();
  }, [searchParams, router]); // 'token' ya está cubierto por searchParams

  // 3. Este componente cliente renderiza el Spinner
  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background">
      <Spinner size="lg" />
      <p className="mt-4 text-muted-foreground">Verificando tu cuenta...</p>
    </div>
  );
}

// 4. La página principal (Server Component) envuelve al cliente en Suspense
export default function VerifyEmailPage() {
  const fallbackUI = (
    <div className="flex flex-col items-center justify-center min-h-screen bg-background">
      <Spinner size="lg" />
      <p className="mt-4 text-muted-foreground">Verificando tu cuenta...</p>
    </div>
  );

  return (
    <Suspense fallback={fallbackUI}>
      <VerifyEmailClient />
    </Suspense>
  );
}

############################## FIN DEL ARCHIVO: app\verify-email\page.tsx ##################################

############################## INICIO DEL ARCHIVO: components\activity\ActivityFeed.tsx ##############################


"use client"

import * as React from 'react'
import { useApi } from '@/hooks/useApi'
import { Activity } from '@/types'
import { ActivityItem } from './ActivityItem'
import { Skeleton } from '@/components/ui/skeleton'
import { AlertTriangle, List } from 'lucide-react'
import { ScrollArea } from '@/components/ui/scroll-area'

interface ActivityFeedProps {
  projectId: string;
}

export function ActivityFeed({ projectId }: ActivityFeedProps) {
  // Usamos el hook useApi para obtener la actividad específica de este proyecto
  const { data: activities, isLoading, error } = useApi<Activity[]>(`/projects/${projectId}/activity`);

  if (isLoading) {
    return (
      <div className="space-y-4">
        <Skeleton className="h-12 w-1/3" />
        {Array.from({ length: 3 }).map((_, i) => (
          <Skeleton key={i} className="h-16 w-full" />
        ))}
      </div>
    )
  }

  if (error) {
    return (
      <div className="flex flex-col items-center justify-center text-center p-8 bg-muted/50 rounded-2xl">
        <AlertTriangle className="w-10 h-10 text-destructive mb-4" />
        <h3 className="text-lg font-semibold">Could not load activity</h3>
        <p className="text-sm text-muted-foreground">{error}</p>
      </div>
    )
  }
  
  return (
    <div className="space-y-6">
      <h2 className="text-2xl font-bold flex items-center gap-3">
        <List className="w-6 h-6" />
        Recent Activity
      </h2>
      {/* 2. Envolver la lista en ScrollArea y aplicar clases de altura */}
      <ScrollArea className="h-[400px] pr-4">
        <div className="space-y-2">
          {activities && activities.length > 0 ? (
            activities.map((activity, index) => (
              <ActivityItem key={activity.id} activity={activity} index={index} />
            ))
          ) : (
            <p className="text-muted-foreground p-4 text-center">No recent activity in this project.</p>
          )}
        </div>
      </ScrollArea>
    </div>
  )
}

############################## FIN DEL ARCHIVO: components\activity\ActivityFeed.tsx ##################################

############################## INICIO DEL ARCHIVO: components\activity\ActivityItem.tsx ##############################

"use client"

import Link from "next/link"
import { motion } from "framer-motion"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { MessageSquare, CheckCircle, UserPlus, FileText } from "lucide-react"
import { formatDistanceToNow } from 'date-fns'


const activityConfig = {
  comment: { icon: MessageSquare, color: "text-blue-500" },
  completion: { icon: CheckCircle, color: "text-green-500" },
  join: { icon: UserPlus, color: "text-purple-500" },
  document: { icon: FileText, color: "text-orange-500" },
}

export function ActivityItem({ activity, index }: { activity: any, index: number }) {
  const config = activityConfig[activity.type as keyof typeof activityConfig] || activityConfig.comment;
  const Icon = config.icon;

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ delay: index * 0.05 }}
    >
      <Link href={`/project/${activity.projectId || 1}`}>
        <div className="flex items-start gap-3 p-4 rounded-xl hover:bg-muted transition-colors  min-w-0">
          <div className="w-8 h-8 rounded-full bg-muted flex-shrink-0 flex items-center justify-center">
            <Icon className={`w-4 h-4 ${config.color}`} />
          </div>
          
          <div className="flex-1 min-w-0 space-y-1">
            <p className="text-sm text-foreground truncate">
              <span className="font-semibold truncate">{activity.user.name}</span> {activity.action}{" "}
              <span className="font-semibold text-primary truncate">"{activity.target}"</span>
            </p>
            <p className="text-xs text-muted-foreground">
              {formatDistanceToNow(new Date(activity.time), { addSuffix: true })}
            </p>
          </div>

          <Avatar className="w-8 h-8">
            <AvatarImage src={activity.user.avatar} />
            <AvatarFallback>{activity.user.name.charAt(0)}</AvatarFallback>
          </Avatar>
        </div>
      </Link>
    </motion.div>
  )
}

############################## FIN DEL ARCHIVO: components\activity\ActivityItem.tsx ##################################

############################## INICIO DEL ARCHIVO: components\animated-background.tsx ##############################

"use client"

export function AnimatedBackground() {
  return (
    <div className="blob-bg">
      <div className="blob blob-1" />
      <div className="blob blob-2" />
      <div className="blob blob-3" />
    </div>
  )
}


############################## FIN DEL ARCHIVO: components\animated-background.tsx ##################################

############################## INICIO DEL ARCHIVO: components\AuthGuard.tsx ##############################

"use client"

import { useAuth } from "@/contexts/auth-context";
import { useRouter } from "next/navigation";
import { useEffect } from "react";
import { Spinner } from "@/components/ui/spinner";

export function AuthGuard({ children }: { children: React.ReactNode }) {
  const { user, isLoading } = useAuth();
  const router = useRouter();

  useEffect(() => {
    // Si la carga ha terminado y no hay usuario, redirigir a la landing.
    if (!isLoading && !user) {
      router.replace('/');
    }
  }, [isLoading, user, router]);

  // Mientras se verifica la sesión, mostramos un spinner.
  if (isLoading || !user) {
    return (
      <div className="flex h-screen w-screen items-center justify-center">
        <Spinner size="lg" />
      </div>
    );
  }

  // Si hay un usuario, mostramos el contenido de la página.
  return <>{children}</>;
}


############################## FIN DEL ARCHIVO: components\AuthGuard.tsx ##################################

############################## INICIO DEL ARCHIVO: components\dashboard\assigned-tasks-widget.tsx ##############################

// components/dashboard/assigned-tasks-widget.tsx

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import Link from "next/link" 
import { Clock } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { useApi } from "@/hooks/useApi"
import { TaskSummary } from "@/types"
import { Skeleton } from "@/components/ui/skeleton"

const priorityConfig = {
  low: { color: "bg-green-500", variant: "secondary" as const },
  medium: { color: "bg-yellow-500", variant: "secondary" as const },
  high: { color: "bg-orange-500", variant: "secondary" as const },
  critical: { color: "bg-red-500", variant: "destructive" as const },
}

// --- CAMBIO: Se añade la prop onTaskClick ---
interface AssignedTasksWidgetProps {
  onTaskClick: (task: TaskSummary) => void;
}

export function AssignedTasksWidget({ onTaskClick }: AssignedTasksWidgetProps) {
  const { data: tasks, isLoading } = useApi<TaskSummary[]>('/tasks/my-tasks?limit=3');

  return (
    <motion.div
      className="glass-card p-6 space-y-6"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.6 }}
    >
      <div className="flex items-center justify-between">
        <div className="space-y-1">
          <h3 className="text-lg font-semibold text-foreground">My Tasks</h3>
          <p className="text-sm text-muted-foreground">Tasks assigned to you across all projects</p>
        </div>
        <Button variant="ghost" size="sm" asChild>
           <Link href="/tasks">View all</Link>
        </Button>
      </div>

      <div className="space-y-4">
        {isLoading ? (
          Array.from({ length: 3 }).map((_, index) => <Skeleton key={index} className="h-16 w-full rounded-xl" />)
        ) : (
          tasks?.map((task, index) => (
            <motion.div
              key={task.id}
              className="flex items-center gap-4 p-3 rounded-xl hover:bg-muted/50 transition-colors cursor-pointer"
              initial={{ opacity: 0}}
              animate={{ opacity: 1}}
              transition={{ delay: index * 0.1 }}
              // --- CAMBIO: Se usa la prop onTaskClick ---
              onClick={() => onTaskClick(task)}
            >
              <div
                className={`w-3 h-3 rounded-full flex-shrink-0 ${priorityConfig[task.priority as keyof typeof priorityConfig].color}`}
              />
              <div className="flex-1 space-y-1 min-w-0">
                <h4 className="font-medium text-foreground truncate">{task.title}</h4>
                <div className="flex items-center gap-2 text-sm text-muted-foreground">
                  {/* --- CORRECCIÓN: Usamos el nombre del proyecto, no el ID --- */}
                  <span className="truncate">{task.projectId}</span>
                </div>
              </div>
              <div className="flex gap-3 items-center text-xs text-muted-foreground">
                  {task.dueDate && (
                    <div className="flex items-center gap-1">
                      <Clock className="w-3 h-3" />
                      <span>{new Date(task.dueDate).toLocaleDateString()}</span>
                    </div>
                  )}
                  <Badge
                    variant={priorityConfig[task.priority as keyof typeof priorityConfig].variant}
                    className="capitalize"
                  >
                    {task.priority}
                  </Badge>
              </div>
            </motion.div>
          ))
        )}
      </div>
    </motion.div>
  )
}


############################## FIN DEL ARCHIVO: components\dashboard\assigned-tasks-widget.tsx ##################################

############################## INICIO DEL ARCHIVO: components\dashboard\personal-todo-widget.tsx ##############################

"use client"
import * as React from "react"
import Link from "next/link"
import { motion, AnimatePresence } from "framer-motion"
import { Plus, Check, Trash2 } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Checkbox } from "@/components/ui/checkbox"
import { useApi } from "@/hooks/useApi"
import { Todo } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Skeleton } from "@/components/ui/skeleton"

export function PersonalTodoWidget() {
  const { data: todos, isLoading, refetch } = useApi<Todo[]>('/todos');

  // --- Mantenemos estados locales solo para la UI ---
  const [newTodoText, setNewTodoText] = React.useState("")
  const [isAdding, setIsAdding] = React.useState(false)

  // --- MODIFICADO: Funciones que llaman a la API ---
  const toggleTodo = async (id: string, completed: boolean) => {
    try {
        await apiClient.put(`/todos/${id}`, { completed });
        toast.success(`Task ${completed ? 'completed' : 'reopened'}!`);
        refetch(); // Recargamos la lista
    } catch (err) {
        toast.error((err as Error).message);
    }
  }

  const addTodo = async () => {
    if (!newTodoText.trim()) return;
    try {
      await apiClient.post('/todos', { text: newTodoText });
      toast.success("Todo added!");
      refetch(); // Recargamos la lista
      setNewTodoText("");
      setIsAdding(false);
    } catch (err) {
      toast.error((err as Error).message);
    }
  }

  const deleteTodo = async (id: string) => {
     if (!window.confirm("Are you sure?")) return;
     try {
        await apiClient.del(`/todos/${id}`);
        toast.success("Todo deleted.");
        refetch(); // Recargamos la lista
     } catch (err) {
        toast.error((err as Error).message);
     }
  }
  
  // --- MODIFICADO: Cálculos basados en datos de la API ---
  const completedCount = todos?.filter((todo) => todo.completed).length || 0;
  const totalCount = todos?.length || 0;

  return (
    <motion.div
      className="glass-card p-6 space-y-6"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.6, delay: 0.1 }}
    >
      <div className="flex items-center justify-between">
        <div className="space-y-1">
          <h3 className="text-lg font-semibold text-foreground">Personal Todo</h3>
          <p className="text-sm text-muted-foreground">
            {completedCount} of {totalCount} completed
          </p>
        </div>
        <Button variant="ghost" size="sm" onClick={() => setIsAdding(!isAdding)}>
           <Plus className="w-4 h-4" />
        </Button>
      </div>

      <div className="space-y-2">
        <div className="w-full bg-muted rounded-full h-2">
          <motion.div
            className="h-2 bg-primary rounded-full"
            initial={{ width: 0 }}
            animate={{ width: `${totalCount > 0 ? (completedCount / totalCount) * 100 : 0}%` }}
            transition={{ duration: 0.5 }}
          />
        </div>
      </div>

      <div className="space-y-3 max-h-48 overflow-y-auto pr-2">
        <AnimatePresence>
          {isLoading ? (
            Array.from({ length: 3 }).map((_, index) => <Skeleton key={index} className="h-8 w-full rounded-lg" />)
          ) : (
            todos?.map((todo) => (
              <motion.div
                key={todo._id}
                layout
                initial={{ opacity: 0, y: -10 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, x: -20 }}
                className="flex items-center gap-3 p-2 rounded-lg group"
              >
                <Checkbox 
                  checked={todo.completed} 
                  onCheckedChange={(checked) => toggleTodo(todo._id, !!checked)} 
                />
                <span className={`flex-1 text-sm truncate ${todo.completed ? "line-through text-muted-foreground" : "text-foreground"}`}>
                  {todo.text}
                </span>
                <Button 
                  variant="ghost" size="icon" 
                  className="w-6 h-6 text-destructive opacity-0 group-hover:opacity-100 transition-opacity" 
                  onClick={() => deleteTodo(todo._id)}
                >
                  <Trash2 className="w-4 h-4" />
                </Button>
              </motion.div>
            ))
          )}
        </AnimatePresence>

        {isAdding && (
          <motion.div
            className="flex items-center gap-2"
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: "auto" }}
            exit={{ opacity: 0, height: 0 }}
          >
            <Input
              placeholder="Add a new todo..."
              value={newTodoText}
              onChange={(e) => setNewTodoText(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === "Enter") addTodo();
                if (e.key === "Escape") setIsAdding(false);
              }}
              className="flex-1"
              autoFocus
            />
            <Button size="sm" onClick={addTodo}>
              <Check className="w-4 h-4" />
            </Button>
          </motion.div>
        )}
      </div>

      <div className="flex flex-wrap gap-2 pt-4 border-t border-border">
        <Button asChild variant="outline" size="sm" className="flex-1 bg-transparent">
          <Link href="/todos">View All</Link>
        </Button>
      </div>
    </motion.div>
  )
}

############################## FIN DEL ARCHIVO: components\dashboard\personal-todo-widget.tsx ##################################

############################## INICIO DEL ARCHIVO: components\dashboard\recent-activity-widget.tsx ##############################

"use client"

import Link from "next/link"
import { motion } from "framer-motion"
import { ActivityItem } from "@/components/activity/ActivityItem"
import { Button } from "@/components/ui/button"
// --- NUEVO: Imports necesarios ---
import { useApi } from "@/hooks/useApi"
import { Activity } from "@/types"
import { Skeleton } from "@/components/ui/skeleton"

export function RecentActivityWidget() {
  // --- NUEVO: Llamada a la API para obtener datos reales ---
  const { data: activities, isLoading } = useApi<Activity[]>('/activity/recent?limit=4');

  return (
    <motion.div
      className="glass-card p-6 space-y-4 flex flex-col"
      initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6, delay: 0.2 }}
    >
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold text-foreground">Recent Activity</h3>
        <Button asChild variant="ghost" size="sm">
          <Link href="/activity">View all</Link>
        </Button>
      </div>

      <div className="flex-grow space-y-1 -mx-3">
        {/* --- MODIFICADO: Lógica para mostrar estado de carga o datos reales --- */}
        {isLoading ? (
          Array.from({ length: 4 }).map((_, index) => (
            <div key={index} className="flex items-center gap-3 p-4">
              <Skeleton className="w-8 h-8 rounded-full" />
              <div className="flex-1 space-y-2">
                <Skeleton className="h-4 w-3/4" />
                <Skeleton className="h-3 w-1/4" />
              </div>
              <Skeleton className="w-8 h-8 rounded-full" />
            </div>
          ))
        ) : (
          activities?.map((activity, index) => (
            <ActivityItem key={activity.id} activity={activity} index={index} />
          ))
        )}
      </div>
    </motion.div>
  )
}

############################## FIN DEL ARCHIVO: components\dashboard\recent-activity-widget.tsx ##################################

############################## INICIO DEL ARCHIVO: components\forms\assignee-selector.tsx ##############################

"use client"

import * as React from 'react'
import { motion } from 'framer-motion'
import { UserSummary } from '@/types'
import { cn } from "@/lib/utils"
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { CheckCircle } from 'lucide-react'
import { ScrollArea } from '@/components/ui/scroll-area'

interface AssigneeSelectorProps {
  projectMembers: UserSummary[];
  selectedAssignees: string[];
  onSelectionChange: (selectedIds: string[]) => void;
}

export function AssigneeSelector({ projectMembers, selectedAssignees, onSelectionChange }: AssigneeSelectorProps) {
  
  // Usamos useCallback para asegurar que la función no se recree en cada render,
  // lo cual es una de las causas comunes de los bucles infinitos.
  const handleToggleMember = React.useCallback((memberId: string) => {
    const isSelected = selectedAssignees.includes(memberId);
    if (isSelected) {
      onSelectionChange(selectedAssignees.filter(id => id !== memberId));
    } else {
      onSelectionChange([...selectedAssignees, memberId]);
    }
  }, [selectedAssignees, onSelectionChange]); // Dependencias de la función

  return (
    <ScrollArea className="h-fit">
      <div className="space-y-2 pr-4">
        {projectMembers.map((member) => (
          <motion.div
            key={member.id}
            onClick={() => handleToggleMember(member.id)}
            className={cn(
              "flex items-center gap-3 p-2 rounded-lg border-1 cursor-pointer transition-all relative",
              selectedAssignees.includes(member.id)
                ? "border-primary bg-primary/10"
                : "border-border hover:bg-muted" // Borde visible en estado no seleccionado
            )}
            whileHover={{ scale: 1.02 }}
          >
            {selectedAssignees.includes(member.id) && (
              <motion.div 
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                // Centrado del check
                className="absolute top-1/2 right-2 -translate-y-1/2 bg-primary text-primary-foreground rounded-full flex items-center justify-center"
              >
                <CheckCircle className="w-5 h-5 p-0.5" />
              </motion.div>
            )}
            <Avatar className="w-8 h-8">
              <AvatarImage src={member.avatarUrl || ''} alt={member.name} />
              <AvatarFallback>{member.name.charAt(0)}</AvatarFallback>
            </Avatar>
            <div className="flex-1 min-w-0">
              <p className="font-medium text-foreground text-sm truncate">{member.name}</p>
            </div>
          </motion.div>
        ))}
      </div>
    </ScrollArea>
  )
}

############################## FIN DEL ARCHIVO: components\forms\assignee-selector.tsx ##################################

############################## INICIO DEL ARCHIVO: components\forms\color-selector.tsx ##############################

"use client"

import * as React from 'react';
import { cn } from '@/lib/utils';
import { Check } from 'lucide-react';

const colors = [
  'bg-slate-500', 'bg-gray-500', 'bg-zinc-500', 'bg-neutral-500', 'bg-stone-500',
  'bg-red-500', 'bg-orange-500', 'bg-amber-500', 'bg-yellow-500', 'bg-lime-500',
  'bg-green-500', 'bg-emerald-500', 'bg-teal-500', 'bg-cyan-500', 'bg-sky-500',
  'bg-blue-500', 'bg-indigo-500', 'bg-violet-500', 'bg-purple-500', 'bg-fuchsia-500',
  'bg-pink-500', 'bg-rose-500'
];

interface ColorSelectorProps {
  selectedColor: string;
  onSelectColor: (color: string) => void;
}

export function ColorSelector({ selectedColor, onSelectColor }: ColorSelectorProps) {
  return (
    <div className="flex flex-wrap gap-2">
      {colors.map((color) => (
        <button
          key={color}
          type="button"
          className={cn(
            "w-8 h-8 rounded-full border-2 border-transparent transition-all",
            color,
            selectedColor === color ? 'ring-2 ring-offset-2 ring-primary ring-offset-background' : ''
          )}
          onClick={() => onSelectColor(color)}
          aria-label={`Select color ${color}`}
        >
          {selectedColor === color && <Check className="w-5 h-5 text-white" />}
        </button>
      ))}
    </div>
  );
}

############################## FIN DEL ARCHIVO: components\forms\color-selector.tsx ##################################

############################## INICIO DEL ARCHIVO: components\forms\image-upload-field.tsx ##############################

// components/forms/image-upload-field.tsx

"use client";

import { useState, useRef } from 'react';
import { UploadCloud, X, Image as ImageIcon } from 'lucide-react';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Button } from '@/components/ui/button';

interface ImageUploadFieldProps {
  name: string;
  label: string;
  onChange: (file: File | null) => void;
  initialImage?: string | null; // <-- Corrección: Propiedad añadida
}

export const ImageUploadField: React.FC<ImageUploadFieldProps> = ({ name, label, onChange, initialImage }) => {
  const [preview, setPreview] = useState<string | null>(initialImage || null);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    const file = event.target.files?.[0] || null;
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        setPreview(reader.result as string);
      };
      reader.readAsDataURL(file);
    } else {
      setPreview(null);
    }
    onChange(file);
  };

  const handleRemoveImage = () => {
    setPreview(null);
    onChange(null);
    if (fileInputRef.current) {
      fileInputRef.current.value = '';
    }
  };

  const handleUploadClick = () => {
    fileInputRef.current?.click();
  };

  return (
    <div className="space-y-2">
      <label htmlFor={name} className="block text-sm font-medium text-muted-foreground">
        {label}
      </label>
      <div className="flex items-center gap-4">
        <Avatar className="h-16 w-16 rounded-lg">
          <AvatarImage src={preview || undefined} className="object-cover" />
          <AvatarFallback className="rounded-lg bg-muted">
            <ImageIcon className="h-8 w-8 text-muted-foreground" />
          </AvatarFallback>
        </Avatar>
        <div className="flex-1">
          <input
            type="file"
            id={name}
            name={name}
            ref={fileInputRef}
            onChange={handleFileChange}
            className="hidden"
            accept="image/png, image/jpeg, image/gif"
          />
          {preview ? (
            <div className="flex items-center gap-2">
              <Button type="button" variant="outline" size="sm" onClick={handleUploadClick}>
                Change
              </Button>
              <Button type="button" variant="ghost" size="sm" onClick={handleRemoveImage}>
                <X className="mr-2 h-4 w-4" /> Remove
              </Button>
            </div>
          ) : (
            <Button type="button" variant="outline" size="sm" onClick={handleUploadClick}>
              <UploadCloud className="mr-2 h-4 w-4" /> Upload
            </Button>
          )}
          <p className="text-xs text-muted-foreground mt-1">PNG, JPG, GIF up to 5MB.</p>
        </div>
      </div>
    </div>
  );
};

############################## FIN DEL ARCHIVO: components\forms\image-upload-field.tsx ##################################

############################## INICIO DEL ARCHIVO: components\forms\label-manager.tsx ##############################

// Jello-Frontend/components/forms/label-manager.tsx

"use client"

import * as React from "react"
import { motion, AnimatePresence } from "framer-motion"
import { X, LoaderCircle } from "lucide-react"
import { Input } from "@/components/ui/input"
import { Label as LabelType } from "@/types"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { Badge } from "@/components/ui/badge"

const COLORS = ["#ef4444", "#f97316", "#eab308", "#84cc16", "#22c55e", "#14b8a6", "#06b6d4", "#3b82f6", "#8b5cf6", "#d946ef", "#ec4899"];
const getRandomColor = () => COLORS[Math.floor(Math.random() * COLORS.length)];

// --- INICIO DE LA CORRECCIÓN: Props modificadas para un componente controlado ---
interface LabelManagerProps {
  labels: LabelType[];
  onLabelAdd: (name: string) => void;
  onLabelDelete: (id: string) => void;
  isSubmitting: boolean;
}

export function LabelManager({ labels, onLabelAdd, onLabelDelete, isSubmitting }: LabelManagerProps) {
  const [newLabelName, setNewLabelName] = React.useState("");

  const handleCreateLabel = () => {
    if (!newLabelName.trim() || isSubmitting) return;
    onLabelAdd(newLabelName.trim()); // Llama a la función del padre
    setNewLabelName("");
  };

  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleCreateLabel();
    }
  };

  return (
    <div className="space-y-3">
      <div className="relative">
        <Input
          placeholder="Add a new label and press Enter"
          value={newLabelName}
          onChange={(e) => setNewLabelName(e.target.value)}
          onKeyDown={handleKeyDown}
          disabled={isSubmitting}
          className="pr-8"
        />
        {isSubmitting && <LoaderCircle className="w-4 h-4 animate-spin absolute right-2 top-1/2 -translate-y-1/2" />}
      </div>
      <div className="flex flex-wrap gap-2 min-h-[20px]">
        <AnimatePresence>
          {labels.map(label => (
            <motion.div key={label._id} initial={{ opacity: 0, scale: 0.5 }} animate={{ opacity: 1, scale: 1 }} exit={{ opacity: 0, scale: 0.5 }}>
              <Badge variant="secondary" className="text-sm py-1 px-3" style={{ backgroundColor: label.color + '20', color: label.color }}>
                {label.name}
                <button 
                  onClick={() => onLabelDelete(label._id)} 
                  className="..." 
                  disabled={isSubmitting}
                  type="button" // <--- AÑADIR ESTA LÍNEA
                >
                  <X className="h-3 w-3" />
                </button>
              </Badge>
            </motion.div>
          ))}
        </AnimatePresence>
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: components\forms\label-manager.tsx ##################################

############################## INICIO DEL ARCHIVO: components\forms\member-selector.tsx.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"

// Mock de miembros del equipo. En una app real, esto vendría de una API.
const mockTeamMembers = [
  { id: "1", name: "Sarah Johnson", email: "sarah@example.com", avatar: "/sarah-avatar.png" },
  { id: "2", name: "Mike Chen", email: "mike@example.com", avatar: "/mike-avatar.jpg" },
  { id: "3", name: "Alex Rivera", email: "alex@example.com", avatar: "/diverse-user-avatars.png" },
  { id: "4", name: "Emma Davis", email: "emma@example.com", avatar: "/diverse-user-avatars.png" },
];

interface MemberSelectorProps {
  selectedMembers: string[];
  onSelectMembers: (selectedIds: string[]) => void;
}

export function MemberSelector({ selectedMembers, onSelectMembers }: MemberSelectorProps) {

  const handleToggleMember = (memberId: string) => {
    const isSelected = selectedMembers.includes(memberId);
    let newSelection: string[];

    if (isSelected) {
      // Si ya está seleccionado, lo quitamos
      newSelection = selectedMembers.filter((id) => id !== memberId);
    } else {
      // Si no está seleccionado, lo añadimos
      newSelection = [...selectedMembers, memberId];
    }

    // Informamos al componente padre del cambio
    onSelectMembers(newSelection);
  };

  return (
    <div className="space-y-2 max-h-48 overflow-y-auto pr-2">
      {mockTeamMembers.map((member) => (
        <motion.div
          key={member.id}
          className={cn(
            "flex items-center gap-3 p-3 rounded-xl border-2 cursor-pointer transition-all",
            selectedMembers.includes(member.id)
              ? "border-primary bg-primary/10"
              : "border-border hover:bg-muted"
          )}
          whileHover={{ scale: 1.02 }}
          whileTap={{ scale: 0.98 }}
          onClick={() => handleToggleMember(member.id)}
        >
          <Avatar className="w-8 h-8">
            <AvatarImage src={member.avatar || "/placeholder.svg"} alt={member.name} />
            <AvatarFallback className="text-xs">{member.name.charAt(0)}</AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <p className="font-medium text-foreground text-sm truncate">{member.name}</p>
            <p className="text-xs text-muted-foreground truncate">{member.email}</p>
          </div>
          {selectedMembers.includes(member.id) && (
            <Badge variant="secondary" className="text-xs">
              Selected
            </Badge>
          )}
        </motion.div>
      ))}
    </div>
  );
}

############################## FIN DEL ARCHIVO: components\forms\member-selector.tsx.tsx ##################################

############################## INICIO DEL ARCHIVO: components\jelli-chat.tsx ##############################

"use client"

import * as React from "react";
import { motion, AnimatePresence } from "framer-motion";
import { Send, Bot, Sparkle, Ban, Plus, LoaderCircle, Download } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar";
import { apiClient } from "@/lib/api";
import { useAuth } from "@/contexts/auth-context";
import { TaskSummary } from "@/types";
import { toast } from "sonner";
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";

interface ChatMessage {
  id: string;
  content: string;
  sender: "user" | "jelli";
}

export function JelliChat() {
  const { user } = useAuth();
  const [messages, setMessages] = React.useState<ChatMessage[]>([
    { id: "init", content: "¡Hola! Soy Jelli. ¿En qué puedo ayudarte?", sender: "jelli" }
  ]);
  const [inputValue, setInputValue] = React.useState("");
  const [isLoading, setIsLoading] = React.useState(false);

  const [session, setSession] = React.useState<AITextSession | null>(null);
  const [status, setStatus] = React.useState<'loading' | 'downloading' | 'ready' | 'unsupported'>('loading');

  const messagesContainerRef = React.useRef<HTMLDivElement>(null);
  const inputRef = React.useRef<HTMLInputElement>(null);

  React.useEffect(() => {
    async function initializeAi() {
      if (window.ai) {
        try {
          const available = await window.ai.canCreateTextSession('gemini-nano');

          if (available === 'no') {
            setStatus('unsupported');
            return;
          }

          if (available === 'after-download') {
            setStatus('downloading');
          }

          const newSession = await window.ai.createTextSession();
          setSession(newSession);
          setStatus('ready');
        } catch (error) {
          console.error("Error al inicializar la sesión de IA:", error);
          setStatus('unsupported');
        }
      } else {
        setStatus('unsupported');
      }
    }
    initializeAi();

    return () => {
      session?.destroy();
    };
  }, [session]);

  React.useEffect(() => {
    if (messagesContainerRef.current) {
      messagesContainerRef.current.scrollTop = messagesContainerRef.current.scrollHeight;
    }
  }, [messages]);

  const handleAddTaskContext = async () => {
    toast.info("Obteniendo contexto de tareas...");
    try {
      const tasks = await apiClient.get<TaskSummary[]>('/tasks/my-tasks');
      if (tasks && tasks.length > 0) {
        const taskTitles = tasks.map(t => `- ${t.title} (Estado: ${t.status})`).join('\n');
        const contextPrompt = `Considerando mis tareas actuales, que son:\n${taskTitles}\n\n---\n\nQuiero preguntarte lo siguiente: `;

        setInputValue(contextPrompt);
        toast.success("Contexto de tareas añadido al chat.");
        inputRef.current?.focus();
      } else {
        toast.info("No tienes tareas para añadir como contexto.");
      }
    } catch (error) {
      toast.error("No se pudo obtener el contexto de las tareas.");
      console.error("Error fetching task context:", error);
    }
  };

  const handleSendMessage = async () => {
    if (!inputValue.trim() || isLoading) return;

    const userMessage: ChatMessage = { id: Date.now().toString(), content: inputValue, sender: "user" };
    setMessages(prev => [...prev, userMessage]);
    setInputValue("");
    setIsLoading(true);

    const jelliMessageId = (Date.now() + 1).toString();

    if (status !== 'ready' || !session) {
      setTimeout(() => {
        const unsupportedMessage = "Lo siento, la IA integrada no está disponible en tu navegador.\n\nEsta función requiere **Chrome 127** o superior con las funciones experimentales activadas. Estoy simulando una respuesta para que veas cómo funcionaría.";
        setMessages(prev => [...prev, { id: jelliMessageId, content: unsupportedMessage, sender: "jelli" }]);
        setIsLoading(false);
      }, 500);
      return;
    }

    setMessages(prev => [...prev, { id: jelliMessageId, content: "", sender: "jelli" }]);

    try {
      const stream = session.promptStreaming(inputValue);

      for await (const chunk of stream) {
        setMessages(prev => prev.map(msg =>
          msg.id === jelliMessageId
            ? { ...msg, content: msg.content + chunk }
            : msg
        ));
      }
    } catch (err) {
      const errorMsgContent = "Lo siento, he tenido un problema al procesar tu solicitud.";
      setMessages(prev => prev.map(msg =>
        msg.id === jelliMessageId
          ? { ...msg, content: errorMsgContent }
          : msg
      ));
    } finally {
      setIsLoading(false);
    }
  };

  const handleNewChat = async () => {
    session?.destroy();
    setMessages([{ id: "init-reset", content: "Ok, empecemos de nuevo. ¿En qué puedo ayudarte?", sender: "jelli" }]);
    if (window.ai) {
      setStatus('loading');
      const newSession = await window.ai.createTextSession();
      setSession(newSession);
      setStatus('ready');
    }
  };

  return (
    <TooltipProvider>
      <div className="flex flex-col h-full bg-gradient-to-br from-jello-blue/5 to-jello-accent/5 rounded-2xl backdrop-blur-xl border border-white/20 shadow-2xl overflow-hidden">
        <div className="flex items-center justify-between p-4 border-b border-white/10 flex-shrink-0">
          <div className="flex items-center gap-3">
            <Avatar className="w-10 h-10 border-2 border-jello-blue/30">
              <AvatarImage src="/images/jelli-avatar.png" alt="Jelli" />
              <AvatarFallback>J</AvatarFallback>
            </Avatar>
            <div>
              <h3 className="font-semibold text-foreground">Jelli</h3>
              <p className="text-xs text-muted-foreground flex items-center gap-1.5">
                {status === 'ready' && <><span className="w-2 h-2 rounded-full bg-green-400 animate-pulse" /> Online</>}
                {status === 'loading' && <><LoaderCircle className="w-3 h-3 animate-spin" /> Inicializando IA...</>}
                {status === 'downloading' && <><Download className="w-3 h-3 text-blue-400 animate-pulse" /> Descargando modelo...</>}
                {status === 'unsupported' && <><Ban className="w-3 h-3 text-red-400" /> IA no disponible</>}
              </p>
            </div>
          </div>
          <Button variant="ghost" size="sm" onClick={handleNewChat} title="Iniciar nuevo chat">
            <Sparkle className="w-4 h-4 mr-2" />
            Nuevo
          </Button>
        </div>

        <div ref={messagesContainerRef} className="flex-1 overflow-y-auto p-4 space-y-4">
          <AnimatePresence>
            {messages.map((message) => (
              <motion.div
                key={message.id}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                className={`flex gap-3 ${message.sender === "user" ? "justify-end" : "justify-start"}`}
              >
                {message.sender === "jelli" && <Avatar className="w-10 h-10 border-2 border-jello-blue/30">
                  <AvatarImage src="/images/jelli-avatar.png" alt="Jelli" />
                  <AvatarFallback>J</AvatarFallback>
                </Avatar>}
                <div className={`max-w-[80%] ${message.sender === "user" ? "order-first" : ""}`}>
                  <div className={`p-3 rounded-2xl ${message.sender === "user" ? "bg-primary text-primary-foreground" : "bg-white/10 text-foreground"}`}>
                    <p className="text-sm leading-relaxed whitespace-pre-wrap">{message.content || "..."}</p>
                  </div>
                </div>
                {message.sender === "user" &&
                  <Avatar className="w-8 h-8 flex-shrink-0">
                    <AvatarImage src={user?.avatarUrl || "/placeholder.svg"} />
                    <AvatarFallback>{user?.name.charAt(0)}</AvatarFallback>
                  </Avatar>
                }
              </motion.div>
            ))}
            {isLoading && messages[messages.length - 1]?.sender === 'user' && (
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                className="flex gap-3 justify-start"
              >
                <Avatar className="w-10 h-10 border-2 border-jello-blue/30">
                  <AvatarImage src="/images/jelli-avatar.png" alt="Jelli" />
                  <AvatarFallback>J</AvatarFallback>
                </Avatar>
                <div className="p-3 rounded-2xl bg-white/10 text-foreground ">
                  <span className="animate-pulse">...</span>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>

        <div className="p-4 border-t border-white/10 flex-shrink-0">
          <div className="flex gap-2 items-center">
            <Tooltip>
              <TooltipTrigger asChild>
                <Button variant="ghost" size="icon" onClick={handleAddTaskContext} disabled={isLoading}>
                  <Plus className="w-4 h-4" />
                </Button>
              </TooltipTrigger>
              <TooltipContent>
                <p>Añadir contexto de tareas</p>
              </TooltipContent>
            </Tooltip>
            <Input
              ref={inputRef}
              value={inputValue}
              onChange={(e) => setInputValue(e.target.value)}
              onKeyPress={(e) => e.key === "Enter" && handleSendMessage()}
              placeholder={status !== 'ready' ? "IA no disponible, pero puedes enviar un mensaje." : "Pregúntale a Jelli..."}
              disabled={isLoading && status === 'ready'}
              className="bg-white/10 border-white/20"
            />
            <Button onClick={handleSendMessage} disabled={!inputValue.trim() || isLoading}><Send className="w-4 h-4" /></Button>
          </div>
        </div>
      </div>
    </TooltipProvider>
  )
}

############################## FIN DEL ARCHIVO: components\jelli-chat.tsx ##################################

############################## INICIO DEL ARCHIVO: components\kanban\kanban-board.tsx ##############################

"use client"

import * as React from 'react';
// ✨ CORRECCIÓN: Importamos el tipo DropResult
import { DragDropContext, type DropResult } from '@hello-pangea/dnd';
import { KanbanColumn } from './kanban-column';
import { ProjectDetails, TaskSummary } from '@/types';

interface KanbanBoardProps {
  project: ProjectDetails;
  // ✨ CORRECCIÓN: La prop ahora espera el objeto 'result' completo
  onTaskStatusChange: (result: DropResult) => void;
  onTaskClick?: (task: TaskSummary) => void;
  onAddTask?: (columnId: string) => void;
}

export function KanbanBoard({ project, onTaskStatusChange, onTaskClick, onAddTask }: KanbanBoardProps) {

  const handleDragEnd = (result: DropResult) => {
    const { destination, source } = result;

    // Si no hay destino, o si se soltó en el mismo lugar, no hacemos nada.
    if (!destination || (destination.droppableId === source.droppableId && destination.index === source.index)) {
      return;
    }
    
    // ✨ CORRECCIÓN: Pasamos el objeto 'result' completo al handler de la página.
    onTaskStatusChange(result);
  };

  const handleTaskClick = (task: TaskSummary) => {
    onTaskClick?.(task);
  }

  const handleAddTask = (columnId: string) => {
    onAddTask?.(columnId);
  }

  return (
    <DragDropContext onDragEnd={handleDragEnd}>
      <div className="flex gap-6  overflow-x-auto h-full items-stretch">
        <KanbanColumn id="todo" title="To Do" tasks={project.tasksByStatus.todo} onAddTask={() => handleAddTask('todo')} onTaskClick={handleTaskClick} />
        <KanbanColumn id="in-progress" title="In Progress" tasks={project.tasksByStatus['in-progress']} onAddTask={() => handleAddTask('in-progress')} onTaskClick={handleTaskClick} />
        <KanbanColumn id="review" title="In Review" tasks={project.tasksByStatus.review} onAddTask={() => handleAddTask('review')} onTaskClick={handleTaskClick} />
        <KanbanColumn id="done" title="Done" tasks={project.tasksByStatus.done} onAddTask={() => handleAddTask('done')} onTaskClick={handleTaskClick} />
      </div>
    </DragDropContext>
  );
}


############################## FIN DEL ARCHIVO: components\kanban\kanban-board.tsx ##################################

############################## INICIO DEL ARCHIVO: components\kanban\kanban-column.tsx ##############################

"use client"

import * as React from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import {
  Draggable,
  Droppable,
  type DroppableProvided,
  type DroppableStateSnapshot,
  type DraggableProvided
} from '@hello-pangea/dnd';
import { TaskSummary } from '@/types';
import { TaskCard } from '@/components/tasks/task-card';
import { Button } from '@/components/ui/button';
import { Plus } from 'lucide-react';
import { cn } from '@/lib/utils';

interface KanbanColumnProps {
  id: string;
  title: string;
  tasks: TaskSummary[];
  onAddTask: () => void;
  onTaskClick: (task: TaskSummary) => void;
}

const statusColorMap: { [key: string]: string } = {
  todo: 'bg-blue-500',
  'in-progress': 'bg-yellow-500',
  review: 'bg-purple-500',
  done: 'bg-green-500',
};

export function KanbanColumn({ id, title, tasks, onAddTask, onTaskClick }: KanbanColumnProps) {
  return (
    <div className="flex flex-col w-full sm:w-80 md:w-96 bg-card/50 rounded-2xl flex-shrink-0 overflow-y-auto">
      <div className="flex items-center justify-between p-4 border-b border-border/50">
        <div className="flex items-center gap-2">
          <div className={cn("w-2.5 h-2.5 rounded-full", statusColorMap[id] || 'bg-gray-400')} />
          <h3 className="font-semibold text-foreground">{title}</h3>
        </div>
        <span className="text-sm font-medium text-muted-foreground">{tasks.length}</span>
      </div>

      <Droppable droppableId={id}>
        {(provided: DroppableProvided, snapshot: DroppableStateSnapshot) => (
          <div
            ref={provided.innerRef}
            {...provided.droppableProps}
            className={cn(
    "p-4 space-y-3 transition-colors duration-200 min-h-[300px] flex-grow", 
    snapshot.isDraggingOver ? 'bg-primary/10' : ''
            )}
          >
            {tasks.map((task, index) => (
              <Draggable key={task.id} draggableId={task.id} index={index}>
                {(provided: DraggableProvided) => (
                  <div
                    ref={provided.innerRef}
                    {...provided.draggableProps}
                    {...provided.dragHandleProps}
                    onClick={() => onTaskClick(task)}
                  >
                    <TaskCard task={task} />
                  </div>
                )}
              </Draggable>
            ))}
            {provided.placeholder}
          </div>
        )}
      </Droppable>

      <div className="p-4 pt-0">
        <Button variant="ghost" className="w-full justify-start gap-2" onClick={onAddTask}>
          <Plus className="w-4 h-4" />
          Add new task
        </Button>
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: components\kanban\kanban-column.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\cta-section.tsx ##############################

"use client"

import Link from "next/link"
import { motion } from "framer-motion"
import { Button } from "@/components/ui/button"
import { ArrowRight } from "lucide-react"

export function CtaSection() {
  return (
    <section className="py-24 px-4">
      <div className="container mx-auto max-w-4xl text-center">
        <motion.div 
          className="space-y-6"
          initial={{ opacity: 0, y: 50 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true, amount: 0.5 }}
          transition={{ duration: 0.6 }}
        >
          <h2 className="text-4xl lg:text-5xl font-bold text-balance">
            Listo para transformar tu productividad?
          </h2>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            Únete a miles de equipos que ya están construyendo su futuro, una tarea a la vez. Es gratis para empezar.
          </p>
          <Link href="/register">
            <Button size="lg" className="group text-lg py-7 px-8">
              Empieza a construir
              <ArrowRight className="ml-2 h-5 w-5 transition-transform group-hover:translate-x-1" />
            </Button>
          </Link>
        </motion.div>
      </div>
    </section>
  )
}

############################## FIN DEL ARCHIVO: components\landing\cta-section.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\features-section-v2.tsx ##############################

"use client"

import { motion } from "framer-motion"
import { Users, Brain, Zap } from "lucide-react"

const features = [
  {
    icon: Users,
    title: "Colaboración Fluida",
    description: "Unifica a tu equipo con tableros Kanban flexibles y comunicación en tiempo real que escala con tus proyectos.",
    image: "/diverse-user-avatars.png"
  },
  {
    icon: Brain,
    title: "Inteligencia Artificial Integrada",
    description: "Conoce a Jelli, tu asistente contextual que crea tareas, genera resúmenes y te ayuda a enfocarte en lo que de verdad importa.",
    image: "/images/jelli-avatar.png"
  },
  {
    icon: Zap,
    title: "Personalización Total",
    description: "Adapta Jello a tu flujo de trabajo con estados, etiquetas y columnas personalizadas. La herramienta se adapta a ti.",
    image: "/abstract-geometric-shapes.png"
  },
]

export function FeaturesSectionV2() {
  return (
    <section className="py-20 px-4">
      <div className="container mx-auto max-w-6xl space-y-24">
        {features.map((feature, index) => (
          <motion.div
            key={feature.title}
            className={`grid md:grid-cols-2 gap-12 items-center ${index % 2 === 1 ? "md:grid-flow-col-dense" : ""}`}
            initial={{ opacity: 0, y: 50 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true, amount: 0.3 }}
            transition={{ duration: 0.6 }}
          >
            <div className={`space-y-6 ${index % 2 === 1 ? "md:col-start-2" : ""}`}>
              <div className="inline-flex items-center gap-3">
                <div className="w-12 h-12 bg-primary rounded-2xl flex items-center justify-center">
                  <feature.icon className="w-6 h-6 text-primary-foreground" />
                </div>
                <h3 className="text-2xl font-bold text-foreground">{feature.title}</h3>
              </div>
              <p className="text-lg text-muted-foreground leading-relaxed">{feature.description}</p>
            </div>
            <div className="glass-card p-6">
              <img src={feature.image} alt={feature.title} className="rounded-xl w-full h-auto" />
            </div>
          </motion.div>
        ))}
      </div>
    </section>
  )
}

############################## FIN DEL ARCHIVO: components\landing\features-section-v2.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\features-section.tsx ##############################

"use client"

import { motion } from "framer-motion"
import { Users, Brain, Zap } from "lucide-react"
import { Button } from "@/components/ui/button"

const features = [
  {
    icon: Users,
    title: "Seamless Collaboration",
    description:
      "Unite your team with flexible Kanban boards, real-time communication, and granular permissions that scale with your projects.",
    color: "bg-primary",
    accent: "text-primary",
  },
  {
    icon: Brain,
    title: "AI-Powered Intelligence",
    description:
      "Meet Jelli, your contextual AI assistant that creates tasks, provides smart summaries, and helps you focus on what matters most.",
    color: "bg-accent",
    accent: "text-accent",
  },
  {
    icon: Zap,
    title: "Total Customization",
    description:
      "Shape Jello to your exact workflow with custom statuses, labels, and columns. Your tool adapts to you, not the other way around.",
    color: "bg-accent-teal",
    accent: "text-accent-teal",
  },
]

export function FeaturesSection() {
  return (
    <section className="py-20 px-4">
      <div className="container mx-auto max-w-6xl">
        {/* Header */}
        <motion.div
          className="text-center space-y-4 mb-16"
          initial={{ opacity: 0}}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <h2 className="text-3xl lg:text-5xl font-bold text-balance">
            Everything you need to <span className="text-primary">work smarter</span>
          </h2>
          <p className="text-xl text-muted-foreground text-pretty max-w-3xl mx-auto">
            Jello brings together the best of project management, personal productivity, and AI assistance in one
            beautiful, intuitive platform.
          </p>
        </motion.div>

        {/* Features Grid */}
        <div className="grid md:grid-cols-3 gap-8">
          {features.map((feature, index) => (
            <motion.div
              key={feature.title}
              className="glass-card p-8 space-y-6 group hover:shadow-xl transition-all duration-300"
              initial={{ opacity: 0}}
              whileInView={{ opacity: 1 }}
              viewport={{ once: true }}
              transition={{ duration: 0.6, delay: index * 0.2 }}
            >
              {/* Icon */}
              <div className={`w-12 h-12 ${feature.color} rounded-2xl flex items-center justify-center`}>
                <feature.icon className="w-6 h-6 text-white" />
              </div>

              {/* Content */}
              <div className="space-y-4">
                <h3 className="text-xl font-semibold text-foreground">{feature.title}</h3>
                <p className="text-muted-foreground leading-relaxed">{feature.description}</p>
              </div>

              {/* Action */}
              <Button variant="ghost" className={`group-hover:${feature.accent} transition-colors`}>
                Learn more
              </Button>
            </motion.div>
          ))}
        </div>

        {/* Bottom CTA */}
        <motion.div
          className="text-center mt-16"
          initial={{ opacity: 0, y: 20 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6, delay: 0.4 }}
        >
          <Button size="lg" variant="outline">
            Explore All Features
          </Button>
        </motion.div>
      </div>
    </section>
  )
}


############################## FIN DEL ARCHIVO: components\landing\features-section.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\hero-section-v2.tsx ##############################

// Archivo: Jello-Frontend/components/landing/hero-section-v2.tsx

"use client"

import * as React from 'react'
import Link from 'next/link'
import { motion } from 'framer-motion'
import { TaskSummary } from '@/types'
import { Button } from '@/components/ui/button'
import { TaskCard } from '@/components/tasks/task-card'
import { ArrowRight } from 'lucide-react'
import { Badge } from '@/components/ui'

const mockTasks: TaskSummary[] = [
    {
        id: '1',
        title: 'Draft Q3 marketing report',
        priority: 'high',
        labels: [{ _id: 'l1', name: 'Marketing', color: '#ff6f61' }],
        assignees: [{ id: 'u1', name: 'A', avatarUrl: '/avatars/sophie.png' }],
        subtasks: { total: 2, completed: 1 },
        status: 'in-progress',
        dueDate: '2025-08-15',
        commentCount: 3,
        attachmentCount: 1,
        projectId: 'proj-1'
    },
    {
        id: '2',
        title: 'Develop new landing page design',
        priority: 'medium',
        labels: [{ _id: 'l2', name: 'Design', color: '#ec4899' }],
        assignees: [{ id: 'u2', name: 'M', avatarUrl: '/avatars/michael.png' }],
        subtasks: { total: 5, completed: 4 },
        status: 'review',
        dueDate: '2025-08-20',
        commentCount: 8,
        attachmentCount: 2,
        projectId: 'proj-1'
    },
    {
        id: '3',
        title: 'Fix authentication bug on mobile',
        priority: 'low',
        labels: [{ _id: 'l3', name: 'Bug', color: '#be123c' }],
        assignees: [{ id: 'u3', name: 'E', avatarUrl: '/avatars/eva.png' }],
        subtasks: { total: 1, completed: 1 },
        status: 'done',
        dueDate: '2025-07-30',
        commentCount: 2,
        attachmentCount: 0,
        projectId: 'proj-2'
    },
];

export function HeroSectionV2() {
    return (
        <section className="w-full py-20 md:py-32 bg-grid-pattern relative overflow-hidden">
            <div className="container mx-auto px-4 md:px-6 text-center">
                <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.8 }}
                >
                    <Badge variant="secondary" className="mb-4">Introducing Jello 2.0</Badge>
                    <h1 className="text-4xl md:text-6xl font-bold tracking-tighter text-foreground mb-6">
                        The Future of Project Management is Here
                    </h1>
                    <p className="max-w-3xl mx-auto text-lg md:text-xl text-muted-foreground mb-10">
                        Jello helps teams move work forward. A single platform for project management, collaboration, and automation.
                    </p>
                    <div className="flex justify-center gap-4">
                        <Button asChild size="lg" className="gap-2">
                            <Link href="/register">Get Started Free <ArrowRight className="w-4 h-4" /></Link>
                        </Button>
                        <Button asChild size="lg" variant="outline">
                            <Link href="/showcase">Explore Features</Link>
                        </Button>
                    </div>
                </motion.div>
            </div>
            
            <div className="absolute -bottom-20 -left-10 -right-10 h-60">
                <div className="flex justify-center items-end h-full gap-4 perspective-1000">
                    <motion.div initial={{ y: 50, opacity: 0, rotateX: 20 }} animate={{ y: 0, opacity: 1, rotateX: 0 }} transition={{ duration: 0.8, delay: 0.2 }} className="w-72">
                        <TaskCard task={mockTasks[0]} />
                    </motion.div>
                    <motion.div initial={{ y: 50, opacity: 0, rotateX: 20 }} animate={{ y: 0, opacity: 1, rotateX: 0 }} transition={{ duration: 0.8, delay: 0.4 }} className="w-72 mb-10">
                        <TaskCard task={mockTasks[1]} />
                    </motion.div>
                    <motion.div initial={{ y: 50, opacity: 0, rotateX: 20 }} animate={{ y: 0, opacity: 1, rotateX: 0 }} transition={{ duration: 0.8, delay: 0.6 }} className="w-72">
                        <TaskCard task={mockTasks[2]} />
                    </motion.div>
                </div>
            </div>
        </section>
    )
}

############################## FIN DEL ARCHIVO: components\landing\hero-section-v2.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\hero-section.tsx ##############################

"use client"

import Link from "next/link"
import { motion } from "framer-motion"
import { ArrowRight, Play } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"

export function HeroSection() {
  return (
    <section className="relative py-20 px-4">
      <div className="container mx-auto max-w-6xl">
        <div className="grid lg:grid-cols-2 gap-12 items-center">
          {/* Content */}
          <motion.div
            className="space-y-8"
            initial={{ opacity: 0, x: -50 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, ease: "easeOut" }}
          >
            <div className="space-y-4">
              <motion.div
                className="inline-flex items-center gap-2 glass-card px-4 py-2 text-sm font-medium text-primary"
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.2 }}
              >
                <span className="w-2 h-2 bg-primary rounded-full animate-pulse" />
                Your Intelligent Work Partner
              </motion.div>

              <h1 className="text-4xl lg:text-6xl font-bold text-balance leading-tight">
                Productivity that <span className="text-primary">adapts to you</span>, not the other way around
              </h1>

              <p className="text-xl text-muted-foreground text-pretty max-w-2xl">
                Jello unifies your professional and personal productivity with AI-powered assistance, seamless
                collaboration, and deep customization that grows with your workflow.
              </p>
            </div>

            <div className="flex flex-col sm:flex-row gap-4">
              <Link href="/register">
                <Button size="lg" className="group">
                  Start Your Journey
                  <ArrowRight className="ml-2 h-4 w-4 transition-transform group-hover:translate-x-1" />
                </Button>
              </Link>
              <Button variant="outline" size="lg" className="group bg-transparent">
                <Play className="mr-2 h-4 w-4" />
                Watch Demo
              </Button>
            </div>

            {/* Social Proof */}
            <div className="flex items-center gap-4 pt-4">
              <div className="flex -space-x-2">
                {[1, 2, 3, 4].map((i) => (
                  <Avatar key={i} className="w-8 h-8 border-2 border-background">
                    <AvatarImage
                      src={`/abstract-geometric-shapes.png?height=32&width=32&query=user${i}`}
                      alt={`User ${i}`}
                    />
                    <AvatarFallback>U{i}</AvatarFallback>
                  </Avatar>
                ))}
              </div>
              <div className="text-sm text-muted-foreground">
                <span className="font-semibold text-foreground">2,000+</span> teams already boosting productivity
              </div>
            </div>
          </motion.div>

          {/* Visual */}
          <motion.div
            className="relative"
            initial={{ opacity: 0, x: 50 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ duration: 0.8, ease: "easeOut", delay: 0.2 }}
          >
            <div className="glass-card p-8 space-y-6">
              {/* Jelli Characters */}
              <div className="flex justify-center">
                <motion.img
                  src="/images/jelli-planning.gif"
                  alt="Jelli characters collaborating"
                  className="w-64 h-48 object-contain"
                  animate={{ y: [0, -10, 0] }}
                  transition={{ duration: 3, repeat: Number.POSITIVE_INFINITY, ease: "easeInOut" }}
                />
              </div>

              {/* Mock Interface */}
              <div className="space-y-4">
                <div className="flex items-center gap-3">
                  <div className="w-3 h-3 bg-primary rounded-full" />
                  <div className="flex-1 h-2 bg-muted rounded-full">
                    <div className="w-3/4 h-full bg-primary rounded-full" />
                  </div>
                  <span className="text-xs text-muted-foreground">75%</span>
                </div>
                <div className="flex items-center gap-3">
                  <div className="w-3 h-3 bg-accent rounded-full" />
                  <div className="flex-1 h-2 bg-muted rounded-full">
                    <div className="w-1/2 h-full bg-accent rounded-full" />
                  </div>
                  <span className="text-xs text-muted-foreground">50%</span>
                </div>
                <div className="flex items-center gap-3">
                  <div className="w-3 h-3 bg-accent-teal rounded-full" />
                  <div className="flex-1 h-2 bg-muted rounded-full">
                    <div className="w-5/6 h-full bg-accent-teal rounded-full" />
                  </div>
                  <span className="text-xs text-muted-foreground">85%</span>
                </div>
              </div>
            </div>
          </motion.div>
        </div>
      </div>
    </section>
  )
}


############################## FIN DEL ARCHIVO: components\landing\hero-section.tsx ##################################

############################## INICIO DEL ARCHIVO: components\landing\testimonials-section.tsx ##############################

"use client"

import { motion } from "framer-motion"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"

const testimonials = [
  {
    name: "Sarah L.",
    role: "Product Manager",
    avatar: "/sarah-avatar.png",
    text: "Jello ha transformado la forma en que nuestro equipo colabora. La integración de la IA para resumir tareas es simplemente brillante."
  },
  {
    name: "Mike C.",
    role: "Lead Developer",
    avatar: "/mike-avatar.jpg",
    text: "Finalmente una herramienta que no se siente como un obstáculo. Es rápida, intuitiva y se adapta a nuestro flujo de trabajo ágil a la perfección."
  },
  {
    name: "Alex R.",
    role: "UX Designer",
    avatar: "/diverse-user-avatars.png",
    text: "Visualmente, es una delicia. La interfaz de cristal y las animaciones fluidas hacen que gestionar tareas sea una experiencia agradable."
  }
]

export function TestimonialsSection() {
  return (
    <section className="py-20 px-4 bg-card/50">
      <div className="container mx-auto max-w-6xl">
        <motion.div 
          className="text-center space-y-4 mb-12"
          initial={{ opacity: 0 }}
          whileInView={{ opacity: 1 }}
          viewport={{ once: true }}
          transition={{ duration: 0.6 }}
        >
          <h2 className="text-3xl lg:text-5xl font-bold">Amado por equipos de todo el mundo</h2>
          <p className="text-xl text-muted-foreground">No confíes solo en nuestra palabra, mira lo que dicen nuestros usuarios.</p>
        </motion.div>
        <div className="grid md:grid-cols-3 gap-8">
          {testimonials.map((testimonial, index) => (
            <motion.div 
              key={testimonial.name}
              className="glass-card p-6 text-center space-y-4"
              initial={{ opacity: 0, y: 50 }}
              whileInView={{ opacity: 1, y: 0 }}
              viewport={{ once: true }}
              transition={{ duration: 0.5, delay: index * 0.1 }}
            >
              <Avatar className="w-16 h-16 mx-auto border-4 border-background">
                <AvatarImage src={testimonial.avatar} />
                <AvatarFallback>{testimonial.name.charAt(0)}</AvatarFallback>
              </Avatar>
              <p className="text-muted-foreground italic">"{testimonial.text}"</p>
              <div>
                <h4 className="font-semibold text-foreground">{testimonial.name}</h4>
                <p className="text-sm text-primary">{testimonial.role}</p>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    </section>
  )
}

############################## FIN DEL ARCHIVO: components\landing\testimonials-section.tsx ##################################

############################## INICIO DEL ARCHIVO: components\layout\app-layout.tsx ##############################

"use client"

import * as React from "react"
import { Sidebar } from "./sidebar"
import { AnimatedBackground } from "@/components/animated-background"
import { useIsMobile } from "@/hooks/use-mobile"
import { cn } from "@/lib/utils"
import { MobileHeader } from "./mobileHeader"
import { motion, AnimatePresence } from "framer-motion"
import { Button } from "@/components/ui/button"
import { MessageSquare, X } from "lucide-react"
import { JelliChat } from "@/components/jelli-chat"
import { AuthGuard } from "@/components/AuthGuard" 

interface AppLayoutProps {
  children: React.ReactNode
}

export function AppLayout({ children }: AppLayoutProps) {
  const [isSidebarCollapsed, setIsSidebarCollapsed] = React.useState(true)
  const [isChatOpen, setIsChatOpen] = React.useState(false)
  const [isChatInitialized, setIsChatInitialized] = React.useState(false)
  const isMobile = useIsMobile()

  const handleFabClick = () => {
    if (!isChatInitialized) {
      setIsChatInitialized(true)
    }
    setIsChatOpen(!isChatOpen)
  }

  const ChatUI = (
    <>
      <motion.div
        className="fixed bottom-6 right-6 z-50"
        initial={{ scale: 0, y: 50 }}
        animate={{ scale: 1, y: 0 }}
        transition={{ type: "spring", stiffness: 260, damping: 20, delay: 0.5 }}
      >
        <Button
          size="lg"
          className="rounded-full w-16 h-16 shadow-lg bg-primary hover:bg-primary-hover"
          onClick={handleFabClick}
        >
          <AnimatePresence initial={false}>
            <motion.div
              key={isChatOpen ? "close" : "chat"}
              initial={{ opacity: 0, scale: 0.5, rotate: -90 }}
              animate={{ opacity: 1, scale: 1, rotate: 0 }}
              exit={{ opacity: 0, scale: 0.5, rotate: 90 }}
            >
              {isChatOpen ? <X className="w-8 h-8" /> : <MessageSquare className="w-8 h-8" />}
            </motion.div>
          </AnimatePresence>
        </Button>
      </motion.div>
      {isChatInitialized && (
        <AnimatePresence>
          {isChatOpen && (
            <motion.div
              className="fixed bottom-24 right-6 z-50 w-[90vw] max-w-[400px] h-[70vh] max-h-[600px] shadow-2xl origin-bottom-right"
              initial={{ opacity: 0, y: 20, scale: 0.95 }}
              animate={{ opacity: 1, y: 0, scale: 1 }}
              exit={{ opacity: 0, y: 20, scale: 0.95 }}
              transition={{ ease: "easeOut", duration: 0.2 }}
            >
              <JelliChat />
            </motion.div>
          )}
        </AnimatePresence>
      )}
    </>
  )

  if (isMobile === undefined) {
    return null; 
  }

  return (
    <AuthGuard>
      {isMobile ? (
        <div className="min-h-screen relative">
          <AnimatedBackground />
          <div className="relative z-10 flex flex-col h-screen">
            <MobileHeader />
            <main className="flex-1 p-3 sm:p-4 overflow-y-auto">{children}</main>
          </div>
          {ChatUI}
        </div>
      ) : (
        <div className="min-h-screen relative">
          <AnimatedBackground />
          <div className="relative z-10 flex h-screen w-screen overflow-hidden">
            <Sidebar isCollapsed={isSidebarCollapsed} onToggle={() => setIsSidebarCollapsed(!isSidebarCollapsed)} isMobileView={false} />
            <div className={cn("flex-1 flex flex-col min-w-0")}>
              <main className="flex-1 p-3 sm:p-4 md:p-6 overflow-y-auto">{children}</main>
            </div>
          </div>
          {ChatUI}
        </div>
      )}
    </AuthGuard>
  )
}

############################## FIN DEL ARCHIVO: components\layout\app-layout.tsx ##################################

############################## INICIO DEL ARCHIVO: components\layout\mobileHeader.tsx ##############################

"use client"
import * as React from "react"
import { Bell, Menu } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { NotificationPanel } from "@/components/notification-panel"
import { UserMenu } from "@/components/user-menu"
import { Badge } from "@/components/ui/badge"
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
import { Sidebar } from "./sidebar"
import { Notification } from "@/types"
import { useApi } from "@/hooks/useApi"

export function MobileHeader() {
  const { data } = useApi<{ notifications: Notification[] }>('/notifications?page=1&limit=10');

// Corregimos cómo se accede a los datos
const notificationCount = data?.notifications?.filter(n => !n.read).length || 0;

  const notificationButton = (
    <Button variant="ghost" size="icon" className="relative rounded-full">
      <Bell className="w-5 h-5" />
      {notificationCount > 0 && (
        <Badge variant="destructive" className="absolute top-1 right-1 h-4 w-4 p-0 flex items-center justify-center text-xs">{notificationCount}</Badge>
      )}
    </Button>
  );

  return (
    <header className="sticky top-0 z-40 w-full bg-sidebar/80 backdrop-blur-xl border-b border-glass-border p-3 flex items-center justify-between">
      <Sheet>
        <SheetTrigger asChild>
          <Button variant="ghost" size="icon">
            <Menu className="h-5 w-5" />
          </Button>
        </SheetTrigger>
        <SheetContent side="left" className="p-0 w-64 border-none bg-transparent">
          <Sidebar isCollapsed={false} isMobileView={true} />
        </SheetContent>
      </Sheet>

      <div className="flex items-center gap-1">
        <Popover>
          <PopoverTrigger asChild>{notificationButton}</PopoverTrigger>
          <PopoverContent side="bottom" align="end" className="p-0">
            <NotificationPanel />
          </PopoverContent>
        </Popover>
        <UserMenu />
      </div>
    </header>
  )
}

############################## FIN DEL ARCHIVO: components\layout\mobileHeader.tsx ##################################

############################## INICIO DEL ARCHIVO: components\layout\public-layout.tsx ##############################

"use client"

import * as React from "react"
import Link from "next/link"
import { motion } from "framer-motion"
import { Button } from "@/components/ui/button"
import { LanguageSwitcher } from "@/components/ui/language-switcher"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { AnimatedBackground } from "@/components/animated-background"
import { Dialog, DialogContent } from "@/components/ui/dialog"
import { Sheet, SheetContent, SheetTrigger } from "@/components/ui/sheet"
import { LoginForm } from "@/components/login-form"
import { RegisterForm } from "@/components/register-form"
import { Menu } from "lucide-react"

interface PublicLayoutProps {
  children: React.ReactNode
}

export function PublicLayout({ children }: PublicLayoutProps) {
  // --- CAMBIO: Se añade el estado y las funciones para manejar los modales ---
  const [isLoginModalOpen, setIsLoginModalOpen] = React.useState(false)
  const [isRegisterModalOpen, setIsRegisterModalOpen] = React.useState(false)

  const switchToRegister = () => {
    setIsLoginModalOpen(false);
    setIsRegisterModalOpen(true);
  };

  const switchToLogin = () => {
    setIsRegisterModalOpen(false);
    setIsLoginModalOpen(true);
  };
  // --- FIN DEL CAMBIO ---

  const navLinks = (
    <>
      <Link href="#features" className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">
        Features
      </Link>
      <Link href="#pricing" className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">
        Pricing
      </Link>
      <Link href="#about" className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">
        About
      </Link>
    </>
  )

  return (
    <>
      <div className="min-h-screen relative">
        <AnimatedBackground />

        <motion.nav
          className="relative z-20 glass-card mx-4 mt-4 rounded-2xl"
          initial={{ y: -20, opacity: 0 }}
          animate={{ y: 0, opacity: 1 }}
          transition={{ type: "spring", stiffness: 300, damping: 20 }}
        >
          <div className="container mx-auto px-6 py-3">
            <div className="flex items-center justify-between">
              <Link href="/" className="flex items-center gap-3">
                <Avatar className="w-8 h-8">
                  <AvatarImage src="/images/jelli-avatar.png" alt="Jello" />
                  <AvatarFallback>J</AvatarFallback>
                </Avatar>
                <span className="text-xl font-bold text-foreground">Jello</span>
              </Link>

              <div className="hidden md:flex items-center gap-6">{navLinks}</div>

              <div className="flex items-center gap-2">
                <div className="hidden sm:block"><LanguageSwitcher /></div>
                <Button variant="ghost" size="sm" onClick={() => setIsLoginModalOpen(true)} className="hidden sm:inline-flex">
                  Sign In
                </Button>
                <Button size="sm" onClick={() => setIsRegisterModalOpen(true)} className="hidden sm:inline-flex">
                  Get Started
                </Button>

                <div className="md:hidden">
                  <Sheet>
                    <SheetTrigger asChild>
                      <Button variant="ghost" size="icon">
                        <Menu className="h-5 w-5" />
                        <span className="sr-only">Toggle Menu</span>
                      </Button>
                    </SheetTrigger>
                    <SheetContent side="right" className=" bg-card/80 backdrop-blur-lg border-none p-0 flex flex-col">
                      <div className="p-4 border-b border-border/50">
                        <Link href="/" className="flex items-center gap-3">
                          <Avatar className="w-8 h-8">
                            <AvatarImage src="/images/jelli-avatar.png" alt="Jello" />
                            <AvatarFallback>J</AvatarFallback>
                          </Avatar>
                          <span className="text-xl font-bold text-foreground">Jello</span>
                        </Link>
                      </div>

                      <div className="p-4 flex flex-col gap-4 text-left">
                        {navLinks}
                      </div>

                      <div className="flex-grow" />

                      <div className="p-4 mt-8 pt-6 border-t border-border/50 flex flex-col gap-3">
                        <Button variant="outline" onClick={() => setIsLoginModalOpen(true)} className="w-full">Sign In</Button>
                        <Button onClick={() => setIsRegisterModalOpen(true)} className="w-full">Get Started</Button>
                        <div className="pt-2 flex justify-center">
                          <LanguageSwitcher />
                        </div>
                      </div>
                    </SheetContent>
                  </Sheet>
                </div>
              </div>
            </div>
          </div>
        </motion.nav>

        <main className="relative z-10">{children}</main>

        <footer className="relative z-10 mt-20">
          <div className="glass-card mx-4 mb-4 rounded-2xl">
            <div className="container mx-auto px-6 py-8">
              <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div className="space-y-4">
                  <div className="flex items-center gap-3">
                    <Avatar className="w-6 h-6">
                      <AvatarImage src="/images/jelli-avatar.png" alt="Jello" />
                      <AvatarFallback>J</AvatarFallback>
                    </Avatar>
                    <span className="font-bold text-foreground">Jello</span>
                  </div>
                  <p className="text-sm text-muted-foreground">
                    Your intelligent productivity ecosystem that adapts to you.
                  </p>
                </div>
                <div className="space-y-4">
                  <h3 className="font-semibold text-foreground">Product</h3>
                  <ul className="space-y-2 text-sm text-muted-foreground">
                    <li><Link href="#features" className="hover:text-foreground transition-colors">Features</Link></li>
                    <li><Link href="#pricing" className="hover:text-foreground transition-colors">Pricing</Link></li>
                    <li><Link href="#integrations" className="hover:text-foreground transition-colors">Integrations</Link></li>
                  </ul>
                </div>
                <div className="space-y-4">
                  <h3 className="font-semibold text-foreground">Company</h3>
                  <ul className="space-y-2 text-sm text-muted-foreground">
                    <li><Link href="#about" className="hover:text-foreground transition-colors">About</Link></li>
                    <li><Link href="#blog" className="hover:text-foreground transition-colors">Blog</Link></li>
                    <li><Link href="#careers" className="hover:text-foreground transition-colors">Careers</Link></li>
                  </ul>
                </div>
                <div className="space-y-4">
                  <h3 className="font-semibold text-foreground">Support</h3>
                  <ul className="space-y-2 text-sm text-muted-foreground">
                    <li><Link href="#help" className="hover:text-foreground transition-colors">Help Center</Link></li>
                    <li><Link href="#contact" className="hover:text-foreground transition-colors">Contact</Link></li>
                    <li><Link href="#privacy" className="hover:text-foreground transition-colors">Privacy</Link></li>
                  </ul>
                </div>
              </div>
              <div className="border-t border-border mt-8 pt-8 text-center">
                <p className="text-sm text-muted-foreground">© 2024 Jello. All rights reserved.</p>
              </div>
            </div>
          </div>
        </footer>
      </div>

      <Dialog open={isLoginModalOpen} onOpenChange={setIsLoginModalOpen}>
        <DialogContent className="p-0 border-none bg-transparent w-[90vw] max-w-md">
          <LoginForm onSwitchToRegister={switchToRegister} />
        </DialogContent>
      </Dialog>

      <Dialog open={isRegisterModalOpen} onOpenChange={setIsRegisterModalOpen}>
        <DialogContent className="p-0 border-none bg-transparent w-[90vw] max-w-md">
          <RegisterForm onSwitchToLogin={switchToLogin} />
        </DialogContent>
      </Dialog>
    </>
  )
}


############################## FIN DEL ARCHIVO: components\layout\public-layout.tsx ##################################

############################## INICIO DEL ARCHIVO: components\layout\sidebar.tsx ##############################

"use client"
import * as React from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { AnimatePresence, motion } from "framer-motion"
import { Home, FolderKanban, CheckSquare, Search, Plus, ChevronsLeft, Bell, ClipboardList } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip"
import { UserMenu } from "@/components/user-menu"
import { cn } from "@/lib/utils"
import { CreateProjectModal } from "@/components/modals/create-project-modal"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { NotificationPanel } from "@/components/notification-panel"
import { Badge } from "@/components/ui/badge"
import { useApi } from "@/hooks/useApi";
import { ProjectSummary, Notification  } from "@/types";
import { Skeleton } from "@/components/ui/skeleton";

const navigation = [
  { name: "Dashboard", href: "/dashboard", icon: Home },
  { name: "Search", href: "/search", icon: Search },
  { name: "Projects", href: "/projects", icon: FolderKanban },
  { name: "My Tasks", href: "/tasks", icon: CheckSquare },
  { name: "Todos", href: "/todos", icon: ClipboardList },
]

interface SidebarProps {
  isCollapsed: boolean
  onToggle?: () => void
  isMobileView?: boolean
}

export function Sidebar({ isCollapsed, onToggle, isMobileView = false }: SidebarProps) {
  const pathname = usePathname()
  const { data: projects, isLoading: isLoadingProjects , refetch} = useApi<ProjectSummary[]>('/projects');
  const [isCreateModalOpen, setIsCreateModalOpen] = React.useState(false)
  
  const { data } = useApi<{ notifications: Notification[] }>('/notifications?page=1&limit=10');
  const notificationCount = data?.notifications?.filter(n => !n.read).length || 0;

  const notificationButton = (
    <Button variant="ghost" size="icon" className="relative rounded-full">
      <Bell className="w-5 h-5" />
      {notificationCount > 0 && (
        <Badge variant="destructive" className="absolute top-1 right-1 h-4 w-4 p-0 flex items-center justify-center text-xs">{notificationCount}</Badge>
      )}
    </Button>
  );

  return (
    <>
      <TooltipProvider delayDuration={0}>
        <motion.aside
          data-collapsed={isCollapsed}
          className="group/sidebar h-full bg-sidebar/80 backdrop-blur-xl border-r border-glass-border flex flex-col z-20"
          animate={{ width: isCollapsed ? "5rem" : "16rem" }}
          transition={{ type: "spring", stiffness: 300, damping: 25 }}
        >
          
          <div className="flex flex-col h-full p-3">
            {/* --- INICIO DE MODIFICACIÓN: Logo envuelto en Link --- */}
            <Link href="/">
              <div className={cn("flex items-center gap-3 mb-4", isCollapsed ? "justify-center" : "px-3")}>
                <Avatar className="w-8 h-8"><AvatarImage src="/images/jelli-avatar.png" alt="Jello" /><AvatarFallback>J</AvatarFallback></Avatar>
                <AnimatePresence>{!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="text-xl font-bold text-foreground whitespace-nowrap">Jello</motion.span>)}</AnimatePresence>
              </div>
            </Link>
            {/* --- FIN DE MODIFICACIÓN --- */}
      
            <div className="flex-grow overflow-y-auto space-y-4">
              <nav className="space-y-1 px-2">
                {navigation.map((item) => (
                  <Tooltip key={item.name} delayDuration={0}>
                    <TooltipTrigger asChild>
                
                      <Link href={item.href} className={cn("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors", pathname === item.href ?
 "bg-primary text-primary-foreground hover:bg-primary/90" : "text-muted-foreground hover:bg-muted", isCollapsed && "justify-center")}>
                        <item.icon className="h-5 w-5" />
                        <AnimatePresence>{!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="flex-grow">{item.name}</motion.span>)}</AnimatePresence>
                    
                      </Link>
                    </TooltipTrigger>
                    <TooltipContent side="right">{item.name}</TooltipContent>
                  </Tooltip>
                ))}
              </nav>
         
              <div className="px-2">
                <div className={cn("mb-2 flex items-center", isCollapsed ? "justify-center" : "justify-between")}>
                  {!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="text-xs font-semibold text-muted-foreground uppercase">Projects</motion.span>)}
                  <Tooltip delayDuration={0}>
         
                    <TooltipTrigger asChild>
                      <Button variant="ghost" size="icon" className={cn("h-7 w-7 rounded-md", isCollapsed ?
 "" : "")} onClick={() => setIsCreateModalOpen(true)}><Plus className="h-4 w-4" /></Button>
                    </TooltipTrigger>
                    <TooltipContent side="right">Create Project</TooltipContent>
                  </Tooltip>
                </div>
                
                <div className="space-y-1">
                  {isLoadingProjects ? (
                    Array.from({ length: 3 }).map((_, index) => (
                      <div key={index} className="flex items-center gap-3 rounded-md px-3 py-2">
                        <Skeleton className="h-2 w-2 rounded-full" />
                        {!isCollapsed && <Skeleton className="h-4 w-full" />}
                      </div>
                    ))
                  ) : (
                    projects?.map((project) => (
                      <Tooltip key={project.id} delayDuration={0}>
                        <TooltipTrigger asChild>
                          
                          <Link href={`/project/${project.id}`} className={cn("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors hover:bg-muted", pathname === `/project/${project.id}` ? "text-primary" : "text-muted-foreground", isCollapsed && "justify-center")}>
                            <span className={cn("h-2 aspect-square w-2 min-w-2 rounded-full", project.color)} />
                            <AnimatePresence>
                              {!isCollapsed && (
                                <motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, 
 x: -10 }} className="flex-grow truncate">
                                  {project.name}
                                </motion.span>
                              )}
                            </AnimatePresence>
                          </Link>
                        </TooltipTrigger>
                        <TooltipContent side="right">{project.name}</TooltipContent>
                      </Tooltip>
                    ))
                  )}
                </div>
              </div>
            </div>
            {!isMobileView && (
              <div className="mt-auto pt-4 border-t border-border/50">
                <div className={cn("flex flex-col items-center gap-2")}>
                  <div 
 className={cn("flex items-center w-full", isCollapsed ? "flex-col gap-2" : "justify-between")}>
                    <div className={cn("flex items-center", isCollapsed ? "flex-col gap-2" : "gap-1")}>
                      <Popover>
                        {isCollapsed ?
 (
                          <Tooltip>
                            <TooltipTrigger asChild><PopoverTrigger asChild>{notificationButton}</PopoverTrigger></TooltipTrigger>
                            <TooltipContent side="right">Notifications</TooltipContent>
               
                          </Tooltip>
                        ) : (
                          <PopoverTrigger asChild>{notificationButton}</PopoverTrigger>
                        )}
            
                        <PopoverContent side="right" align="start" className="p-0"><NotificationPanel /></PopoverContent>
                      </Popover>
                      <UserMenu />
                    </div>
                   
                    {!isCollapsed && onToggle && (
                      <Button variant="ghost" size="icon" className="rounded-full" onClick={onToggle}><ChevronsLeft className="w-5 h-5" /></Button>
                    )}
                  </div>
                  {isCollapsed && onToggle && (
      
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <Button variant="ghost" size="icon" className="w-full rounded-xl" onClick={onToggle}><ChevronsLeft className="w-5 h-5 rotate-180" /></Button>
                      </TooltipTrigger>
        
                      <TooltipContent side="right">Expand</TooltipContent>
                    </Tooltip>
                  )}
                </div>
              </div>
            )}
     
          </div>
        </motion.aside>
      </TooltipProvider>
      <CreateProjectModal
        isOpen={isCreateModalOpen}
        onClose={() => setIsCreateModalOpen(false)}
        onProjectCreated={ refetch } 
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: components\layout\sidebar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\login-form.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\login-form.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\login-form.tsx ##############################

// components/login-form.tsx
"use client";

import * as React from "react";
import { useAuth } from "@/contexts/auth-context";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import { Eye, EyeOff, LoaderCircle } from "lucide-react";
import { motion } from "framer-motion";
import Link from "next/link";

const GoogleIcon = () => <svg className="mr-2 h-4 w-4" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" /><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" /><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" /><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" /></svg>;
const GitHubIcon = () => <svg className="mr-2 h-4 w-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.024-.105-.949-.199-2.403.041-3.439.219-.937 1.404-5.965 1.404-5.965s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.097.118.112.221.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.748-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.001z" /></svg>;

export function LoginForm({ onSwitchToRegister }: { onSwitchToRegister: () => void }) {
  const { login, isLoading } = useAuth();
  const [formData, setFormData] = React.useState({ email: "", password: "", rememberMe: false });
  const [showPassword, setShowPassword] = React.useState(false);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleRememberChange = (checked: boolean) => {
    setFormData(prev => ({ ...prev, rememberMe: checked }));
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (isLoading) return;
    // Pasamos el valor de rememberMe a la función de login
    login({ email: formData.email, password: formData.password }, formData.rememberMe);
  };

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
      className="glass-card p-8 w-full space-y-6"
    >
      <div className="space-y-2 text-center">
        <h1 className="text-2xl font-bold text-foreground">¡Bienvenido de nuevo!</h1>
        <p className="text-muted-foreground">Inicia sesión para continuar en Jello</p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="space-y-2">
          <label htmlFor="email" className="text-sm font-medium text-foreground">Email</label>
          <Input id="email" name="email" type="email" placeholder="john@example.com" required value={formData.email} onChange={handleChange} />
        </div>
        <div className="space-y-2">
          <label htmlFor="password" className="text-sm font-medium text-foreground">Contraseña</label>
          <div className="relative">
            <Input id="password" name="password" type={showPassword ? "text" : "password"} placeholder="Ingresa tu contraseña" required value={formData.password} onChange={handleChange} className="pr-10" />
            <Button type="button" variant="ghost" size="icon" className="w-10 rounded-full absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent" onClick={() => setShowPassword(!showPassword)}>
              {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
            </Button>
          </div>
        </div>
        <div className="flex items-center justify-between">
          <div className="flex items-center space-x-2">
            <Checkbox id="remember" checked={formData.rememberMe} onCheckedChange={handleRememberChange} />
            <label htmlFor="remember" className="text-sm text-muted-foreground">Recordarme</label>
          </div>
          <Link href="/forgot-password" className="text-sm text-primary underline">
            ¿Olvidaste tu contraseña?
          </Link>
        </div>
        <Button type="submit" className="w-full" disabled={isLoading}>
          {isLoading && <LoaderCircle className="mr-2 h-4 w-4 animate-spin" />}
          {isLoading ? "Iniciando sesión..." : "Iniciar sesión"}
        </Button>
      </form>

      <div className="relative">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t border-border" />
        </div>
        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-card px-2 text-muted-foreground">O continuar con</span>
        </div>
      </div>

      <div className="flex flex-wrap gap-2 flex-row items-center justify-center">
        <a href="https://jello-backend.onrender.com/api/auth/google"><Button variant="outline" className="bg-transparent"><GoogleIcon />Google</Button></a>
        <a href="https://jello-backend.onrender.com/api/auth/github">
            <Button variant="outline" className="bg-transparent"><GitHubIcon />GitHub</Button></a>
      </div>

      <p className="text-center text-sm text-muted-foreground">
        ¿No tienes una cuenta?{' '}
        <button
          type="button"
          onClick={onSwitchToRegister}
          className="underline text-primary font-medium focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 rounded-sm"
        >
          Regístrate
        </button>
      </p>
    </motion.div>
  );
}

############################## FIN DEL ARCHIVO: components\login-form.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\AddMemberModal.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { Search, Send, UserCheck } from "lucide-react"
import { apiClient } from "@/lib/api"
import { SearchResult } from "@/types"
import { toast } from "sonner"
import { useDebounce } from "@/hooks/useDebounce" 
import { Modal, ModalContent, ModalHeader, ModalTitle, ModalDescription } from "@/components/ui/modal"
import { Input } from "@/components/ui/input"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Spinner } from "@/components/ui/spinner"
import { Skeleton } from "@/components/ui/skeleton"

interface AddMemberModalProps {
  isOpen: boolean
  onClose: () => void
  projectId: string
  onInviteSent: () => void 
  currentMembers: string[] 
}

export function AddMemberModal({ isOpen, onClose, projectId, onInviteSent, currentMembers }: AddMemberModalProps) {
  const [query, setQuery] = React.useState("")
  const [results, setResults] = React.useState<SearchResult[]>([])
  const [isLoading, setIsLoading] = React.useState(false)
  const [invitedUserIds, setInvitedUserIds] = React.useState<Set<string>>(new Set());

  const debouncedQuery = useDebounce(query, 300)

  React.useEffect(() => {
    const fetchResults = async () => {
      if (debouncedQuery.length < 2) {
        setResults([]);
        return;
      }
      setIsLoading(true);
      try {
        const data = await apiClient.get<SearchResult[]>(`/search?q=${debouncedQuery}&type=user`);
        const filteredData = data.filter(user => !currentMembers.includes(user.id));
        setResults(filteredData);
      } catch (err) {
        toast.error((err as Error).message);
      } finally {
        setIsLoading(false);
      }
    };
    
    if(isOpen) {
      fetchResults();
    }
  }, [debouncedQuery, currentMembers, isOpen]);

  const handleInvite = async (userId: string) => {
    toast.info("Sending invitation...");
    try {
      await apiClient.post(`/projects/${projectId}/invitations`, { userIdToInvite: userId });
      toast.success("Invitation sent successfully!");
      setInvitedUserIds(prev => new Set(prev).add(userId)); 
      onInviteSent(); 
    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  const handleClose = () => {
    setQuery('');
    setResults([]);
    setInvitedUserIds(new Set());
    onClose();
  }

  return (
    <Modal open={isOpen} onOpenChange={handleClose}>
      <ModalContent className="max-w-lg">
        <ModalHeader>
          <ModalTitle>Add Members to Project</ModalTitle>
          <ModalDescription>Search for users to invite and add them to the project.</ModalDescription>
        </ModalHeader>
        <div className="p-6 space-y-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
            <Input
              placeholder="Search by name or email..."
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              className="pl-10"
              autoFocus
            />
          </div>
          <div className="space-y-2 max-h-64 overflow-y-auto pr-2">
            {isLoading && <Skeleton className="h-16 w-full" />}
            {!isLoading && results.map((user) => {
              const isInvited = invitedUserIds.has(user.id);
              return (
                <motion.div
                  key={user.id}
                  className="flex items-center justify-between p-2 rounded-lg hover:bg-muted"
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                >
                  <div className="flex items-center gap-3">
                    <Avatar className="w-10 h-10">
                      <AvatarImage src={user.avatar || undefined} />
                      <AvatarFallback>{user.name.charAt(0)}</AvatarFallback>
                    </Avatar>
                    <div>
                      <p className="font-semibold">{user.name}</p>
                      <p className="text-sm text-muted-foreground">{user.description}</p>
                    </div>
                  </div>
                  <Button
                    size="sm"
                    onClick={() => handleInvite(user.id)}
                    disabled={isInvited}
                  >
                    {isInvited ? <UserCheck className="w-4 h-4 mr-2" /> : <Send className="w-4 h-4 mr-2" />}
                    {isInvited ? 'Invited' : 'Invite'}
                  </Button>
                </motion.div>
              );
            })}
             {!isLoading && debouncedQuery.length > 1 && results.length === 0 && (
              <div className="text-center text-muted-foreground py-4">
                <p>No users found matching "{debouncedQuery}".</p>
              </div>
            )}
          </div>
        </div>
      </ModalContent>
    </Modal>
  );
}

############################## FIN DEL ARCHIVO: components\modals\AddMemberModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\AttachmentViewerModal.tsx ##############################

// Jello-Frontend/components/modals/AttachmentViewerModal.tsx
"use client"

import * as React from 'react'
import { AnimatePresence, motion } from 'framer-motion'
import { Modal, ModalContent } from "@/components/ui/modal"
import { Button } from '@/components/ui/button'
import { X, Download, ExternalLink, ChevronLeft, ChevronRight } from 'lucide-react'
import { Attachment } from '@/types'

interface AttachmentViewerModalProps {
  isOpen: boolean
  onClose: () => void
  attachments: Attachment[]
  selectedAttachmentId: string | null
}

export function AttachmentViewerModal({
  isOpen,
  onClose,
  attachments,
  selectedAttachmentId,
}: AttachmentViewerModalProps) {
  const [currentIndex, setCurrentIndex] = React.useState<number | null>(null)

  // Sincroniza el índice actual cuando cambia el adjunto seleccionado
  React.useEffect(() => {
    if (selectedAttachmentId) {
      const index = attachments.findIndex((att) => att._id === selectedAttachmentId)
      setCurrentIndex(index !== -1 ? index : null)
    } else {
      setCurrentIndex(null)
    }
  }, [selectedAttachmentId, attachments])

  // Lógica para navegar entre adjuntos
  const handleNext = () => {
    if (currentIndex === null || attachments.length === 0) return
    setCurrentIndex((prev) => (prev! + 1) % attachments.length)
  }

  const handlePrev = () => {
    if (currentIndex === null || attachments.length === 0) return
    setCurrentIndex((prev) => (prev! - 1 + attachments.length) % attachments.length)
  }

  // Manejo de atajos de teclado
  React.useEffect(() => {
    const handleKeyDown = (e: KeyboardEvent) => {
      if (!isOpen) return
      if (e.key === 'ArrowRight') handleNext()
      if (e.key === 'ArrowLeft') handlePrev()
      if (e.key === 'Escape') onClose()
    }
    window.addEventListener('keydown', handleKeyDown)
    return () => window.removeEventListener('keydown', handleKeyDown)
  }, [isOpen, handleNext, handlePrev, onClose])

  const currentAttachment = currentIndex !== null ? attachments[currentIndex] : null

  if (!isOpen || !currentAttachment) {
    return null
  }

  return (
    <Modal open={isOpen} onOpenChange={onClose}>
      <ModalContent className="max-w-screen-xl w-[95vw] h-[90vh] p-0 bg-transparent border-0 shadow-none flex items-center justify-center">
        {/* Botón de cierre */}
        <Button
          size="icon"
          variant="ghost"
          className="absolute top-4 right-4 z-50 rounded-full bg-black/50 text-white hover:bg-black/70 hover:text-white"
          onClick={onClose}
        >
          <X className="w-6 h-6" />
        </Button>

        {/* Navegación (Anterior) */}
        {attachments.length > 1 && (
          <Button
            size="icon"
            variant="ghost"
            className="absolute left-4 top-1/2 -translate-y-1/2 z-50 rounded-full bg-black/50 text-white hover:bg-black/70 hover:text-white h-12 w-12"
            onClick={handlePrev}
          >
            <ChevronLeft className="w-8 h-8" />
          </Button>
        )}

        {/* Contenido Principal (Imagen y Acciones) */}
        <motion.div
          key={currentAttachment._id}
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          className="w-full h-full flex flex-col items-center justify-center relative p-16"
        >
          {/* Header con información */}
          <motion.div className="absolute top-4 left-4 right-4 text-center text-white text-shadow-lg bg-black/30 p-2 rounded-lg z-20">
            <p className="font-bold truncate">{currentAttachment.name}</p>
            <p className="text-sm opacity-80">{currentIndex! + 1} / {attachments.length}</p>
          </motion.div>
          
          <img
            src={currentAttachment.url}
            alt={currentAttachment.name}
            className="max-w-full max-h-full object-contain rounded-lg shadow-2xl"
          />

          {/* Footer con acciones */}
          <motion.div className="absolute bottom-4 flex gap-4 z-20">
            <Button asChild variant="secondary">
              <a href={currentAttachment.url} download target="_blank" rel="noopener noreferrer">
                <Download className="mr-2 h-4 w-4" /> Descargar
              </a>
            </Button>
            <Button asChild variant="secondary">
              <a href={currentAttachment.url} target="_blank" rel="noopener noreferrer">
                <ExternalLink className="mr-2 h-4 w-4" /> Abrir en nueva pestaña
              </a>
            </Button>
          </motion.div>
        </motion.div>

        {/* Navegación (Siguiente) */}
        {attachments.length > 1 && (
          <Button
            size="icon"
            variant="ghost"
            className="absolute right-4 top-1/2 -translate-y-1/2 z-50 rounded-full bg-black/50 text-white hover:bg-black/70 hover:text-white h-12 w-12"
            onClick={handleNext}
          >
            <ChevronRight className="w-8 h-8" />
          </Button>
        )}
      </ModalContent>
    </Modal>
  )
}

############################## FIN DEL ARCHIVO: components\modals\AttachmentViewerModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\CollaborateModal.tsx ##############################

// components/modals/CollaborateModal.tsx

"use client"

import * as React from "react"
import { Button } from "@/components/ui/button"
import { Modal, ModalContent, ModalHeader, ModalTitle, ModalDescription } from "@/components/ui/modal"
import { Textarea } from "@/components/ui/textarea"
// --- NUEVO: Imports necesarios ---
import { apiClient } from "@/lib/api"
import { toast } from "sonner"


const predefinedText = "Hello! I'm very interested in collaborating on this project. I believe my skills in [mention your skills] would be a great asset. Looking forward to hearing from you."

// --- MODIFICADO: Se añade projectId a las props ---
interface CollaborateModalProps {
  isOpen: boolean
  onClose: () => void
  projectName: string
  projectId: string
}

export function CollaborateModal({ isOpen, onClose, projectName, projectId }: CollaborateModalProps) {
  const [message, setMessage] = React.useState(predefinedText)

  // --- MODIFICADO: La función ahora llama a la API ---
  const handleSubmit = async () => {
    toast.info("Sending collaboration request...");
    try {
      // Asumimos un endpoint lógico para crear la notificación de solicitud
      await apiClient.post('/notifications/collaborate', { projectId, message });
      toast.success("Request sent successfully!");
      onClose()
    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  return (
    <Modal open={isOpen} onOpenChange={onClose}>
      <ModalContent>
        <ModalHeader>
          <ModalTitle>Request to Collaborate</ModalTitle>
          <ModalDescription>Send a message to the project owner of "{projectName}".</ModalDescription>
        </ModalHeader>
        <div className="p-6 space-y-4">
          <Textarea
            value={message}
            onChange={(e) => setMessage(e.target.value)}
            className="min-h-[120px]"
          />
          <div className="flex justify-end gap-3">
            <Button variant="ghost" onClick={onClose}>Cancel</Button>
            <Button onClick={handleSubmit}>Send Request</Button>
          </div>
        </div>
      </ModalContent>
    </Modal>
  )
}

############################## FIN DEL ARCHIVO: components\modals\CollaborateModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\create-project-modal.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\modals\create-project-modal.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\create-project-modal.tsx ##############################

"use client"

import * as React from "react"
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { ImageUploadField } from "@/components/forms/image-upload-field"
import { ColorSelector } from "@/components/forms/color-selector"
import { UserSummary } from "@/types"
import { UserPlus, X } from "lucide-react"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { UserSearchModal } from "./UserSearchModal" 
import { apiClient } from "@/lib/api";
import { ApiError } from "@/types"; 
import { toast } from "sonner"; 
import { Loader2 } from "lucide-react";
interface ProjectFormData {
  name: string;
  description: string;
  color: string;
  members: string[]; // Guardaremos solo los IDs de los miembros a invitar
  projectImage?: File;
  bannerImage?: File;
  dueDate?: string;
}

interface CreateProjectModalProps {
  isOpen: boolean;
  onClose: () => void;
  onProjectCreated: () => void;
}

const initialFormData: Partial<ProjectFormData> = {
  name: "",
  description: "",
  color: "bg-blue-500",
  members: [],
};

export function CreateProjectModal({ isOpen, onClose, onProjectCreated }: CreateProjectModalProps) {
  const [formData, setFormData] = React.useState<Partial<ProjectFormData>>(initialFormData);
  const [isSubmitting, setIsSubmitting] = React.useState(false);
  const [memberObjects, setMemberObjects] = React.useState<UserSummary[]>([]);
  const [isUserSearchModalOpen, setIsUserSearchModalOpen] = React.useState(false);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSelectUsers = (selectedUsers: UserSummary[]) => {
    // Evitar duplicados
    const newUsers = selectedUsers.filter(
      selected => !memberObjects.some(existing => existing.id === selected.id)
    );

    const newMemberObjects = [...memberObjects, ...newUsers];
    const newMemberIds = newMemberObjects.map(m => m.id);

    setMemberObjects(newMemberObjects);
    setFormData(prev => ({ ...prev, members: newMemberIds }));
    setIsUserSearchModalOpen(false);
  }
  
  const handleRemoveMember = (memberId: string) => {
    setMemberObjects(prev => prev.filter(m => m.id !== memberId));
    setFormData(prev => ({...prev, members: prev.members?.filter(id => id !== memberId)}));
  }

  const resetAndClose = () => {
    setFormData(initialFormData);
    setMemberObjects([]);
    onClose();
  }

  const handleFormSubmit = async (e: React.FormEvent<HTMLFormElement>) => {
    e.preventDefault();
    setIsSubmitting(true);
    const toastId = toast.loading("Creating your new project...");

    try {
      // 1. Convertir el JSON a FormData (para las imágenes)
      const data = new FormData();

      // Función auxiliar para añadir campos solo si existen
      const appendIfExists = (key: string, value: any) => {
        if (value !== null && value !== undefined) {
          data.append(key, value);
        }
      };

      appendIfExists('name', formData.name);
      appendIfExists('description', formData.description);
      appendIfExists('color', formData.color);
      appendIfExists('dueDate', formData.dueDate);
      appendIfExists('projectImage', formData.projectImage);
      appendIfExists('bannerImage', formData.bannerImage);

      // Añadir el array de miembros
      formData.members?.forEach((memberId: string) => {
        data.append('members[]', memberId);
      });

      await apiClient.post('/projects', data);

      toast.success("Project created successfully!", { id: toastId });
      onProjectCreated(); // <-- Llama al callback de éxito
      resetAndClose(); // <-- Cierra y resetea el modal

    } catch (error) {
      // 4. Error
      console.error("Failed to create project:", error);
      const apiError = error as ApiError;
      const errorMessage = apiError.response?.data?.error || "Failed to create project.";
      toast.error(errorMessage, { id: toastId });
    } finally {
      // 5. Finalizar
      setIsSubmitting(false);
    }
  };

  return (
    <>
      <Dialog open={isOpen} onOpenChange={resetAndClose}>
        <DialogContent className="sm:max-w-[525px] max-h-[90vh] flex flex-col">
          <DialogHeader>
            <DialogTitle>Create New Project</DialogTitle>
            <DialogDescription>
              Fill in the details below to start a new project.
            </DialogDescription>
          </DialogHeader>

          <form onSubmit={handleFormSubmit} id="create-project-form" className="flex-1 overflow-y-auto px-2">
            <div className="space-y-4 py-4">
              <div className="space-y-2">
                <label htmlFor="name" className="text-sm font-medium">Project Name</label>
                <Input id="name" name="name" value={formData.name} onChange={handleChange} required />
              </div>
              <div className="space-y-2">
                <label htmlFor="description" className="text-sm font-medium">Description</label>
                <Textarea id="description" name="description" value={formData.description} onChange={handleChange} />
              </div>
              
              <div className="space-y-2">
                <div className="flex justify-between items-center">
                    <label className="text-sm font-medium">Team Members</label>
                    <Button type="button" variant="ghost" size="sm" onClick={() => setIsUserSearchModalOpen(true)}>
                      <UserPlus className="w-4 h-4 mr-2" /> Add People
                    </Button>
                </div>
                <div className="flex items-center flex-wrap gap-2 min-h-[40px]">
                  {memberObjects.map((member) => (
                    <div key={member.id} className="relative group">
                      <Avatar title={member.name}>
                        <AvatarImage src={member.avatarUrl ?? undefined} alt={member.name} />
                        <AvatarFallback>{member.name.charAt(0)}</AvatarFallback>
                      </Avatar>
                      <button 
                        type="button"
                        onClick={() => handleRemoveMember(member.id)}
                        className="absolute -top-1 -right-1 bg-destructive text-destructive-foreground rounded-full w-4 h-4 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity"
                        aria-label={`Remove ${member.name}`}
                      >
                        <X className="w-2.5 h-2.5" />
                      </button>
                    </div>
                  ))}
                  {memberObjects.length === 0 && <p className="text-xs text-muted-foreground">No members added yet.</p>}
                </div>
              </div>

              <div className="flex flex-col gap-2">
                  <div className="space-y-2">
                    <ImageUploadField 
                        label="Project Image" 
                        name="projectImage" 
                        onChange={(file) => setFormData(prev => ({...prev, projectImage: file || undefined}))} 
                    />
                  </div>
                  <div className="space-y-2">
                    <ImageUploadField 
                        label="Banner Image" 
                        name="bannerImage" 
                        onChange={(file) => setFormData(prev => ({...prev, bannerImage: file || undefined}))} 
                    />
                  </div>
              </div>

              <div className="space-y-2">
                <label className="text-sm font-medium">Project Color</label>
                <ColorSelector 
                    selectedColor={formData.color || 'bg-blue-500'} 
                    onSelectColor={(color: string) => setFormData(prev => ({ ...prev, color }))} 
                />
              </div>
            </div>
          </form>
          
          <DialogFooter className="flex-shrink-0 pt-4 flex flex-col-reverse sm:flex-row sm:justify-end gap-2">
            <Button type="button" variant="ghost" onClick={resetAndClose} disabled={isSubmitting}>
    Cancel
  </Button>
  <Button type="submit" form="create-project-form" disabled={isSubmitting}>
    {isSubmitting ? (
      <Loader2 className="mr-2 h-4 w-4 animate-spin" />
    ) : null}
    Create Project
  </Button>
          </DialogFooter>

        </DialogContent>
      </Dialog>
      
      <UserSearchModal
        isOpen={isUserSearchModalOpen}
        onClose={() => setIsUserSearchModalOpen(false)}
        onSelectUsers={handleSelectUsers}
        excludedUserIds={formData.members}
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: components\modals\create-project-modal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\create-task-modal.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { X, Calendar, Flag, Tag, Users, Plus } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Modal, ModalContent, ModalHeader } from "@/components/ui/modal"
import { DatePicker } from "@/components/ui/date-picker"
import { cn } from "@/lib/utils"
import { Label, UserSummary, ProjectDetails, Attachment } from "@/types"
import { AssigneeSelector } from "@/components/forms/assignee-selector"
import { useApi } from "@/hooks/useApi"
import { Skeleton } from "@/components/ui/skeleton"
import { AttachmentList } from "../tasks/attachment-list"

type TaskStatus = 'todo' | 'in-progress' | 'review' | 'done';
type TaskPriority = 'low' | 'medium' | 'high' | 'critical';

export interface CreateTaskFormDataState {
  title: string;
  description: string;
  priority: TaskPriority;
  status: TaskStatus;
  dueDate: Date | undefined;
  labels: Label[]; 
  assignees: string[];
  subtasks: string[];
  attachments: File[];
}

interface CreateTaskModalProps {
  isOpen: boolean
  onClose: () => void
  onSubmit: (taskData: FormData) => void 
  defaultStatus?: TaskStatus
  projectId?: string
}

const priorityOptions: { value: TaskPriority, label: string, color: string }[] = [
  { value: "low", label: "Low", color: "text-green-500" },
  { value: "medium", label: "Medium", color: "text-yellow-500" },
  { value: "high", label: "High", color: "text-orange-500" },
  { value: "critical", label: "Critical", color: "text-red-500" },
];

const statusOptions: { value: TaskStatus, label: string }[] = [
  { value: "todo", label: "To Do" },
  { value: "in-progress", label: "In Progress" },
  { value: "review", label: "Review" },
  { value: "done", label: "Done" },
];

export function CreateTaskModal({ isOpen, onClose, onSubmit, defaultStatus = 'todo', projectId }: CreateTaskModalProps) {
  const [formData, setFormData] = React.useState<CreateTaskFormDataState>({
    title: "",
    description: "",
    priority: "medium",
    status: defaultStatus,
    dueDate: undefined,
    labels: [],
    assignees: [],
    subtasks: [],
    attachments: [],
  });
  
  const { data: project, isLoading: isLoadingProject } = projectId ? useApi<ProjectDetails>(`/projects/${projectId}`) : { data: undefined, isLoading: false };
  const { data: availableLabels, isLoading: isLoadingLabels } = projectId ? useApi<Label[]>(`/projects/${projectId}/labels`) : { data: [], isLoading: false };

  const [errors, setErrors] = React.useState<Record<string, string>>({})
  const [newSubtask, setNewSubtask] = React.useState("")

  React.useEffect(() => {
    if (isOpen) {
      setFormData(prev => ({ ...prev, status: defaultStatus }));
    } else {
      setFormData({
        title: "", description: "", priority: "medium", status: defaultStatus,
        dueDate: undefined, labels: [], assignees: [], subtasks: [], attachments: [],
      });
      setErrors({});
    }
  }, [defaultStatus, isOpen]);

  const validateForm = () => {
    const newErrors: Record<string, string> = {}
    if (!formData.title.trim()) {
      newErrors.title = "Task title is required"
    }
    setErrors(newErrors)
    return Object.keys(newErrors).length === 0
  }

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    if (validateForm()) {
      const apiFormData = new FormData();
      
      apiFormData.append('title', formData.title);
      apiFormData.append('description', formData.description);
      apiFormData.append('priority', formData.priority);
      apiFormData.append('status', formData.status);
      if (formData.dueDate) {
        apiFormData.append('dueDate', formData.dueDate.toISOString());
      }
      
      apiFormData.append('labels', JSON.stringify(formData.labels.map(l => l._id)));
      apiFormData.append('assignees', JSON.stringify(formData.assignees));
      apiFormData.append('subtasks', JSON.stringify(formData.subtasks));

      formData.attachments.forEach(file => {
        apiFormData.append('attachments', file);
      });

      onSubmit(apiFormData); 
    }
  }

  const toggleLabel = (label: Label) => {
    setFormData((prev) => {
      const isSelected = prev.labels.some(l => l._id === label._id);
      return {
        ...prev,
        labels: isSelected
          ? prev.labels.filter((l) => l._id !== label._id)
          : [...prev.labels, label],
      };
    });
  };

  const addSubtask = () => {
    if (newSubtask.trim()) {
      setFormData((prev) => ({ ...prev, subtasks: [...prev.subtasks, newSubtask.trim()] }))
      setNewSubtask("")
    }
  }

  const removeSubtask = (index: number) => {
    setFormData((prev) => ({ ...prev, subtasks: prev.subtasks.filter((_, i) => i !== index) }))
  }

  const handleAttachmentAdd = (files: FileList) => {
    setFormData(prev => ({ ...prev, attachments: [...prev.attachments, ...Array.from(files)] }));
  };

  const handleAttachmentDelete = (fileName: string) => {
    setFormData(prev => ({ ...prev, attachments: prev.attachments.filter(f => f.name !== fileName) }));
  };
  
  const attachmentLikeFiles: Attachment[] = formData.attachments.map((file, index) => ({
    _id: `${file.name}-${index}`,
    name: file.name,
    url: '',
    size: `${(file.size / 1024).toFixed(1)} KB`,
    type: file.type.startsWith('image/') ? 'image' : 'document',
  }));

  return (
    <Modal open={isOpen} onOpenChange={onClose}>
      <ModalContent className="max-h-[95vh] overflow-hidden max-w-3xl">
        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          exit={{ opacity: 0, scale: 0.95 }}
          transition={{ type: "spring", stiffness: 300, damping: 20 }}
        >
          <ModalHeader className="border-b border-border pb-4">
            <div className="flex items-center justify-between">
              <h2 className="text-lg sm:text-xl font-semibold text-foreground">Create New Task</h2>
              <Button variant="ghost" size="icon" onClick={onClose}>
                <X className="w-4 h-4" />
              </Button>
            </div>
          </ModalHeader>

          <form onSubmit={handleSubmit} className="overflow-y-auto max-h-[calc(95vh-120px)]">
            <div className="p-4 sm:p-6 space-y-4 sm:space-y-6">
              <div className="space-y-2">
                <label className="text-sm font-medium text-foreground">Task Title *</label>
                <Input
                  value={formData.title}
                  onChange={(e) => setFormData((prev) => ({ ...prev, title: e.target.value }))}
                  placeholder="Enter task title..."
                  className={errors.title ? "border-destructive" : ""}
                />
                {errors.title && <p className="text-sm text-destructive">{errors.title}</p>}
              </div>

              <div className="space-y-2">
                <label className="text-sm font-medium text-foreground">Description</label>
                <Textarea
                  value={formData.description}
                  onChange={(e) => setFormData((prev) => ({ ...prev, description: e.target.value }))}
                  placeholder="Describe the task..."
                  className="min-h-[80px] sm:min-h-[100px]"
                />
              </div>

              <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <div className="space-y-2">
                  <label className="text-sm font-medium text-foreground flex items-center gap-2"><Flag className="w-4 h-4" />Priority</label>
                  <Select value={formData.priority} onValueChange={(value: TaskPriority) => setFormData((prev) => ({ ...prev, priority: value }))}>
                    <SelectTrigger><SelectValue /></SelectTrigger>
                    <SelectContent>
                      {priorityOptions.map((option) => (
                        <SelectItem key={option.value} value={option.value}>
                          <div className="flex items-center gap-2">
                            <div className={cn("w-2 h-2 rounded-full", option.color.replace("text-", "bg-"))} />
                            {option.label}
                          </div>
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </div>
                <div className="space-y-2">
                  <label className="text-sm font-medium text-foreground">Status</label>
                  <Select value={formData.status} onValueChange={(value: TaskStatus) => setFormData((prev) => ({ ...prev, status: value }))}>
                    <SelectTrigger><SelectValue /></SelectTrigger>
                    <SelectContent>
                      {statusOptions.map((option) => (<SelectItem key={option.value} value={option.value}>{option.label}</SelectItem>))}
                    </SelectContent>
                  </Select>
                </div>
              </div>
              
              <div className="space-y-2">
                <label className="text-sm font-medium flex items-center gap-2"><Calendar className="w-4 h-4" /> Due Date</label>
                <DatePicker date={formData.dueDate} setDate={(date) => setFormData(prev => ({ ...prev, dueDate: date }))} />
              </div>

              {(!isLoadingLabels && availableLabels && availableLabels.length > 0) && (
                <div className="space-y-3">
                  <label className="text-sm font-medium text-foreground flex items-center gap-2"><Tag className="w-4 h-4" />Labels</label>
                  <div className="flex flex-wrap gap-2">
                    {availableLabels.map((label) => {
                      const isSelected = formData.labels.some(l => l._id === label._id);
                      return (
                        <motion.button 
                          key={label._id} type="button" whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} 
                          onClick={() => toggleLabel(label)}
                          className={cn("px-2 py-1 sm:px-3 sm:py-1 rounded-full text-xs sm:text-sm font-medium border-2 transition-all min-h-[32px] touch-manipulation",
                            isSelected ? "border-transparent text-white" : "border-border text-foreground hover:bg-muted"
                          )}
                          style={isSelected ? { backgroundColor: label.color } : {}}>
                          {label.name}
                        </motion.button>
                      );
                    })}
                  </div>
                </div>
              )}

              <div className="space-y-3">
                <label className="text-sm font-medium text-foreground flex items-center gap-2"><Users className="w-4 h-4" />Assignees</label>
                <div className="space-y-2 max-h-40 sm:max-h-48 overflow-y-auto">
                  {isLoadingProject || !project ? (
                    <div className="space-y-2"><Skeleton className="h-10 w-full" /><Skeleton className="h-10 w-full" /></div>
                  ) : (
                    <AssigneeSelector
                      projectMembers={project.members}
                      selectedAssignees={formData.assignees}
                      onSelectionChange={(ids) => setFormData(prev => ({ ...prev, assignees: ids }))}
                    />
                  )}
                </div>
              </div>
              
              <div className="space-y-3">
                <label className="text-sm font-medium text-foreground">Subtasks</label>
                <div className="space-y-2">
                  {formData.subtasks.map((subtask, index) => (
                    <div key={index} className="flex items-center gap-2 p-2 bg-muted rounded-lg min-h-[40px]">
                      <span className="flex-1 text-sm">{subtask}</span>
                      <Button type="button" variant="ghost" size="sm" onClick={() => removeSubtask(index)} className="min-h-[32px] min-w-[32px]"><X className="w-4 h-4" /></Button>
                    </div>
                  ))}
                  <div className="flex gap-2">
                    <Input value={newSubtask} onChange={(e) => setNewSubtask(e.target.value)} placeholder="Add a subtask..." onKeyDown={(e) => e.key === "Enter" && (e.preventDefault(), addSubtask())} className="min-h-[40px]" />
                    <Button type="button" onClick={addSubtask} disabled={!newSubtask.trim()} className="min-h-[40px] min-w-[40px]"><Plus className="w-4 h-4" /></Button>
                  </div>
                </div>
              </div>

              <div className="space-y-3">
                <AttachmentList
                  taskId=""
                  attachments={attachmentLikeFiles}
                  isEditing={true}
                  onAttachmentAdd={handleAttachmentAdd}
                  onAttachmentDelete={(id) => {
                    const fileToDelete = attachmentLikeFiles.find(f => f._id === id);
                    if (fileToDelete) handleAttachmentDelete(fileToDelete.name);
                  }}
                />
              </div>
            </div>
            
            <div className="flex flex-col sm:flex-row gap-3 p-4 sm:p-6 pt-4 border-t border-border">
              <Button type="submit" className="w-full sm:flex-1 min-h-[44px]">Create Task</Button>
              <Button type="button" variant="outline" onClick={onClose} className="w-full sm:w-auto min-h-[44px] bg-transparent">Cancel</Button>
            </div>
          </form>
        </motion.div>
      </ModalContent>
    </Modal>
  )
}

############################## FIN DEL ARCHIVO: components\modals\create-task-modal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\DeleteProjectConfirmModal.tsx ##############################

"use client"

import * as React from "react"
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { cn } from "@/lib/utils"
import { toast } from "sonner"

interface DeleteProjectConfirmModalProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirmDelete: () => void;
  projectName: string;
}

/**
 * Genera una cadena alfanumérica aleatoria de 8 caracteres.
 */
const generateRandomString = () => {
  const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
  let result = "";
  for (let i = 0; i < 8; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
};

export function DeleteProjectConfirmModal({ isOpen, onClose, onConfirmDelete, projectName }: DeleteProjectConfirmModalProps) {
  const [confirmationString, setConfirmationString] = React.useState("");
  const [userInput, setUserInput] = React.useState("");

  // Regenera el código y limpia el input cada vez que el modal se abre
  React.useEffect(() => {
    if (isOpen) {
      setConfirmationString(generateRandomString());
      setUserInput("");
    }
  }, [isOpen]);

  /**
   * Bloquea el evento 'pegar' (paste) en el input.
   */
  const handlePaste = (e: React.ClipboardEvent) => {
    e.preventDefault();
    toast.warning("Para confirmar, debes escribir el código manualmente.");
  };

  /**
   * Bloquea el evento 'copiar' (copy) en el texto de confirmación.
   */
  const handleCopy = (e: React.ClipboardEvent) => {
    e.preventDefault();
    toast.error("No se puede copiar el texto de confirmación.");
  };

  // El botón de eliminar solo se activa si el texto coincide exactamente.
  const isMatch = userInput === confirmationString;

  return (
    // Usamos 'Dialog' como en DeleteTaskAlert para que funcione sobre el modal de edición
    <Dialog open={isOpen} onOpenChange={onClose}>
      {/* onPointerDownOutside previene que se cierre el modal de edición 
        que está por debajo al hacer clic fuera.
      */}
      <DialogContent onPointerDownOutside={(e: any) => e.preventDefault()}>
        <DialogHeader>
          <DialogTitle>¿Estás absolutamente seguro?</DialogTitle>
          <DialogDescription>
            Esta acción no se puede deshacer. Esto eliminará permanentemente el proyecto <strong>{projectName}</strong>,
            junto con todas sus tareas, etiquetas, comentarios y adjuntos.
          </DialogDescription>
        </DialogHeader>
        
        <div className="space-y-4 my-4">
          <p className="text-sm text-foreground">
            Para confirmar, por favor escribe la siguiente cadena de texto (se distinguen mayúsculas y minúsculas):
          </p>
          
          {/* Este bloque previene que el usuario seleccione y copie el texto.
          */}
          <div 
            className="w-full text-center bg-muted/80 text-foreground font-mono text-lg py-3 rounded-md"
            style={{ userSelect: 'none' }} // Previene la selección de texto
            onCopy={handleCopy} // Previene la copia por teclado
          >
            {confirmationString}
          </div>

          <Input 
            value={userInput}
            onChange={(e) => setUserInput(e.target.value)}
            onPaste={handlePaste} // Previene el pegado
            placeholder="Escribe la cadena para confirmar..."
            className={cn(
              "font-mono text-center text-base",
              // Añade feedback visual si el usuario está escribiendo
              userInput && (isMatch ? "border-green-500 focus-visible:ring-green-500" : "border-destructive focus-visible:ring-destructive")
            )}
            aria-label="Confirmation input"
          />
        </div>

        <DialogFooter>
          <Button variant="ghost" onClick={onClose}>
            Cancelar
          </Button>
          <Button
            variant="destructive"
            disabled={!isMatch}
            onClick={onConfirmDelete}
          >
            Sí, entiendo y quiero eliminar este proyecto
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}

############################## FIN DEL ARCHIVO: components\modals\DeleteProjectConfirmModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\DeleteTaskAlert.tsx ##############################

// components/modals/DeleteTaskAlert.tsx

"use client"

import * as React from "react"
import { motion } from "framer-motion"

// --- INICIO DE LA CORRECCIÓN: Importamos 'Dialog' en lugar de 'AlertDialog' ---
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog" 
// --- FIN DE LA CORRECCIÓN ---

import { Button } from "@/components/ui/button"

interface DeleteTaskAlertProps {
  isOpen: boolean;
  onClose: () => void;
  onConfirmDelete: () => void;
}

export function DeleteTaskAlert({ isOpen, onClose, onConfirmDelete }: DeleteTaskAlertProps) {
  const [isDeleteEnabled, setIsDeleteEnabled] = React.useState(false);

  React.useEffect(() => {
    if (isOpen) {
      setIsDeleteEnabled(false); 
      const timer = setTimeout(() => {
        setIsDeleteEnabled(true); 
      }, 5000);
      return () => clearTimeout(timer);
    }
  }, [isOpen]);

  return (
    // --- CORRECCIÓN: Usamos 'Dialog' ---
    <Dialog open={isOpen} onOpenChange={onClose}>
      
      {/* --- CORRECCIÓN: Usamos 'DialogContent' y añadimos la prop 'onPointerDownOutside' --- */}
      {/* Esto evita que el clic en la sombra cierre el modal de tarea de fondo. */}
      {/* Usamos 'e: any' para evitar los errores de tipo complejos de Radix. */}
      <DialogContent onPointerDownOutside={(e: any) => e.preventDefault()}>
        <DialogHeader>
          <DialogTitle>¿Estás absolutamente seguro?</DialogTitle>
          <DialogDescription>
            Esta acción no se puede deshacer. Esto eliminará permanentemente la
            tarea, junto con todas sus subtareas, comentarios y adjuntos.
          </DialogDescription>
        </DialogHeader>
        
        <div className="w-full h-2 bg-muted rounded-full overflow-hidden mt-2">
          {isOpen && (
            <motion.div
              className="h-full bg-destructive"
              initial={{ width: "0%" }}
              animate={{ width: "100%" }}
              transition={{ duration: 5, ease: "linear" }}
            />
          )}
        </div>

        {/* --- CORRECCIÓN: Usamos 'DialogFooter' y 'Button' normales --- */}
        <DialogFooter>
          <Button variant="ghost" onClick={onClose}>
            Cancelar
          </Button>
          <Button
            variant="destructive"
            disabled={!isDeleteEnabled}
            onClick={onConfirmDelete}
          >
            {isDeleteEnabled ? "Sí, eliminar tarea" : "Esperando..."}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  )
}

############################## FIN DEL ARCHIVO: components\modals\DeleteTaskAlert.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\DetailModal.tsx ##############################

"use client"

import * as React from "react"
import { Button } from "@/components/ui/button"
import { Modal, ModalContent } from "@/components/ui/modal"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Badge } from "@/components/ui/badge"
import { UserPlus, Handshake } from "lucide-react"
// 1. Re-importamos SkillsEditor. ¡Esta es la forma correcta!
import { SkillsEditor } from "@/components/profile/SkillsEditor" 
import { SearchResult } from "@/types"

interface DetailModalProps {
  isOpen: boolean
  onClose: () => void
  result: SearchResult | null
  onInvite: () => void
  onCollaborate: () => void
}

export function DetailModal({ isOpen, onClose, result, onInvite, onCollaborate }: DetailModalProps) {
  if (!result) return null

  // 2. Lógica robusta para el banner (usa bannerUrl o bannerImageUrl)
  const bannerSrc = result.bannerUrl || (result as any).bannerImageUrl || null;

  return (
    <Modal open={isOpen} onOpenChange={onClose}>
      <ModalContent className="w-[95vw] max-w-2xl max-h-[90vh] flex flex-col p-0 glass-card">
        <div className="flex-shrink-0 relative">
          
          {/* --- BANNER Y FALLBACK --- */}
          <div className="w-full h-32 rounded-t-2xl overflow-hidden relative bg-blue-100 dark:bg-white">
            {/* Fallback de color */}
            {bannerSrc && ( 
              <img 
                src={bannerSrc} 
                alt={`${result.name} banner`} 
                className="w-full h-full object-cover absolute inset-0" 
              />
            )}
          </div>
          {/* --- FIN BANNER --- */}

          <div className="absolute -bottom-10 left-6">
            <Avatar className="w-20 h-20 rounded-lg border-4 border-background">
              <AvatarImage src={result.avatar ?? undefined} />
              <AvatarFallback className="rounded-lg text-2xl">{result.name.charAt(0)}</AvatarFallback>
            </Avatar>
          </div>
        </div>

        <div className="flex-1 overflow-y-auto min-h-0 min-w-0">
          <div className="pt-14 px-6 pb-6 space-y-6 min-w-0">
            <div className="space-y-1 min-w-0">
      
              {/* --- TÍTULO (con truncate) --- */}
              <div className="flex items-center gap-2 min-w-0">
                <h2 className="flex-1 text-2xl font-bold text-foreground min-w-0 truncate">{result.name}</h2>
                <Badge variant={result.type === 'user' ? 'secondary' : 'default'}>{result.type}</Badge>
              </div>

              {/* --- DESCRIPCIÓN (con scroll y break-all) --- */}
              {result.description && (
                <p className="text-muted-foreground break-all max-h-32 overflow-y-auto rounded-md bg-muted/50 p-3">
                  {result.description}
                </p>
              )}
            </div>

            {/* --- SKILLS (Usando SkillsEditor) --- */}
            {/* 3. Esto funcionará tan pronto como la API envíe el array 'result.skills' */}
            {result.type === 'user' && (
              <div className="space-y-4">
                <h3 className="text-lg font-semibold">Skills</h3>
                <SkillsEditor 
                  selectedSkills={result.skills || []} 
                  setSelectedSkills={() => { }} 
                  isEditing={false} 
                />
              </div>
            )}
            {/* --- FIN SKILLS --- */}

          </div>
        </div>

        <div className="flex-shrink-0 flex justify-end gap-3 p-4 border-t border-border/50">
          {result.type === 'user' && (<Button onClick={onInvite}><UserPlus className="w-4 h-4 mr-2" />Enviar invitación</Button>)}
          {result.type === 'project' && (<Button onClick={onCollaborate}><Handshake className="w-4 h-4 mr-2" />Quiero colaborar</Button>)}
        </div>
      </ModalContent>
    </Modal>
  )
}

############################## FIN DEL ARCHIVO: components\modals\DetailModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\edit-project-modal.tsx ##############################

"use client"

import * as React from "react"
import { Button } from "@/components/ui/button"
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { ProjectSummary, UserSummary, Label as LabelType } from "@/types"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { ColorSelector } from "@/components/forms/color-selector"
import { ImageUploadField } from "@/components/forms/image-upload-field"
import { UserSearchModal } from "./UserSearchModal" 
import { UserPlus } from "lucide-react"
import { LabelManager } from "@/components/forms/label-manager"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"
import { DeleteProjectConfirmModal } from "./DeleteProjectConfirmModal"

interface ProjectFormData {
  name: string;
  description: string;
  color: string;
  projectImage?: File;
  bannerImage?: File;
  dueDate?: string;
}

interface EditProjectModalProps {
  isOpen: boolean;
  onClose: () => void;
  onSubmit: (data: FormData) => void;
  onDelete: (id: string) => void;
  project: ProjectSummary;
  onDataChange: () => void; 
}

const COLORS = ["#ef4444", "#f97316", "#eab308", "#84cc16", "#22c55e", "#14b8a6", "#06b6d4", "#3b82f6", "#8b5cf6", "#d946ef", "#ec4899"];
const getRandomColor = () => COLORS[Math.floor(Math.random() * COLORS.length)];

export function EditProjectModal({ isOpen, onClose, onSubmit, onDelete, project, onDataChange }: EditProjectModalProps) {
  const [formData, setFormData] = React.useState<ProjectFormData>({ name: '', description: '', color: '' });
  const [isUserSearchModalOpen, setIsUserSearchModalOpen] = React.useState(false);
  const [currentMembers, setCurrentMembers] = React.useState<UserSummary[]>([]);
const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = React.useState(false);
const [projectLabels, setProjectLabels] = React.useState<LabelType[]>([]);
const [labelsToAdd, setLabelsToAdd] = React.useState<string[]>([]);
const [labelsToDelete, setLabelsToDelete] = React.useState<string[]>([]);

  React.useEffect(() => {
    if (project && isOpen) {
      setFormData({
        name: project.name,
        description: project.description,
        color: project.color,
        dueDate: project.dueDate || undefined,
      });
      setCurrentMembers(project.members);
      
      apiClient.get<LabelType[]>(`/projects/${project.id}/labels`)
            .then(setProjectLabels)
            .catch(() => toast.error("Could not load project labels."));
    } else {
      setProjectLabels([]);
      setLabelsToAdd([]);
      setLabelsToDelete([]);
    }
  }, [project, isOpen]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  
const handleLabelAdd = (name: string) => {
    if (projectLabels.some(l => l.name.toLowerCase() === name.toLowerCase())) {
      toast.error("A label with that name already exists.");
      return;
    }
    setLabelsToAdd(prev => [...prev, name]);
    setProjectLabels(prev => [...prev, { _id: `temp-${name}`, name, color: getRandomColor() }]);
};

const handleLabelDelete = (id: string) => {
    const labelToRemove = projectLabels.find(l => l._id === id);
    if (!labelToRemove) return;

    if (!id.startsWith('temp-')) {
      setLabelsToDelete(prev => [...prev, id]);
    }
    setLabelsToAdd(prev => prev.filter(name => name !== labelToRemove.name));
    setProjectLabels(prev => prev.filter(l => l._id !== id));
};
  
  const handleSaveChanges = async (e: React.FormEvent) => {
    e.preventDefault();
    toast.info("Saving project changes...");

    if (labelsToAdd.length > 0 || labelsToDelete.length > 0) {
      try {
        await apiClient.put(`/projects/${project.id}/labels/batch`, {
          add: labelsToAdd.map(name => ({ name, color: getRandomColor() })),
          delete: labelsToDelete,
        });
        setLabelsToAdd([]);
        setLabelsToDelete([]);
      } catch (err) {
        toast.error(`Failed to update labels: ${(err as Error).message}`);
        return; 
      }
    }

    const data = new FormData();
    data.append('name', formData.name);
    data.append('description', formData.description);
    data.append('color', formData.color);
    if (formData.projectImage) data.append('projectImage', formData.projectImage);
    if (formData.bannerImage) data.append('bannerImage', formData.bannerImage);
    
    onSubmit(data);
  };
  
  const handleInviteUsers = async (selectedUsers: UserSummary[]) => {
    setIsUserSearchModalOpen(false);
    if (selectedUsers.length === 0) return;

    toast.info(`Inviting ${selectedUsers.length} member(s)...`);
    
    const invitePromises = selectedUsers.map(user => 
      apiClient.post(`/projects/${project.id}/invitations`, { userIdToInvite: user.id })
    );

    try {
      await Promise.all(invitePromises);
      toast.success("Invitations sent successfully!");
      onDataChange();
    } catch (error) {
      toast.error(`Failed to send invitations: ${(error as Error).message}`);
    }
  }

  if (!project) return null;

  return (
    <>
      <Dialog open={isOpen} onOpenChange={onClose}>
        <DialogContent className="sm:max-w-[525px] max-h-[90vh] flex flex-col">
          <DialogHeader>
            <DialogTitle>Editar Projecto</DialogTitle>
            <DialogDescription>
             Haz cambios en tu proyecto desde aqui. Dale click a guardar para no perder tus modificaciones.
            </DialogDescription>
          </DialogHeader>
          
          <div className="flex-1 overflow-y-auto px-2">
            <form id="edit-project-form" onSubmit={handleSaveChanges} className="space-y-4 py-4">
              <div className="space-y-2">
                <label className="text-sm font-medium">Project Name</label>
                <Input name="name" value={formData.name} onChange={handleChange} />
              </div>
              <div className="space-y-2">
                <label className="text-sm font-medium">Description</label>
                <Textarea name="description" value={formData.description} onChange={handleChange} />
              </div>
              <div className="space-y-2">
                <div className="flex justify-between items-center">
                  <label className="text-sm font-medium">Team Members</label>
                  <Button type="button" variant="ghost" size="sm" onClick={() => setIsUserSearchModalOpen(true)}>
                    <UserPlus className="w-4 h-4 mr-2" /> Invite
                  </Button>
                </div>
                <div className="flex items-center flex-wrap gap-2">
                  {currentMembers.map((member: UserSummary) => (
                    <Avatar key={member.id} title={member.name}>
                      <AvatarImage src={member.avatarUrl ?? undefined} alt={member.name} />
                      <AvatarFallback>{member.name.charAt(0)}</AvatarFallback>
                    </Avatar>
                  ))}
                </div>
              </div>

<div className="space-y-2">
    <label className="text-sm font-medium">Project Labels</label>
    <LabelManager 
        labels={projectLabels}
        onLabelAdd={handleLabelAdd}
        onLabelDelete={handleLabelDelete}
        isSubmitting={false} 
    />
</div>

              <div className="flex flex-col gap-2">
                <div className="space-y-2">
                  <ImageUploadField 
                      label="Project Image" 
                      name="projectImage" 
                      initialImage={project.projectImageUrl}
                      onChange={(file) => setFormData(prev => ({...prev, projectImage: file || undefined}))} 
                  />
                </div>
                <div className="space-y-2">
                  <ImageUploadField 
                      label="Banner Image" 
                      name="bannerImage" 
                      initialImage={project.bannerImageUrl}
                      onChange={(file) => setFormData(prev => ({...prev, bannerImage: file || undefined}))} 
                  />
                </div>
              </div>
              <div className="space-y-2">
                <label className="text-sm font-medium">Project Color</label>
                <ColorSelector 
                    selectedColor={formData.color || ''} 
                    onSelectColor={(color: string) => setFormData(prev => ({ ...prev, color }))} 
                />
              </div>
            </form>
          </div>
          <DialogFooter className="flex-shrink-0 pt-4 flex-nowrap justify-between w-full">
<Button variant="destructive" onClick={() => setIsDeleteConfirmOpen(true)}>Delete Project</Button>
              <div className="flex gap-2">
                  <Button variant="ghost" onClick={onClose}>Cancel</Button>
                  <Button type="submit" form="edit-project-form">Save changes</Button>
              </div>
          </DialogFooter>
        </DialogContent>
      </Dialog>

      <UserSearchModal
        isOpen={isUserSearchModalOpen}
        onClose={() => setIsUserSearchModalOpen(false)}
        onSelectUsers={handleInviteUsers}
        excludedUserIds={currentMembers.map(m => m.id)}
      />
      <DeleteProjectConfirmModal
        isOpen={isDeleteConfirmOpen}
        onClose={() => setIsDeleteConfirmOpen(false)}
        projectName={project.name}
        onConfirmDelete={() => {
          setIsDeleteConfirmOpen(false); 
          onDelete(project.id);       
        }}
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: components\modals\edit-project-modal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\InviteUserModal.tsx ##############################

// components/modals/InviteUserModal.tsx

"use client"

import * as React from "react"
import { Button } from "@/components/ui/button"
import { Modal, ModalContent, ModalHeader, ModalTitle, ModalDescription } from "@/components/ui/modal"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { UserSummary, ProjectSummary } from "@/types"
// --- NUEVO: Imports necesarios ---
import { useApi } from "@/hooks/useApi"
import { apiClient } from "@/lib/api"
import { toast } from "sonner"

interface InviteUserModalProps {
  isOpen: boolean
  onClose: () => void
  user: UserSummary
}

export function InviteUserModal({ isOpen, onClose, user }: InviteUserModalProps) {
  const [selectedProject, setSelectedProject] = React.useState("")

  // --- NUEVO: Obtenemos los proyectos reales del usuario para el dropdown ---
  const { data: userProjects, isLoading } = useApi<ProjectSummary[]>('/projects?filter=owned');

  // --- MODIFICADO: La función ahora llama a la API ---
  const handleInvite = async () => {
    if (!selectedProject) {
        toast.error("Please select a project.");
        return;
    };

    toast.info(`Inviting ${user.name} to the project...`);
    try {
      // El backend espera el ID del usuario a invitar en el cuerpo de la petición
      await apiClient.post(`/projects/${selectedProject}/invitations`, { userIdToInvite: user.id });
      toast.success(`Invitation sent to ${user.name}!`);
      onClose();
    } catch (error) {
      toast.error((error as Error).message);
    }
  }

  return (
    <Modal open={isOpen} onOpenChange={onClose}>
      <ModalContent>
        <ModalHeader>
          <div className="flex items-center gap-3">
            <Avatar>
              <AvatarImage src={user.avatarUrl ?? undefined} alt={user.name} />
              <AvatarFallback>{user.name.charAt(0)}</AvatarFallback>
            </Avatar>
            <div>
              <ModalTitle>Invite {user.name} to a project</ModalTitle>
              <ModalDescription>Select a project to send the invitation.</ModalDescription>
            </div>
          </div>
        </ModalHeader>
        <div className="p-6 space-y-4">
          <Select value={selectedProject} onValueChange={setSelectedProject}>
            <SelectTrigger disabled={isLoading}>
              <SelectValue placeholder={isLoading ? "Loading projects..." : "Choose a project..."} />
            </SelectTrigger>
            <SelectContent>
              {userProjects?.map((project) => (
                <SelectItem key={project.id} value={project.id}>{project.name}</SelectItem>
              ))}
            </SelectContent>
          </Select>
          <div className="flex justify-end gap-3">
            <Button variant="ghost" onClick={onClose}>Cancel</Button>
            <Button onClick={handleInvite} disabled={!selectedProject}>Send Invitation</Button>
          </div>
        </div>
      </ModalContent>
    </Modal>
  )
}

############################## FIN DEL ARCHIVO: components\modals\InviteUserModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\NotificationDetailModal.tsx ##############################

// components/modals/NotificationDetailModal.tsx

"use client"

import * as React from "react"
import Link from "next/link"
import { formatDistanceToNow } from 'date-fns'
import { es } from 'date-fns/locale'
import {
  Check, X, Loader2, ArrowRight, MessageSquareWarning, UserPlus, MessageSquare,
  UserCheck, Bell
} from "lucide-react"
import { toast } from "sonner"
import { Notification } from "@/types"
import { apiClient } from "@/lib/api"

import { Dialog, DialogContent, DialogFooter, DialogHeader } from "@/components/ui/dialog"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Separator } from "@/components/ui/separator"

// Nota: Para que `formatDistanceToNow` funcione, necesitarás instalar date-fns:
// npm install date-fns

interface NotificationDetailModalProps {
  notification: Notification | null
  isOpen: boolean
  onClose: () => void
  onResponseSuccess: () => void
}

const getNotificationIcon = (type: Notification['type']) => {
  switch (type) {
    case 'project_invitation':
    case 'collaboration_request':
      return <UserPlus className="w-5 h-5 text-blue-400" />;
    case 'new_comment':
      return <MessageSquare className="w-5 h-5 text-green-400" />;
    case 'task_assigned':
      return <UserCheck className="w-5 h-5 text-purple-400" />;
    default:
      return <Bell className="w-5 h-5 text-gray-400" />;
  }
};

export function NotificationDetailModal({
  notification,
  isOpen,
  onClose,
  onResponseSuccess,
}: NotificationDetailModalProps) {
  const [isResponding, setIsResponding] = React.useState(false);

  if (!notification) return null;

  const handleResponse = async (response: "accepted" | "declined") => {
    setIsResponding(true);
    try {
      await apiClient.put(`/notifications/${notification._id}/respond`, { response });
      toast.success(`La invitación ha sido ${response === 'accepted' ? 'aceptada' : 'rechazada'}.`);
      onResponseSuccess();
      onClose();
    } catch (error) {
      toast.error("No se pudo procesar la respuesta.");
    } finally {
      setIsResponding(false);
    }
  };

  const handleMarkAsUnread = async () => {
    try {
      await apiClient.put(`/notifications/${notification._id}/unread`, {});
      toast.success("Notificación marcada como no leída.");
      onResponseSuccess();
      onClose();
    } catch (err) {
      toast.error("No se pudo marcar como no leída.");
    }
  };

  return (
    <Dialog open={isOpen} onOpenChange={onClose}>
      <DialogContent className="glass-card p-0 max-w-lg">
        <DialogHeader className="p-6 pb-4">
          <div className="flex items-center gap-4">
            <div className="bg-foreground/10 p-2 rounded-lg">
              {getNotificationIcon(notification.type)}
            </div>
            <div className="flex-grow">
              <p className="font-semibold text-foreground">
                {notification.sender.name}
              </p>
              <p className="text-xs text-muted-foreground">
                {notification.createdAt && formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true, locale: es })}
              </p>
            </div>
          </div>
        </DialogHeader>
        
        <div className="px-6 pb-6 space-y-4">
          <p className="text-base text-foreground leading-relaxed">
            {notification.text}
          </p>
        </div>

        <Separator className="bg-white/10" />

        <DialogFooter className="p-4 bg-black/10 flex-col-reverse sm:flex-row sm:justify-end w-full gap-4">
          <div className="flex items-center gap-4 pt-2 sm:pt-0">
            <Button variant="outline" size="icon" onClick={handleMarkAsUnread} className=" text-muted-foreground">
              <MessageSquareWarning  />
            </Button>
          </div>
          
          {notification.status === 'pending' ? (
            <div className="flex gap-2 self-end">
              <Button variant="outline" onClick={() => handleResponse('declined')} disabled={isResponding}>
                <X className="mr-2 h-4 w-4" /> Rechazar
              </Button>
              <Button onClick={() => handleResponse('accepted')} disabled={isResponding} className="bg-primary hover:bg-primary/90">
                {isResponding ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <Check className="mr-2 h-4 w-4" />}
                Aceptar
              </Button>
            </div>
          ) : (
            <Button asChild className="self-end">
              <Link href={notification.link} onClick={onClose}>
                Ver Detalles <ArrowRight className="w-4 h-4 ml-2" />
              </Link>
            </Button>
          )}
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}

############################## FIN DEL ARCHIVO: components\modals\NotificationDetailModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\modals\UserSearchModal.tsx ##############################

// components/modals/UserSearchModal.tsx
"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { Search, UserCheck, Plus } from "lucide-react"
import { apiClient } from "@/lib/api"
import { SearchResult, UserSummary } from "@/types"
import { toast } from "sonner"
import { useDebounce } from "@/hooks/useDebounce" 
import { Modal, ModalContent, ModalHeader, ModalTitle, ModalDescription, ModalFooter } from "@/components/ui/modal"
import { Input } from "@/components/ui/input"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Skeleton } from "@/components/ui/skeleton"

interface UserSearchModalProps {
  isOpen: boolean
  onClose: () => void
  onSelectUsers: (users: UserSummary[]) => void
  excludedUserIds?: string[] 
}

export function UserSearchModal({ isOpen, onClose, onSelectUsers, excludedUserIds = [] }: UserSearchModalProps) {
  const [query, setQuery] = React.useState("")
  const [results, setResults] = React.useState<UserSummary[]>([])
  const [isLoading, setIsLoading] = React.useState(false)
  const [selectedUsers, setSelectedUsers] = React.useState<UserSummary[]>([]);

  const debouncedQuery = useDebounce(query, 300)

  React.useEffect(() => {
    const fetchResults = async () => {
      if (debouncedQuery.length < 2) {
        setResults([]);
        return;
      }
      setIsLoading(true);
      try {
        const data = await apiClient.get<SearchResult[]>(`/search?q=${debouncedQuery}&type=user`);
        const newResults = data
          .filter(user => !excludedUserIds.includes(user.id)) // Excluir usuarios ya en el proyecto/lista
          .map(user => ({ // Mapear a UserSummary
            id: user.id,
            name: user.name,
            avatarUrl: user.avatar
          }));
        setResults(newResults);
      } catch (err) {
        toast.error((err as Error).message);
      } finally {
        setIsLoading(false);
      }
    };
    
    if(isOpen) {
      fetchResults();
    }
  }, [debouncedQuery, excludedUserIds, isOpen]);

  const handleToggleUser = (user: UserSummary) => {
    setSelectedUsers(prev => 
      prev.some(u => u.id === user.id) 
        ? prev.filter(u => u.id !== user.id)
        : [...prev, user]
    )
  }

  const handleConfirmSelection = () => {
    onSelectUsers(selectedUsers);
    handleClose();
  }

  const handleClose = () => {
    setQuery('');
    setResults([]);
    setSelectedUsers([]);
    onClose();
  }

  return (
    <Modal open={isOpen} onOpenChange={handleClose}>
      <ModalContent className="max-w-lg">
        <ModalHeader>
          <ModalTitle>Add Members</ModalTitle>
          <ModalDescription>Search for users to add to the project.</ModalDescription>
        </ModalHeader>
        <div className="p-6 space-y-4">
          <div className="relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" />
            <Input
              placeholder="Search by name or email..."
              value={query}
              onChange={(e) => setQuery(e.target.value)}
              className="pl-10"
              autoFocus
            />
          </div>
          <div className="space-y-2 max-h-64 overflow-y-auto pr-2">
            {isLoading && <Skeleton className="h-16 w-full" />}
            {!isLoading && results.map((user) => {
              const isSelected = selectedUsers.some(u => u.id === user.id);
              return (
                <motion.div
                  key={user.id}
                  className="flex items-center justify-between p-2 rounded-lg hover:bg-muted cursor-pointer"
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  onClick={() => handleToggleUser(user)}
                >
                  <div className="flex items-center gap-3">
                    <Avatar className="w-10 h-10">
                      <AvatarImage src={user.avatarUrl || undefined} />
                      <AvatarFallback>{user.name.charAt(0)}</AvatarFallback>
                    </Avatar>
                    <div>
                      <p className="font-semibold">{user.name}</p>
                    </div>
                  </div>
                  <Button
                    size="sm"
                    variant={isSelected ? "default" : "outline"}
                  >
                    {isSelected ? <UserCheck className="w-4 h-4 mr-2" /> : <Plus className="w-4 h-4 mr-2" />}
                    {isSelected ? 'Selected' : 'Select'}
                  </Button>
                </motion.div>
              );
            })}
            {!isLoading && debouncedQuery.length > 1 && results.length === 0 && (
              <div className="text-center text-muted-foreground py-4">
                <p>No users found matching "{debouncedQuery}".</p>
              </div>
            )}
          </div>
        </div>
        <ModalFooter>
          <Button variant="ghost" onClick={handleClose}>Cancel</Button>
          <Button onClick={handleConfirmSelection} disabled={selectedUsers.length === 0}>
            Add {selectedUsers.length} member(s)
          </Button>
        </ModalFooter>
      </ModalContent>
    </Modal>
  );
}

############################## FIN DEL ARCHIVO: components\modals\UserSearchModal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\notification-panel.tsx ##############################

// Jello-Frontend/components/notification-panel.tsx

"use client";

import * as React from "react";
import Link from "next/link";
import { useApi } from "@/hooks/useApi";
import { Notification } from "@/types";
import { Skeleton } from "@/components/ui/skeleton";
import { NotificationItem } from "@/components/notifications/NotificationItem";
import { Button } from "./ui/button";
import { NotificationDetailModal } from "./modals/NotificationDetailModal";
import { apiClient } from "@/lib/api";
import { BellOff, LoaderCircle } from "lucide-react";

export function NotificationPanel() {
 const { data, isLoading, error, setData, refetch } = useApi<{ notifications: Notification[] }>("/notifications?limit=10");


  const [selectedNotification, setSelectedNotification] = React.useState<Notification | null>(null);

  const unreadNotifications = React.useMemo(() => {
    return data?.notifications?.filter(n => !n.read) || [];
  }, [data]);

 const handleNotificationClick = (notification: Notification) => {
    // Actualización optimista: marcamos como leída en la UI inmediatamente
    setData(currentData => ({
      ...currentData,
      notifications: currentData?.notifications.map(n =>
        n._id === notification._id ? { ...n, read: true } : n
      ) || [],
    }));

    // Hacemos la llamada a la API en segundo plano
    apiClient.put(`/notifications/${notification._id}/read`, {}).catch(() => {
      refetch(); // Si falla, revertimos con datos del servidor
    });

    setSelectedNotification(notification);
  };

  return (
    <>
      <div className="w-full max-w-sm">
        <div className="flex items-center justify-between p-4 border-b border-border">
          <h3 className="font-semibold text-foreground">Notificaciones</h3>
        </div>

        <div className="max-h-96 overflow-y-auto">
          {isLoading ? (
            <div className="flex items-center justify-center p-8">
              <LoaderCircle className="w-6 h-6 animate-spin text-muted-foreground" />
            </div>
          ) : error ? (
            <div className="text-center p-8 text-sm text-destructive">{error}</div>
          // 3. Verificamos si hay notificaciones no leídas para mostrar
          ) : unreadNotifications.length > 0 ? (
            unreadNotifications.map((notification) => (
              <NotificationItem
                key={notification._id}
                notification={notification}
                onClick={() => handleNotificationClick(notification)}
              />
            ))
          // 4. Mostramos el mensaje cuando no hay nada
          ) : (
            <div className="text-center p-8 text-muted-foreground">
              <BellOff className="mx-auto w-10 h-10 mb-2 opacity-50" />
              <h3 className="font-semibold text-sm">You're all caught up</h3>
              <p className="text-xs">You have no unread notifications.</p>
            </div>
          )}
        </div>

        <div className="p-2 border-t border-border">
          <Button variant="ghost" className="w-full text-sm" asChild>
            <Link href="/notifications">Ver todas las notificaciones</Link>
          </Button>
        </div>
      </div>

      <NotificationDetailModal
        isOpen={!!selectedNotification}
        onClose={() => setSelectedNotification(null)}
        notification={selectedNotification}
        onResponseSuccess={refetch} 
      />
    </>
  );
}

############################## FIN DEL ARCHIVO: components\notification-panel.tsx ##################################

############################## INICIO DEL ARCHIVO: components\notifications\NotificationItem.tsx ##############################

// Jello-Frontend/components/notifications/NotificationItem.tsx

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { formatDistanceToNow } from "date-fns"
import { UserPlus, Handshake, ClipboardCheck, MessageSquare, Bell, FilePlus, Shuffle, Check, X } from "lucide-react"

import { cn } from "@/lib/utils"
import { Notification } from "@/types"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"

interface NotificationItemProps {
  notification: Notification
  onClick: () => void;
}

// --- MODIFICADO: Se añaden los nuevos tipos de notificación con sus estilos ---
const notificationConfig = {
  project_invitation: { icon: UserPlus, color: "text-blue-500" },
  collaboration_request: { icon: Handshake, color: "text-purple-500" },
  task_created: { icon: FilePlus, color: "text-gray-500" },
  task_assigned: { icon: ClipboardCheck, color: "text-green-500" },
  task_status_changed: { icon: Shuffle, color: "text-yellow-500" },
  new_comment: { icon: MessageSquare, color: "text-orange-500" },
  invitation_accepted: { icon: Check, color: "text-green-500" },
  invitation_declined: { icon: X, color: "text-red-500" },
  collaboration_accepted: { icon: Check, color: "text-green-500" },
  collaboration_declined: { icon: X, color: "text-red-500" },
  generic: { icon: Bell, color: "text-gray-500" },
};

export function NotificationItem({ notification, onClick }: NotificationItemProps) {
  const config = notificationConfig[notification.type as keyof typeof notificationConfig] || notificationConfig.generic;
  const Icon = config.icon;

  return (
    <motion.button
      initial={{ opacity: 0, x: -20 }}
      animate={{ opacity: 1, x: 0 }}
      onClick={onClick}
      className={cn(
        "w-full flex items-start gap-3 p-4 text-left transition-colors duration-200 relative hover:bg-muted/60 cursor-pointer border-b border-border/50",
        !notification.read && "bg-primary/5",
      )}
    >
      {!notification.read && (
        <div className="absolute left-1.5 top-1/2 -translate-y-1/2 h-2 w-2 bg-primary rounded-full" />
      )}

      <div className="pl-4 pt-1">
        <Icon className={cn("w-5 h-5", config.color)} />
      </div>

      <div className="flex-1 min-w-0">
        <div className="flex items-center gap-3">
          <Avatar className="w-8 h-8">
            <AvatarImage src={notification.sender.avatarUrl || undefined} />
            <AvatarFallback>{notification.sender.name.charAt(0)}</AvatarFallback>
          </Avatar>
          <div className="flex-1">
            {/* Se usa `notification.text` en lugar de `message` */}
            <p className="text-sm text-foreground line-clamp-2">{notification.text}</p>
            <p className="text-xs text-muted-foreground pt-1">
              {formatDistanceToNow(new Date(notification.createdAt), { addSuffix: true })}
            </p>
          </div>
        </div>
      </div>
    </motion.button>
  )
}

############################## FIN DEL ARCHIVO: components\notifications\NotificationItem.tsx ##################################

############################## INICIO DEL ARCHIVO: components\profile\SkillsEditor.tsx ##############################

"use client"

import * as React from "react"
import { Badge } from "@/components/ui/badge"
import { Button } from "@/components/ui/button"
import { Command, CommandEmpty, CommandGroup, CommandInput, CommandItem, CommandList } from "@/components/ui/command"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { X, Check } from "lucide-react"
import { cn } from "@/lib/utils"

const ALL_SKILLS = {
  "Programming Languages": ["JavaScript", "TypeScript", "Python", "Java", "C#", "Go", "Rust", "PHP", "Ruby"],
  "Frontend Frameworks": ["React", "Next.js", "Vue.js", "Angular", "Svelte", "SolidJS"],
  "Backend Frameworks": ["Node.js", "Express", "Django", "Flask", "Spring Boot", "ASP.NET", "Laravel"],
  "Styling & UI": ["CSS", "Sass", "Tailwind CSS", "Styled Components", "Framer Motion", "Shadcn/UI"],
  "Databases": ["PostgreSQL", "MySQL", "MongoDB", "Redis", "SQLite", "Firebase"],
  "Tools & Platforms": ["Git", "GitHub", "Docker", "Kubernetes", "AWS", "Google Cloud", "Vercel", "Figma", "Jira"],
  "Soft Skills": ["Teamwork", "Communication", "Problem Solving", "Leadership", "Adaptability", "Creativity", "Time Management"],
}

interface SkillsEditorProps {
  selectedSkills: string[]
  setSelectedSkills: (skills: string[]) => void
  isEditing: boolean
}

export function SkillsEditor({ selectedSkills, setSelectedSkills, isEditing }: SkillsEditorProps) {
  const [open, setOpen] = React.useState(false)

  const handleSelect = (skill: string) => {
    if (!selectedSkills.includes(skill)) {
      setSelectedSkills([...selectedSkills, skill])
    }
    setOpen(false)
  }

  const handleRemove = (skill: string) => {
    setSelectedSkills(selectedSkills.filter((s) => s !== skill))
  }

  const availableSkills = Object.values(ALL_SKILLS).flat().filter(skill => !selectedSkills.includes(skill));

  return (
    <div className="space-y-3">
      <div className="flex flex-wrap gap-2">
        {selectedSkills.map(skill => (
          <Badge key={skill} variant="secondary" className="text-sm py-1 px-3">
            {skill}
            {isEditing && (
              <button onClick={() => handleRemove(skill)} className="ml-2 rounded-full hover:bg-destructive/20 p-0.5">
                <X className="h-3 w-3" />
              </button>
            )}
          </Badge>
        ))}
      </div>
      {isEditing && (
        <Popover open={open} onOpenChange={setOpen}>
          <PopoverTrigger asChild>
            <Button variant="outline" size="sm">Add Skill +</Button>
          </PopoverTrigger>
          <PopoverContent className="p-0 w-[250px]">
            <Command>
              <CommandInput placeholder="Search skills..." />
              <CommandList>
                <CommandEmpty>No results found.</CommandEmpty>
                {Object.entries(ALL_SKILLS).map(([group, skills]) => {
                  const filteredSkills = skills.filter(s => !selectedSkills.includes(s));
                  if (filteredSkills.length === 0) return null;
                  return (
                    <CommandGroup key={group} heading={group}>
                      {filteredSkills.map(skill => (
                        <CommandItem key={skill} onSelect={() => handleSelect(skill)}>
                          {skill}
                        </CommandItem>
                      ))}
                    </CommandGroup>
                  )
                })}
              </CommandList>
            </Command>
          </PopoverContent>
        </Popover>
      )}
    </div>
  )
}

############################## FIN DEL ARCHIVO: components\profile\SkillsEditor.tsx ##################################

############################## INICIO DEL ARCHIVO: components\project-card.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\project-card.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\project-card.tsx ##############################

"use client"

import * as React from "react"
import Link from "next/link"
import { motion } from "framer-motion"
import { ProjectSummary } from "@/types"
import { cn } from "@/lib/utils"
import { Badge } from "@/components/ui/badge"
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar"
import { Progress } from "@/components/ui/progress"
import { Button } from "@/components/ui/button"
import { SquarePen, CheckCircle, Calendar } from "lucide-react"

interface ProjectCardProps {
  project: ProjectSummary;
  onEdit: (project: ProjectSummary) => void;
}

export function ProjectCard({ project, onEdit }: ProjectCardProps) {
  return (
    <motion.div
      layout
      initial={{ opacity: 0, scale: 0.9 }}
      animate={{ opacity: 1, scale: 1 }}
      exit={{ opacity: 0, scale: 0.9 }}
      transition={{ duration: 0.2 }}
      className={cn(
        "relative group flex flex-col justify-between rounded-2xl border p-5 shadow-sm transition-all duration-300 ease-in-out hover:shadow-lg ",
        "bg-card/60 text-card-foreground"
      )}
    >

      <div className="absolute top-4 right-4">
        <Button
          variant="ghost"
          size="icon"
          className="rounded-full h-8 w-8 bg-background/20 hover:bg-background/80"
          onClick={(e) => {
            e.preventDefault(); 
            onEdit(project);
          }}
          aria-label="Edit project"
        >
          <SquarePen className="w-4 h-4" />
        </Button>
      </div>

      <Link href={`/project/${project.id}`} className="flex flex-col z-2 h-full">
        <div className="flex-grow ">
          <div className="flex items-start justify-between min-w-0">
            <div className="space-y-2 min-w-0">
              <h3 className="text-lg font-bold truncate">{project.name}</h3>
              {project.isOwner && (
                <Badge variant="secondary" className="text-xs">Owner</Badge>
              )}
            </div>
          </div>
          <p className="mt-2 text-sm text-muted-foreground line-clamp-2 h-[40px]">
            {project.description}
          </p>
        </div>

        <div className="mt-4">
          <div className="flex justify-between items-center mb-1 text-xs text-muted-foreground">
            <span>Progress</span>
            <span>{project.progress}%</span>
          </div>
          <Progress value={project.progress} className="h-2" />
        </div>

        <div className="mt-4 flex justify-between items-end">
          <div className="flex -space-x-2">
            {project.members.slice(0, 3).map((member) => (
              <Avatar key={member.id} className="w-6 h-6 border-2 border-background">
                <AvatarImage src={member.avatarUrl || ''} alt={member.name} />
                <AvatarFallback className="text-xs">{member.name.charAt(0)}</AvatarFallback>
              </Avatar>
            ))}
            {project.members.length > 3 && (
              <Avatar className="w-6 h-6 border-2 border-background">
                <AvatarFallback className="text-xs">+{project.members.length - 3}</AvatarFallback>
              </Avatar>
            )}
          </div>

          <div className="flex items-center gap-4 text-xs text-muted-foreground">
            <div className="flex items-center gap-1">
              <CheckCircle className="w-3 h-3" />
              <span>{project.completedTasks}/{project.totalTasks}</span>
            </div>
            {project.dueDate && (
              <div className="flex items-center gap-1">
                <Calendar className="w-3 h-3" />
                <span>{new Date(project.dueDate).toLocaleDateString()}</span>
              </div>
            )}
          </div>
        </div>
      </Link>
    </motion.div>
  );
}

############################## FIN DEL ARCHIVO: components\project-card.tsx ##################################

############################## INICIO DEL ARCHIVO: components\project-header.tsx ##############################

"use client"

import * as React from 'react';
import { ProjectDetails } from '@/types';
import { Users, Settings, UserPlus } from 'lucide-react';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { Button } from '@/components/ui/button';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";
import { cn } from '@/lib/utils';

interface ProjectHeaderProps {
  project: ProjectDetails;
  onEdit: () => void;
  onInviteMembers: () => void;
}

export function ProjectHeader({ project, onEdit, onInviteMembers }: ProjectHeaderProps) {

  return (
    <div className="relative flex flex-col p-6 pt-0 bg-card/70 rounded-2xl">
      {/* Banner Image */}
      <div className="h-40 bg-muted  rounded-t-2xl overflow-hidden -mx-6 -mt-0 mb-8 relative">
        <img 
          src={project.bannerImageUrl || "/placeholder.jpg"} 
          alt={`${project.name} banner`}
          className="w-full h-full object-cover"
        />
      </div>

      {/* Header Content */}
      <div className="flex flex-col overflow-x-hidden md:flex-row gap-4 md:items-end md:justify-between">
        {/* Left Side: Avatar, Title, Description, Members */}
        <div className="flex items-start gap-4 min-w-0">
           <Avatar className={cn("w-16 h-16 rounded-full border-4 border-background", !project.projectImageUrl && project.color)}>
            <AvatarImage src={project.projectImageUrl || undefined} className="rounded-full" />
            <AvatarFallback className="rounded-full text-2xl font-bold">
              {project.name.charAt(0).toUpperCase()}
            </AvatarFallback>
          </Avatar>
          
          <div className="space-y-1 min-w-0">
            <h1 className="text-3xl truncate font-bold text-foreground">{project.name}</h1>
            <p className="text-muted-foreground truncate">{project.description}</p>
            
            <TooltipProvider delayDuration={100}>
              <Tooltip>
                <TooltipTrigger asChild>
                  <div className="flex items-center gap-2 pt-2 cursor-pointer">
                    <div className="flex -space-x-2">
                      {project.members.slice(0, 5).map((member) => (
                        <Avatar key={member.id} className="w-8 h-8 border-2 border-background">
                          <AvatarImage src={member.avatarUrl || ''} alt={member.name} />
                          <AvatarFallback className="text-xs">{member.name.charAt(0)}</AvatarFallback>
                        </Avatar>
                      ))}
                      {project.members.length > 5 && (
                        <Avatar className="w-8 h-8 border-2 border-background">
                          <AvatarFallback className="text-xs">+{project.members.length - 5}</AvatarFallback>
                        </Avatar>
                      )}
                    </div>
                    <span className="text-sm text-muted-foreground hover:text-foreground transition-colors">
                      {project.members.length} Members
                    </span>
                  </div>
                </TooltipTrigger>
                <TooltipContent className="p-2">
                  <div className="flex flex-col gap-2 text-sm">
                    <p className="font-semibold px-2">Project Members</p>
                    {project.members.map(member => (
                      <div key={member.id} className="flex items-center gap-2">
                         <Avatar className="w-6 h-6">
                          <AvatarImage src={member.avatarUrl || ''} alt={member.name} />
                          <AvatarFallback className="text-xs">{member.name.charAt(0)}</AvatarFallback>
                        </Avatar>
                        <span>{member.name}</span>
                      </div>
                    ))}
                  </div>
                </TooltipContent>
              </Tooltip>
            </TooltipProvider>

          </div>
        </div>

        {/* Right Side: Action Buttons */}
        {project.isOwner && (
          <div className="flex items-center gap-2 self-end md:self-auto">
            <Button variant="outline" onClick={onInviteMembers}>
              <UserPlus className="w-4 h-4 mr-2" />
              Add People
            </Button>
            <Button variant="ghost" size="icon" onClick={onEdit} aria-label="Project settings">
              <Settings className="w-5 h-5" />
            </Button>
          </div>
        )}
      </div>
    </div>
  );
}

############################## FIN DEL ARCHIVO: components\project-header.tsx ##################################

############################## INICIO DEL ARCHIVO: components\register-form.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\register-form.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\register-form.tsx ##############################

"use client";

import * as React from "react";
import { useAuth } from "@/contexts/auth-context";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import { Eye, EyeOff, LoaderCircle, CheckCircle } from "lucide-react";
import Link from "next/link";
import { motion } from "framer-motion";

const GoogleIcon = () => <svg className="mr-2 h-4 w-4" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4" /><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853" /><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05" /><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335" /></svg>;
const GitHubIcon = () => <svg className="mr-2 h-4 w-4" fill="currentColor" viewBox="0 0 24 24"><path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.024-.105-.949-.199-2.403.041-3.439.219-.937 1.404-5.965 1.404-5.965s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.097.118.112.221.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.748-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001.012.001z" /></svg>;

export function RegisterForm({ onSwitchToLogin }: { onSwitchToLogin: () => void }) {
  const { register, isLoading } = useAuth();
  const [formData, setFormData] = React.useState({ firstName: "", lastName: "", email: "", password: "" });
  const [showPassword, setShowPassword] = React.useState(false);
  const [termsAccepted, setTermsAccepted] = React.useState(false);
  const [isSubmitted, setIsSubmitted] = React.useState(false); // Nuevo estado

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (isLoading || !termsAccepted) return;
    
    const result = await register({
      name: `${formData.firstName} ${formData.lastName}`.trim(),
      email: formData.email,
      password: formData.password
    });

    if (result.success) {
      setIsSubmitted(true);
    }
  };

  // Si el formulario ya se envió, mostramos el mensaje de éxito.
  if (isSubmitted) {
    return (
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="glass-card p-8 w-full space-y-6 text-center"
      >
        <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
        <h1 className="text-2xl font-bold text-foreground">¡Registro Exitoso!</h1>
        <p className="text-muted-foreground">
          Por favor, revisa tu correo electrónico para activar tu cuenta.
        </p>
      </motion.div>
    );
  }
return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.5 }}
      className="glass-card p-8 w-full space-y-6"
    >
      <div className="space-y-2 text-center">
        <h1 className="text-2xl font-bold text-foreground">Crea tu cuenta</h1>
        <p className="text-muted-foreground">Comienza tu viaje de productividad con Jello</p>
      </div>

      <form onSubmit={handleSubmit} className="space-y-4">
        <div className="grid grid-cols-2 gap-3">
          <div className="space-y-2">
            <label htmlFor="firstName" className="text-sm font-medium text-foreground">Nombre</label>
            <Input id="firstName" name="firstName" placeholder="John" required value={formData.firstName} onChange={handleChange} />
          </div>
          <div className="space-y-2">
            <label htmlFor="lastName" className="text-sm font-medium text-foreground">Apellido</label>
            <Input id="lastName" name="lastName" placeholder="Doe" required value={formData.lastName} onChange={handleChange} />
          </div>
        </div>
        <div className="space-y-2">
          <label htmlFor="emailReg" className="text-sm font-medium text-foreground">Email</label>
          <Input id="emailReg" name="email" type="email" placeholder="john@example.com" required value={formData.email} onChange={handleChange} />
        </div>
        <div className="space-y-2">
          <label htmlFor="passwordReg" className="text-sm font-medium text-foreground">Contraseña</label>
          <div className="relative">
            <Input id="passwordReg" name="password" type={showPassword ? "text" : "password"} placeholder="Crea una contraseña segura" required value={formData.password} onChange={handleChange} className="pr-10" />
            <Button type="button" variant="ghost" size="icon" className="w-10 rounded-full absolute right-0 top-0 h-full px-3 py-2 hover:bg-transparent" onClick={() => setShowPassword(!showPassword)}>
              {showPassword ? <EyeOff className="h-4 w-4" /> : <Eye className="h-4 w-4" />}
            </Button>
          </div>
          <p className="text-xs text-muted-foreground">Debe tener al menos 8 caracteres.</p>
        </div>
        <div className="flex items-center space-x-2">
          <Checkbox id="terms" checked={termsAccepted} onCheckedChange={(checked) => setTermsAccepted(Boolean(checked))} />
          <label htmlFor="terms" className="text-sm text-muted-foreground">Acepto los <Link href="/terms" className="underline text-primary">términos y condiciones</Link></label>
        </div>
        <Button type="submit" className="w-full" disabled={isLoading || !termsAccepted}>
          {isLoading && <LoaderCircle className="mr-2 h-4 w-4 animate-spin" />}
          {isLoading ? "Creando cuenta..." : "Crear cuenta"}
        </Button>
      </form><div className="relative">
        <div className="absolute inset-0 flex items-center">
          <span className="w-full border-t border-border" />
        </div>
        <div className="relative flex justify-center text-xs uppercase">
          <span className="bg-card px-2 text-muted-foreground">O regístrate con</span>
        </div>
      </div>

      <div className="flex flex-wrap gap-2 flex-row items-center justify-center">
        <Button asChild variant="outline" className="bg-transparent">
          <a href="https://jello-backend.onrender.com/api/auth/google">
            <GoogleIcon />Google
          </a>
        </Button>
        <Button asChild variant="outline" className="bg-transparent">
          <a href="https://jello-backend.onrender.com/api/auth/github">
            <GitHubIcon />GitHub
          </a>
        </Button>
      </div>
      
      <p className="text-center text-sm text-muted-foreground">
        ¿Ya tienes una cuenta?{' '}
        {/* 3. Reemplazamos <Link> por <button> */}
        <button
          type="button"
          onClick={onSwitchToLogin}
          className="underline text-primary font-medium focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 rounded-sm"
        >
          Inicia Sesión
        </button>
      </p>
    </motion.div>
  );
}

############################## FIN DEL ARCHIVO: components\register-form.tsx ##################################

############################## INICIO DEL ARCHIVO: components\search\SearchResultCard.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import { Badge } from "@/components/ui/badge"
import { UserPlus, Handshake } from "lucide-react"
import { InviteUserModal } from "@/components/modals/InviteUserModal"
import { CollaborateModal } from "@/components/modals/CollaborateModal"
import { SearchResult } from "@/types" 
import { DetailModal } from "@/components/modals/DetailModal"
interface SearchResultCardProps {
  result: SearchResult
}

export function SearchResultCard({ result }: SearchResultCardProps) {
  const [isInviteModalOpen, setInviteModalOpen] = React.useState(false)
  const [isCollaborateModalOpen, setCollaborateModalOpen] = React.useState(false)
  const [isDetailModalOpen, setDetailModalOpen] = React.useState(false)

  const handleActionClick = (e: React.MouseEvent, action: () => void) => {
    e.stopPropagation();
    action();
  }

  return (
    <>
      <motion.div
        className="glass-card p-6 flex flex-col h-full cursor-pointer"
        whileHover={{ scale: 1.04, transition: { type: "spring" }}}
        onClick={() => setDetailModalOpen(true)}
      >
        <div className="flex-grow pb-4">
          <div className="flex items-start gap-4">
            <Avatar className="w-12 h-12 rounded-lg">
              <AvatarImage src={result.avatar ?? undefined} />
              <AvatarFallback className="rounded-lg">{result.name.charAt(0)}</AvatarFallback>
            </Avatar>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-1 min-w-0">
                <h3 className="font-semibold text-foreground truncate">{result.name}</h3>
                <Badge variant={result.type === 'user' ? 'secondary' : 'default'}>
                  {result.type}
                </Badge>
              </div>
              <p className="text-sm text-muted-foreground break-words truncate">{result.description}</p>
            </div>
          </div>
        </div>

        <div className="flex justify-end gap-2 pt-4 border-t border-border/50">
          {result.type === 'user' && (
            <Button size="sm" onClick={(e) => handleActionClick(e, () => setInviteModalOpen(true))}>
              <UserPlus className="w-4 h-4 mr-2" />
              Enviar invitación
            </Button>
          )}
          {result.type === 'project' && (
            <Button size="sm" onClick={(e) => handleActionClick(e, () => setCollaborateModalOpen(true))}>
              <Handshake className="w-4 h-4 mr-2" />
              Quiero colaborar
            </Button>
          )}
        </div>
      </motion.div>

      <DetailModal
        isOpen={isDetailModalOpen}
        onClose={() => setDetailModalOpen(false)}
        result={result}
        onInvite={() => setInviteModalOpen(true)}
        onCollaborate={() => setCollaborateModalOpen(true)}
      />
      {result.type === 'user' && (
       <InviteUserModal 
  isOpen={isInviteModalOpen} 
  onClose={() => setInviteModalOpen(false)} 
  user={{
    id: result.id,
    name: result.name,
    avatarUrl: result.avatar 
  }} 
/>
      )}
      {result.type === 'project' && (
  <CollaborateModal 
    isOpen={isCollaborateModalOpen} 
    onClose={() => setCollaborateModalOpen(false)} 
    projectName={result.name}
    projectId={result.id} 
  />
)}
    </>
  )
}

############################## FIN DEL ARCHIVO: components\search\SearchResultCard.tsx ##################################

############################## INICIO DEL ARCHIVO: components\search-bar.tsx ##############################

"use client"

import * as React from "react"
import { useRouter } from "next/navigation"
import { Search } from "lucide-react"
import { Button } from "@/components/ui/button"
import { cn } from "@/lib/utils"

interface SearchBarProps {
  className?: string
}

export function SearchBar({ className }: SearchBarProps) {
  const router = useRouter()

  const handleSearchClick = () => {
    router.push("/search") 
  }

  return (
    <Button
      variant="outline"
      className={cn(
        "flex items-center justify-start gap-2 w-full text-muted-foreground",
        className
      )}
      onClick={handleSearchClick}
    >
      <Search className="h-4 w-4" />
      <span className="flex-grow text-left">Search...</span>
    </Button>
  )
}

############################## FIN DEL ARCHIVO: components\search-bar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\settings\settings-layout.tsx ##############################

"use client"

import type { ReactNode } from "react"
import { motion } from "framer-motion"
import { User, Bell, Palette, Plug, Shield, HelpCircle } from "lucide-react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { cn } from "@/lib/utils"

interface SettingsLayoutProps {
  children: ReactNode
}

const settingsNavigation = [
  {
    name: "Notifications",
    href: "/settings/notifications",
    icon: Bell,
    description: "Configure how you receive updates",
  },
  {
    name: "Appearance",
    href: "/settings/appearance",
    icon: Palette,
    description: "Customize your theme and display preferences",
  },
  {
    name: "Integrations",
    href: "/settings/integrations",
    icon: Plug,
    description: "Connect with third-party services",
  },
  {
    name: "Privacy & Security",
    href: "/settings/privacy",
    icon: Shield,
    description: "Control your privacy and security settings",
  },
  {
    name: "Help & Support",
    href: "/settings/help",
    icon: HelpCircle,
    description: "Get help and contact support",
  },
]

export function SettingsLayout({ children }: SettingsLayoutProps) {
  const pathname = usePathname()

  return (
    <div className="min-h-screen bg-gradient-to-br from-jello-blue/5 to-jello-accent/5">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div className="mb-8">
          <h1 className="text-3xl font-bold text-foreground mb-2">Settings</h1>
          <p className="text-muted-foreground">Manage your account and customize your Jello experience</p>
        </div>

        <div className="grid grid-cols-1 lg:grid-cols-4 gap-8">
          {/* Settings Navigation */}
          <div className="lg:col-span-1">
            <nav className="space-y-2">
              {settingsNavigation.map((item) => {
                const isActive = pathname === item.href
                return (
                  <Link key={item.name} href={item.href}>
                    <motion.div
                      whileHover={{ scale: 1.02 }}
                      whileTap={{ scale: 0.98 }}
                      className={cn(
                        "flex items-start gap-3 p-4 rounded-xl transition-all duration-200",
                        "backdrop-blur-sm border border-white/20",
                        isActive
                          ? "bg-jello-blue text-white border-jello-blue/30"
                          : "bg-white/10 hover:bg-white/20 text-foreground",
                      )}
                    >
                      <item.icon
                        className={cn("w-5 h-5 mt-0.5 flex-shrink-0", isActive ? "text-white" : "text-jello-blue")}
                      />
                      <div className="min-w-0 flex-1">
                        <p className={cn("font-medium text-sm", isActive ? "text-white" : "text-foreground")}>
                          {item.name}
                        </p>
                        <p
                          className={cn(
                            "text-xs mt-1 leading-relaxed",
                            isActive ? "text-white/80" : "text-muted-foreground",
                          )}
                        >
                          {item.description}
                        </p>
                      </div>
                    </motion.div>
                  </Link>
                )
              })}
            </nav>
          </div>

          {/* Settings Content */}
          <div className="lg:col-span-3">
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.3 }}
              className="bg-white/10 backdrop-blur-xl border border-white/20 rounded-2xl p-8"
            >
              {children}
            </motion.div>
          </div>
        </div>
      </div>
    </div>
  )
}


############################## FIN DEL ARCHIVO: components\settings\settings-layout.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\attachment-list.tsx ##############################

// Jello-Frontend/components/tasks/AttachmentList.tsx
"use client"

import * as React from 'react'
import { Attachment } from "@/types"
import { Button } from '@/components/ui/button'
import { Paperclip, FileText, Image as ImageIcon, Trash2, Download } from 'lucide-react'
import Image from 'next/image'

interface AttachmentListProps {
  attachments: Attachment[]
  isEditing: boolean
  taskId: string
  onAttachmentAdd: (files: FileList) => void
  onAttachmentDelete: (id: string) => void
  onAttachmentView?: (id: string) => void
}

export function AttachmentList({
  attachments,
  isEditing,
  onAttachmentAdd,
  onAttachmentDelete,
  onAttachmentView
}: AttachmentListProps) {
  const fileInputRef = React.useRef<HTMLInputElement>(null)

  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.files) {
      onAttachmentAdd(e.target.files)
      e.target.value = '' // Reset input
    }
  }

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h4 className="font-medium text-foreground flex items-center gap-2">
          <Paperclip className="w-4 h-4" />
          Attachments
        </h4>
       {isEditing && (
          <Button 
            size="sm" 
            variant="outline" 
            onClick={() => fileInputRef.current?.click()}
            type="button" 
          >
            Add
          </Button>
        )}
        <input
          type="file"
          ref={fileInputRef}
          className="hidden"
          multiple
          onChange={handleFileSelect}
        />
      </div>

      <div className="space-y-2">
        {attachments.length === 0 ? (
          <p className="text-sm text-muted-foreground">No attachments yet.</p>
        ) : (
          attachments.map(att => (
            <div key={att._id} className="flex items-center gap-3 p-2 bg-muted rounded-lg group">
              {att.type === 'image' ? (
                // Si es una imagen, mostramos una miniatura
                <div 
                  className="relative w-12 h-12 flex-shrink-0 bg-background rounded-md overflow-hidden cursor-pointer"
                  onClick={() => onAttachmentView?.(att._id)}
                >
                  <Image src={att.url} alt={att.name} layout="fill" objectFit="cover" />
                </div>
              ) : (
                // Si es otro tipo de archivo, mostramos un ícono
                <div className="w-12 h-12 flex-shrink-0 bg-background rounded-md flex items-center justify-center">
                  <FileText className="w-6 h-6 text-muted-foreground" />
                </div>
              )}
              
              <div className="flex-1 overflow-hidden">
                <p className="text-sm font-medium truncate">{att.name}</p>
                <span className="text-xs text-muted-foreground">{att.size}</span>
              </div>
              
              {/* Botón de descarga siempre visible */}
              <Button asChild variant="ghost" size="icon" className="h-8 w-8">
                <a href={att.url} target="_blank" rel="noopener noreferrer" download>
                  <Download className="w-4 h-4" />
                </a>
              </Button>

              {isEditing && (
                <Button 
                  variant="ghost" 
                  size="icon" 
                  className="h-8 w-8 text-destructive opacity-0 group-hover:opacity-100 transition-opacity"
                  onClick={() => onAttachmentDelete(att._id)}
                >
                  <Trash2 className="w-4 h-4" />
                </Button>
              )}
            </div>
          ))
        )}
      </div>
    </div>
  )
}

############################## FIN DEL ARCHIVO: components\tasks\attachment-list.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\comment-section.tsx ##############################

// Jello-Frontend/components/tasks/comment-section.tsx

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { Send, Paperclip, X } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Textarea } from "@/components/ui/textarea"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Comment } from "@/types"
import { Input } from "@/components/ui/input"
import { Dialog, DialogContent } from "@/components/ui/dialog" 

interface CommentSectionProps {
  comments: Comment[];
  taskId: string;
  // --- INICIO DE LA CORRECCIÓN: Props modificadas ---
  onSubmitComment: (content: string, attachmentFile: File | null) => Promise<void>;
  // --- FIN DE LA CORRECCIÓN ---
}

export function CommentSection({ comments, taskId, onSubmitComment }: CommentSectionProps) {
  const [newComment, setNewComment] = React.useState("")
  const [attachmentFile, setAttachmentFile] = React.useState<File | null>(null);
  const fileInputRef = React.useRef<HTMLInputElement>(null);
  const [expandedImage, setExpandedImage] = React.useState<string | null>(null);
  const [isSubmitting, setIsSubmitting] = React.useState(false);


  const handleFileChange = (event: React.ChangeEvent<HTMLInputElement>) => {
    if (event.target.files && event.target.files[0]) {
      setAttachmentFile(event.target.files[0]);
    }
  };

  // --- INICIO DE LA CORRECCIÓN: handleSubmit modificado ---
  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!newComment.trim() && !attachmentFile) return;

    setIsSubmitting(true);
    await onSubmitComment(newComment, attachmentFile);
    setNewComment("");
    setAttachmentFile(null);
    if (fileInputRef.current) {
      fileInputRef.current.value = "";
    }
    setIsSubmitting(false);
  };
  // --- FIN DE LA CORRECCIÓN ---

  return (
    <div className="space-y-4">
      <h4 className="font-medium text-foreground">Comments ({comments.length})</h4>
      <div className="space-y-4 max-h-64 overflow-y-auto pr-2">
        {comments.map((comment, index) => (
          <motion.div 
            key={comment.id} 
            className="flex gap-3"
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.05 }}
          >
            <Avatar className="h-8 w-8">
              <AvatarImage src={comment.author.avatarUrl || ''} />
              <AvatarFallback>{comment.author.name.charAt(0)}</AvatarFallback>
            </Avatar>
            <div className="flex-1">
              <div className="flex items-baseline gap-2">
                <p className="font-semibold text-sm">{comment.author.name}</p>
                <p className="text-xs text-muted-foreground">{new Date(comment.timestamp).toLocaleString()}</p>
              </div>
              <p className="text-sm text-foreground/90 whitespace-pre-wrap">{comment.content}</p>
              {comment.attachmentUrl && (
                <button 
                  onClick={() => setExpandedImage(comment.attachmentUrl!)}
                  className="mt-2 block cursor-pointer"
                >
                  <img 
                    src={comment.attachmentUrl} 
                    alt="Attachment" 
                    className="max-w-xs max-h-40 rounded-lg object-cover border border-border"
                  />
                </button>
              )}
            </div>
          </motion.div>
        ))}
      </div>

      <form onSubmit={handleSubmit} className="space-y-3">
        <div className="relative">
          <Textarea
            placeholder="Write a comment..."
            value={newComment}
            onChange={(e) => setNewComment(e.target.value)}
            className="min-h-[80px] pr-12"
            disabled={isSubmitting}
          />
        </div>

        {attachmentFile && (
            <div className="flex items-center justify-between p-2 bg-muted rounded-lg text-sm">
                <span className="truncate">{attachmentFile.name}</span>
                <Button variant="ghost" size="icon" className="h-6 w-6" onClick={() => setAttachmentFile(null)}>
                   <X className="h-4 w-4" />
                </Button>
            </div>
        )}
        
        <div className="flex justify-between items-center">
            <Button type="button" variant="ghost" size="icon" onClick={() => fileInputRef.current?.click()} disabled={isSubmitting}>
                <Paperclip className="w-4 h-4" />
            </Button>
            <Input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" />

            <Button type="submit" size="sm" disabled={(!newComment.trim() && !attachmentFile) || isSubmitting}>
                <Send className="w-4 h-4 mr-2" />
                {isSubmitting ? "Commenting..." : "Comment"}
            </Button>
        </div>
      </form>

    <Dialog open={!!expandedImage} onOpenChange={() => setExpandedImage(null)}>
      <DialogContent className="p-0 border-none bg-transparent w-auto max-w-4xl">
        <img src={expandedImage || ''} alt="Expanded attachment" className="w-full h-auto rounded-lg" />
      </DialogContent>
    </Dialog>
    </div>
  )
}

############################## FIN DEL ARCHIVO: components\tasks\comment-section.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\subtask-list.tsx ##############################

"use client"
import * as React from "react"
import { motion, AnimatePresence } from "framer-motion"
import { Plus, Trash2 } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Checkbox } from "@/components/ui/checkbox"
import { Subtask } from "@/types"

interface SubtaskListProps {
  subtasks: Subtask[];
  isEditing: boolean;
  onSubtaskToggle: (id: string, completed: boolean) => void;
  onSubtaskAdd: (text: string) => void;
  onSubtaskDelete: (id: string) => void;
}

export function SubtaskList({ subtasks, isEditing, onSubtaskToggle, onSubtaskAdd, onSubtaskDelete }: SubtaskListProps) {
  const [newSubtaskText, setNewSubtaskText] = React.useState("")

  const handleAdd = () => {
    if (newSubtaskText.trim()) {
      onSubtaskAdd(newSubtaskText.trim())
      setNewSubtaskText("")
    }
  }

  const completedCount = subtasks.filter((subtask) => subtask.completed).length

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div className="space-y-1">
          <h4 className="font-medium text-foreground">Subtasks</h4>
          <p className="text-sm text-muted-foreground">
            {completedCount} of {subtasks.length} completed
          </p>
        </div>
        {isEditing && (
          <Button variant="ghost" size="sm" onClick={handleAdd}>
            <Plus className="w-4 h-4" />
          </Button>
        )}
      </div>

      {subtasks.length > 0 && (
        <div className="w-full bg-muted rounded-full h-2">
          <motion.div
            className="h-2 bg-primary rounded-full"
            animate={{ width: `${(completedCount / subtasks.length) * 100}%` }}
          />
        </div>
      )}

      <div className="space-y-2">
        <AnimatePresence>
          {subtasks.map((subtask) => (
            <motion.div
              key={subtask.id}
              layout
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0, x: -20 }}
              className="flex items-center gap-3 p-2 rounded-lg hover:bg-muted/50 transition-colors group"
            >
              <Checkbox id={`subtask-${subtask.id}`} checked={subtask.completed} onCheckedChange={(checked) => onSubtaskToggle(subtask.id, Boolean(checked))} disabled={!isEditing} />
              <label htmlFor={`subtask-${subtask.id}`} className={`flex-1 text-sm ${subtask.completed ? "line-through text-muted-foreground" : "text-foreground"} ${isEditing ? 'cursor-pointer' : ''}`}>
                {subtask.text}
              </label>
             {isEditing && (
                <Button
                  variant="ghost"
                  size="icon"
                  className="w-6 h-6 transition-opacity text-destructive"
                  onClick={() => onSubtaskDelete(subtask.id)}
                >
                  <Trash2 className="w-3 h-3" />
                </Button>
              )}
            </motion.div>
          ))}
        </AnimatePresence>

        {isEditing && (
          <motion.div className="flex items-center gap-2" initial={{ opacity: 0 }} animate={{ opacity: 1 }}>
            <Input placeholder="Add a subtask..." value={newSubtaskText} onChange={(e) => setNewSubtaskText(e.target.value)} onKeyDown={(e) => { if (e.key === "Enter") handleAdd() }} className="flex-1" autoFocus />
            <Button size="sm" onClick={handleAdd}>Add</Button>
          </motion.div>
        )}
      </div>
    </div>
  )
}


############################## FIN DEL ARCHIVO: components\tasks\subtask-list.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\task-card.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\tasks\task-card.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\task-card.tsx ##############################

"use client"
import * as React from 'react'
import { motion } from 'framer-motion'
import { TaskSummary } from '@/types'
import { cn } from '@/lib/utils'
import { Badge } from '@/components/ui/badge'
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar'
import { Progress } from '@/components/ui/progress'
import { Button } from '@/components/ui/button'
import { SquarePen, MessageSquare, Paperclip, Calendar, CheckCircle } from 'lucide-react'

interface TaskCardProps {
  task: TaskSummary;
}

const priorityClasses = {
  low: 'bg-green-500',
  medium: 'bg-yellow-500',
  high: 'bg-orange-500',
  critical: 'bg-red-500',
};

export function TaskCard({ task }: TaskCardProps) {
  const subtaskProgress = task.subtasks.total > 0 ? (task.subtasks.completed / task.subtasks.total) * 100 : 0;
  return (
    <motion.div
      layout
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className="glass-card p-4 space-y-3 cursor-pointer group relative hover:shadow-lg transition-all duration-200"
      tabIndex={0}
    >
      <div className="absolute top-2 right-2 flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
        <Button variant="ghost" size="icon" className="rounded-full h-7 w-7 bg-background/50 hover:bg-background/80">
          <SquarePen className="w-4 h-4" />
        </Button>
      </div>

      <div className="flex items-start justify-between">
        <div className="flex items-center gap-2 flex-wrap">
          <div className={cn("w-2 h-2 rounded-full", priorityClasses[task.priority])} />
          {task.labels.map(label => (
            <Badge key={label._id} variant="secondary" className="text-xs px-2 py-0" style={{ backgroundColor: label.color + '20', color: label.color }}>
              {label.name}
            </Badge>
          ))}
        </div>
      </div>
      
      <h4 className="font-medium text-foreground truncate leading-tight pr-8">{task.title}</h4>

      {task.subtasks.total > 0 && (
        <div className="space-y-1">
          <div className="flex items-center justify-between text-xs text-muted-foreground">
            <span>Subtasks</span>
            <span>{task.subtasks.completed}/{task.subtasks.total}</span>
          </div>
          <Progress value={subtaskProgress} className="h-1" />
        </div>
      )}

      <div className="flex items-center justify-between pt-2">
        <div className="flex items-center gap-3 text-xs text-muted-foreground">
          {task.dueDate && (
            <div className="flex items-center gap-1">
              <Calendar className="w-3 h-3" />
              <span>{new Date(task.dueDate).toLocaleDateString()}</span>
            </div>
          )}
          <div className="flex items-center gap-1">
            <MessageSquare className="w-3 h-3" />
            <span>{task.commentCount}</span>
          </div>
          <div className="flex items-center gap-1">
            <Paperclip className="w-3 h-3" />
            <span>{task.attachmentCount}</span>
          </div>
        </div>

        <div className="flex -space-x-1">
          {task.assignees.map(assignee => (
            <Avatar key={assignee.id} className="w-6 h-6 border-2 border-background">
              <AvatarImage src={assignee.avatarUrl || ''} alt={assignee.name} />
              <AvatarFallback className="text-xs">{assignee.name.charAt(0)}</AvatarFallback>
            </Avatar>
          ))}
        </div>
      </div>
    </motion.div>
  )
}

############################## FIN DEL ARCHIVO: components\tasks\task-card.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\task-modal.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: components\tasks\task-modal.test.tsx ##################################

############################## INICIO DEL ARCHIVO: components\tasks\task-modal.tsx ##############################

"use client"

import * as React from "react"
import Link from "next/link"
import { motion } from "framer-motion"
import { X, Edit, ArrowRight, Tag, Loader2, Trash2 } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Input } from "@/components/ui/input"
import { Textarea } from "@/components/ui/textarea"
import { Badge } from "@/components/ui/badge"
import { Modal, ModalContent, ModalHeader } from "@/components/ui/modal"
import { SubtaskList } from "./subtask-list"
import { CommentSection } from "./comment-section"
import { AttachmentList } from "./attachment-list"
import { toast } from "sonner"
import { apiClient } from "@/lib/api"
import { useApi } from "@/hooks/useApi"
import { cn } from "@/lib/utils"
import { AttachmentViewerModal } from "../modals/AttachmentViewerModal"
import { User, Calendar, Flag } from "lucide-react"
import { DatePicker } from "@/components/ui/date-picker";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { AssigneeSelector } from "../forms/assignee-selector";
import { TaskDetails, Label, Comment, Attachment, TaskPriority, UserSummary, Subtask } from "@/types"; 
import { DeleteTaskAlert } from "../modals/DeleteTaskAlert" 

interface TaskModalProps {
  isOpen: boolean;
  onClose: () => void;
  task: TaskDetails | null;
  onDataChange?: () => void;
  onTaskDeleted?: () => void;
  showGoToProjectButton?: boolean;
  projectMembers: UserSummary[];
}

export function TaskModal({ isOpen, onClose, task, onDataChange, showGoToProjectButton, projectMembers }: TaskModalProps) {
  const [isEditing, setIsEditing] = React.useState(false);
  const [currentTask, setCurrentTask] = React.useState<TaskDetails | null>(task);
  const [newAttachments, setNewAttachments] = React.useState<File[]>([]);
  const [attachmentsToDelete, setAttachmentsToDelete] = React.useState<string[]>([]);
  const [isSaving, setIsSaving] = React.useState(false);
  const [isDeleteAlertOpen, setIsDeleteAlertOpen] = React.useState(false); 
  
  const priorityOptions: { value: TaskPriority; label: string }[] = [
    { value: 'low', label: 'Low' },
    { value: 'medium', label: 'Medium' },
    { value: 'high', label: 'High' },
    { value: 'critical', label: 'Critical' },
  ];
  
  const labelsEndpoint = currentTask ? `/projects/${currentTask.projectId}/labels` : null;
  const { data: availableLabels } = useApi<Label[] | null>(labelsEndpoint);

  const [viewingAttachmentId, setViewingAttachmentId] = React.useState<string | null>(null);

  React.useEffect(() => {
    setCurrentTask(task);
    setIsEditing(false);
  }, [task]);

  // --- CORRECCIÓN 1: 'handleCloseAndRefetch' ELIMINADA ---
  // Ya no necesitamos esta función. Usaremos 'onClose' directamente.

  const handleCancelEdit = () => {
    setCurrentTask(task);
    setNewAttachments([]);
    setAttachmentsToDelete([]);
    setIsEditing(false);
  }

  const handleViewAttachment = (attachmentId: string) => {
    setViewingAttachmentId(attachmentId);
  };

  const handleCommentSubmit = async (content: string, attachmentFile: File | null) => {
    if (!currentTask) return;
    if (!content.trim() && !attachmentFile) return;

    const formData = new FormData();
    formData.append('content', content);
    if (attachmentFile) {
      formData.append('attachment', attachmentFile);
    }

    try {
      toast.info("Adding comment...");
      const newComment = await apiClient.post<Comment>(`/tasks/${currentTask.id}/comments`, formData);
      setCurrentTask(prevTask => {
        if (!prevTask) return null;
        return {
          ...prevTask,
          comments: [...prevTask.comments, newComment]
        };
      });
      toast.success("Comment added!");
    } catch (error) {
      toast.error(`Failed to add comment: ${(error as Error).message}`);
    }
  };
  
  const handleSubtaskAdd = (text: string) => {
    if (!currentTask || !text.trim()) return;
    const newSubtask: Subtask = {
        id: `temp-${Date.now()}`,
        text: text,
        completed: false
    };
    setCurrentTask(prevTask => {
        if (!prevTask) return null;
        return {
            ...prevTask,
            subtasks: [...prevTask.subtasks, newSubtask]
        };
    });
  };


  const handleSubtaskToggle = (subtaskId: string, completed: boolean) => {
    if (!currentTask) return;
    setCurrentTask(prevTask => {
        if (!prevTask) return null;
        return {
            ...prevTask,
            subtasks: prevTask.subtasks.map(sub =>
                sub.id === subtaskId ? { ...sub, completed } : sub
            )
        };
    });
  };

  const handleSubtaskDelete = (subtaskId: string) => {
    if (!currentTask) return;
    setCurrentTask(prevTask => {
        if (!prevTask) return null;
        return {
            ...prevTask,
            subtasks: prevTask.subtasks.filter(sub => sub.id !== subtaskId)
        };
    });
  };

 const handleDeleteTask = async () => {
    if (!currentTask || isSaving) return;
    setIsSaving(true);
    const toastId = toast.loading("Deleting task...");
    
    try {
        await apiClient.del(`/projects/${currentTask.projectId}/tasks/${currentTask.id}`); 
        
        toast.success("Task deleted successfully!", { id: toastId });
        setIsDeleteAlertOpen(false);
        onClose(); 
        onDataChange?.(); 
    } catch (error) {
        toast.error(`Failed to delete task: ${(error as Error).message}`, { id: toastId });
    } finally {
        setIsSaving(false);
    }
  };

  const handleSave = async () => {
    if (!currentTask || isSaving) return;
    
    setIsSaving(true);
    const toastId = toast.loading("Saving task changes...");
    
    try {
        // 1. Guardar la tarea principal (título, labels, etc.) PRIMERO
        const payload = {
            title: currentTask.title,
            description: currentTask.description,
            labels: currentTask.labels.map(label => label._id),
            assignees: currentTask.assignees.map(a => a.id),
            priority: currentTask.priority,
            dueDate: currentTask.dueDate,
        };
        await apiClient.put(`/projects/${currentTask.projectId}/tasks/${currentTask.id}`, payload);
        toast.info("Task details saved...", { id: toastId });

        // 2. Preparar listas de cambios para Subtareas
        const originalSubtasks = task?.subtasks || [];
        const newSubtasks = currentTask.subtasks || [];
        const addedSubtasks = newSubtasks.filter(s => s.id.startsWith('temp-'));
        const deletedSubtasks = originalSubtasks.filter(os => !newSubtasks.some(s => s.id === os.id));
        const modifiedSubtasks = newSubtasks.filter(s => {
            if (s.id.startsWith('temp-')) return false;
            const original = originalSubtasks.find(os => os.id === s.id);
            return original && original.completed !== s.completed;
        });

        // 3. Preparar promesas de Subtareas
        const subtaskPromises: Promise<any>[] = [];
        addedSubtasks.forEach(s => subtaskPromises.push(apiClient.post(`/tasks/${currentTask.id}/subtasks`, { text: s.text })));
        deletedSubtasks.forEach(s => subtaskPromises.push(apiClient.del(`/tasks/${currentTask.id}/subtasks/${s.id}`)));
        modifiedSubtasks.forEach(s => subtaskPromises.push(apiClient.put(`/tasks/${currentTask.id}/subtasks/${s.id}`, { completed: s.completed })));
        
        await Promise.all(subtaskPromises);
        if (subtaskPromises.length > 0) toast.info("Subtasks updated...", { id: toastId });
        
        // 4. Preparar promesas de Attachments
        const attachmentPromises: Promise<any>[] = [];
        newAttachments.forEach(file => {
            const formData = new FormData();
            formData.append('file', file);
            attachmentPromises.push(apiClient.post(`/tasks/${currentTask.id}/attachments`, formData));
        });
        attachmentsToDelete.forEach(id => {
            attachmentPromises.push(apiClient.del(`/tasks/${currentTask.id}/attachments/${id}`));
        });

        await Promise.all(attachmentPromises);
        if (attachmentPromises.length > 0) toast.info("Attachments updated...", { id: toastId });

        // --- CORRECCIÓN 3: Refrescar y Cerrar al final ---
        onDataChange?.(); // Refresca la página principal
        setNewAttachments([]);
        setAttachmentsToDelete([]);
        setIsEditing(false); 
        toast.success("Task updated successfully!", { id: toastId });
        
        onClose(); // Llama a onClose al final para cerrar el modal y limpiar la URL
        // --- FIN CORRECCIÓN 3 ---

    } catch (error) {
        toast.error(`Failed to save task: ${(error as Error).message}`, { id: toastId });
    } finally {
        setIsSaving(false);
    }
  };
  
  const handleLabelToggle = (labelToToggle: Label) => {
    if (!currentTask || !isEditing) return;
    setCurrentTask(prevTask => {
      if (!prevTask) return null;
      const isSelected = prevTask.labels.some(l => l._id === labelToToggle._id);
      const newLabels = isSelected
        ? prevTask.labels.filter(l => l._id !== labelToToggle._id)
        : [...prevTask.labels, labelToToggle];
      return { ...prevTask, labels: newLabels };
    });
  };

  const handleAttachmentAdd = (files: FileList) => {
    setNewAttachments(prev => [...prev, ...Array.from(files)]);
  };

  const handleAttachmentDelete = (attachmentId: string) => {
    if (attachmentId.startsWith('new-')) {
        const fileName = attachmentId.split('-')[1];
        setNewAttachments(prev => prev.filter(file => file.name !== fileName));
    } else {
        setAttachmentsToDelete(prev => [...prev, attachmentId]);
    }
  };

  const allAttachmentsForUI: Attachment[] = React.useMemo(() => [
    ...(currentTask?.attachments.filter(att => !attachmentsToDelete.includes(att._id)) || []),
    ...newAttachments.map((file, index) => ({
    _id: `new-${file.name}-${index}`,
    name: file.name,
    url: URL.createObjectURL(file),
    size: `${(file.size / 1024).toFixed(1)} KB`,
    type: file.type.startsWith('image/') ? "image" as "image" : "document" as "document",
  }))
  ], [currentTask?.attachments, newAttachments, attachmentsToDelete]);

  if (!isOpen || !currentTask) {
    return null;
  }
  
  return (
    <>
      {/* --- CORRECCIÓN 2: Usar 'onClose' para 'onOpenChange' --- */}
      <Modal open={isOpen} onOpenChange={onClose}>
        <ModalContent className="max-h-screen overflow-hidden max-w-4xl p-0">
          <ModalHeader className="p-4 border-b border-border/50">
            <div className="flex items-center justify-between">
              {isEditing ? (
                <Input
                   value={currentTask.title}
                  onChange={(e) => setCurrentTask({ ...currentTask, title: e.target.value })}
                  className="text-lg font-semibold border-2 border-primary"
                  disabled={isSaving}
                />
              ) : (
                <h2 className="text-lg font-semibold truncate text-foreground">{currentTask.title}</h2>
              )}

              <div className="flex items-center gap-2">
                {showGoToProjectButton && !isEditing && (
                  <Button asChild variant="ghost" size="sm">
                    <Link href={`/project/${currentTask.projectId}`}>
                       Go to project <ArrowRight className="w-3 h-3 ml-2" />
                    </Link>
                  </Button>
                )}

                {isEditing ?
                (
                  <>
                    <Button size="sm" onClick={handleSave} disabled={isSaving}>
                      {isSaving && <Loader2 className="w-4 h-4 mr-2 animate-spin" />}
                      Save
                    </Button>
                    <Button size="sm" variant="ghost" onClick={handleCancelEdit} disabled={isSaving}>
                      Cancel
                    </Button>
                  </>
                ) : (
                  <Button size="sm" variant="outline" onClick={() => setIsEditing(true)}>
                    <Edit className="w-4 h-4 mr-2" /> Edit
                  </Button>
                )}
                
                {/* --- CORRECCIÓN 2: Usar 'onClose' para el botón 'X' --- */}
                <Button variant="ghost" size="icon" onClick={onClose} disabled={isSaving}>
                  <X className="w-4 h-4" />
                </Button>
              </div>
            </div>
          </ModalHeader>

          <div className="grid grid-cols-1 lg:grid-cols-3 max-h-[calc(100vh-80px)] overflow-y-auto">
            <div className="lg:col-span-2 space-y-6 p-6">
               <div className="space-y-3">
                <h4 className="font-medium text-foreground">Descripcion</h4>
                {isEditing ?
                (
                  <Textarea
                    value={currentTask.description || ''}
                    onChange={(e) => setCurrentTask({ ...currentTask, description: e.target.value })}
                    className="min-h-[120px]"
                    disabled={isSaving}
                   />
                ) : (
                  <p className="text-sm break-words h-32 overflow-y-auto text-muted-foreground">{currentTask.description || "No description provided."}</p>
                )}
              </div>
              
               {isEditing && (
                  <div className="grid grid-cols-1 sm:grid-cols-3 gap-6 pb-6 border-b">
                    <div className="space-y-2">
                       <h3 className="text-sm font-semibold flex items-center gap-2 text-muted-foreground"><User className="w-4 h-4" /> Assignees</h3>
                      <AssigneeSelector
                        projectMembers={projectMembers}
                        selectedAssignees={currentTask.assignees.map(a => a.id)}
                         onSelectionChange={(selectedIds) => {
                          if (isSaving) return;
                          const updatedAssignees = projectMembers.filter(m => selectedIds.includes(m.id));
                          setCurrentTask(prev => prev ? { ...prev, assignees: updatedAssignees } : null);
                        }}
                      />
                    </div>
                    <div className="space-y-2">
                       <h3 className="text-sm font-semibold flex items-center gap-2 text-muted-foreground"><Calendar className="w-4 h-4" /> Due Date</h3>
                      <DatePicker
                        date={currentTask.dueDate ? new Date(currentTask.dueDate) : undefined}
                        setDate={(date) => setCurrentTask(prev => prev ? { ...prev, dueDate: date?.toISOString() ?? null } : null)}
                      />
                    </div>
                    <div className="space-y-2">
                      <h3 className="text-sm font-semibold flex items-center gap-2 text-muted-foreground"><Flag className="w-4 h-4" /> Priority</h3>
                      <Select
                         value={currentTask.priority}
                        onValueChange={(priority: TaskPriority) => setCurrentTask(prev => prev ? { ...prev, priority } : null)}
                        disabled={isSaving}
                      >
                        <SelectTrigger>
                           <SelectValue placeholder="Select priority" />
                        </SelectTrigger>
                        <SelectContent>
                          {priorityOptions.map(opt => (
                             <SelectItem key={opt.value} value={opt.value}>{opt.label}</SelectItem>
                          ))}
                        </SelectContent>
                      </Select>
                     </div>
                  </div>
                )}

              {(isEditing || (currentTask.labels && currentTask.labels.length > 0)) && (
                <div className="space-y-3">
                  <h4 className="font-medium text-foreground flex items-center gap-2"><Tag className="w-4 h-4" />Labels</h4>
                  <div className="flex flex-wrap gap-2">
                    {isEditing ? (
                       availableLabels?.map((label: Label) => {
                        const isSelected = currentTask.labels.some(l => l._id === label._id);
                        return (
                          <Badge
                             key={label._id}
                            variant={"outline"}
                            className={cn(
                              "cursor-pointer transition-all border-2 text-sm py-1 px-3",
                              isSaving && "opacity-50 cursor-not-allowed"
                            )}
                             style={{
                              backgroundColor: isSelected ? `${label.color}40` : 'transparent',
                              borderColor: label.color,
                              color: label.color,
                            }}
                            onClick={() => !isSaving && handleLabelToggle(label)}
                          >
                             {label.name}
                          </Badge>
                        )
                      })
                     ) : (
                      currentTask.labels.map((label: Label) => (
                        <Badge key={label._id} variant="secondary" className="text-sm py-1 px-3" style={{ backgroundColor: label.color + "20", color: label.color }}>
                           {label.name}
                        </Badge>
                      ))
                    )}
                  </div>
                 </div>
              )}
              
              <SubtaskList
                subtasks={currentTask.subtasks}
                isEditing={isEditing}
                onSubtaskAdd={handleSubtaskAdd}
                onSubtaskDelete={handleSubtaskDelete}
                onSubtaskToggle={handleSubtaskToggle}
              />


              <CommentSection
                comments={currentTask.comments}
                taskId={currentTask.id}
                 onSubmitComment={handleCommentSubmit}
              />

              {/* Botón de Eliminar Tarea */}
              {isEditing && (
                <div className="space-y-3 pt-6 border-t border-destructive/20">
                  <h4 className="font-medium text-destructive">Danger Zone</h4>
                   <Button 
                    variant="destructive" 
                    className="w-full sm:w-auto"
                    onClick={() => setIsDeleteAlertOpen(true)}
                    disabled={isSaving}
                  >
                    <Trash2 className="w-4 h-4 mr-2" />
                    Delete this task
                  </Button>
                  <p className="text-xs text-muted-foreground">
                    Esta acción no se puede deshacer.
                  </p>
                </div>
              )}

            </div>
            <div className="lg:col-span-1 lg:border-l border-border/50 p-6 space-y-6">
              <AttachmentList 
                attachments={allAttachmentsForUI} 
                 isEditing={isEditing} 
                taskId={currentTask.id}
                onAttachmentAdd={handleAttachmentAdd}
                onAttachmentDelete={handleAttachmentDelete}
                onAttachmentView={handleViewAttachment}
              />
            </div>
           </div>
        </ModalContent>
      </Modal>
      
      {/* Modal de Alerta de Eliminación */}
      <DeleteTaskAlert 
        isOpen={isDeleteAlertOpen}
        onClose={() => setIsDeleteAlertOpen(false)}
        onConfirmDelete={handleDeleteTask}
      />

      <AttachmentViewerModal 
        isOpen={!!viewingAttachmentId}
        onClose={() => setViewingAttachmentId(null)}
        attachments={currentTask.attachments}
        selectedAttachmentId={viewingAttachmentId}
      />
    </>
  )
}

############################## FIN DEL ARCHIVO: components\tasks\task-modal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\theme-provider.tsx ##############################

"use client"
import { ThemeProvider as NextThemesProvider } from "next-themes"

export function NextThemeProvider({ children, ...props }: any) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>
}


############################## FIN DEL ARCHIVO: components\theme-provider.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\accordion.tsx ##############################

"use client"

import * as React from "react"
import * as AccordionPrimitive from "@radix-ui/react-accordion"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Accordion({
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />
}

function AccordionItem({
  className,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  )
}

function AccordionTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  )
}

function AccordionContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pt-0 pb-4", className)}>{children}</div>
    </AccordionPrimitive.Content>
  )
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent }


############################## FIN DEL ARCHIVO: components\ui\accordion.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\alert-dialog.tsx ##############################

"use client"

import * as React from "react"
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog"

import { cn } from "@/lib/utils"
import { buttonVariants } from "@/components/ui/button"

function AlertDialog({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />
}

function AlertDialogTrigger({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return (
    <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />
  )
}

function AlertDialogPortal({
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return (
    <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />
  )
}

function AlertDialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogContent({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      />
    </AlertDialogPortal>
  )
}

function AlertDialogHeader({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function AlertDialogFooter({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function AlertDialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  )
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function AlertDialogAction({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return (
    <AlertDialogPrimitive.Action
      className={cn(buttonVariants(), className)}
      {...props}
    />
  )
}

function AlertDialogCancel({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return (
    <AlertDialogPrimitive.Cancel
      className={cn(buttonVariants({ variant: "outline" }), className)}
      {...props}
    />
  )
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
}


############################## FIN DEL ARCHIVO: components\ui\alert-dialog.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\alert.tsx ##############################

import * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
)

function Alert({
  className,
  variant,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return (
    <div
      data-slot="alert"
      role="alert"
      className={cn(alertVariants({ variant }), className)}
      {...props}
    />
  )
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn(
        "col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",
        className
      )}
      {...props}
    />
  )
}

function AlertDescription({
  className,
  ...props
}: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className
      )}
      {...props}
    />
  )
}

export { Alert, AlertTitle, AlertDescription }


############################## FIN DEL ARCHIVO: components\ui\alert.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\aspect-ratio.tsx ##############################

"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

function AspectRatio({
  ...props
}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />
}

export { AspectRatio }


############################## FIN DEL ARCHIVO: components\ui\aspect-ratio.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\avatar.tsx ##############################

"use client"

import * as React from "react"
import * as AvatarPrimitive from "@radix-ui/react-avatar"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <motion.div whileHover={{ scale: 1.05 }} transition={{ type: "spring", stiffness: 300, damping: 20 }}>
    <AvatarPrimitive.Root
      ref={ref}
      className={cn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full", className)}
      {...props}
    />
  </motion.div>
))
Avatar.displayName = AvatarPrimitive.Root.displayName

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image ref={ref} className={cn("aspect-square h-full w-full", className)} {...props} />
))
AvatarImage.displayName = AvatarPrimitive.Image.displayName

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn("flex h-full w-full items-center justify-center rounded-full bg-muted", className)}
    {...props}
  />
))
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName

export { Avatar, AvatarImage, AvatarFallback }


############################## FIN DEL ARCHIVO: components\ui\avatar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\badge.tsx ##############################

"use client"

import type * as React from "react"
import { cva, type VariantProps } from "class-variance-authority"
import { cn } from "@/lib/utils"

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary: "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive: "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
        pink: "border-transparent bg-accent-pink text-white",
        purple: "border-transparent bg-accent-purple text-white",
        teal: "border-transparent bg-accent-teal text-white",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
)

export interface BadgeProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div
      className={cn(badgeVariants({ variant }), className)}
      {...props}
    />
  )
}

export { Badge, badgeVariants }


############################## FIN DEL ARCHIVO: components\ui\badge.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\breadcrumb.tsx ##############################

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { ChevronRight, MoreHorizontal } from "lucide-react"

import { cn } from "@/lib/utils"

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 text-sm break-words sm:gap-2.5",
        className
      )}
      {...props}
    />
  )
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-item"
      className={cn("inline-flex items-center gap-1.5", className)}
      {...props}
    />
  )
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean
}) {
  const Comp = asChild ? Slot : "a"

  return (
    <Comp
      data-slot="breadcrumb-link"
      className={cn("hover:text-foreground transition-colors", className)}
      {...props}
    />
  )
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  )
}

function BreadcrumbSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  )
}

function BreadcrumbEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  )
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
}


############################## FIN DEL ARCHIVO: components\ui\breadcrumb.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\button.tsx ##############################

"use client"

import * as React from "react"
import { Slot } from "@radix-ui/react-slot"
import { cva, type VariantProps } from "class-variance-authority"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-2xl text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary-hover shadow-lg",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90 shadow-lg",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80 shadow-md",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
        glass: "glass-card text-foreground hover:bg-glass/80",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-xl px-3",
        lg: "h-11 rounded-2xl px-8",
        icon: "h-10 w-10 rounded-full",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
)

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button"

    return (
      <motion.div
        whileTap={variant !== "ghost" && variant !== "link" ? { scale: 0.95 } : {}}
         whileHover={variant !== "ghost" && variant !== "link" ? { scale: 1.05 } : {}}
      >
        <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />
      </motion.div>
    )
  },
)
Button.displayName = "Button"

export { Button, buttonVariants }


############################## FIN DEL ARCHIVO: components\ui\button.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\calendar.tsx ##############################

"use client"

import * as React from "react"
import {
  ChevronDownIcon,
  ChevronLeftIcon,
  ChevronRightIcon,
} from "lucide-react"
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"]
}) {
  const defaultClassNames = getDefaultClassNames()

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) =>
          date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn(
          "flex gap-4 flex-col md:flex-row relative",
          defaultClassNames.months
        ),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn(
          "flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between",
          defaultClassNames.nav
        ),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root
        ),
        dropdown: cn(
          "absolute bg-popover inset-0 opacity-0",
          defaultClassNames.dropdown
        ),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn(
          "select-none w-(--cell-size)",
          defaultClassNames.week_number_header
        ),
        week_number: cn(
          "text-[0.8rem] select-none text-muted-foreground",
          defaultClassNames.week_number
        ),
        day: cn(
          "relative w-full h-full p-0 text-center [&:first-child[data-selected=true]_button]:rounded-l-md [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          defaultClassNames.day
        ),
        range_start: cn(
          "rounded-l-md bg-accent",
          defaultClassNames.range_start
        ),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today
        ),
        outside: cn(
          "text-muted-foreground aria-selected:text-muted-foreground",
          defaultClassNames.outside
        ),
        disabled: cn(
          "text-muted-foreground opacity-50",
          defaultClassNames.disabled
        ),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return (
            <div
              data-slot="calendar"
              ref={rootRef}
              className={cn(className)}
              {...props}
            />
          )
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return (
              <ChevronLeftIcon className={cn("size-4", className)} {...props} />
            )
          }

          if (orientation === "right") {
            return (
              <ChevronRightIcon
                className={cn("size-4", className)}
                {...props}
              />
            )
          }

          return (
            <ChevronDownIcon className={cn("size-4", className)} {...props} />
          )
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="flex size-(--cell-size) items-center justify-center text-center">
                {children}
              </div>
            </td>
          )
        },
        ...components,
      }}
      {...props}
    />
  )
}

function CalendarDayButton({
  className,
  day,
  modifiers,
  ...props
}: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames()

  const ref = React.useRef<HTMLButtonElement>(null)
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus()
  }, [modifiers.focused])

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected &&
        !modifiers.range_start &&
        !modifiers.range_end &&
        !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground flex aspect-square size-auto w-full min-w-(--cell-size) flex-col gap-1 leading-none font-normal group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] data-[range-end=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-start=true]:rounded-l-md [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className
      )}
      {...props}
    />
  )
}

export { Calendar, CalendarDayButton }


############################## FIN DEL ARCHIVO: components\ui\calendar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\card.tsx ##############################

import * as React from "react"

import { cn } from "@/lib/utils"

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn(
        "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
        className
      )}
      {...props}
    />
  )
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  )
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  )
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  )
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  )
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  )
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
}


############################## FIN DEL ARCHIVO: components\ui\card.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\carousel.tsx ##############################

"use client"

import * as React from "react"
import useEmblaCarousel, {
  type UseEmblaCarouselType,
} from "embla-carousel-react"
import { ArrowLeft, ArrowRight } from "lucide-react"

import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"

type CarouselApi = UseEmblaCarouselType[1]
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>
type CarouselOptions = UseCarouselParameters[0]
type CarouselPlugin = UseCarouselParameters[1]

type CarouselProps = {
  opts?: CarouselOptions
  plugins?: CarouselPlugin
  orientation?: "horizontal" | "vertical"
  setApi?: (api: CarouselApi) => void
}

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0]
  api: ReturnType<typeof useEmblaCarousel>[1]
  scrollPrev: () => void
  scrollNext: () => void
  canScrollPrev: boolean
  canScrollNext: boolean
} & CarouselProps

const CarouselContext = React.createContext<CarouselContextProps | null>(null)

function useCarousel() {
  const context = React.useContext(CarouselContext)

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />")
  }

  return context
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins
  )
  const [canScrollPrev, setCanScrollPrev] = React.useState(false)
  const [canScrollNext, setCanScrollNext] = React.useState(false)

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return
    setCanScrollPrev(api.canScrollPrev())
    setCanScrollNext(api.canScrollNext())
  }, [])

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev()
  }, [api])

  const scrollNext = React.useCallback(() => {
    api?.scrollNext()
  }, [api])

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault()
        scrollPrev()
      } else if (event.key === "ArrowRight") {
        event.preventDefault()
        scrollNext()
      }
    },
    [scrollPrev, scrollNext]
  )

  React.useEffect(() => {
    if (!api || !setApi) return
    setApi(api)
  }, [api, setApi])

  React.useEffect(() => {
    if (!api) return
    onSelect(api)
    api.on("reInit", onSelect)
    api.on("select", onSelect)

    return () => {
      api?.off("select", onSelect)
    }
  }, [api, onSelect])

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation:
          orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  )
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel()

  return (
    <div
      ref={carouselRef}
      className="overflow-hidden"
      data-slot="carousel-content"
    >
      <div
        className={cn(
          "flex",
          orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col",
          className
        )}
        {...props}
      />
    </div>
  )
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel()

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn(
        "min-w-0 shrink-0 grow-0 basis-full",
        orientation === "horizontal" ? "pl-4" : "pt-4",
        className
      )}
      {...props}
    />
  )
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel()

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -left-12 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  )
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel()

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "top-1/2 -right-12 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  )
}

export {
  type CarouselApi,
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselPrevious,
  CarouselNext,
}


############################## FIN DEL ARCHIVO: components\ui\carousel.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\chart.tsx ##############################

"use client"

import * as React from "react"
import * as RechartsPrimitive from "recharts"

import { cn } from "@/lib/utils"

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode
    icon?: React.ComponentType
  } & (
    | { color?: string; theme?: never }
    | { color?: never; theme: Record<keyof typeof THEMES, string> }
  )
}

type ChartContextProps = {
  config: ChartConfig
}

const ChartContext = React.createContext<ChartContextProps | null>(null)

function useChart() {
  const context = React.useContext(ChartContext)

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />")
  }

  return context
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig
  children: React.ComponentProps<
    typeof RechartsPrimitive.ResponsiveContainer
  >["children"]
}) {
  const uniqueId = React.useId()
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden",
          className
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>
          {children}
        </RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  )
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(
    ([, config]) => config.theme || config.color
  )

  if (!colorConfig.length) {
    return null
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color =
      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||
      itemConfig.color
    return color ? `  --color-${key}: ${color};` : null
  })
  .join("\n")}
}
`
          )
          .join("\n"),
      }}
    />
  )
}

const ChartTooltip = RechartsPrimitive.Tooltip

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean
    hideIndicator?: boolean
    indicator?: "line" | "dot" | "dashed"
    nameKey?: string
    labelKey?: string
  }) {
  const { config } = useChart()

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null
    }

    const [item] = payload
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`
    const itemConfig = getPayloadConfigFromPayload(config, item, key)
    const value =
      !labelKey && typeof label === "string"
        ? config[label as keyof typeof config]?.label || label
        : itemConfig?.label

    if (labelFormatter) {
      return (
        <div className={cn("font-medium", labelClassName)}>
          {labelFormatter(value, payload)}
        </div>
      )
    }

    if (!value) {
      return null
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>
  }, [
    label,
    labelFormatter,
    payload,
    hideLabel,
    labelClassName,
    config,
    labelKey,
  ])

  if (!active || !payload?.length) {
    return null
  }

  const nestLabel = payload.length === 1 && indicator !== "dot"

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload.map((item, index) => {
          const key = `${nameKey || item.name || item.dataKey || "value"}`
          const itemConfig = getPayloadConfigFromPayload(config, item, key)
          const indicatorColor = color || item.payload.fill || item.color

          return (
            <div
              key={item.dataKey}
              className={cn(
                "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                indicator === "dot" && "items-center"
              )}
            >
              {formatter && item?.value !== undefined && item.name ? (
                formatter(item.value, item.name, item, index, item.payload)
              ) : (
                <>
                  {itemConfig?.icon ? (
                    <itemConfig.icon />
                  ) : (
                    !hideIndicator && (
                      <div
                        className={cn(
                          "shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)",
                          {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent":
                              indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          }
                        )}
                        style={
                          {
                            "--color-bg": indicatorColor,
                            "--color-border": indicatorColor,
                          } as React.CSSProperties
                        }
                      />
                    )
                  )}
                  <div
                    className={cn(
                      "flex flex-1 justify-between leading-none",
                      nestLabel ? "items-end" : "items-center"
                    )}
                  >
                    <div className="grid gap-1.5">
                      {nestLabel ? tooltipLabel : null}
                      <span className="text-muted-foreground">
                        {itemConfig?.label || item.name}
                      </span>
                    </div>
                    {item.value && (
                      <span className="text-foreground font-mono font-medium tabular-nums">
                        {item.value.toLocaleString()}
                      </span>
                    )}
                  </div>
                </>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

const ChartLegend = RechartsPrimitive.Legend

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean
    nameKey?: string
  }) {
  const { config } = useChart()

  if (!payload?.length) {
    return null
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center gap-4",
        verticalAlign === "top" ? "pb-3" : "pt-3",
        className
      )}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`
        const itemConfig = getPayloadConfigFromPayload(config, item, key)

        return (
          <div
            key={item.value}
            className={cn(
              "[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3"
            )}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        )
      })}
    </div>
  )
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(
  config: ChartConfig,
  payload: unknown,
  key: string
) {
  if (typeof payload !== "object" || payload === null) {
    return undefined
  }

  const payloadPayload =
    "payload" in payload &&
    typeof payload.payload === "object" &&
    payload.payload !== null
      ? payload.payload
      : undefined

  let configLabelKey: string = key

  if (
    key in payload &&
    typeof payload[key as keyof typeof payload] === "string"
  ) {
    configLabelKey = payload[key as keyof typeof payload] as string
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[
      key as keyof typeof payloadPayload
    ] as string
  }

  return configLabelKey in config
    ? config[configLabelKey]
    : config[key as keyof typeof config]
}

export {
  ChartContainer,
  ChartTooltip,
  ChartTooltipContent,
  ChartLegend,
  ChartLegendContent,
  ChartStyle,
}


############################## FIN DEL ARCHIVO: components\ui\chart.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\checkbox.tsx ##############################

"use client"

import * as React from "react"
import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
import { Check } from "lucide-react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <motion.div whileTap={{ scale: 0.95 }} transition={{ type: "spring", stiffness: 400, damping: 17 }}>
    <CheckboxPrimitive.Root
      ref={ref}
      className={cn(
        "peer h-4 w-4 shrink-0 rounded border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator className={cn("flex items-center justify-center text-current")}>
        <motion.div
          initial={{ scale: 0 }}
          animate={{ scale: 1 }}
          exit={{ scale: 0 }}
          transition={{ type: "spring", stiffness: 500, damping: 30 }}
        >
          <Check className="h-4 w-4" />
        </motion.div>
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  </motion.div>
))
Checkbox.displayName = CheckboxPrimitive.Root.displayName

export { Checkbox }


############################## FIN DEL ARCHIVO: components\ui\checkbox.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\collapsible.tsx ##############################

"use client"

import * as CollapsiblePrimitive from "@radix-ui/react-collapsible"

function Collapsible({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />
}

function CollapsibleTrigger({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return (
    <CollapsiblePrimitive.CollapsibleTrigger
      data-slot="collapsible-trigger"
      {...props}
    />
  )
}

function CollapsibleContent({
  ...props
}: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return (
    <CollapsiblePrimitive.CollapsibleContent
      data-slot="collapsible-content"
      {...props}
    />
  )
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent }


############################## FIN DEL ARCHIVO: components\ui\collapsible.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\color-picker.tsx ##############################

"use client"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const colors = [
  { name: "Pink", value: "#ec4899", class: "bg-accent-pink" },
  { name: "Purple", value: "#8b5cf6", class: "bg-accent-purple" },
  { name: "Teal", value: "#14b8a6", class: "bg-accent-teal" },
  { name: "Blue", value: "#3b82f6", class: "bg-primary" },
  { name: "Green", value: "#10b981", class: "bg-green-500" },
  { name: "Orange", value: "#f59e0b", class: "bg-orange-500" },
  { name: "Red", value: "#ef4444", class: "bg-red-500" },
  { name: "Gray", value: "#6b7280", class: "bg-gray-500" },
]

interface ColorPickerProps {
  value?: string
  onChange?: (color: string) => void
  className?: string
}

export function ColorPicker({ value, onChange, className }: ColorPickerProps) {
  return (
    <div className={cn("flex flex-wrap gap-2", className)}>
      {colors.map((color) => (
        <motion.button
          key={color.value}
          type="button"
          className={cn(
            "w-8 h-8 rounded-full border-2 border-transparent",
            color.class,
            value === color.value && "border-foreground ring-2 ring-ring ring-offset-2",
          )}
          onClick={() => onChange?.(color.value)}
          whileHover={{ scale: 1.1 }}
          whileTap={{ scale: 0.9 }}
          transition={{ type: "spring", stiffness: 400, damping: 17 }}
          title={color.name}
        />
      ))}
    </div>
  )
}


############################## FIN DEL ARCHIVO: components\ui\color-picker.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\command.tsx ##############################

"use client"

import * as React from "react"
import { Command as CommandPrimitive } from "cmdk"
import { SearchIcon } from "lucide-react"

import { cn } from "@/lib/utils"
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog"

function Command({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className
      )}
      {...props}
    />
  )
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string
  description?: string
  className?: string
  showCloseButton?: boolean
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent
        className={cn("overflow-hidden p-0", className)}
        showCloseButton={showCloseButton}
      >
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  )
}

function CommandInput({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div
      data-slot="command-input-wrapper"
      className="flex h-9 items-center gap-2 border-b px-3"
    >
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",
          className
        )}
        {...props}
      />
    </div>
  )
}

function CommandList({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn(
        "max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",
        className
      )}
      {...props}
    />
  )
}

function CommandEmpty({
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return (
    <CommandPrimitive.Empty
      data-slot="command-empty"
      className="py-6 text-center text-sm"
      {...props}
    />
  )
}

function CommandGroup({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className
      )}
      {...props}
    />
  )
}

function CommandSeparator({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  )
}

function CommandItem({
  className,
  ...props
}: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function CommandShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
}


############################## FIN DEL ARCHIVO: components\ui\command.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\context-menu.tsx ##############################

"use client"

import * as React from "react"
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function ContextMenu({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />
}

function ContextMenuTrigger({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return (
    <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />
  )
}

function ContextMenuGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return (
    <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />
  )
}

function ContextMenuPortal({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return (
    <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />
  )
}

function ContextMenuSub({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />
}

function ContextMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return (
    <ContextMenuPrimitive.RadioGroup
      data-slot="context-menu-radio-group"
      {...props}
    />
  )
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  )
}

function ContextMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-context-menu-content-available-height) min-w-[8rem] origin-(--radix-context-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  )
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  )
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  )
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn(
        "text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function ContextMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function ContextMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
}


############################## FIN DEL ARCHIVO: components\ui\context-menu.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\date-picker.tsx ##############################

// Jello-Frontend/components/ui/date-picker.tsx

"use client"

import * as React from "react"
import { format } from "date-fns"
import { Calendar as CalendarIcon } from "lucide-react"
import { cn } from "@/lib/utils"
import { Button } from "@/components/ui/button"
import { Calendar } from "@/components/ui/calendar"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"

interface DatePickerProps {
  date: Date | undefined;
  setDate: (date: Date | undefined) => void;
}

export function DatePicker({ date, setDate }: DatePickerProps) {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button
          variant={"outline"}
          className={cn("w-full justify-start text-left font-normal", !date && "text-muted-foreground")}
        >
          <CalendarIcon className="mr-2 h-4 w-4" />
          {date ? format(date, "PPP") : <span>Pick a date</span>}
        </Button>
      </PopoverTrigger>
      
      <PopoverContent className="w-auto p-0">
        <Calendar
          mode="single"
          selected={date}
          onSelect={setDate}
          initialFocus
        />
      </PopoverContent>
    </Popover>
  )
}

############################## FIN DEL ARCHIVO: components\ui\date-picker.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\dialog.tsx ##############################

"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Dialog({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />
}

function DialogTrigger({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />
}

function DialogPortal({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />
}

function DialogClose({
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />
}

function DialogOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  )
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  )
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn(
        "flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",
        className
      )}
      {...props}
    />
  )
}

function DialogTitle({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg leading-none font-semibold", className)}
      {...props}
    />
  )
}

function DialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
}


############################## FIN DEL ARCHIVO: components\ui\dialog.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\drawer.tsx ##############################

"use client"

import * as React from "react"
import { Drawer as DrawerPrimitive } from "vaul"

import { cn } from "@/lib/utils"

function Drawer({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />
}

function DrawerTrigger({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />
}

function DrawerPortal({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />
}

function DrawerClose({
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />
}

function DrawerOverlay({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function DrawerContent({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  )
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className
      )}
      {...props}
    />
  )
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function DrawerTitle({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function DrawerDescription({
  className,
  ...props
}: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
}


############################## FIN DEL ARCHIVO: components\ui\drawer.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\dropdown-menu.tsx ##############################

"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}


############################## FIN DEL ARCHIVO: components\ui\dropdown-menu.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\form.tsx ##############################

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { Slot } from "@radix-ui/react-slot"
import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form"

import { cn } from "@/lib/utils"
import { Label } from "@/components/ui/label"

const Form = FormProvider

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName
}

const FormFieldContext = React.createContext<FormFieldContextValue>(
  {} as FormFieldContextValue
)

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  )
}

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext)
  const itemContext = React.useContext(FormItemContext)
  const { getFieldState } = useFormContext()
  const formState = useFormState({ name: fieldContext.name })
  const fieldState = getFieldState(fieldContext.name, formState)

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>")
  }

  const { id } = itemContext

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  }
}

type FormItemContextValue = {
  id: string
}

const FormItemContext = React.createContext<FormItemContextValue>(
  {} as FormItemContextValue
)

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId()

  return (
    <FormItemContext.Provider value={{ id }}>
      <div
        data-slot="form-item"
        className={cn("grid gap-2", className)}
        {...props}
      />
    </FormItemContext.Provider>
  )
}

function FormLabel({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField()

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  )
}

function FormControl({ ...props }: React.ComponentProps<typeof Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()

  return (
    <Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={
        !error
          ? `${formDescriptionId}`
          : `${formDescriptionId} ${formMessageId}`
      }
      aria-invalid={!!error}
      {...props}
    />
  )
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField()

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField()
  const body = error ? String(error?.message ?? "") : props.children

  if (!body) {
    return null
  }

  return (
    <p
      data-slot="form-message"
      id={formMessageId}
      className={cn("text-destructive text-sm", className)}
      {...props}
    >
      {body}
    </p>
  )
}

export {
  useFormField,
  Form,
  FormItem,
  FormLabel,
  FormControl,
  FormDescription,
  FormMessage,
  FormField,
}


############################## FIN DEL ARCHIVO: components\ui\form.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\hover-card.tsx ##############################

"use client"

import * as React from "react"
import * as HoverCardPrimitive from "@radix-ui/react-hover-card"

import { cn } from "@/lib/utils"

function HoverCard({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />
}

function HoverCardTrigger({
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return (
    <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />
  )
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-64 origin-(--radix-hover-card-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  )
}

export { HoverCard, HoverCardTrigger, HoverCardContent }


############################## FIN DEL ARCHIVO: components\ui\hover-card.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\icon.tsx ##############################

"use client"

import type * as React from "react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

// CORREGIDO: Se cambia el nombre de la prop de 'icon' a 'as' para mayor claridad y
// se ajusta para recibir un componente, que es la práctica estándar.
interface IconProps extends React.SVGProps<SVGSVGElement> {
  as: React.ElementType;
  size?: "sm" | "md" | "lg" | "xl";
  animated?: boolean;
}

const sizeClasses = {
  sm: "w-4 h-4",
  md: "w-5 h-5",
  lg: "w-6 h-6",
  xl: "w-8 h-8",
}

export function Icon({ as: Component, size = "md", animated = false, className, ...props }: IconProps) {
  const MotionComponent = motion(Component);

  return animated ? (
    <MotionComponent
      className={cn("inline-block", sizeClasses[size], className)}
      whileHover={{ scale: 1.1 }}
      whileTap={{ scale: 0.9 }}
      transition={{ type: "spring", stiffness: 400, damping: 17 }}
      {...props}
    />
  ) : (
    <Component
      className={cn("inline-block", sizeClasses[size], className)}
      {...props}
    />
  );
}


############################## FIN DEL ARCHIVO: components\ui\icon.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\index.ts ##############################

// UI Components Export Index
export { Button } from "./button"
export { Input } from "./input"
export { Textarea } from "./textarea"
export { Select } from "./select"
export { Modal } from "./modal"
export { Avatar } from "./avatar"
export { Spinner } from "./spinner"
export { Badge } from "./badge"
export { Checkbox } from "./checkbox"
export { Tooltip } from "./tooltip"
export { Toast } from "./toast"
export { Icon } from "./icon"
export { LanguageSwitcher } from "./language-switcher"
export { ColorPicker } from "./color-picker"
export { DatePicker } from "./date-picker"


############################## FIN DEL ARCHIVO: components\ui\index.ts ##################################

############################## INICIO DEL ARCHIVO: components\ui\input-otp.tsx ##############################

"use client"

import * as React from "react"
import { OTPInput, OTPInputContext } from "input-otp"
import { MinusIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn(
        "flex items-center gap-2 has-disabled:opacity-50",
        containerClassName
      )}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  )
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-otp-group"
      className={cn("flex items-center", className)}
      {...props}
    />
  )
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number
}) {
  const inputOTPContext = React.useContext(OTPInputContext)
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {}

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input relative flex h-9 w-9 items-center justify-center border-y border-r text-sm shadow-xs transition-all outline-none first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  )
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  )
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }


############################## FIN DEL ARCHIVO: components\ui\input-otp.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\input.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string
  error?: string
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(({ className, type, label, error, ...props }, ref) => {
  return (
    <div className="space-y-2">
      {label && <label className="text-sm font-medium text-foreground">{label}</label>}
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-2xl border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          error && "border-destructive focus-visible:ring-destructive",
          className,
        )}
        ref={ref} {...props}
      />
      {error && (
        <p className="text-sm text-destructive">
          {error}
        </p>
      )}
    </div>
  )
})
Input.displayName = "Input"

export { Input }


############################## FIN DEL ARCHIVO: components\ui\input.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\label.tsx ##############################

"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"

import { cn } from "@/lib/utils"

function Label({
  className,
  ...props
}: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
        className
      )}
      {...props}
    />
  )
}

export { Label }


############################## FIN DEL ARCHIVO: components\ui\label.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\language-switcher.tsx ##############################

"use client"

import * as React from "react"
import { Globe } from "lucide-react"
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select"

const languages = [
  { code: "en", name: "English", flag: "🇺🇸" },
  { code: "es", name: "Español", flag: "🇪🇸" },
]

export function LanguageSwitcher() {
  const [selectedLanguage, setSelectedLanguage] = React.useState("en")

  return (
    <Select value={selectedLanguage} onValueChange={setSelectedLanguage}>
      <SelectTrigger className="w-auto">
          <Globe className="h-4 w-4 mr-1" />
          <SelectValue />
      </SelectTrigger>
      <SelectContent>
        {languages.map((language) => (
          <SelectItem key={language.code} value={language.code}>
            <span className="flex items-center gap-2">
              <span>{language.code}</span>
            </span>
          </SelectItem>
        ))}
      </SelectContent>
    </Select>
  )
}

############################## FIN DEL ARCHIVO: components\ui\language-switcher.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\menubar.tsx ##############################

"use client"

import * as React from "react"
import * as MenubarPrimitive from "@radix-ui/react-menubar"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Menubar({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn(
        "bg-background flex h-9 items-center gap-1 rounded-md border p-1 shadow-xs",
        className
      )}
      {...props}
    />
  )
}

function MenubarMenu({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />
}

function MenubarGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />
}

function MenubarPortal({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />
}

function MenubarRadioGroup({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return (
    <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />
  )
}

function MenubarTrigger({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex items-center rounded-sm px-2 py-1 text-sm font-medium outline-hidden select-none",
        className
      )}
      {...props}
    />
  )
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[12rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </MenubarPortal>
  )
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  )
}

function MenubarRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-xs py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  )
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function MenubarSeparator({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function MenubarShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function MenubarSub({
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-none select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  )
}

function MenubarSubContent({
  className,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-menubar-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
}


############################## FIN DEL ARCHIVO: components\ui\menubar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\modal.tsx ##############################

"use client"

import * as React from "react"
import * as DialogPrimitive from "@radix-ui/react-dialog"
import { X } from "lucide-react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const Modal = DialogPrimitive.Root

const ModalTrigger = DialogPrimitive.Trigger

const ModalPortal = DialogPrimitive.Portal

const ModalClose = DialogPrimitive.Close

const ModalOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/50 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className,
    )}
    {...props}
  />
))
ModalOverlay.displayName = DialogPrimitive.Overlay.displayName

const ModalContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <ModalPortal>
    <ModalOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 w-full max-w-lg translate-x-[-50%] translate-y-[-50%] glass-modal p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-3xl",
        className,
      )}
      {...props}
    >
      <motion.div
        initial={{ scale: 0.9, opacity: 0 }}
        animate={{ scale: 1, opacity: 1 }}
      >
        {children}
      </motion.div>
    </DialogPrimitive.Content>
  </ModalPortal>
))
ModalContent.displayName = DialogPrimitive.Content.displayName

const ModalHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left", className)} {...props} />
)
ModalHeader.displayName = "ModalHeader"

const ModalFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)} {...props} />
)
ModalFooter.displayName = "ModalFooter"

const ModalTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold leading-none tracking-tight", className)}
    {...props}
  />
))
ModalTitle.displayName = DialogPrimitive.Title.displayName

const ModalDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
))
ModalDescription.displayName = DialogPrimitive.Description.displayName

export {
  Modal,
  ModalPortal,
  ModalOverlay,
  ModalClose,
  ModalTrigger,
  ModalContent,
  ModalHeader,
  ModalFooter,
  ModalTitle,
  ModalDescription,
}


############################## FIN DEL ARCHIVO: components\ui\modal.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\navigation-menu.tsx ##############################

import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDownIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn(
        "group/navigation-menu relative flex max-w-max flex-1 items-center justify-center",
        className
      )}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  )
}

function NavigationMenuList({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn(
        "group flex flex-1 list-none items-center justify-center gap-1",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuItem({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item
      data-slot="navigation-menu-item"
      className={cn("relative", className)}
      {...props}
    />
  )
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1"
)

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  )
}

function NavigationMenuContent({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 top-0 left-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div
      className={cn(
        "absolute top-full left-0 isolate z-50 flex justify-center"
      )}
    >
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className
        )}
        {...props}
      />
    </div>
  )
}

function NavigationMenuLink({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm transition-all outline-none focus-visible:ring-[3px] focus-visible:outline-1 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  )
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
}


############################## FIN DEL ARCHIVO: components\ui\navigation-menu.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\pagination.tsx ##############################

import * as React from "react"
import {
  ChevronLeftIcon,
  ChevronRightIcon,
  MoreHorizontalIcon,
} from "lucide-react"

import { cn } from "@/lib/utils"
import { Button, buttonVariants } from "@/components/ui/button"

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  )
}

function PaginationContent({
  className,
  ...props
}: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="pagination-content"
      className={cn("flex flex-row items-center gap-1", className)}
      {...props}
    />
  )
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />
}

type PaginationLinkProps = {
  isActive?: boolean
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">

function PaginationLink({
  className,
  isActive,
  size = "icon",
  ...props
}: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className
      )}
      {...props}
    />
  )
}

function PaginationPrevious({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  )
}

function PaginationNext({
  className,
  ...props
}: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  )
}

function PaginationEllipsis({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  )
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
}


############################## FIN DEL ARCHIVO: components\ui\pagination.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\popover.tsx ##############################

"use client"

import * as React from "react"
import * as PopoverPrimitive from "@radix-ui/react-popover"

import { cn } from "@/lib/utils"

function Popover({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />
}

function PopoverTrigger({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
          className
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  )
}

function PopoverAnchor({
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }


############################## FIN DEL ARCHIVO: components\ui\popover.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\progress.tsx ##############################

"use client"

import * as React from "react"
import * as ProgressPrimitive from "@radix-ui/react-progress"

import { cn } from "@/lib/utils"

function Progress({
  className,
  value,
  ...props
}: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn(
        "bg-primary/20 relative h-2 w-full overflow-hidden rounded-full",
        className
      )}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  )
}

export { Progress }


############################## FIN DEL ARCHIVO: components\ui\progress.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\radio-group.tsx ##############################

"use client"

import * as React from "react"
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group"
import { CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function RadioGroup({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return (
    <RadioGroupPrimitive.Root
      data-slot="radio-group"
      className={cn("grid gap-3", className)}
      {...props}
    />
  )
}

function RadioGroupItem({
  className,
  ...props
}: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  )
}

export { RadioGroup, RadioGroupItem }


############################## FIN DEL ARCHIVO: components\ui\radio-group.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\resizable.tsx ##############################

"use client"

import * as React from "react"
import { GripVerticalIcon } from "lucide-react"
import * as ResizablePrimitive from "react-resizable-panels"

import { cn } from "@/lib/utils"

function ResizablePanelGroup({
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn(
        "flex h-full w-full data-[panel-group-direction=vertical]:flex-col",
        className
      )}
      {...props}
    />
  )
}

function ResizablePanel({
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 focus-visible:outline-hidden data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:translate-x-0 data-[panel-group-direction=vertical]:after:-translate-y-1/2 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border z-10 flex h-4 w-3 items-center justify-center rounded-xs border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  )
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle }


############################## FIN DEL ARCHIVO: components\ui\resizable.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\scroll-area.tsx ##############################

"use client"

import * as React from "react"
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area"

import { cn } from "@/lib/utils"

function ScrollArea({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root
      data-slot="scroll-area"
      className={cn("relative", className)}
      {...props}
    >
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  )
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none p-px transition-colors select-none",
        orientation === "vertical" &&
          "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" &&
          "h-2.5 flex-col border-t border-t-transparent",
        className
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  )
}

export { ScrollArea, ScrollBar }


############################## FIN DEL ARCHIVO: components\ui\scroll-area.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\select.tsx ##############################

"use client"

import * as React from "react"
import * as SelectPrimitive from "@radix-ui/react-select"
import { Check, ChevronDown, ChevronUp } from "lucide-react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const Select = SelectPrimitive.Root

const SelectGroup = SelectPrimitive.Group

const SelectValue = SelectPrimitive.Value

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-2xl border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className,
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
))
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn("flex cursor-default items-center justify-center py-1", className)}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
))
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn("flex cursor-default items-center justify-center py-1", className)}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
))
SelectScrollDownButton.displayName = SelectPrimitive.ScrollDownButton.displayName

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      asChild
      position={position}
      {...props}
    >
      <motion.div
        initial={{ opacity: 0, y: -10, scale: 0.95 }}
        animate={{ opacity: 1, y: 0, scale: 1 }}
        exit={{ opacity: 0, y: -10, scale: 0.95 }} 
        transition={{ type: "spring", stiffness: 400, damping: 25 }}
        className={cn(
          "relative z-50 max-h-96 min-w-[8rem] overflow-hidden glass-card",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </motion.div>
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
))
SelectContent.displayName = SelectPrimitive.Content.displayName

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label ref={ref} className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)} {...props} />
))
SelectLabel.displayName = SelectPrimitive.Label.displayName

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-xl py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
))
SelectItem.displayName = SelectPrimitive.Item.displayName

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator ref={ref} className={cn("-mx-1 my-1 h-px bg-muted", className)} {...props} />
))
SelectSeparator.displayName = SelectPrimitive.Separator.displayName

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
}

############################## FIN DEL ARCHIVO: components\ui\select.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\separator.tsx ##############################

"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",
        className
      )}
      {...props}
    />
  )
}

export { Separator }


############################## FIN DEL ARCHIVO: components\ui\separator.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\sheet.tsx ##############################

"use client"

import * as React from "react"
import * as SheetPrimitive from "@radix-ui/react-dialog"
import { XIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />
}

function SheetTrigger({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />
}

function SheetClose({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />
}

function SheetPortal({
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />
}

function SheetOverlay({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className
      )}
      {...props}
    />
  )
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left"
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className
        )}
        {...props}
      >
        {children}
      </SheetPrimitive.Content>
    </SheetPortal>
  )
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-header"
      className={cn("flex flex-col gap-1.5 p-4", className)}
      {...props}
    />
  )
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sheet-footer"
      className={cn("mt-auto flex flex-col gap-2 p-4", className)}
      {...props}
    />
  )
}

function SheetTitle({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  )
}

function SheetDescription({
  className,
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  )
}

export {
  Sheet,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
}


############################## FIN DEL ARCHIVO: components\ui\sheet.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\sidebar.tsx ##############################

"use client"
import * as React from "react"
import Link from "next/link"
import { usePathname } from "next/navigation"
import { AnimatePresence, motion } from "framer-motion"
import { Home, FolderKanban, CheckSquare, Search, Plus, ChevronsLeft, Bell, ClipboardList } from "lucide-react"
import { Button } from "@/components/ui/button"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip"
import { UserMenu } from "@/components/user-menu"
import { cn } from "@/lib/utils"
import { CreateProjectModal } from "@/components/modals/create-project-modal"
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover"
import { NotificationPanel } from "@/components/notification-panel"
import { Badge } from "@/components/ui/badge"

const navigation = [
  { name: "Dashboard", href: "/dashboard", icon: Home },
  { name: "Search", href: "/search", icon: Search },
  { name: "Projects", href: "/projects", icon: FolderKanban },
  { name: "My Tasks", href: "/tasks", icon: CheckSquare },
  { name: "Todos", href: "/todos", icon: ClipboardList },
]
const projects = [
  { id: 1, name: "Website Redesign", color: "bg-chart-1" },
  { id: 2, name: "Mobile App", color: "bg-chart-2" },
  { id: 3, name: "Marketing Campaign Q4", color: "bg-chart-3" },
  { id: 4, name: "Data Analysis Dashboard", color: "bg-chart-2" },
  { id: 5, name: "API Integration with Stripe", color: "bg-chart-5" },
];

interface SidebarProps {
  isCollapsed: boolean
  onToggle?: () => void
  isMobileView?: boolean // La prop es opcional
}

export function Sidebar({ isCollapsed, onToggle, isMobileView = false }: SidebarProps) {
  const pathname = usePathname()
  const [isCreateModalOpen, setIsCreateModalOpen] = React.useState(false)
  const [notificationCount] = React.useState(3)

  const notificationButton = (
    <Button variant="ghost" size="icon" className="relative rounded-full">
      <Bell className="w-5 h-5" />
      {notificationCount > 0 && (
        <Badge variant="destructive" className="absolute top-1 right-1 h-4 w-4 p-0 flex items-center justify-center text-xs">{notificationCount}</Badge>
      )}
    </Button>
  );

  return (
    <>
      <TooltipProvider delayDuration={0}>
        <motion.aside
          data-collapsed={isCollapsed}
          className="group/sidebar h-full bg-sidebar/80 backdrop-blur-xl border-r border-glass-border flex flex-col z-20"
          animate={{ width: isCollapsed ? "5rem" : "16rem" }}
          transition={{ type: "spring", stiffness: 300, damping: 25 }}
        >
          <div className="flex flex-col h-full p-3">
            <div className={cn("flex items-center gap-3 mb-4", isCollapsed ? "justify-center" : "px-3")}>
              <Avatar className="w-8 h-8"><AvatarImage src="/images/jelli-avatar.png" alt="Jello" /><AvatarFallback>J</AvatarFallback></Avatar>
              <AnimatePresence>{!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="text-xl font-bold text-foreground whitespace-nowrap">Jello</motion.span>)}</AnimatePresence>
            </div>
            <div className="flex-grow overflow-y-auto space-y-4">
              <nav className="space-y-1 px-2">
                {navigation.map((item) => (
                  <Tooltip key={item.name} delayDuration={0}>
                    <TooltipTrigger asChild>
                      <Link href={item.href} className={cn("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors", pathname === item.href ? "bg-primary text-primary-foreground hover:bg-primary/90" : "text-muted-foreground hover:bg-muted", isCollapsed && "justify-center")}>
                        <item.icon className="h-5 w-5" />
                        <AnimatePresence>{!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="flex-grow">{item.name}</motion.span>)}</AnimatePresence>
                      </Link>
                    </TooltipTrigger>
                    <TooltipContent side="right">{item.name}</TooltipContent>
                  </Tooltip>
                ))}
              </nav>
              <div className="px-2">
                <div className={cn("mb-2 flex items-center", isCollapsed ? "justify-center" : "justify-between")}>
                  {!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="text-xs font-semibold text-muted-foreground uppercase">Projects</motion.span>)}
                  <Tooltip delayDuration={0}>
                    <TooltipTrigger asChild>
                      <Button variant="ghost" size="icon" className={cn("h-7 w-7 rounded-md", isCollapsed ? "" : "")} onClick={() => setIsCreateModalOpen(true)}><Plus className="h-4 w-4" /></Button>
                    </TooltipTrigger>
                    <TooltipContent side="right">Create Project</TooltipContent>
                  </Tooltip>
                </div>
                <div className="space-y-1">
                  {projects.map((project) => (
                    <Tooltip key={project.id} delayDuration={0}>
                      <TooltipTrigger asChild>
                        <Link href={`/project/${project.id}`} className={cn("flex items-center gap-3 rounded-md px-3 py-2 text-sm font-medium transition-colors hover:bg-muted", pathname === `/project/${project.id}` ? "text-primary" : "text-muted-foreground", isCollapsed && "justify-center")}>
                          <span className={cn("h-2 w-2 rounded-full", project.color)} />
                          <AnimatePresence>{!isCollapsed && (<motion.span initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -10 }} className="flex-grow truncate">{project.name}</motion.span>)}</AnimatePresence>
                        </Link>
                      </TooltipTrigger>
                      <TooltipContent side="right">{project.name}</TooltipContent>
                    </Tooltip>
                  ))}
                </div>
              </div>
            </div>
            {!isMobileView && (
              <div className="mt-auto pt-4 border-t border-border/50">
                <div className={cn("flex flex-col items-center gap-2")}>
                  <div className={cn("flex items-center w-full", isCollapsed ? "flex-col gap-2" : "justify-between")}>
                    <div className={cn("flex items-center", isCollapsed ? "flex-col gap-2" : "gap-1")}>
                      <Popover>
                        {isCollapsed ? (
                          <Tooltip>
                            <TooltipTrigger asChild><PopoverTrigger asChild>{notificationButton}</PopoverTrigger></TooltipTrigger>
                            <TooltipContent side="right">Notifications</TooltipContent>
                          </Tooltip>
                        ) : (
                          <PopoverTrigger asChild>{notificationButton}</PopoverTrigger>
                        )}
                        <PopoverContent side="right" align="start" className="p-0"><NotificationPanel /></PopoverContent>
                      </Popover>
                      <UserMenu />
                    </div>
                    {!isCollapsed && onToggle && (
                      <Button variant="ghost" size="icon" className="rounded-full" onClick={onToggle}><ChevronsLeft className="w-5 h-5" /></Button>
                    )}
                  </div>
                  {isCollapsed && onToggle && (
                    <Tooltip>
                      <TooltipTrigger asChild>
                        <Button variant="ghost" size="icon" className="w-full rounded-xl" onClick={onToggle}><ChevronsLeft className="w-5 h-5 rotate-180" /></Button>
                      </TooltipTrigger>
                      <TooltipContent side="right">Expand</TooltipContent>
                    </Tooltip>
                  )}
                </div>
              </div>
            )}
          </div>
        </motion.aside>
      </TooltipProvider>
      <CreateProjectModal
        isOpen={isCreateModalOpen}
        onClose={() => setIsCreateModalOpen(false)}
        onSubmit={(data) => console.log("Creating project:", data)}
      />
    </>
  )
}



############################## FIN DEL ARCHIVO: components\ui\sidebar.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\skeleton.tsx ##############################

// components/ui/skeleton.tsx

import { cn } from "@/lib/utils"

function Skeleton({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-md bg-muted", className)}
      data-testid="skeleton" // <-- Corrección: Atributo añadido
      {...props}
    />
  )
}

export { Skeleton }

############################## FIN DEL ARCHIVO: components\ui\skeleton.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\slider.tsx ##############################

"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () =>
      Array.isArray(value)
        ? value
        : Array.isArray(defaultValue)
          ? defaultValue
          : [min, max],
    [value, defaultValue, min, max]
  )

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",
        className
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn(
            "bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full"
          )}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  )
}

export { Slider }


############################## FIN DEL ARCHIVO: components\ui\slider.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\sonner.tsx ##############################

"use client"

import { useTheme } from "next-themes"
import { Toaster as Sonner, ToasterProps } from "sonner"

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme()

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
        } as React.CSSProperties
      }
      {...props}
    />
  )
}

export { Toaster }


############################## FIN DEL ARCHIVO: components\ui\sonner.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\spinner.tsx ##############################

"use client"

import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

interface SpinnerProps {
  size?: "sm" | "md" | "lg"
  className?: string
}

export function Spinner({ size = "md", className }: SpinnerProps) {
  const sizeClasses = {
    sm: "w-4 h-4",
    md: "w-6 h-6",
    lg: "w-8 h-8",
  }

  return (
    <motion.div
      className={cn("inline-block", sizeClasses[size], className)}
      animate={{ rotate: 360 }}
      transition={{ duration: 1, repeat: Number.POSITIVE_INFINITY, ease: "linear" }}
    >
      <div className="w-full h-full border-2 border-current border-t-transparent rounded-full" />
    </motion.div>
  )
}


############################## FIN DEL ARCHIVO: components\ui\spinner.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\switch.tsx ##############################

"use client"

import * as React from "react"
import * as SwitchPrimitive from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

function Switch({
  className,
  ...props
}: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
        )}
      />
    </SwitchPrimitive.Root>
  )
}

export { Switch }


############################## FIN DEL ARCHIVO: components\ui\switch.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\table.tsx ##############################

"use client"

import * as React from "react"

import { cn } from "@/lib/utils"

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div
      data-slot="table-container"
      className="relative w-full overflow-x-auto"
    >
      <table
        data-slot="table"
        className={cn("w-full caption-bottom text-sm", className)}
        {...props}
      />
    </div>
  )
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return (
    <thead
      data-slot="table-header"
      className={cn("[&_tr]:border-b", className)}
      {...props}
    />
  )
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return (
    <tbody
      data-slot="table-body"
      className={cn("[&_tr:last-child]:border-0", className)}
      {...props}
    />
  )
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn(
        "bg-muted/50 border-t font-medium [&>tr]:last:border-b-0",
        className
      )}
      {...props}
    />
  )
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn(
        "hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",
        className
      )}
      {...props}
    />
  )
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className
      )}
      {...props}
    />
  )
}

function TableCaption({
  className,
  ...props
}: React.ComponentProps<"caption">) {
  return (
    <caption
      data-slot="table-caption"
      className={cn("text-muted-foreground mt-4 text-sm", className)}
      {...props}
    />
  )
}

export {
  Table,
  TableHeader,
  TableBody,
  TableFooter,
  TableHead,
  TableRow,
  TableCell,
  TableCaption,
}


############################## FIN DEL ARCHIVO: components\ui\table.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\tabs.tsx ##############################

"use client"

import * as React from "react"
import * as TabsPrimitive from "@radix-ui/react-tabs"

import { cn } from "@/lib/utils"

function Tabs({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return (
    <TabsPrimitive.Root
      data-slot="tabs"
      className={cn("flex flex-col gap-2", className)}
      {...props}
    />
  )
}

function TabsList({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className
      )}
      {...props}
    />
  )
}

function TabsTrigger({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function TabsContent({
  className,
  ...props
}: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return (
    <TabsPrimitive.Content
      data-slot="tabs-content"
      className={cn("flex-1 outline-none", className)}
      {...props}
    />
  )
}

export { Tabs, TabsList, TabsTrigger, TabsContent }


############################## FIN DEL ARCHIVO: components\ui\tabs.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\textarea.tsx ##############################

"use client"

import * as React from "react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

export interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {
  label?: string
  error?: string
}

const Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, label, error, ...props }, ref) => {
  return (
    <div className="space-y-2">
      {label && <label className="text-sm font-medium text-foreground">{label}</label>}
      {/* CORREGIDO: Se eliminó `motion` del textarea base para evitar conflictos de tipos. */}
      <textarea
        className={cn(
          "flex min-h-[80px] w-full rounded-2xl border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
          error && "border-destructive focus-visible:ring-destructive",
          className,
        )}
        ref={ref}
        {...props}
      />
      {error && (
        <p className="text-sm text-destructive">
          {error}
        </p>
      )}
    </div>
  )
})
Textarea.displayName = "Textarea"

export { Textarea }


############################## FIN DEL ARCHIVO: components\ui\textarea.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\toast.tsx ##############################

"use client"

import * as React from "react"
import * as ToastPrimitives from "@radix-ui/react-toast"
import { cva, type VariantProps } from "class-variance-authority"
import { X } from "lucide-react"
import { motion } from "framer-motion"
import { cn } from "@/lib/utils"

const ToastProvider = ToastPrimitives.Provider

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className,
    )}
    {...props}
  />
))
ToastViewport.displayName = ToastPrimitives.Viewport.displayName

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden glass-card p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive: "destructive border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
)

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> & VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return (
    <motion.div
      initial={{ opacity: 0, y: 50, scale: 0.3 }}
      animate={{ opacity: 1, y: 0, scale: 1 }}
      exit={{ opacity: 0, scale: 0.5, transition: { duration: 0.2 } }}
      transition={{ type: "spring", stiffness: 500, damping: 30 }}
    >
      <ToastPrimitives.Root ref={ref} className={cn(toastVariants({ variant }), className)} {...props} />
    </motion.div>
  )
})
Toast.displayName = ToastPrimitives.Root.displayName

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",
      className,
    )}
    {...props}
  />
))
ToastAction.displayName = ToastPrimitives.Action.displayName

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className,
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
))
ToastClose.displayName = ToastPrimitives.Close.displayName

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title ref={ref} className={cn("text-sm font-semibold", className)} {...props} />
))
ToastTitle.displayName = ToastPrimitives.Title.displayName

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description ref={ref} className={cn("text-sm opacity-90", className)} {...props} />
))
ToastDescription.displayName = ToastPrimitives.Description.displayName

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>

type ToastActionElement = React.ReactElement<typeof ToastAction>

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
}


############################## FIN DEL ARCHIVO: components\ui\toast.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\toaster.tsx ##############################

"use client"

import { useToast } from "@/hooks/use-toast"
import {
  Toast,
  ToastClose,
  ToastDescription,
  ToastProvider,
  ToastTitle,
  ToastViewport,
} from "@/components/ui/toast"

export function Toaster() {
  const { toasts } = useToast()

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && (
                <ToastDescription>{description}</ToastDescription>
              )}
            </div>
            {action}
            <ToastClose />
          </Toast>
        )
      })}
      <ToastViewport />
    </ToastProvider>
  )
}


############################## FIN DEL ARCHIVO: components\ui\toaster.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\toggle-group.tsx ##############################

"use client"

import * as React from "react"
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group"
import { type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"
import { toggleVariants } from "@/components/ui/toggle"

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants>
>({
  size: "default",
  variant: "default",
})

function ToggleGroup({
  className,
  variant,
  size,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      className={cn(
        "group/toggle-group flex w-fit items-center rounded-md data-[variant=outline]:shadow-xs",
        className
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size }}>
        {children}
      </ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  )
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> &
  VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext)

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "min-w-0 flex-1 shrink-0 rounded-none shadow-none first:rounded-l-md last:rounded-r-md focus:z-10 focus-visible:z-10 data-[variant=outline]:border-l-0 data-[variant=outline]:first:border-l",
        className
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  )
}

export { ToggleGroup, ToggleGroupItem }


############################## FIN DEL ARCHIVO: components\ui\toggle-group.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\toggle.tsx ##############################

"use client"

import * as React from "react"
import * as TogglePrimitive from "@radix-ui/react-toggle"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline:
          "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
)

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> &
  VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root
      data-slot="toggle"
      className={cn(toggleVariants({ variant, size, className }))}
      {...props}
    />
  )
}

export { Toggle, toggleVariants }


############################## FIN DEL ARCHIVO: components\ui\toggle.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\tooltip.tsx ##############################

"use client"

import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"
import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden glass-card px-3 py-1.5 text-xs animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }


############################## FIN DEL ARCHIVO: components\ui\tooltip.tsx ##################################

############################## INICIO DEL ARCHIVO: components\ui\use-mobile.ts ##############################

import * as React from "react"

const MOBILE_BREAKPOINT = 1024; // Usamos 1024px para coincidir con 'lg' de Tailwind

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);

  React.useEffect(() => {
    const checkDevice = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    checkDevice();
    window.addEventListener("resize", checkDevice);
    return () => window.removeEventListener("resize", checkDevice);
  }, []);

  return isMobile;
}

############################## FIN DEL ARCHIVO: components\ui\use-mobile.ts ##################################

############################## INICIO DEL ARCHIVO: components\ui\use-toast.ts ##############################

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


############################## FIN DEL ARCHIVO: components\ui\use-toast.ts ##################################

############################## INICIO DEL ARCHIVO: components\user-menu.tsx ##############################

// Archivo: components/user-menu.tsx

"use client"
import { User, Settings, LogOut, Moon, Sun } from "lucide-react"
import type React from "react"
import { useTheme } from "@/contexts/theme-context"
import { motion } from "framer-motion"
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar"
import { Button } from "@/components/ui/button"
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu"
import { useRouter } from "next/navigation"
import { useAuth } from "@/contexts/auth-context" // 1. Importamos el hook de autenticación

export function UserMenu() {
  const { theme, toggleTheme } = useTheme()
  const router = useRouter()
  const { user, logout } = useAuth() // 2. Obtenemos el usuario y la función de logout

  if (!user) {
    return null; // O un esqueleto de carga si se prefiere
  }

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <motion.div
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          transition={{ type: "spring", stiffness: 400, damping: 17 }}
        >
          <Button variant="ghost" className="relative h-10 w-10 rounded-full">
            <Avatar className="h-10 w-10">
              {/* 3. Usamos datos dinámicos */}
              <AvatarImage src={user.avatarUrl ?? undefined} alt={user.name} />
              <AvatarFallback>{user.name.charAt(0).toUpperCase()}</AvatarFallback>
            </Avatar>
          </Button>
        </motion.div>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="w-56 glass-card" align="end" forceMount>
        <DropdownMenuLabel className="font-normal">
          <div className="flex flex-col space-y-1">
            {/* 4. Usamos datos dinámicos */}
            <p className="text-sm font-medium leading-none">{user.name}</p>
            <p className="text-xs leading-none text-muted-foreground">{user.email}</p>
          </div>
        </DropdownMenuLabel>
        <DropdownMenuSeparator />
        <DropdownMenuItem onClick={() => router.push("/profile")}>
          <User className="mr-2 h-4 w-4" />
          <span>Profile</span>
        </DropdownMenuItem>
        <DropdownMenuItem onClick={() => router.push("/settings/appearance")}>
          <Settings className="mr-2 h-4 w-4" />
          <span>Settings</span>
        </DropdownMenuItem>
        <DropdownMenuItem onClick={toggleTheme}>
          {theme === "dark" ? <Sun className="mr-2 h-4 w-4" /> : <Moon className="mr-2 h-4 w-4" />}
          <span>Toggle theme</span>
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        {/* 5. Conectamos la función de logout */}
        <DropdownMenuItem onClick={logout}>
          <LogOut className="mr-2 h-4 w-4" />
          <span>Log out</span>
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  )
}

############################## FIN DEL ARCHIVO: components\user-menu.tsx ##################################

############################## INICIO DEL ARCHIVO: components.json ##############################

{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "iconLibrary": "lucide"
}

############################## FIN DEL ARCHIVO: components.json ##################################

############################## INICIO DEL ARCHIVO: contexts\auth-context.tsx ##############################

"use client";

import * as React from "react";
import { UserProfile, ApiError } from "@/types";
import { apiClient } from "@/lib/api";
import { useRouter } from "next/navigation";
import { toast } from "sonner";

interface AuthContextType {
  user: UserProfile | null;
  token: string | null;
  isLoading: boolean;
  login: (data: any, rememberMe: boolean) => Promise<void>;
  register: (data: any) => Promise<{ success: boolean }>;
  logout: () => void;
  revalidateUser: () => Promise<void>;
}

const AuthContext = React.createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = React.useState<UserProfile | null>(null);
  const [token, setToken] = React.useState<string | null>(null);
  const [isLoading, setIsLoading] = React.useState(true);
  const router = useRouter();

  const fetchUser = React.useCallback(async () => {
    const sessionToken = sessionStorage.getItem('authToken');
    const localToken = localStorage.getItem('authToken');
    const storedToken = sessionToken || localToken;

    if (storedToken) {
      setToken(storedToken);
      try {
        const userData = await apiClient.get<UserProfile>('/user/me');
        setUser(userData);
      } catch {
        localStorage.removeItem('authToken');
        sessionStorage.removeItem('authToken');
        setToken(null);
        setUser(null);
      }
    }
    setIsLoading(false);
  }, []);

  React.useEffect(() => {
    fetchUser();
  }, [fetchUser]);

  const handleAuthSuccess = (data: { token: string; user: UserProfile }, rememberMe: boolean) => {
    setToken(data.token);
    setUser(data.user);

    localStorage.setItem('authToken', data.token);
    sessionStorage.removeItem('authToken');

    router.push('/dashboard');
    toast.success(`Welcome, ${data.user.name}!`);
  };

  const login = async (data: any, rememberMe: boolean) => {
    try {
      const response = await apiClient.login({ ...data, rememberMe });
      handleAuthSuccess(response, rememberMe);
    } catch (error) {
      const apiError = error as ApiError;
      const errorMessage = apiError.response?.data?.error || (error as Error).message || 'Ocurrió un error inesperado.';
      if (apiError.response?.status === 403) {
        toast.error(errorMessage);
      } else {
        toast.error(errorMessage);
      }
    }
  };

  const register = async (data: any): Promise<{ success: boolean }> => {
    try {
      await apiClient.register(data);
      toast.success("Registro exitoso. Por favor, revisa tu correo para activar tu cuenta.");
      return { success: true };
    } catch (error) {
      const apiError = error as ApiError;
      const errorMessage = apiError.response?.data?.error || (error as Error).message || 'Ocurrió un error inesperado.';
      toast.error(errorMessage);
      return { success: false };
    }
  };

  const logout = () => {
    setUser(null);
    setToken(null);
    localStorage.removeItem('authToken');
    sessionStorage.removeItem('authToken');
    router.push('/');
    toast.info("You have been logged out.");
  };

  const revalidateUser = async () => {
    await fetchUser();
  };

  const value = { user, token, isLoading, login, register, logout, revalidateUser };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = React.useContext(AuthContext);
  if (context === undefined) {
    throw new Error("useAuth must be used within an AuthProvider");
  }
  return context;
}

############################## FIN DEL ARCHIVO: contexts\auth-context.tsx ##################################

############################## INICIO DEL ARCHIVO: contexts\theme-context.tsx ##############################

"use client"

import type React from "react"
import { createContext, useContext, useEffect } from "react"
import { ThemeProvider as NextThemesProvider, useTheme as useNextTheme } from "next-themes"

interface CustomThemeContextType {
  theme: string | undefined
  setTheme: (theme: string) => void
  toggleTheme: (event: React.MouseEvent) => void
}

const ThemeContext = createContext<CustomThemeContextType | undefined>(undefined)

// Definimos los colores de fondo exactos para la animación
const THEME_BACKGROUNDS = {
  light: "#ffffff", // --background en modo claro
  dark: "#0f172a",  // --background en modo oscuro
}

function CustomThemeProvider({ children }: { children: React.ReactNode }) {
  const { theme, setTheme } = useNextTheme()

  const toggleTheme = (event: React.MouseEvent) => {
    const newTheme = theme === "dark" ? "light" : "dark"

    // Acto 1: La Preparación
    const circle = document.createElement("div")
    circle.className = "water-expand" // Asignamos la clase con la animación

    // Asignamos el color de fondo del TEMA DESTINO
    circle.style.backgroundColor = THEME_BACKGROUNDS[newTheme]

    // Posicionamos el círculo en el lugar del clic
    const rect = (event.currentTarget as HTMLElement).getBoundingClientRect()
    circle.style.left = `${rect.left + rect.width / 2}px`
    circle.style.top = `${rect.top + rect.height / 2}px`

    document.body.appendChild(circle)

    // Acto 2: El Cambio Instantáneo (ocurre por debajo)
    setTheme(newTheme)

    // Acto 3: La Limpieza (después de la animación)
    setTimeout(() => {
      document.body.removeChild(circle)
    }, 800) // Duración de la animación
  }

  return (
    <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>
      {children}
    </ThemeContext.Provider>
  )
}

// Hook personalizado para usar nuestro contexto
export function useTheme() {
  const context = useContext(ThemeContext)
  if (context === undefined) {
    throw new Error("useTheme must be used within a ThemeProvider")
  }
  return context
}

// El proveedor principal que envuelve todo en layout.tsx
export function ThemeProvider({ children }: { children: React.ReactNode }) {
  return (
    <NextThemesProvider attribute="class" defaultTheme="system" enableSystem>
      <CustomThemeProvider>{children}</CustomThemeProvider>
    </NextThemesProvider>
  )
}

############################## FIN DEL ARCHIVO: contexts\theme-context.tsx ##################################

############################## INICIO DEL ARCHIVO: hooks\use-media-query.ts ##############################

import * as React from "react"

export function useMediaQuery(query: string) {
  const [value, setValue] = React.useState(false)

  React.useEffect(() => {
    function onChange(event: MediaQueryListEvent) {
      setValue(event.matches)
    }

    const result = matchMedia(query)
    result.addEventListener("change", onChange)
    setValue(result.matches)

    return () => result.removeEventListener("change", onChange)
  }, [query])

  return value
}

############################## FIN DEL ARCHIVO: hooks\use-media-query.ts ##################################

############################## INICIO DEL ARCHIVO: hooks\use-mobile.ts ##############################

import * as React from "react"

// Usamos 1024px para que coincida con el breakpoint 'lg' de Tailwind
const MOBILE_BREAKPOINT = 1024

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)

  React.useEffect(() => {
    // Esta función se ejecuta solo en el cliente, evitando errores de servidor
    const checkDevice = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)
    }

    // Comprueba el tamaño al montar el componente
    checkDevice()

    window.addEventListener("resize", checkDevice)

    // Limpia el listener al desmontar el componente
    return () => window.removeEventListener("resize", checkDevice)
  }, [])

  return isMobile
}

############################## FIN DEL ARCHIVO: hooks\use-mobile.ts ##################################

############################## INICIO DEL ARCHIVO: hooks\use-toast.ts ##############################

"use client"

// Inspired by react-hot-toast library
import * as React from "react"

import type {
  ToastActionElement,
  ToastProps,
} from "@/components/ui/toast"

const TOAST_LIMIT = 1
const TOAST_REMOVE_DELAY = 1000000

type ToasterToast = ToastProps & {
  id: string
  title?: React.ReactNode
  description?: React.ReactNode
  action?: ToastActionElement
}

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const

let count = 0

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER
  return count.toString()
}

type ActionType = typeof actionTypes

type Action =
  | {
      type: ActionType["ADD_TOAST"]
      toast: ToasterToast
    }
  | {
      type: ActionType["UPDATE_TOAST"]
      toast: Partial<ToasterToast>
    }
  | {
      type: ActionType["DISMISS_TOAST"]
      toastId?: ToasterToast["id"]
    }
  | {
      type: ActionType["REMOVE_TOAST"]
      toastId?: ToasterToast["id"]
    }

interface State {
  toasts: ToasterToast[]
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId)
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    })
  }, TOAST_REMOVE_DELAY)

  toastTimeouts.set(toastId, timeout)
}

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      }

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === action.toast.id ? { ...t, ...action.toast } : t
        ),
      }

    case "DISMISS_TOAST": {
      const { toastId } = action

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId)
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id)
        })
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t
        ),
      }
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        }
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      }
  }
}

const listeners: Array<(state: State) => void> = []

let memoryState: State = { toasts: [] }

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action)
  listeners.forEach((listener) => {
    listener(memoryState)
  })
}

type Toast = Omit<ToasterToast, "id">

function toast({ ...props }: Toast) {
  const id = genId()

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    })
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id })

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss()
      },
    },
  })

  return {
    id: id,
    dismiss,
    update,
  }
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState)

  React.useEffect(() => {
    listeners.push(setState)
    return () => {
      const index = listeners.indexOf(setState)
      if (index > -1) {
        listeners.splice(index, 1)
      }
    }
  }, [state])

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  }
}

export { useToast, toast }


############################## FIN DEL ARCHIVO: hooks\use-toast.ts ##################################

############################## INICIO DEL ARCHIVO: hooks\useApi.test.tsx ##############################

--- Contenido de archivo de prueba omitido intencionadamente ---


############################## FIN DEL ARCHIVO: hooks\useApi.test.tsx ##################################

############################## INICIO DEL ARCHIVO: hooks\useApi.ts ##############################

import { useState, useEffect, useCallback } from 'react';
import { apiClient } from '@/lib/api';
import { toast } from 'sonner';

export function useApi<T>(endpoint: string | null) {
  const [data, setData] = useState<T | null>(null);
  const [isLoading, setIsLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  const fetchData = useCallback(async () => {
    if (!endpoint) {
        setIsLoading(false);
        setData(null);
        setError(null);
        return;
    }

    setIsLoading(true);
    setError(null);
    try {
      const result = await apiClient.get<T>(endpoint);
      setData(result);
    } catch (err) {
      const errorMessage = (err as Error).message;
      setError(errorMessage);
      toast.error(`Failed to fetch data: ${errorMessage}`);
    } finally {
      setIsLoading(false);
    }
  }, [endpoint]);

  useEffect(() => {
    fetchData();
  }, [fetchData]);

  return { data, isLoading, error, refetch: fetchData, setData };
}

############################## FIN DEL ARCHIVO: hooks\useApi.ts ##################################

############################## INICIO DEL ARCHIVO: hooks\useDebounce.ts ##############################

import { useState, useEffect } from 'react';

export function useDebounce<T>(value: T, delay: number): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);
  useEffect(() => {
    const handler = setTimeout(() => setDebouncedValue(value), delay);
    return () => clearTimeout(handler);
  }, [value, delay]);
  return debouncedValue;
}

############################## FIN DEL ARCHIVO: hooks\useDebounce.ts ##################################

############################## INICIO DEL ARCHIVO: jest.config.mjs ##############################

// Archivo: Jello-Frontend/jest.config.mjs

import nextJest from 'next/jest.js'

const createJestConfig = nextJest({
  dir: './',
})

/** @type {import('jest').Config} */
const config = {
  setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  testEnvironment: 'jest-environment-jsdom',
  preset: 'ts-jest',
  
  // --- AÑADE ESTE BLOQUE ---
  // Esto le dice a Jest cómo resolver los alias de importación '@/*'
  // mapeándolos a la carpeta raíz del proyecto.
  moduleNameMapper: {
    '^@/(.*)$': '<rootDir>/$1',
  },
  // --- FIN DEL BLOQUE AÑADIDO ---
}

export default createJestConfig(config)

############################## FIN DEL ARCHIVO: jest.config.mjs ##################################

############################## INICIO DEL ARCHIVO: jest.setup.js ##############################


import '@testing-library/jest-dom'
class ResizeObserver {
  observe() {
    // no hacer nada
  }
  unobserve() {
    // no hacer nada
  }
  disconnect() {
    // no hacer nada
  }
}

window.ResizeObserver = ResizeObserver;

############################## FIN DEL ARCHIVO: jest.setup.js ##################################

############################## INICIO DEL ARCHIVO: lib\api.ts ##############################

// lib/api.ts
import { UserProfile } from '@/types';

const API_BASE_URL = 'https://jello-backend.onrender.com/api';

// Interfaz para el error de la API
interface ApiErrorData {
  error: string;
  message?: string; // Para mensajes más descriptivos
}


// Función auxiliar para manejar las respuestas de la API
async function handleResponse<T>(response: Response): Promise<T> {
  if (response.status === 204) {
    return {} as T;
  }
  
  const contentType = response.headers.get("content-type");
  const isJson = contentType && contentType.includes("application/json");

  if (!response.ok) {
    let errorData: ApiErrorData = { error: `Error ${response.status}: ${response.statusText}` };
    if (isJson) {
      // Intentamos parsear el error del cuerpo JSON
      const jsonError = await response.json().catch(() => null);
      if(jsonError && jsonError.error) {
        errorData = jsonError;
      }
    }

    const error = new Error(errorData.error) as any;
    error.response = {
        status: response.status,
        data: errorData
    };
    throw error;
  }

  // Para el caso de registro exitoso (201), el backend solo envía un mensaje.
  if (response.status === 201 && isJson) {
      return response.json() as Promise<T>;
  }

  // Para respuestas OK que no son JSON, devolvemos un objeto vacío.
  if (!isJson) {
    return {} as T;
  }

  return response.json() as Promise<T>;
}


// Función para obtener el token de almacenamiento
function getAuthToken(): string | null {
  if (typeof window === 'undefined') return null;
  // Prioriza sessionStorage para la sesión actual
  return sessionStorage.getItem('authToken') || localStorage.getItem('authToken');
}

// Objeto que encapsula todas nuestras llamadas a la API
export const apiClient = {
  // El método login ahora puede lanzar un error 403 que será capturado en el contexto
  login: async (data: any): Promise<{ token: string; user: UserProfile }> => {
    const response = await fetch(`${API_BASE_URL}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    // handleResponse se encargará de lanzar el error si no es 200 OK
    return handleResponse<{ token: string; user: UserProfile }>(response);
  },

  // El método register ahora espera un mensaje, no un token.
  register: async (data: any): Promise<{ message: string }> => {
    const response = await fetch(`${API_BASE_URL}/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    return handleResponse<{ message: string }>(response);
  },
  
  get: async <T>(endpoint: string): Promise<T> => {
    const token = getAuthToken();
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      headers: { 'Authorization': `Bearer ${token}` },
    });
    return handleResponse<T>(response);
  },

  post: async <T>(endpoint: string, data: any): Promise<T> => {
    const token = getAuthToken();
    const isFormData = data instanceof FormData;
    const headers: HeadersInit = { 'Authorization': `Bearer ${token}` };
    if (!isFormData) {
      headers['Content-Type'] = 'application/json';
    }
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'POST',
      headers,
      body: isFormData ? data : JSON.stringify(data),
    });
    return handleResponse<T>(response);
  },

  put: async <T>(endpoint: string, data: any): Promise<T> => {
    const token = getAuthToken();
    const isFormData = data instanceof FormData;
    const headers: HeadersInit = { 'Authorization': `Bearer ${token}` };
     if (!isFormData) {
       headers['Content-Type'] = 'application/json';
    }
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'PUT',
      headers,
      body: isFormData ? data : JSON.stringify(data),
    });
    return handleResponse<T>(response);
  },

  del: async <T>(endpoint: string): Promise<T> => {
    const token = getAuthToken();
    const response = await fetch(`${API_BASE_URL}${endpoint}`, {
      method: 'DELETE',
      headers: { 'Authorization': `Bearer ${token}` },
    });
    return handleResponse<T>(response);
  },
};

############################## FIN DEL ARCHIVO: lib\api.ts ##################################

############################## INICIO DEL ARCHIVO: lib\skills.ts ##############################


export const SKILLS_CATEGORIES = {
  LANGUAGES: "Lenguajes de Programación",
  FRONTEND: "Frontend Development",
  BACKEND: "Backend Development",
  DATABASES: "Bases de Datos",
  MOBILE: "Mobile Development",
  DEVOPS: "DevOps & Cloud",
  TESTING: "Testing",
  TOOLS: "Herramientas y Software",
  DESIGN: "Diseño UI/UX",
  SOFT_SKILLS: "Habilidades Blandas",
};

export const SKILLS = [
  // Lenguajes
  { name: "JavaScript", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "TypeScript", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Python", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Java", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "C#", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Go", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Rust", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "PHP", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Ruby", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Swift", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "Kotlin", category: SKILLS_CATEGORIES.LANGUAGES },
  { name: "SQL", category: SKILLS_CATEGORIES.LANGUAGES },
  
  // Frontend
  { name: "React", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Next.js", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Vue.js", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Angular", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Svelte", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "HTML5", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "CSS3", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Sass", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Tailwind CSS", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "Redux", category: SKILLS_CATEGORIES.FRONTEND },
  { name: "GraphQL", category: SKILLS_CATEGORIES.FRONTEND },

  // Backend
  { name: "Node.js", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Express.js", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Django", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Flask", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Ruby on Rails", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Spring Boot", category: SKILLS_CATEGORIES.BACKEND },
  { name: "ASP.NET Core", category: SKILLS_CATEGORIES.BACKEND },
  { name: "Laravel", category: SKILLS_CATEGORIES.BACKEND },
  { name: "REST APIs", category: SKILLS_CATEGORIES.BACKEND },

  // Bases de Datos
  { name: "PostgreSQL", category: SKILLS_CATEGORIES.DATABASES },
  { name: "MySQL", category: SKILLS_CATEGORIES.DATABASES },
  { name: "MongoDB", category: SKILLS_CATEGORIES.DATABASES },
  { name: "Redis", category: SKILLS_CATEGORIES.DATABASES },
  { name: "Firebase", category: SKILLS_CATEGORIES.DATABASES },
  { name: "Supabase", category: SKILLS_CATEGORIES.DATABASES },

  // Mobile
  { name: "React Native", category: SKILLS_CATEGORIES.MOBILE },
  { name: "Flutter", category: SKILLS_CATEGORIES.MOBILE },
  { name: "Swift (iOS)", category: SKILLS_CATEGORIES.MOBILE },
  { name: "Kotlin (Android)", category: SKILLS_CATEGORIES.MOBILE },

  // DevOps & Cloud
  { name: "Docker", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "Kubernetes", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "AWS", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "Google Cloud", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "Microsoft Azure", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "CI/CD", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "GitHub Actions", category: SKILLS_CATEGORIES.DEVOPS },
  { name: "Terraform", category: SKILLS_CATEGORIES.DEVOPS },

  // Testing
  { name: "Jest", category: SKILLS_CATEGORIES.TESTING },
  { name: "Cypress", category: SKILLS_CATEGORIES.TESTING },
  { name: "Playwright", category: SKILLS_CATEGORIES.TESTING },
  { name: "JUnit", category: SKILLS_CATEGORIES.TESTING },
  
  // Herramientas y Software
  { name: "Git", category: SKILLS_CATEGORIES.TOOLS },
  { name: "GitHub", category: SKILLS_CATEGORIES.TOOLS },
  { name: "VS Code", category: SKILLS_CATEGORIES.TOOLS },
  { name: "Jira", category: SKILLS_CATEGORIES.TOOLS },
  { name: "Notion", category: SKILLS_CATEGORIES.TOOLS },
  { name: "Postman", category: SKILLS_CATEGORIES.TOOLS },

  // Diseño
  { name: "Figma", category: SKILLS_CATEGORIES.DESIGN },
  { name: "Adobe XD", category: SKILLS_CATEGORIES.DESIGN },
  { name: "Sketch", category: SKILLS_CATEGORIES.DESIGN },

  // Habilidades Blandas
  { name: "Comunicación", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Trabajo en Equipo", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Resolución de Problemas", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Liderazgo", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Gestión del Tiempo", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Adaptabilidad", category: SKILLS_CATEGORIES.SOFT_SKILLS },
  { name: "Pensamiento Crítico", category: SKILLS_CATEGORIES.SOFT_SKILLS },
];

############################## FIN DEL ARCHIVO: lib\skills.ts ##################################

############################## INICIO DEL ARCHIVO: lib\utils.ts ##############################

import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}


############################## FIN DEL ARCHIVO: lib\utils.ts ##################################

############################## INICIO DEL ARCHIVO: messages\en.json ##############################

{
  "LoginForm": {
    "welcome": "Welcome back!",
    "signInToContinue": "Sign in to continue to Jello",
    "emailLabel": "Email",
    "passwordLabel": "Password",
    "rememberMe": "Remember me",
    "signInButton": "Sign in",
    "signingInButton": "Signing in...",
    "orContinueWith": "Or continue with",
    "noAccount": "Don't have an account?",
    "signUpLink": "Sign up"
  },
  "Sidebar": {
    "dashboard": "Dashboard",
    "search": "Search",
    "projects": "Projects",
    "myTasks": "My Tasks",
    "todos": "Todos",
    "createProject": "Create Project"
  },
  "Dashboard": {
    "greeting": "Good morning, {name}!",
    "subtitle": "Here's what's happening with your projects today.",
    "newProject": "New Project",
    "recentProjects": "Recent Projects",
    "viewAllProjects": "View all projects"
  }
}

############################## FIN DEL ARCHIVO: messages\en.json ##################################

############################## INICIO DEL ARCHIVO: messages\es.json ##############################

{
  "LoginForm": {
    "welcome": "¡Bienvenido de nuevo!",
    "signInToContinue": "Inicia sesión para continuar en Jello",
    "emailLabel": "Correo electrónico",
    "passwordLabel": "Contraseña",
    "rememberMe": "Recordarme",
    "signInButton": "Iniciar sesión",
    "signingInButton": "Iniciando sesión...",
    "orContinueWith": "O continuar con",
    "noAccount": "¿No tienes una cuenta?",
    "signUpLink": "Regístrate"
  },
  "Sidebar": {
    "dashboard": "Panel",
    "search": "Buscar",
    "projects": "Proyectos",
    "myTasks": "Mis Tareas",
    "todos": "Personales",
    "createProject": "Crear Proyecto"
  },
  "Dashboard": {
    "greeting": "¡Buenos días, {name}!",
    "subtitle": "Esto es lo que está pasando hoy con tus proyectos.",
    "newProject": "Nuevo Proyecto",
    "recentProjects": "Proyectos Recientes",
    "viewAllProjects": "Ver todos los proyectos"
  }
}

############################## FIN DEL ARCHIVO: messages\es.json ##################################

############################## INICIO DEL ARCHIVO: next-env.d.ts ##############################

/// <reference types="next" />
/// <reference types="next/image-types/global" />

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/building-your-application/configuring/typescript for more information.


############################## FIN DEL ARCHIVO: next-env.d.ts ##################################

############################## INICIO DEL ARCHIVO: next.config.mjs ##############################

/** @type {import('next').NextConfig} */
const nextConfig = {
  eslint: {
    ignoreDuringBuilds: true,
  },
  typescript: {
    ignoreBuildErrors: true,
  },
  images: {
    unoptimized: true,
  },
}

export default nextConfig


############################## FIN DEL ARCHIVO: next.config.mjs ##################################

############################## INICIO DEL ARCHIVO: package.json ##############################

{
  "name": "jello-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "build": "next build",
    "dev": "next dev",
    "lint": "next lint",
    "start": "next start",
    "test": "jest --watch"
  },
  "dependencies": {
    "@emotion/is-prop-valid": "latest",
    "@hello-pangea/dnd": "^18.0.1",
    "@hookform/resolvers": "^3.10.0",
    "@mlc-ai/web-llm": "^0.2.79",
    "@radix-ui/react-accordion": "1.2.2",
    "@radix-ui/react-alert-dialog": "1.1.4",
    "@radix-ui/react-aspect-ratio": "1.1.1",
    "@radix-ui/react-avatar": "latest",
    "@radix-ui/react-checkbox": "latest",
    "@radix-ui/react-collapsible": "1.1.2",
    "@radix-ui/react-context-menu": "2.2.4",
    "@radix-ui/react-dialog": "latest",
    "@radix-ui/react-dropdown-menu": "2.1.4",
    "@radix-ui/react-hover-card": "1.1.4",
    "@radix-ui/react-label": "2.1.1",
    "@radix-ui/react-menubar": "1.1.4",
    "@radix-ui/react-navigation-menu": "1.2.3",
    "@radix-ui/react-popover": "1.1.4",
    "@radix-ui/react-progress": "1.1.1",
    "@radix-ui/react-radio-group": "1.2.2",
    "@radix-ui/react-scroll-area": "1.2.2",
    "@radix-ui/react-select": "latest",
    "@radix-ui/react-separator": "1.1.1",
    "@radix-ui/react-slider": "1.2.2",
    "@radix-ui/react-slot": "latest",
    "@radix-ui/react-switch": "1.1.2",
    "@radix-ui/react-tabs": "1.1.2",
    "@radix-ui/react-toast": "latest",
    "@radix-ui/react-toggle": "1.1.1",
    "@radix-ui/react-toggle-group": "1.1.1",
    "@radix-ui/react-tooltip": "latest",
    "@remix-run/react": "latest",
    "@sveltejs/kit": "latest",
    "@vercel/analytics": "latest",
    "autoprefixer": "^10.4.20",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "1.0.4",
    "date-fns": "latest",
    "embla-carousel-react": "8.5.1",
    "framer-motion": "latest",
    "geist": "^1.3.1",
    "input-otp": "1.4.1",
    "lucide-react": "^0.454.0",
    "next": "14.2.16",
    "next-intl": "^4.3.12",
    "next-themes": "latest",
    "react": "^18",
    "react-day-picker": "9.8.0",
    "react-dom": "^18",
    "react-hook-form": "^7.60.0",
    "react-resizable-panels": "^2.1.7",
    "recharts": "2.15.4",
    "sonner": "^1.7.4",
    "svelte": "latest",
    "tailwind-merge": "^2.5.5",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.9",
    "vue": "latest",
    "vue-router": "latest",
    "zod": "3.25.67"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4.1.9",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^14.6.1",
    "@types/jest": "^30.0.0",
    "@types/node": "^22",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "jest": "^30.2.0",
    "jest-environment-jsdom": "^30.2.0",
    "postcss": "^8.5",
    "tailwindcss": "^4.1.9",
    "ts-jest": "^29.4.4",
    "tw-animate-css": "1.3.3",
    "typescript": "^5"
  }
}

############################## FIN DEL ARCHIVO: package.json ##################################

############################## INICIO DEL ARCHIVO: postcss.config.mjs ##############################

/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}

export default config


############################## FIN DEL ARCHIVO: postcss.config.mjs ##################################

############################## INICIO DEL ARCHIVO: public\llm-worker.js ##############################

import { CreateMLCEngine } from "https://esm.run/@mlc-ai/web-llm";

let engine;

self.onmessage = async (event) => {
  const { type, payload } = event.data;

  // --- Comando para cargar el modelo (sin cambios) ---
  if (type === 'load') {
    if (engine) {
      self.postMessage({ type: 'load-complete' });
      return;
    }
    try {
      engine = await CreateMLCEngine("TinyLlama-1.1B-Chat-v1.0-q4f16_1-MLC", {
        initProgressCallback: (progress) => {
          self.postMessage({ type: 'load-progress', payload: progress });
        },
      });
      self.postMessage({ type: 'load-complete' });
    } catch (error) {
      self.postMessage({ type: 'load-error', payload: error.message });
    }
  }

  // --- Comando de Chat (Ahora recibe un historial) ---
  if (type === 'chat') {
    if (!engine) {
      self.postMessage({ type: 'chat-error', payload: "Engine not initialized." });
      return;
    }
    try {
      const chunks = await engine.chat.completions.create({
        // 👇 CAMBIO CLAVE: Usa el historial completo en lugar de un solo prompt
        messages: payload.history, 
        stream: true,
      });
      for await (const chunk of chunks) {
        self.postMessage({ type: 'chat-chunk', payload: chunk.choices[0]?.delta?.content || "" });
      }
      self.postMessage({ type: 'chat-complete' });
    } catch (error) {
      self.postMessage({ type: 'chat-error', payload: error.message });
    }
  }

  // --- NUEVO COMANDO: Resetear la conversación ---
  if (type === 'reset') {
    if (engine) {
      await engine.reset();
      self.postMessage({ type: 'reset-complete' });
    }
  }
};

############################## FIN DEL ARCHIVO: public\llm-worker.js ##################################

############################## INICIO DEL ARCHIVO: public\Nuevo Text Document.svg ##############################


<svg version="1.1" viewBox="0 0 1488 1488" width="372" height="372" xmlns="http://www.w3.org/2000/svg">
<path transform="translate(598,35)" d="m0 0h160l80 2 58 3 61 4 41 4 39 5 35 6 37 8 29 8 26 9 23 10 21 11 17 11 12 9 14 12 22 22 11 14 12 18 10 18 7 15 12 31 9 29 11 42 18 79 13 61 12 64 15 76 14 75 11 57 15 79 13 73 5 39 1 10v37l-5 28-6 20-10 24-12 22-11 16-9 11-18 20-13 12-11 9-13 10-18 12-15 9-18 10-23 12-25 11-34 13-24 8 3 2 13 4 31 7 42 12 22 8 18 8 17 9 13 10 7 7 5 10v12l-5 10-6 7-11 8-16 9-20 9-30 10-26 7-30 7-41 8-45 7-56 7-77 7-43 3-40 2-90 3-60 1h-50l-62-1-101-3-69-4-69-6-47-5-42-6-39-6-45-9-36-9-26-8-19-7-20-9-15-9-10-9-6-7-3-9v-8l3-8 4-6 9-9 15-10 17-9 23-9 24-8 60-15 21-5 1-1-16-5-38-9-33-10-27-10-25-11-21-11-18-12-13-10-15-13-10-10-7-8-13-17-9-14-11-21-8-22-5-21-3-21v-20l3-37 8-59 12-77 12-70 12-63 15-75 14-66 16-74 15-66 17-67 12-42 11-32 13-30 11-20 8-12 12-16 11-12 7-8 15-14 14-11 18-12 20-12 16-8 32-14 36-12 37-10 39-8 49-8 51-5z" fill="#54C6EC"/>
<path transform="translate(598,35)" d="m0 0h160l80 2 58 3 61 4 41 4 39 5 35 6 37 8 29 8 26 9 23 10 21 11 17 11 12 9 14 12 22 22 11 14 12 18 10 18 7 15 12 31 9 29 11 42 18 79 13 61 12 64 15 76 14 75 11 57 15 79 13 73 5 39 1 10v37l-5 28-6 20-10 24-12 22-11 16-9 11-18 20-13 12-11 9-13 10-18 12-15 9-18 10-23 12-25 11-34 13-24 8 3 2 13 4 31 7 42 12 22 8 18 8 17 9 13 10 7 7 5 10v12l-5 10-6 7-11 8-16 9-20 9-30 10-26 7-30 7-41 8-45 7-56 7-77 7-43 3-40 2-90 3-60 1h-50l-62-1-101-3-69-4-69-6-47-5-42-6-39-6-45-9-36-9-26-8-19-7-20-9-15-9-10-9-6-7-3-9v-8l3-8 4-6 9-9 15-10 17-9 23-9 24-8 60-15 21-5 1-1-16-5-38-9-33-10-27-10-25-11-21-11-18-12-13-10-15-13-10-10-7-8-13-17-9-14-11-21-8-22-5-21-3-21v-20l3-37 8-59 12-77 12-70 12-63 15-75 14-66 16-74 15-66 17-67 12-42 11-32 13-30 11-20 8-12 12-16 11-12 7-8 15-14 14-11 18-12 20-12 16-8 32-14 36-12 37-10 39-8 49-8 51-5zm15 34-55 3-49 5-35 5-33 6-37 9-27 8-28 10-27 12-19 10-19 12-17 13-14 12-10 10-9 11-10 13-9 15-7 12-9 21-12 34-12 42-8 30-12 49-12 53-16 74-16 77-12 60-12 64-9 51-10 61-9 62-5 44-1 14v25l3 21 5 19 7 16 7 13 13 19 14 15 14 14 17 13 15 10 27 14 27 11 27 9 29 8 41 9 54 10 64 10 41 5 54 5 84 6 64 4 84 4 30 1h73l-2-2 38-9 21-6 29-11 29-14 17-10 16-11 14-11 10-9 14-14 7-8 11-14 9-13 8-13 9-17 10-27 6-24 3-19 2-22v-43l-2-34-5-55-8-76-8-79-8-72-5-43-10-80-6-41-8-42-6-22-8-18-8-11-9-11-4-3 1-3 6-1 8-4 20-7 26-11 29-14 22-12 19-12 19-13 13-10 11-9 4-3v-2l4-2 20-20 7-8 9-12 7-9 7-11 2-3 1-6-4-5-3-5-13-11-18-13-19-11-16-8-21-9-24-8-31-8-29-6-39-6-52-6-49-4-69-4-66-2-47-1z" fill="#37A3D8"/>
<path transform="translate(285,1219)" d="m0 0 15 1 35 7 54 9 44 6 45 5 45 4 54 4 67 4 86 4 77 3 22 1 48 1h42l30-1 49-4 40-5 36-6 35-7 34-8 51-14 6 2 13 4 31 7 42 12 22 8 18 8 17 9 13 10 7 7 5 10v12l-5 10-6 7-11 8-16 9-20 9-30 10-26 7-30 7-41 8-45 7-56 7-77 7-43 3-40 2-90 3-60 1h-50l-62-1-101-3-69-4-69-6-47-5-42-6-39-6-45-9-36-9-26-8-19-7-20-9-15-9-10-9-6-7-3-9v-8l3-8 4-6 9-9 15-10 17-9 23-9 24-8 60-15 21-5 1-1-5-2z" fill="#5BAEE1"/>
<path transform="translate(598,35)" d="m0 0h160l80 2 58 3 61 4 41 4 39 5 35 6 37 8 29 8 26 9 23 10 21 11 17 11 12 9 14 12 22 22 11 14 12 18 10 18 7 15 12 31 9 29 11 42 18 79 13 61 12 64 15 76 14 75 11 57 15 79 13 73 5 39 1 10v37l-5 28-6 20-10 24-12 22-11 16-9 11-18 20-13 12-11 9-13 10-18 12-15 9-18 10-23 12-25 11-34 13-31 10-55 15-35 8-43 8-34 5-36 4-38 3-30 1h-42l-48-1-69-3-53-2-82-4-75-5-60-5-49-5-45-6-49-8-33-6-14-3-18-2-46-11-33-10-27-10-25-11-21-11-18-12-13-10-15-13-10-10-7-8-13-17-9-14-11-21-8-22-5-21-3-21v-20l3-37 8-59 12-77 12-70 12-63 15-75 14-66 16-74 15-66 17-67 12-42 11-32 13-30 11-20 8-12 12-16 11-12 7-8 15-14 14-11 18-12 20-12 16-8 32-14 36-12 37-10 39-8 49-8 51-5zm15 34-55 3-49 5-35 5-33 6-37 9-27 8-28 10-27 12-19 10-19 12-17 13-14 12-10 10-9 11-10 13-9 15-7 12-9 21-12 34-12 42-8 30-12 49-12 53-16 74-16 77-12 60-12 64-9 51-10 61-9 62-5 44-1 14v25l3 21 5 19 7 16 7 13 13 19 14 15 14 14 17 13 15 10 27 14 27 11 27 9 29 8 41 9 54 10 64 10 41 5 54 5 84 6 64 4 84 4 59 2 45 1h87l37-2 49-5 39-6 42-8 30-7 49-14 38-13 24-10 29-13 23-12 19-11 22-15 14-11 10-9 12-11 9-10 11-14 11-17 11-21 5-13 6-21 2-14 1-22-2-30-4-32-6-37-13-68-12-62-12-64-12-62-5-25-13-67-5-26-7-35-9-43-7-30-6-26-11-44-7-23-7-22-8-20-8-17-10-17-11-15-9-11-14-14-11-9-16-12-20-12-15-8-24-10-24-8-31-8-29-6-39-6-52-6-49-4-69-4-66-2-47-1z" fill="#1C508B"/>
<path transform="translate(300,329)" d="m0 0h22l12 4 5 6 1 2v13l-5 10-12 12-11 7-8 6-10 8-6 5-1 2h-2l-2 4-10 13-11 21-13 34-8 25-8 27-12 47-8 33-10 43-9 37-7 33-8 38-8 36-7 27-9 28-4 10-2 2-4-1-2-63v-14l2-42 4-43 4-30 4-25 8-40 8-36 9-40 6-28 11-42 13-40 10-24 10-19 10-13 6-7 8-7 10-7 14-7z" fill="#B9F4FF"/>
<path transform="translate(436,292)" d="m0 0 25 1 100 10 62 5 42 3 65 3 35 1h98l41-2 42-4 35-5 15-1 10 2 9 5 4 5 2 4v13l-4 7-7 5-17 5-26 5-23 3-24 2-20 1h-106l-38-1-53-3-48-4-41-5-40-6-41-8-36-9-23-7-20-8-15-9-4-5z" fill="#B9F4FF"/>
<path transform="translate(802,586)" d="m0 0h19l13 4 13 8 10 9 9 12 6 13 4 16 2 23-1 17-3 16-6 16-6 10-9 11-12 10-14 7-16 4h-13l-12-3-10-5-12-11-9-14-6-18-2-9-1-10v-13l3-24 6-21 8-16 7-11 9-9 10-7z" fill="#1B4F8A"/>
<path transform="translate(393,553)" d="m0 0h17l10 2 12 5 10 9 7 9 5 11 4 15 2 12v31l-3 20-5 19-6 14-8 12-5 5-8 7-11 4h-20l-15-4-15-8-12-11-7-10-5-11-5-19-1-8v-30l3-17 5-15 8-15 11-12 11-8 12-5z" fill="#1B4F8A"/>
<path transform="translate(360,163)" d="m0 0h28l16 3 12 4 10 6 6 7 3 8v13l-4 11-6 9-12 12-16 10-16 7-12 4-6 1h-24l-16-4-14-6-12-9-7-10-2-8v-11l4-12 7-9 9-8 10-6 14-6 9-3z" fill="#E8FBFE"/>
<path transform="translate(519,729)" d="m0 0h7l6 3 6 9 7 13 8 10 10 8 12 6 16 4h13l14-3 16-8 11-8 10-10 7-4h12l6 3 5 4 4 8v9l-4 9-8 11-11 10-14 9-15 7-14 4-16 2h-13l-19-3-18-6-16-8-11-7-13-12-8-9-6-10-3-7v-13l3-8 8-9z" fill="#1B4F8A"/>
<path transform="translate(474,176)" d="m0 0h9l11 4 6 7 2 4v13l-5 9-8 6-8 3h-8l-8-3-5-5-4-5-1-3v-12l4-8 8-7z" fill="#B9F4FF"/>
<path transform="translate(514,1218)" d="m0 0h24l106 7 100 5 59 2 45 1 5 1 84 1v1l-16 1-13 1h-41l-10-1h-14l-6 1-12-1-29-1-8-1-27 1h-36l-4-1v-2l-6 1-6-1-33-1-10 1-29-2-4-1-9-1-18-1h-22v-2l-3 1h-4l-7-2-11-1-5-1h-18l-8-1-7-2-7-1z" fill="#174582"/>
<path transform="translate(519,729)" d="m0 0h7l6 3 6 9 7 13 8 10 10 8 12 6 16 4h13l14-3 16-8 11-8 10-10 7-4h12l6 3 5 4 4 8v9l-4 9-8 11-11 10-14 9-15 7-14 4-16 2h-13l-19-3-18-6-16-8-11-7-13-12-8-9v-2l3 1 5 5 5 4 5 5 8 7 9 5 4 3 9 4 6 1v2l15 3 11 2 8 1h16l18-4 11-5 10-5 7-7 6-1v-2l8-7 6-7 3-3 3-8-1-9-1-4h-2v-3l-6-1-1-2-9-1-9 6-12 11h-2v2l-6 3-7 5-7 3-5 2-12 3h-10l-22-5-11-5-11-6-6-7-1-4h-2l-5-10-2-2-1-7h-2l-4-5-3-2v-2l-10 4-8 7-1 3h-2l-2 5h-1l1-7 6-8 8-6z" fill="#174582"/>
<path transform="translate(598,35)" d="m0 0h160l48 1 5 1-4 2h-8l-3-1v2l-9 1h-43l-2 1h-7l-7 1-6-2v2l-12-1-8-1v2h-3v-2h-11l-4-1v-2l-31 1-2 2-5-3v2h-7v-2l-15 1-4 1-13 1-14-1-6-2 2-2z" fill="#1A4B87"/>
<path transform="translate(393,553)" d="m0 0h17l10 2 12 5 10 9 7 9 5 11 4 15 2 12v31l-1 9-2 2-2-10h2l-1-7v-34h-2l-3-6-2-11h-2l-3-8-2-2v-4l-4-2-5-5-5-4-8-5-7-1-4-1v-2h-10l-9 2-11 3-14 8-3 3h-2l-2 4h-2l-2 5-4 7h-2l-2 6-3 6h-1l1-7 7-13 11-12 11-8 12-5z" fill="#174581"/>
<path transform="translate(802,586)" d="m0 0h19l13 4 13 8 10 9 9 12 6 13 4 16v23l-2-1-1-6-1-16v-3l-2-7-3-1-2-9-2-1-2-6-3-3v-2l-4-2-3-4-4-5-8-6-6-4-4-2-16-3v-2l-7 2-10 2-16 10-4 2-2 4h-2l-2 7-4 5h-2l-1 6-3 4-5 13-2 3 1-9 7-16 7-11 9-10 9-7 12-6z" fill="#174481"/>
<path transform="translate(875,683)" d="m0 0h1v12l-3 12-6 15-7 11-10 11-11 8-12 6-16 4h-13l-12-3-10-5-12-11-9-14-6-18v-8h1l4 14 4 9 5 9 8 10 9 7 8 4 11 2h14l16-5 7-6 7-3 11-10 6-9 3-3h2l1-9 3-3 2-7 1-2v-9z" fill="#174582"/>
<path transform="translate(456,660)" d="m0 0h1v7l-5 19-6 14-8 12-5 5-8 7-11 4h-20l-15-4-15-8-12-11-7-10-4-8v-5l3 1 4 9 5 10 3 1 4 5 11 8 14 6 16 3 13-1 4-3 9-3v-2l6-5 3-5 2-1v-2l2-2 2-1 1-5 5-12 1-4 4-8z" fill="#174582"/>
<path transform="translate(1454 1e3)" d="m0 0h1l-1 10-9 24-8 17-10 17-4 2-1-6 2-7 6-1-2-8v-3l2-1 3-7 5-3h3l1-7 3-3 1-7 2-2 2-9z" fill="#1B4B87"/>
<path transform="translate(749,703)" d="m0 0h1l4 14 4 9 5 9 8 10 9 7 8 4 11 2h13l4 3-5 1h-13l-12-3-10-5-12-11-9-14-6-18z" fill="#184683"/>
<path transform="translate(393,553)" d="m0 0h17l-4 2-7 1-9 2-11 3-14 8-3 3h-2l-2 4h-2l-2 5-4 7h-2l-2 6-3 6h-1l1-7 7-13 11-12 11-8 12-5z" fill="#174682"/>
<path transform="translate(1235,126)" d="m0 0 5 1 16 15 17 17 5 7-3 1-7-6-4-4v-2l-4-2-5-6-4-3-5-4v-2h-3l-3-5z" fill="#265891"/>
<path transform="translate(641,65)" d="m0 0h37l5 1h17l1 2h-86v-1l6-1z" fill="#174481"/>
<path transform="translate(863,1235)" d="m0 0h74v1l-16 1-13 1h-41l-4-1z" fill="#174481"/>
<path transform="translate(514,1218)" d="m0 0h24l43 3v1h-24l-3 1h-18l-8-1-7-2-7-1z" fill="#184884"/>
<path transform="translate(1204,223)" d="m0 0v3l-21 21h-2v2l-11 9-18 14-12 8-2-1 8-6 6-5 5-3 10-8 8-6 5-5 12-11z" fill="#5CAEE1"/>
<path transform="translate(782,596)" d="m0 0m-1 1m-2 1 2 1-4 4-3 5h-2l-2 7-4 5h-2l-1 6-3 4-5 13-2 3 1-9 7-16 7-11 9-10z" fill="#184683"/>
<path transform="translate(360,163)" d="m0 0h28l7 1v1h-28l-19 2-17 5-12 5-7 4-2-1 8-5 14-6 9-3z" fill="#B9F4FF"/>
<path transform="translate(560,37)" d="m0 0h25l-4 2-3 3-8 1-4-1v-2h-12l1-2z" fill="#174481"/>
<path transform="translate(264,164)" d="m0 0 2 1-12 13-13 13-5 3 2-4 14-15z" fill="#44ADDE"/>
<path transform="translate(308,181)" d="m0 0 2 1-5 5h-2v2h-2l-2 4-6 8-3 12 1 11 2 8-3-3-2-8v-11l4-12 7-9z" fill="#B9F4FF"/>
<path transform="translate(1327,1157)" d="m0 0 3 1v6l-12 6v-4l-2-1 2-2 1-2z" fill="#1A4A86"/>
<path transform="translate(1431,1060)" d="m0 0h1v5l-7 10h-2l-1-6 2-7z" fill="#194884"/>
<path transform="translate(1212,109)" d="m0 0 5 2 11 7 1 2-1 3-5-2-2-3-9-3-1-5z" fill="#23548E"/>
<path transform="translate(1347,1144)" d="m0 0 2 2-3 4h-2v5l-4 1-4-2v2l-4-1 3-1 2-4 6-1 2-4z" fill="#184582"/>
<path transform="translate(1369,1126)" d="m0 0h3l1 5-5 2-3 4v2l-4-1 1-7 5-3h2z" fill="#174481"/>
<path transform="translate(428,179)" d="m0 0 4 4 3 8v13l-2 4v-16l-5-11z" fill="#B9F4FF"/>
<path transform="translate(1433,775)" d="m0 0 2 1 2 9v8l-2-1-2-9z" fill="#1A4A86"/>
<path transform="translate(1279,171)" d="m0 0 5 2 5 7-1 2-8-6z" fill="#21538E"/>
<path transform="translate(393,553)" d="m0 0h17l-4 2-7 1h-7z" fill="#194985"/>
<path transform="translate(1405,630)" d="m0 0h2l2 8v7l-4-5z" fill="#1B4D89"/>
<path transform="translate(867,39)" d="m0 0h14l-3 3-4 1-7-2z" fill="#225994"/>
<path transform="translate(1438,795)" d="m0 0h1l2 11v4l-3-1v-5l-2-2 1-5z" fill="#1E518D"/>
<path transform="translate(365,565)" d="m0 0m-2 1 2 1-4 4-3 5-5 2 2-4z" fill="#184884"/>
<path transform="translate(337,667)" d="m0 0 2 2 3 12h-3l-2-7z" fill="#184783"/>
<path transform="translate(782,596)" d="m0 0m-1 1m-2 1 2 1-4 4-3 5-4 1 2-4z" fill="#184783"/>
<path transform="translate(993,349)" d="m0 0 2 1-3 2-9 2h-8v-1z" fill="#5CAEE1"/>
<path transform="translate(838,1229)" d="m0 0h7l2 3h-11l-1-2z" fill="#5CAEE1"/>
<path transform="translate(1370,1130)" d="m0 0 2 1v3l-7 5-1-3 4-4h2z" fill="#235D97"/>
<path transform="translate(879,40)" d="m0 0 11 1-2 2-5 1-4-2z" fill="#174481"/>
</svg>


############################## FIN DEL ARCHIVO: public\Nuevo Text Document.svg ##################################

############################## INICIO DEL ARCHIVO: public\placeholder-logo.svg ##############################

<svg xmlns="http://www.w3.org/2000/svg" width="215" height="48" fill="none"><path fill="#000" d="M57.588 9.6h6L73.828 38h-5.2l-2.36-6.88h-11.36L52.548 38h-5.2l10.24-28.4Zm7.16 17.16-4.16-12.16-4.16 12.16h8.32Zm23.694-2.24c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.486-7.72.12 3.4c.534-1.227 1.307-2.173 2.32-2.84 1.04-.693 2.267-1.04 3.68-1.04 1.494 0 2.76.387 3.8 1.16 1.067.747 1.827 1.813 2.28 3.2.507-1.44 1.294-2.52 2.36-3.24 1.094-.747 2.414-1.12 3.96-1.12 1.414 0 2.64.307 3.68.92s1.84 1.52 2.4 2.72c.56 1.2.84 2.667.84 4.4V38h-4.96V25.92c0-1.813-.293-3.187-.88-4.12-.56-.96-1.413-1.44-2.56-1.44-.906 0-1.68.213-2.32.64-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.84-.48 3.04V38h-4.56V25.92c0-1.2-.133-2.213-.4-3.04-.24-.827-.626-1.453-1.16-1.88-.506-.427-1.133-.64-1.88-.64-.906 0-1.68.227-2.32.68-.64.427-1.133 1.053-1.48 1.88-.32.827-.48 1.827-.48 3V38h-4.96V16.8h4.48Zm26.723 10.6c0-2.24.427-4.187 1.28-5.84.854-1.68 2.067-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.84 0 3.494.413 4.96 1.24 1.467.827 2.64 2.08 3.52 3.76.88 1.653 1.347 3.693 1.4 6.12v1.32h-15.08c.107 1.813.614 3.227 1.52 4.24.907.987 2.134 1.48 3.68 1.48.987 0 1.88-.253 2.68-.76a4.803 4.803 0 0 0 1.84-2.2l5.08.36c-.64 2.027-1.84 3.64-3.6 4.84-1.733 1.173-3.733 1.76-6 1.76-2.08 0-3.906-.453-5.48-1.36-1.573-.907-2.786-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84Zm15.16-2.04c-.213-1.733-.76-3.013-1.64-3.84-.853-.827-1.893-1.24-3.12-1.24-1.44 0-2.6.453-3.48 1.36-.88.88-1.44 2.12-1.68 3.72h9.92ZM163.139 9.6V38h-5.04V9.6h5.04Zm8.322 7.2.24 5.88-.64-.36c.32-2.053 1.094-3.56 2.32-4.52 1.254-.987 2.787-1.48 4.6-1.48 2.32 0 4.107.733 5.36 2.2 1.254 1.44 1.88 3.387 1.88 5.84V38h-4.96V25.92c0-1.253-.12-2.28-.36-3.08-.24-.8-.64-1.413-1.2-1.84-.533-.427-1.253-.64-2.16-.64-1.44 0-2.573.48-3.4 1.44-.8.933-1.2 2.307-1.2 4.12V38h-4.96V16.8h4.48Zm30.003 7.72c-.186-1.307-.706-2.32-1.56-3.04-.853-.72-1.866-1.08-3.04-1.08-1.68 0-2.986.613-3.92 1.84-.906 1.227-1.36 2.947-1.36 5.16s.454 3.933 1.36 5.16c.934 1.227 2.24 1.84 3.92 1.84 1.254 0 2.307-.373 3.16-1.12.854-.773 1.387-1.867 1.6-3.28l5.12.24c-.186 1.68-.733 3.147-1.64 4.4-.906 1.227-2.08 2.173-3.52 2.84-1.413.667-2.986 1-4.72 1-2.08 0-3.906-.453-5.48-1.36-1.546-.907-2.76-2.2-3.64-3.88-.853-1.68-1.28-3.627-1.28-5.84 0-2.24.427-4.187 1.28-5.84.88-1.68 2.094-2.973 3.64-3.88 1.574-.907 3.4-1.36 5.48-1.36 1.68 0 3.227.32 4.64.96 1.414.64 2.56 1.56 3.44 2.76.907 1.2 1.454 2.6 1.64 4.2l-5.12.28Zm11.443 8.16V38h-5.6v-5.32h5.6Z"/><path fill="#171717" fill-rule="evenodd" d="m7.839 40.783 16.03-28.054L20 6 0 40.783h7.839Zm8.214 0H40L27.99 19.894l-4.02 7.032 3.976 6.914H20.02l-3.967 6.943Z" clip-rule="evenodd"/></svg>

############################## FIN DEL ARCHIVO: public\placeholder-logo.svg ##################################

############################## INICIO DEL ARCHIVO: public\placeholder.svg ##############################

<svg xmlns="http://www.w3.org/2000/svg" width="1200" height="1200" fill="none"><rect width="1200" height="1200" fill="#EAEAEA" rx="3"/><g opacity=".5"><g opacity=".5"><path fill="#FAFAFA" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 736.5c-75.454 0-136.621-61.167-136.621-136.62 0-75.454 61.167-136.621 136.621-136.621 75.453 0 136.62 61.167 136.62 136.621 0 75.453-61.167 136.62-136.62 136.62Z"/></g><path stroke="url(#a)" stroke-width="2.418" d="M0-1.209h553.581" transform="scale(1 -1) rotate(45 1163.11 91.165)"/><path stroke="url(#b)" stroke-width="2.418" d="M404.846 598.671h391.726"/><path stroke="url(#c)" stroke-width="2.418" d="M599.5 795.742V404.017"/><path stroke="url(#d)" stroke-width="2.418" d="m795.717 796.597-391.441-391.44"/><path fill="#fff" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/><g clip-path="url(#e)"><path fill="#666" fill-rule="evenodd" d="M616.426 586.58h-31.434v16.176l3.553-3.554.531-.531h9.068l.074-.074 8.463-8.463h2.565l7.18 7.181V586.58Zm-15.715 14.654 3.698 3.699 1.283 1.282-2.565 2.565-1.282-1.283-5.2-5.199h-6.066l-5.514 5.514-.073.073v2.876a2.418 2.418 0 0 0 2.418 2.418h26.598a2.418 2.418 0 0 0 2.418-2.418v-8.317l-8.463-8.463-7.181 7.181-.071.072Zm-19.347 5.442v4.085a6.045 6.045 0 0 0 6.046 6.045h26.598a6.044 6.044 0 0 0 6.045-6.045v-7.108l1.356-1.355-1.282-1.283-.074-.073v-17.989h-38.689v23.43l-.146.146.146.147Z" clip-rule="evenodd"/></g><path stroke="#C9C9C9" stroke-width="2.418" d="M600.709 656.704c-31.384 0-56.825-25.441-56.825-56.824 0-31.384 25.441-56.825 56.825-56.825 31.383 0 56.824 25.441 56.824 56.825 0 31.383-25.441 56.824-56.824 56.824Z"/></g><defs><linearGradient id="a" x1="554.061" x2="-.48" y1=".083" y2=".087" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="b" x1="796.912" x2="404.507" y1="599.963" y2="599.965" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="c" x1="600.792" x2="600.794" y1="403.677" y2="796.082" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><linearGradient id="d" x1="404.85" x2="796.972" y1="403.903" y2="796.02" gradientUnits="userSpaceOnUse"><stop stop-color="#C9C9C9" stop-opacity="0"/><stop offset=".208" stop-color="#C9C9C9"/><stop offset=".792" stop-color="#C9C9C9"/><stop offset="1" stop-color="#C9C9C9" stop-opacity="0"/></linearGradient><clipPath id="e"><path fill="#fff" d="M581.364 580.535h38.689v38.689h-38.689z"/></clipPath></defs></svg>

############################## FIN DEL ARCHIVO: public\placeholder.svg ##################################

############################## INICIO DEL ARCHIVO: public\site.webmanifest ##############################

{"name":"","short_name":"","icons":[{"src":"/android-chrome-192x192.png","sizes":"192x192","type":"image/png"},{"src":"/android-chrome-512x512.png","sizes":"512x512","type":"image/png"}],"theme_color":"#ffffff","background_color":"#ffffff","display":"standalone"}

############################## FIN DEL ARCHIVO: public\site.webmanifest ##################################

############################## INICIO DEL ARCHIVO: README.md ##############################

# Jello-Frontend


############################## FIN DEL ARCHIVO: README.md ##################################

############################## INICIO DEL ARCHIVO: styles\globals.css ##############################

@import 'tailwindcss';
@import 'tw-animate-css';

@custom-variant dark (&:is(.dark *));

:root {
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --destructive-foreground: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.646 0.222 41.116);
  --chart-2: oklch(0.6 0.118 184.704);
  --chart-3: oklch(0.398 0.07 227.392);
  --chart-4: oklch(0.828 0.189 84.429);
  --chart-5: oklch(0.769 0.188 70.08);
  --radius: 0.625rem;
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  
  --glass-background: oklch(14.479% 0.00002 271.152 / 0.589);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.145 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.145 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.985 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.396 0.141 25.723);
  --destructive-foreground: oklch(0.637 0.237 25.331);
  --border: oklch(0.269 0 0);
  --input: oklch(0.269 0 0);
  --ring: oklch(0.439 0 0);
  --chart-1: oklch(0.488 0.243 264.376);
  --chart-2: oklch(0.696 0.17 162.48);
  --chart-3: oklch(0.769 0.188 70.08);
  --chart-4: oklch(0.627 0.265 303.9);
  --chart-5: oklch(0.645 0.246 16.439);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(0.269 0 0);
  --sidebar-ring: oklch(0.439 0 0);
}

@theme inline {
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-destructive-foreground: var(--destructive-foreground);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --color-chart-1: var(--chart-1);
  --color-chart-2: var(--chart-2);
  --color-chart-3: var(--chart-3);
  --color-chart-4: var(--chart-4);
  --color-chart-5: var(--chart-5);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
  --color-sidebar: var(--sidebar);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-ring: var(--sidebar-ring);
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }
  body {
    @apply bg-background text-foreground;
  }
}


############################## FIN DEL ARCHIVO: styles\globals.css ##################################

############################## INICIO DEL ARCHIVO: tsconfig.json ##############################

{
  "compilerOptions": {
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "target": "ES6",
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./*"]
    },
    "types": ["jest", "node", "@testing-library/jest-dom"] 
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules"]
}


############################## FIN DEL ARCHIVO: tsconfig.json ##################################

############################## INICIO DEL ARCHIVO: types\global.d.ts ##############################

// Jello-Frontend/types/globals.d.ts

/**
 * Extiende la interfaz global Window para incluir la API de IA nativa de Chrome,
 * evitando así errores de TypeScript al acceder a `window.ai`.
 */
declare global {
  interface Window {
    ai?: {
      canCreateTextSession: (
        model: string
      ) => Promise<'readily' | 'after-download' | 'no'>;
      createTextSession: () => Promise<AITextSession>;
    };
  }

  /**
   * Define el tipo para la sesión de texto de la IA.
   */
  interface AITextSession {
    promptStreaming: (prompt: string) => AsyncIterable<string>;
    destroy: () => void;
  }
}

// Exportar un objeto vacío asegura que este archivo sea tratado como un módulo.
export {};

############################## FIN DEL ARCHIVO: types\global.d.ts ##################################

############################## INICIO DEL ARCHIVO: types\index.ts ##############################

// -------------------- USUARIOS --------------------
export interface UserSummary {
  id: string;
  name: string;
  avatarUrl: string | null;
}

export interface UserProfile extends UserSummary {
  email: string;
  bannerUrl: string | null;
  title: string | null;
  bio: string | null;
  timezone: string | null;
  skills: string[];
}

export interface UserSettings {
  notifications: {
    tasks: { email: boolean; push: boolean; inApp: boolean };
    meetings: { email: boolean; push: boolean; inApp: boolean };
    team: { email: boolean; push: boolean; inApp: boolean };
    mentions: { email: boolean; push: boolean; inApp: boolean };
  };
  appearance: {
    theme: 'light' | 'dark' | 'system';
    accentColor: string;
    animations: boolean;
  };
}

// -------------------- PROYECTOS --------------------
export interface ProjectSummary {
  id: string;
  name: string;
  description: string;
  color: string;
  progress: number;
  members: UserSummary[];
  isOwner: boolean;
  dueDate: string | null;
  totalTasks: number;
  completedTasks: number;
  projectImageUrl: string | null;
  bannerImageUrl: string | null;  
}

export interface ProjectDetails extends ProjectSummary {
  tasksByStatus: {
    todo: TaskSummary[];
    'in-progress': TaskSummary[];
    review: TaskSummary[];
    done: TaskSummary[];
  };
}

// -------------------- TAREAS --------------------
export interface Subtask {
  id: string;
  text: string;
  completed: boolean;
}

export interface Label {
  _id: string;
  name: string;
  color: string;
}

export interface Attachment {
  _id: string;
  name: string;
  url: string;
  size: string;
  type: 'image' | 'document' | 'other';
}

export interface Comment {
  id: string;
  author: UserSummary;
  content: string;
  timestamp: string;
  attachmentUrl?: string; 
}

export type TaskPriority = 'low' | 'medium' | 'high' | 'critical';

export interface TaskSummary {
  id: string;
  title: string;
  description?: string | null;
  status: 'todo' | 'in-progress' | 'review' | 'done';
  priority: TaskPriority;
  labels: Label[];
  assignees: UserSummary[];
  dueDate: string | null;
  subtasks: {
    total: number;
    completed: number;
  };
  commentCount: number;
  attachmentCount: number;
  projectId: string;
}

export interface TaskDetails extends Omit<TaskSummary, 'subtasks' | 'commentCount' | 'attachmentCount'> {
  description: string | null;
  status: 'todo' | 'in-progress' | 'review' | 'done';
  subtasks: Subtask[];
  comments: Comment[];
  attachments: Attachment[];
}

// -------------------- OTROS --------------------
export interface Todo {
  _id: string;
  text: string;
  completed: boolean;
  priority: 'low' | 'medium' | 'high';
  category: string;
  dueDate: string | null;
  createdAt: string;
}

export interface Activity {
  id: string;
  type: 'comment' | 'completion' | 'join' | 'document';
  user: UserSummary;
  action: string;
  target: string;
  time: string;
  projectId: string;
}

export interface SearchResult {
  type: 'project' | 'user';
  id: string;
  name: string;
  description: string | null;
  avatar: string | null;
  skills?: string[];
  bannerUrl?: string;
}

/*------------------------ Notifications --------------------*/

export interface NotificationProjectSummary {
  _id: string
  name: string
}

export interface Notification {
  _id: string;
  recipient: string;
  sender: UserSummary;
  type:
    | "project_invitation"
    | "collaboration_request"
    | "task_created"
    | "task_assigned"
    | "task_status_changed"
    | "new_comment"
    | "invitation_accepted"
    | "invitation_declined"
    | "collaboration_accepted"
    | "collaboration_declined";
  status: "pending" | "accepted" | "declined" | "info"; 
  read: boolean;
  project: {
    _id: string;
    name: string;
  };
  task?: string;
  text: string; 
  link: string;
  createdAt: string;
  updatedAt: string;
}

export interface ApiError extends Error {
  response?: {
    status: number;
    data: {
      error: string;
      message?: string;
    };
  };
}

############################## FIN DEL ARCHIVO: types\index.ts ##################################
